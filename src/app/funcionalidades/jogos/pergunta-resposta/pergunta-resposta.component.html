<main class="pergunta-resposta container">

  <!-- Tela inicial: escolha a categoria + botão para cadastro -->
  <section *ngIf="!jogoIniciado" class="tela-inicial">
    <button class="btn-cadastrar" routerLink="/jogos/pergunta-resposta/cadastro">
      + Cadastrar nova pergunta
    </button>

    <h2 class="texto-pergunta">Escolha a categoria</h2>

    <ul class="lista-categorias">
      <li *ngFor="let cat of categorias">
        <button class="botao-pergunta" (click)="iniciarJogo(cat)">
          {{ cat }}
        </button>
      </li>
    </ul>
  </section>

  <!-- Tela do jogo em andamento -->
  <section *ngIf="jogoIniciado && !jogoFinalizado" class="jogo jogo-iniciado">
    <div class="pergunta">
      <div class="texto-pergunta">{{ perguntas[perguntaAtual].enunciado }}</div>

      <ul class="respostas-pergunta">
        <li *ngFor="let resp of perguntas[perguntaAtual].respostas; let i = index"
            [attr.data-selecionada]="respostaSelecionada === i ? 'true' : null"
            [class.correta]="jogoFinalizado && resp.correta"
            [class.errada]="jogoFinalizado && respostaSelecionada === i && !resp.correta">

          <input
            type="radio"
            [id]="'resp-'+i"
            name="respostas"
            [value]="i"
            [checked]="respostaSelecionada === i"
            (change)="selecionarResposta(i)"
            hidden
          />

          <div
            class="resposta-label"
            (click)="selecionarResposta(i)"
            tabindex="0"
            (keydown.enter)="selecionarResposta(i)"
            role="radio"
            [attr.aria-checked]="respostaSelecionada === i"
          >
            {{ resp.texto }}
          </div>
        </li>
      </ul>

      <button
        class="botao-pergunta"
        [disabled]="respostaSelecionada === null"
        (click)="proximaPergunta()"
      >
        {{ perguntaAtual + 1 < perguntas.length ? 'Próximo' : 'Finalizar' }}
      </button>
    </div>
  </section>

  <!-- Tela do resultado final -->
  <section *ngIf="jogoFinalizado" class="resultado" data-jogo-finalizado>
    <h2 class="texto-pergunta">Resultado Final</h2>

    <div
      class="item-resultado"
      *ngFor="let p of perguntas; let idx = index"
      [class.correta]="respostasUsuario[idx] === p.respostaCorretaIndex"
      [class.errada]="respostasUsuario[idx] !== p.respostaCorretaIndex"
    >
      <div>Pergunta {{ idx + 1 }}: {{ p.enunciado }}</div>
      <div>
        Sua resposta:
        {{ p.respostas[respostasUsuario[idx]].texto || 'Nenhuma' }}
        <span *ngIf="respostasUsuario[idx] === p.respostaCorretaIndex" class="correta">✔</span>
        <span *ngIf="respostasUsuario[idx] !== p.respostaCorretaIndex" class="errada">✘</span>
      </div>
    </div>

    <h3 class="titulo-ranking">Ranking (Fake)</h3>

    <div class="gabarito-final">
      <div class="bloco-gabarito" *ngFor="let ranking of rankingsPorCategoria">
        <div class="titulo-gabarito">{{ ranking.categoria }}</div>
        <ul class="lista-respostas">
          <li *ngFor="let user of ranking.top10">
            {{ user.nome }} - {{ user.pontos }} pts
          </li>
        </ul>
      </div>

      <div class="bloco-gabarito">
        <div class="titulo-gabarito">Ranking Geral</div>
        <ul class="lista-respostas">
          <li *ngFor="let user of rankingGeral.top10">
            {{ user.nome }} - {{ user.pontos }} pts
          </li>
        </ul>
      </div>
    </div>

    <button class="botao-reiniciar" (click)="reiniciarJogo()">Reiniciar</button>
  </section>

</main>
