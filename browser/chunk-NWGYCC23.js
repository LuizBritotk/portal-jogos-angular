import{$ as hn,Ob as ih,Pb as sh,Sb as yo,T as eh,W as ln,Z as Xe,_ as Pe,a as ho,b as fo,ba as th,c as gt,ca as di,d as v,da as nh,g as Lt,l as Xl,la as _t,m as Zl,o as po,oa as fi,p as mo,q as go,qa as Ue,w as _o,ya as rh}from"./chunk-WXL45R7I.js";var oh=()=>{};var uh=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Qm=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let o=n[t++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){let o=n[t++],a=n[t++],u=n[t++],h=((i&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{let o=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|a&63)}}return e.join("")},pi={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let o=n[i],a=i+1<n.length,u=a?n[i+1]:0,h=i+2<n.length,d=h?n[i+2]:0,p=o>>2,y=(o&3)<<4|u>>4,E=(u&15)<<2|d>>6,R=d&63;h||(R=64,a||(E=64)),r.push(t[p],t[y],t[E],t[R])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(uh(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Qm(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let o=t[n.charAt(i++)],u=i<n.length?t[n.charAt(i)]:0;++i;let d=i<n.length?t[n.charAt(i)]:64;++i;let y=i<n.length?t[n.charAt(i)]:64;if(++i,o==null||u==null||d==null||y==null)throw new Io;let E=o<<2|u>>4;if(r.push(E),d!==64){let R=u<<4&240|d>>2;if(r.push(R),y!==64){let k=d<<6&192|y;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Io=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Ym=function(n){let e=uh(n);return pi.encodeByteArray(e,!0)},lr=function(n){return Ym(n).replace(/\./g,"")},mi=function(n){try{return pi.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function wo(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Jm=()=>wo().__FIREBASE_DEFAULTS__,Xm=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Zm=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&mi(n[1]);return e&&JSON.parse(e)},gi=()=>{try{return oh()||Jm()||Xm()||Zm()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},To=n=>{var e,t;return(t=(e=gi())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},lh=n=>{let e=To(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Ao=()=>{var n;return(n=gi())===null||n===void 0?void 0:n.config},bo=n=>{var e;return(e=gi())===null||e===void 0?void 0:e[`_${n}`]};var Mt=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function yt(n){return n.endsWith(".cloudworkstations.dev")}function _i(n){return v(this,null,function*(){return(yield fetch(n,{credentials:"include"})).ok})}function hh(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[lr(JSON.stringify(t)),lr(JSON.stringify(a)),""].join(".")}var ur={};function eg(){let n={prod:[],emulator:[]};for(let e of Object.keys(ur))ur[e]?n.emulator.push(e):n.prod.push(e);return n}function tg(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}var ah=!1;function yi(n,e){if(typeof window>"u"||typeof document>"u"||!yt(window.location.host)||ur[n]===e||ur[n]||ah)return;ur[n]=e;function t(E){return`__firebase__banner__${E}`}let r="__firebase__banner",o=eg().prod.length>0;function a(){let E=document.getElementById(r);E&&E.remove()}function u(E){E.style.display="flex",E.style.background="#7faaf0",E.style.position="fixed",E.style.bottom="5px",E.style.left="5px",E.style.padding=".5em",E.style.borderRadius="5px",E.style.alignItems="center"}function h(E,R){E.setAttribute("width","24"),E.setAttribute("id",R),E.setAttribute("height","24"),E.setAttribute("viewBox","0 0 24 24"),E.setAttribute("fill","none"),E.style.marginLeft="-6px"}function d(){let E=document.createElement("span");return E.style.cursor="pointer",E.style.marginLeft="16px",E.style.fontSize="24px",E.innerHTML=" &times;",E.onclick=()=>{ah=!0,a()},E}function p(E,R){E.setAttribute("id",R),E.innerText="Learn more",E.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",E.setAttribute("target","__blank"),E.style.paddingLeft="5px",E.style.textDecoration="underline"}function y(){let E=tg(r),R=t("text"),k=document.getElementById(R)||document.createElement("span"),x=t("learnmore"),D=document.getElementById(x)||document.createElement("a"),$=t("preprendIcon"),U=document.getElementById($)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(E.created){let j=E.element;u(j),p(D,x);let J=d();h(U,$),j.append(U,k,D,J),document.body.appendChild(j)}o?(k.innerText="Preview backend disconnected.",U.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(U.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",y):y()}function ce(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function dh(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ce())}function ng(){var n;let e=(n=gi())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function fh(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function ph(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function mh(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function gh(){let n=ce();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function _h(){return!ng()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function hr(){try{return typeof indexedDB=="object"}catch{return!1}}function yh(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var o;e(((o=i.error)===null||o===void 0?void 0:o.message)||"")}}catch(t){e(t)}})}var rg="FirebaseError",be=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=rg,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Oe.prototype.create)}},Oe=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,o=this.errors[e],a=o?ig(o,r):"Error",u=`${this.serviceName}: ${a} (${i}).`;return new be(i,u,r)}};function ig(n,e){return n.replace(sg,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var sg=/\{\$([^}]+)}/g;function vh(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Be(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let o=n[i],a=e[i];if(ch(o)&&ch(a)){if(!Be(o,a))return!1}else if(o!==a)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function ch(n){return n!==null&&typeof n=="object"}function dr(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Ih(n,e){let t=new Eo(n,e);return t.subscribe.bind(t)}var Eo=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");og(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=vo),i.error===void 0&&(i.error=vo),i.complete===void 0&&(i.complete=vo);let o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function og(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function vo(){}var xw=4*60*60*1e3;function _e(n){return n&&n._delegate?n._delegate:n}var Te=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var Ft="[DEFAULT]";var So=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new Mt;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(o){if(i)return null;throw o}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(cg(e))try{this.getOrInitializeService({instanceIdentifier:Ft})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=Ft){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return v(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=Ft){return this.instances.has(e)}getOptions(e=Ft){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[o,a]of this.instancesDeferred.entries()){let u=this.normalizeInstanceIdentifier(o);r===u&&a.resolve(i)}return i}onInit(e,t){var r;let i=this.normalizeInstanceIdentifier(t),o=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;o.add(e),this.onInitCallbacks.set(i,o);let a=this.instances.get(i);return a&&e(a,i),()=>{o.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:ag(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Ft){return this.component?this.component.multipleInstances?e:Ft:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function ag(n){return n===Ft?void 0:n}function cg(n){return n.instantiationMode==="EAGER"}var vi=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new So(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var ug=[],W=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(W||{}),lg={debug:W.DEBUG,verbose:W.VERBOSE,info:W.INFO,warn:W.WARN,error:W.ERROR,silent:W.SILENT},hg=W.INFO,dg={[W.DEBUG]:"log",[W.VERBOSE]:"log",[W.INFO]:"info",[W.WARN]:"warn",[W.ERROR]:"error"},fg=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=dg[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},qe=class{constructor(e){this.name=e,this._logLevel=hg,this._logHandler=fg,this._userLogHandler=null,ug.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in W))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?lg[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,W.DEBUG,...e),this._logHandler(this,W.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,W.VERBOSE,...e),this._logHandler(this,W.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,W.INFO,...e),this._logHandler(this,W.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,W.WARN,...e),this._logHandler(this,W.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,W.ERROR,...e),this._logHandler(this,W.ERROR,...e)}};var pg=(n,e)=>e.some(t=>n instanceof t),Eh,wh;function mg(){return Eh||(Eh=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function gg(){return wh||(wh=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Th=new WeakMap,Po=new WeakMap,Ah=new WeakMap,Ro=new WeakMap,ko=new WeakMap;function _g(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t($e(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Th.set(t,n)}).catch(()=>{}),ko.set(e,n),e}function yg(n){if(Po.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});Po.set(n,e)}var Co={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Po.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Ah.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return $e(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function bh(n){Co=n(Co)}function vg(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(Ii(this),e,...t);return Ah.set(r,e.sort?e.sort():[e]),$e(r)}:gg().includes(n)?function(...e){return n.apply(Ii(this),e),$e(Th.get(this))}:function(...e){return $e(n.apply(Ii(this),e))}}function Ig(n){return typeof n=="function"?vg(n):(n instanceof IDBTransaction&&yg(n),pg(n,mg())?new Proxy(n,Co):n)}function $e(n){if(n instanceof IDBRequest)return _g(n);if(Ro.has(n))return Ro.get(n);let e=Ig(n);return e!==n&&(Ro.set(n,e),ko.set(e,n)),e}var Ii=n=>ko.get(n);function Rh(n,e,{blocked:t,upgrade:r,blocking:i,terminated:o}={}){let a=indexedDB.open(n,e),u=$e(a);return r&&a.addEventListener("upgradeneeded",h=>{r($e(a.result),h.oldVersion,h.newVersion,$e(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}var Eg=["get","getKey","getAll","getAllKeys","count"],wg=["put","add","delete","clear"],Do=new Map;function Sh(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Do.get(e))return Do.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=wg.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Eg.includes(t)))return;let o=function(a,...u){return v(this,null,function*(){let h=this.transaction(a,i?"readwrite":"readonly"),d=h.store;return r&&(d=d.index(u.shift())),(yield Promise.all([d[t](...u),i&&h.done]))[0]})};return Do.set(e,o),o}bh(n=>fo(ho({},n),{get:(e,t,r)=>Sh(e,t)||n.get(e,t,r),has:(e,t)=>!!Sh(e,t)||n.has(e,t)}));var Oo=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Tg(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function Tg(n){let e=n.getComponent();return e?.type==="VERSION"}var xo="@firebase/app",Ph="0.13.1";var Ze=new qe("@firebase/app"),Ag="@firebase/app-compat",bg="@firebase/analytics-compat",Sg="@firebase/analytics",Rg="@firebase/app-check-compat",Pg="@firebase/app-check",Cg="@firebase/auth",kg="@firebase/auth-compat",Dg="@firebase/database",Ng="@firebase/data-connect",Og="@firebase/database-compat",xg="@firebase/functions",Vg="@firebase/functions-compat",Lg="@firebase/installations",Mg="@firebase/installations-compat",Fg="@firebase/messaging",Ug="@firebase/messaging-compat",Bg="@firebase/performance",qg="@firebase/performance-compat",$g="@firebase/remote-config",jg="@firebase/remote-config-compat",zg="@firebase/storage",Wg="@firebase/storage-compat",Gg="@firebase/firestore",Kg="@firebase/ai",Hg="@firebase/firestore-compat",Qg="firebase",Yg="11.9.0";var Vo="[DEFAULT]",Jg={[xo]:"fire-core",[Ag]:"fire-core-compat",[Sg]:"fire-analytics",[bg]:"fire-analytics-compat",[Pg]:"fire-app-check",[Rg]:"fire-app-check-compat",[Cg]:"fire-auth",[kg]:"fire-auth-compat",[Dg]:"fire-rtdb",[Ng]:"fire-data-connect",[Og]:"fire-rtdb-compat",[xg]:"fire-fn",[Vg]:"fire-fn-compat",[Lg]:"fire-iid",[Mg]:"fire-iid-compat",[Fg]:"fire-fcm",[Ug]:"fire-fcm-compat",[Bg]:"fire-perf",[qg]:"fire-perf-compat",[$g]:"fire-rc",[jg]:"fire-rc-compat",[zg]:"fire-gcs",[Wg]:"fire-gcs-compat",[Gg]:"fire-fst",[Hg]:"fire-fst-compat",[Kg]:"fire-vertex","fire-js":"fire-js",[Qg]:"fire-js-all"};var fr=new Map,Xg=new Map,Lo=new Map;function Ch(n,e){try{n.container.addComponent(e)}catch(t){Ze.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function xe(n){let e=n.name;if(Lo.has(e))return Ze.debug(`There were multiple attempts to register component ${e}.`),!1;Lo.set(e,n);for(let t of fr.values())Ch(t,n);for(let t of Xg.values())Ch(t,n);return!0}function dn(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Ce(n){return n==null?!1:n.settings!==void 0}var Zg={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},vt=new Oe("app","Firebase",Zg);var Mo=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Te("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw vt.create("app-deleted",{appName:this._name})}};var It=Yg;function Bo(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=Object.assign({name:Vo,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw vt.create("bad-app-name",{appName:String(i)});if(t||(t=Ao()),!t)throw vt.create("no-options");let o=fr.get(i);if(o){if(Be(t,o.options)&&Be(r,o.config))return o;throw vt.create("duplicate-app",{appName:i})}let a=new vi(i);for(let h of Lo.values())a.addComponent(h);let u=new Mo(t,r,a);return fr.set(i,u),u}function Ut(n=Vo){let e=fr.get(n);if(!e&&n===Vo&&Ao())return Bo();if(!e)throw vt.create("no-app",{appName:n});return e}function Ei(){return Array.from(fr.values())}function re(n,e,t){var r;let i=(r=Jg[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);let o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){let u=[`Unable to register library "${i}" with version "${e}":`];o&&u.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&a&&u.push("and"),a&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ze.warn(u.join(" "));return}xe(new Te(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}var e_="firebase-heartbeat-database",t_=1,pr="firebase-heartbeat-store",No=null;function Oh(){return No||(No=Rh(e_,t_,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(pr)}catch(t){console.warn(t)}}}}).catch(n=>{throw vt.create("idb-open",{originalErrorMessage:n.message})})),No}function n_(n){return v(this,null,function*(){try{let t=(yield Oh()).transaction(pr),r=yield t.objectStore(pr).get(xh(n));return yield t.done,r}catch(e){if(e instanceof be)Ze.warn(e.message);else{let t=vt.create("idb-get",{originalErrorMessage:e?.message});Ze.warn(t.message)}}})}function kh(n,e){return v(this,null,function*(){try{let r=(yield Oh()).transaction(pr,"readwrite");yield r.objectStore(pr).put(e,xh(n)),yield r.done}catch(t){if(t instanceof be)Ze.warn(t.message);else{let r=vt.create("idb-set",{originalErrorMessage:t?.message});Ze.warn(r.message)}}})}function xh(n){return`${n.name}!${n.options.appId}`}var r_=1024,i_=30,Fo=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Uo(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return v(this,null,function*(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=Dh();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(a=>a.date===o))return;if(this._heartbeatsCache.heartbeats.push({date:o,agent:i}),this._heartbeatsCache.heartbeats.length>i_){let a=o_(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Ze.warn(r)}})}getHeartbeatsHeader(){return v(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=Dh(),{heartbeatsToSend:r,unsentEntries:i}=s_(this._heartbeatsCache.heartbeats),o=lr(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(t){return Ze.warn(t),""}})}};function Dh(){return new Date().toISOString().substring(0,10)}function s_(n,e=r_){let t=[],r=n.slice();for(let i of n){let o=t.find(a=>a.agent===i.agent);if(o){if(o.dates.push(i.date),Nh(t)>e){o.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Nh(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var Uo=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return v(this,null,function*(){return hr()?yh().then(()=>!0).catch(()=>!1):!1})}read(){return v(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield n_(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return v(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return kh(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return v(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return kh(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};function Nh(n){return lr(JSON.stringify({version:2,heartbeats:n})).length}function o_(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function a_(n){xe(new Te("platform-logger",e=>new Oo(e),"PRIVATE")),xe(new Te("heartbeat",e=>new Fo(e),"PRIVATE")),re(xo,Ph,n),re(xo,Ph,"esm2017"),re("fire-js","")}a_("");var c_="firebase",u_="11.9.1";re(c_,u_,"app");function qo(n){n===void 0&&(nh(qo),n=Xe(_t));let e=n.get(fi);return t=>new Lt(r=>{let i=e.add(),o=!1;function a(){o||(i(),o=!0)}let u=t.subscribe({next:h=>{r.next(h),a()},complete:()=>{r.complete(),a()},error:h=>{r.error(h),a()}});return u.add(()=>{r.unsubscribe(),a()}),u})}var Et=new ih("ANGULARFIRE2_VERSION");function mr(n,e,t){if(e){if(e.length===1)return e[0];let o=e.filter(a=>a.app===t);if(o.length===1)return o[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var pn=(n,e)=>{let t=e?[e]:Ei(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(a=>{r.includes(a)||r.push(a)})}),r},fn=function(n){return n[n.SILENT=0]="SILENT",n[n.WARN=1]="WARN",n[n.VERBOSE=2]="VERBOSE",n}(fn||{}),Vh=yo()&&typeof Zone<"u"?fn.WARN:fn.SILENT;var wi=class{zone;delegate;constructor(e,t=Zl){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,o=function(a){i?i.runGuarded(()=>{e.apply(this,[a])}):e.apply(this,[a])};return this.delegate.schedule(o,t,r)}},wt=(()=>{class n{outsideAngular;insideAngular;constructor(){let t=Xe(Ue);this.outsideAngular=t.runOutsideAngular(()=>new wi(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=t.run(()=>new wi(typeof Zone>"u"?void 0:Zone.current,Xl))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=eh({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Lh=!1;function l_(n,e){!Lh&&(Vh>fn.SILENT||yo())&&(Lh=!0,console.warn("Calling Firebase APIs outside of an Injection context may destabilize your application leading to subtle change-detection and hydration bugs. Find more at https://github.com/angular/angularfire/blob/main/docs/zones.md")),Vh>=e&&console.warn(`Firebase API called outside injection context: ${n.name}`)}function h_(n){let e=Xe(Ue,{optional:!0});return e?e.runOutsideAngular(()=>n()):n()}function Bt(n){let e=Xe(Ue,{optional:!0});return e?e.run(()=>n()):n()}var d_=(n,e,t)=>(...r)=>(e&&setTimeout(e,0),di(t,()=>Bt(()=>n.apply(void 0,r)))),ke=(n,e,t)=>(t||=e?fn.WARN:fn.VERBOSE,function(){let r,i=arguments,o,a,u;try{o=Xe(wt),a=Xe(fi),u=Xe(th)}catch{return l_(n,t),n.apply(this,i)}for(let d=0;d<arguments.length;d++)typeof i[d]=="function"&&(e&&(r||=Bt(()=>a.add())),i[d]=d_(i[d],r,u));let h=h_(()=>n.apply(this,i));return e?h instanceof Lt?h.pipe(go(o.outsideAngular),mo(o.insideAngular),qo(u)):h instanceof Promise?Bt(()=>new Promise((d,p)=>{a.run(()=>h).then(y=>di(u,()=>Bt(()=>d(y))),y=>di(u,()=>Bt(()=>p(y))))})):typeof h=="function"&&r?function(){return setTimeout(r,0),h.apply(this,arguments)}:Bt(()=>h):h instanceof Lt?h.pipe(go(o.outsideAngular),mo(o.insideAngular)):Bt(()=>h)});var et=class{constructor(e){return e}},qt=class{constructor(){return Ei()}};function f_(n){return n&&n.length===1?n[0]:new et(Ut())}var $o=new ln("angularfire2._apps"),p_={provide:et,useFactory:f_,deps:[[new Pe,$o]]},m_={provide:qt,deps:[[new Pe,$o]]};function g_(n){return(e,t)=>{let r=t.get(rh);re("angularfire",Et.full,"core"),re("angularfire",Et.full,"app"),re("angular",sh.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new et(i)}}function FT(n,...e){return hn([p_,m_,{provide:$o,useFactory:g_(n),multi:!0,deps:[Ue,_t,wt,...e]}])}var UT=ke(Bo,!0);var __=new Map,y_={activated:!1,tokenObservers:[]},v_={initialized:!1,enabled:!1};function Ve(n){return __.get(n)||Object.assign({},y_)}function Bh(){return v_}var I_="https://content-firebaseappcheck.googleapis.com/v1";var E_="exchangeDebugToken",Mh={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},HT=24*60*60*1e3;var Wo=class{constructor(e,t,r,i,o){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=o,this.pending=null,this.nextErrorWaitInterval=i,i>o)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return v(this,null,function*(){this.stop();try{this.pending=new Mt,this.pending.promise.catch(t=>{}),yield w_(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Mt,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function w_(n){return new Promise(e=>{setTimeout(e,n)})}var T_={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},Tt=new Oe("appCheck","AppCheck",T_);function qh(n){if(!Ve(n).activated)throw Tt.create("use-before-activation",{appName:n.name})}function $h(r,i){return v(this,arguments,function*({url:n,body:e},t){let o={"Content-Type":"application/json"},a=t.getImmediate({optional:!0});if(a){let R=yield a.getHeartbeatsHeader();R&&(o["X-Firebase-Client"]=R)}let u={method:"POST",body:JSON.stringify(e),headers:o},h;try{h=yield fetch(n,u)}catch(R){throw Tt.create("fetch-network-error",{originalErrorMessage:R?.message})}if(h.status!==200)throw Tt.create("fetch-status-error",{httpStatus:h.status});let d;try{d=yield h.json()}catch(R){throw Tt.create("fetch-parse-error",{originalErrorMessage:R?.message})}let p=d.ttl.match(/^([\d.]+)(s)$/);if(!p||!p[2]||isNaN(Number(p[1])))throw Tt.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${d.ttl}`});let y=Number(p[1])*1e3,E=Date.now();return{token:d.token,expireTimeMillis:E+y,issuedAtTimeMillis:E}})}function jh(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${I_}/projects/${t}/apps/${r}:${E_}?key=${i}`,body:{debug_token:e}}}var A_="firebase-app-check-database",b_=1,Go="firebase-app-check-store";var Ti=null;function S_(){return Ti||(Ti=new Promise((n,e)=>{try{let t=indexedDB.open(A_,b_);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Tt.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(Go,{keyPath:"compositeKey"})}}}catch(t){e(Tt.create("storage-open",{originalErrorMessage:t?.message}))}}),Ti)}function R_(n,e){return P_(C_(n),e)}function P_(n,e){return v(this,null,function*(){let r=(yield S_()).transaction(Go,"readwrite"),o=r.objectStore(Go).put({compositeKey:n,value:e});return new Promise((a,u)=>{o.onsuccess=h=>{a()},r.onerror=h=>{var d;u(Tt.create("storage-set",{originalErrorMessage:(d=h.target.error)===null||d===void 0?void 0:d.message}))}})})}function C_(n){return`${n.options.appId}-${n.name}`}var gr=new qe("@firebase/app-check");function jo(n,e){return hr()?R_(n,e).catch(t=>{gr.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function zh(){return Bh().enabled}function Wh(){return v(this,null,function*(){let n=Bh();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var k_={error:"UNKNOWN_ERROR"};function D_(n){return pi.encodeString(JSON.stringify(n),!1)}function Ko(n,e=!1,t=!1){return v(this,null,function*(){let r=n.app;qh(r);let i=Ve(r),o=i.token,a;if(o&&!_r(o)&&(i.token=void 0,o=void 0),!o){let d=yield i.cachedTokenPromise;d&&(_r(d)?o=d:yield jo(r,void 0))}if(!e&&o&&_r(o))return{token:o.token};let u=!1;if(zh())try{i.exchangeTokenPromise||(i.exchangeTokenPromise=$h(jh(r,yield Wh()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),u=!0);let d=yield i.exchangeTokenPromise;return yield jo(r,d),i.token=d,{token:d.token}}catch(d){return d.code==="appCheck/throttled"||d.code==="appCheck/initial-throttle"?gr.warn(d.message):t&&gr.error(d),zo(d)}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),u=!0),o=yield Ve(r).exchangeTokenPromise}catch(d){d.code==="appCheck/throttled"||d.code==="appCheck/initial-throttle"?gr.warn(d.message):t&&gr.error(d),a=d}let h;return o?a?_r(o)?h={token:o.token,internalError:a}:h=zo(a):(h={token:o.token},i.token=o,yield jo(r,o)):h=zo(a),u&&V_(r,h),h})}function N_(n){return v(this,null,function*(){let e=n.app;qh(e);let{provider:t}=Ve(e);if(zh()){let r=yield Wh(),{token:i}=yield $h(jh(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function O_(n,e,t,r){let{app:i}=n,o=Ve(i),a={next:t,error:r,type:e};if(o.tokenObservers=[...o.tokenObservers,a],o.token&&_r(o.token)){let u=o.token;Promise.resolve().then(()=>{t({token:u.token}),Fh(n)}).catch(()=>{})}o.cachedTokenPromise.then(()=>Fh(n))}function Gh(n,e){let t=Ve(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function Fh(n){let{app:e}=n,t=Ve(e),r=t.tokenRefresher;r||(r=x_(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function x_(n){let{app:e}=n;return new Wo(()=>v(null,null,function*(){let t=Ve(e),r;if(t.token?r=yield Ko(n,!0):r=yield Ko(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=Ve(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},Mh.RETRIAL_MIN_WAIT,Mh.RETRIAL_MAX_WAIT)}function V_(n,e){let t=Ve(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function _r(n){return n.expireTimeMillis-Date.now()>0}function zo(n){return{token:D_(k_),error:n}}var Ho=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Ve(this.app);for(let t of e)Gh(this.app,t.next);return Promise.resolve()}};function L_(n,e){return new Ho(n,e)}function M_(n){return{getToken:e=>Ko(n,e),getLimitedUseToken:()=>N_(n),addTokenListener:e=>O_(n,"INTERNAL",e),removeTokenListener:e=>Gh(n.app,e)}}var F_="@firebase/app-check",U_="0.10.0";var B_="app-check",Uh="app-check-internal";function q_(){xe(new Te(B_,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return L_(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Uh).initialize()})),xe(new Te(Uh,n=>{let e=n.getProvider("app-check").getImmediate();return M_(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),re(F_,U_)}q_();var $_="app-check";var mn=class{constructor(){return pn($_)}};var j_=["localhost","0.0.0.0","127.0.0.1"],aA=typeof window<"u"&&j_.includes(window.location.hostname);function ad(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var cd=ad,ud=new Oe("auth","Firebase",ad());var Ci=new qe("@firebase/auth");function z_(n,...e){Ci.logLevel<=W.WARN&&Ci.warn(`Auth (${It}): ${n}`,...e)}function bi(n,...e){Ci.logLevel<=W.ERROR&&Ci.error(`Auth (${It}): ${n}`,...e)}function St(n,...e){throw pa(n,...e)}function jt(n,...e){return pa(n,...e)}function ld(n,e,t){let r=Object.assign(Object.assign({},cd()),{[e]:t});return new Oe("auth","Firebase",r).create(e,{appName:n.name})}function $t(n){return ld(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function pa(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return ud.create(n,...e)}function F(n,e,...t){if(!n)throw pa(e,...t)}function tt(n){let e="INTERNAL ASSERTION FAILED: "+n;throw bi(e),new Error(e)}function Rt(n,e){n||tt(e)}function Xo(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function W_(){return Kh()==="http:"||Kh()==="https:"}function Kh(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function G_(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(W_()||ph()||"connection"in navigator)?navigator.onLine:!0}function K_(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var zt=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,Rt(t>e,"Short delay should be less than long delay!"),this.isMobile=dh()||mh()}get(){return G_()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function ma(n,e){Rt(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var ki=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;tt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;tt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;tt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var H_={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var Q_=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Y_=new zt(3e4,6e4);function ga(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function gn(o,a,u,h){return v(this,arguments,function*(n,e,t,r,i={}){return hd(n,i,()=>v(null,null,function*(){let d={},p={};r&&(e==="GET"?p=r:d={body:JSON.stringify(r)});let y=dr(Object.assign({key:n.config.apiKey},p)).slice(1),E=yield n._getAdditionalHeaders();E["Content-Type"]="application/json",n.languageCode&&(E["X-Firebase-Locale"]=n.languageCode);let R=Object.assign({method:e,headers:E},d);return fh()||(R.referrerPolicy="no-referrer"),n.emulatorConfig&&yt(n.emulatorConfig.host)&&(R.credentials="include"),ki.fetch()(yield dd(n,n.config.apiHost,t,y),R)}))})}function hd(n,e,t){return v(this,null,function*(){n._canInitEmulator=!1;let r=Object.assign(Object.assign({},H_),e);try{let i=new Zo(n),o=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let a=yield o.json();if("needConfirmation"in a)throw Ai(n,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{let u=o.ok?a.errorMessage:a.error.message,[h,d]=u.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ai(n,"credential-already-in-use",a);if(h==="EMAIL_EXISTS")throw Ai(n,"email-already-in-use",a);if(h==="USER_DISABLED")throw Ai(n,"user-disabled",a);let p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw ld(n,p,d);St(n,p)}}catch(i){if(i instanceof be)throw i;St(n,"network-request-failed",{message:String(i)})}})}function J_(o,a,u,h){return v(this,arguments,function*(n,e,t,r,i={}){let d=yield gn(n,e,t,r,i);return"mfaPendingCredential"in d&&St(n,"multi-factor-auth-required",{_serverResponse:d}),d})}function dd(n,e,t,r){return v(this,null,function*(){let i=`${e}${t}?${r}`,o=n,a=o.config.emulator?ma(n.config,i):`${n.config.apiScheme}://${i}`;return Q_.includes(t)&&(yield o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(a).toString():a})}var Zo=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(jt(this.auth,"network-request-failed")),Y_.get())})}};function Ai(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=jt(n,e,r);return i.customData._tokenResponse=t,i}function X_(n,e){return v(this,null,function*(){return gn(n,"POST","/v1/accounts:delete",e)})}function Di(n,e){return v(this,null,function*(){return gn(n,"POST","/v1/accounts:lookup",e)})}function yr(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function _a(n,e=!1){return v(this,null,function*(){let t=_e(n),r=yield t.getIdToken(e),i=ya(r);F(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let o=typeof i.firebase=="object"?i.firebase:void 0,a=o?.sign_in_provider;return{claims:i,token:r,authTime:yr(Qo(i.auth_time)),issuedAtTime:yr(Qo(i.iat)),expirationTime:yr(Qo(i.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}})}function Qo(n){return Number(n)*1e3}function ya(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return bi("JWT malformed, contained fewer than 3 sections"),null;try{let i=mi(t);return i?JSON.parse(i):(bi("Failed to decode base64 JWT payload"),null)}catch(i){return bi("Caught error parsing JWT payload as JSON",i?.toString()),null}}function Hh(n){let e=ya(n);return F(e,"internal-error"),F(typeof e.exp<"u","internal-error"),F(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function Ir(n,e,t=!1){return v(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof be&&Z_(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function Z_({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var ea=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>v(this,null,function*(){yield this.iteration()}),t)}iteration(){return v(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var Er=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=yr(this.lastLoginAt),this.creationTime=yr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function Ni(n){return v(this,null,function*(){var e;let t=n.auth,r=yield n.getIdToken(),i=yield Ir(n,Di(t,{idToken:r}));F(i?.users.length,t,"internal-error");let o=i.users[0];n._notifyReloadListener(o);let a=!((e=o.providerUserInfo)===null||e===void 0)&&e.length?fd(o.providerUserInfo):[],u=ey(n.providerData,a),h=n.isAnonymous,d=!(n.email&&o.passwordHash)&&!u?.length,p=h?d:!1,y={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:u,metadata:new Er(o.createdAt,o.lastLoginAt),isAnonymous:p};Object.assign(n,y)})}function va(n){return v(this,null,function*(){let e=_e(n);yield Ni(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function ey(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function fd(n){return n.map(e=>{var{providerId:t}=e,r=po(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function ty(n,e){return v(this,null,function*(){let t=yield hd(n,{},()=>v(null,null,function*(){let r=dr({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=n.config,a=yield dd(n,i,"/v1/token",`key=${o}`),u=yield n._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";let h={method:"POST",headers:u,body:r};return n.emulatorConfig&&yt(n.emulatorConfig.host)&&(h.credentials="include"),ki.fetch()(a,h)}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function ny(n,e){return v(this,null,function*(){return gn(n,"POST","/v2/accounts:revokeToken",ga(n,e))})}var vr=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){F(e.idToken,"internal-error"),F(typeof e.idToken<"u","internal-error"),F(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Hh(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){F(e.length!==0,"internal-error");let t=Hh(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return v(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(F(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return v(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:o}=yield ty(e,t);this.updateTokensAndExpiration(r,i,Number(o))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:o}=t,a=new n;return r&&(F(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(F(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),o&&(F(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return tt("not implemented")}};function At(n,e){F(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var bt=class n{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,o=po(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ea(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=o.displayName||null,this.email=o.email||null,this.emailVerified=o.emailVerified||!1,this.phoneNumber=o.phoneNumber||null,this.photoURL=o.photoURL||null,this.isAnonymous=o.isAnonymous||!1,this.tenantId=o.tenantId||null,this.providerData=o.providerData?[...o.providerData]:[],this.metadata=new Er(o.createdAt||void 0,o.lastLoginAt||void 0)}getIdToken(e){return v(this,null,function*(){let t=yield Ir(this,this.stsTokenManager.getToken(this.auth,e));return F(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return _a(this,e)}reload(){return va(this)}_assign(e){this!==e&&(F(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){F(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return v(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield Ni(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return v(this,null,function*(){if(Ce(this.auth.app))return Promise.reject($t(this.auth));let e=yield this.getIdToken();return yield Ir(this,X_(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,o,a,u,h,d,p;let y=(r=t.displayName)!==null&&r!==void 0?r:void 0,E=(i=t.email)!==null&&i!==void 0?i:void 0,R=(o=t.phoneNumber)!==null&&o!==void 0?o:void 0,k=(a=t.photoURL)!==null&&a!==void 0?a:void 0,x=(u=t.tenantId)!==null&&u!==void 0?u:void 0,D=(h=t._redirectEventId)!==null&&h!==void 0?h:void 0,$=(d=t.createdAt)!==null&&d!==void 0?d:void 0,U=(p=t.lastLoginAt)!==null&&p!==void 0?p:void 0,{uid:j,emailVerified:J,isAnonymous:Ie,providerData:Y,stsTokenManager:w}=t;F(j&&w,e,"internal-error");let m=vr.fromJSON(this.name,w);F(typeof j=="string",e,"internal-error"),At(y,e.name),At(E,e.name),F(typeof J=="boolean",e,"internal-error"),F(typeof Ie=="boolean",e,"internal-error"),At(R,e.name),At(k,e.name),At(x,e.name),At(D,e.name),At($,e.name),At(U,e.name);let _=new n({uid:j,auth:e,email:E,emailVerified:J,displayName:y,isAnonymous:Ie,photoURL:k,phoneNumber:R,tenantId:x,stsTokenManager:m,createdAt:$,lastLoginAt:U});return Y&&Array.isArray(Y)&&(_.providerData=Y.map(I=>Object.assign({},I))),D&&(_._redirectEventId=D),_}static _fromIdTokenResponse(e,t,r=!1){return v(this,null,function*(){let i=new vr;i.updateFromServerResponse(t);let o=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield Ni(o),o})}static _fromGetAccountInfoResponse(e,t,r){return v(this,null,function*(){let i=t.users[0];F(i.localId!==void 0,"internal-error");let o=i.providerUserInfo!==void 0?fd(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!o?.length,u=new vr;u.updateFromIdToken(r);let h=new n({uid:i.localId,auth:e,stsTokenManager:u,isAnonymous:a}),d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new Er(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!o?.length};return Object.assign(h,d),h})}};var Qh=new Map;function nt(n){Rt(n instanceof Function,"Expected a class definition");let e=Qh.get(n);return e?(Rt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Qh.set(n,e),e)}var ry=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return v(this,null,function*(){return!0})}_set(t,r){return v(this,null,function*(){this.storage[t]=r})}_get(t){return v(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return v(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),ta=ry;function Si(n,e,t){return`firebase:${n}:${e}:${t}`}var Oi=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:o}=this.auth;this.fullUserKey=Si(this.userKey,i.apiKey,o),this.fullPersistenceKey=Si("persistence",i.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return v(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=yield Di(this.auth,{idToken:e}).catch(()=>{});return t?bt._fromGetAccountInfoResponse(this.auth,t,e):null}return bt._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return v(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return v(this,null,function*(){if(!t.length)return new n(nt(ta),e,r);let i=(yield Promise.all(t.map(d=>v(null,null,function*(){if(yield d._isAvailable())return d})))).filter(d=>d),o=i[0]||nt(ta),a=Si(r,e.config.apiKey,e.name),u=null;for(let d of t)try{let p=yield d._get(a);if(p){let y;if(typeof p=="string"){let E=yield Di(e,{idToken:p}).catch(()=>{});if(!E)break;y=yield bt._fromGetAccountInfoResponse(e,E,p)}else y=bt._fromJSON(e,p);d!==o&&(u=y),o=d;break}}catch{}let h=i.filter(d=>d._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new n(o,e,r):(o=h[0],u&&(yield o._set(a,u.toJSON())),yield Promise.all(t.map(d=>v(null,null,function*(){if(d!==o)try{yield d._remove(a)}catch{}}))),new n(o,e,r))})}};function Yh(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(_d(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(pd(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(vd(e))return"Blackberry";if(Id(e))return"Webos";if(md(e))return"Safari";if((e.includes("chrome/")||gd(e))&&!e.includes("edge/"))return"Chrome";if(yd(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function pd(n=ce()){return/firefox\//i.test(n)}function md(n=ce()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function gd(n=ce()){return/crios\//i.test(n)}function _d(n=ce()){return/iemobile/i.test(n)}function yd(n=ce()){return/android/i.test(n)}function vd(n=ce()){return/blackberry/i.test(n)}function Id(n=ce()){return/webos/i.test(n)}function Ia(n=ce()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function iy(n=ce()){var e;return Ia(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function sy(){return gh()&&document.documentMode===10}function Ed(n=ce()){return Ia(n)||yd(n)||Id(n)||vd(n)||/windows phone/i.test(n)||_d(n)}function wd(n,e=[]){let t;switch(n){case"Browser":t=Yh(ce());break;case"Worker":t=`${Yh(ce())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${It}/${r}`}var na=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=o=>new Promise((a,u)=>{try{let h=e(o);a(h)}catch(h){u(h)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return v(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function oy(t){return v(this,arguments,function*(n,e={}){return gn(n,"GET","/v2/passwordPolicy",ga(n,e))})}var ay=6,ra=class{constructor(e){var t,r,i,o;let a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:ay,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(o=e.forceUpgradeOnSignin)!==null&&o!==void 0?o:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,o,a,u;let h={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,h),this.validatePasswordCharacterOptions(e,h),h.isValid&&(h.isValid=(t=h.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),h.isValid&&(h.isValid=(r=h.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),h.isValid&&(h.isValid=(i=h.containsLowercaseLetter)!==null&&i!==void 0?i:!0),h.isValid&&(h.isValid=(o=h.containsUppercaseLetter)!==null&&o!==void 0?o:!0),h.isValid&&(h.isValid=(a=h.containsNumericCharacter)!==null&&a!==void 0?a:!0),h.isValid&&(h.isValid=(u=h.containsNonAlphanumericCharacter)!==null&&u!==void 0?u:!0),h}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}};var ia=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new xi(this),this.idTokenSubscription=new xi(this),this.beforeStateQueue=new na(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ud,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=nt(t)),this._initializationPromise=this.queue(()=>v(this,null,function*(){var r,i,o;if(!this._deleted&&(this.persistenceManager=yield Oi.create(this,e),(r=this._resolvePersistenceManagerAvailable)===null||r===void 0||r.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((o=this.currentUser)===null||o===void 0?void 0:o.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return v(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return v(this,null,function*(){try{let t=yield Di(this,{idToken:e}),r=yield bt._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return v(this,null,function*(){var t;if(Ce(this.app)){let a=this.app.settings.authIdToken;return a?new Promise(u=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(u,u))}):this.directlySetCurrentUser(null)}let r=yield this.assertedPersistence.getCurrentUser(),i=r,o=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,u=i?._redirectEventId,h=yield this.tryRedirectSignIn(e);(!a||a===u)&&h?.user&&(i=h.user,o=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(o)try{yield this.beforeStateQueue.runMiddleware(i)}catch(a){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return F(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return v(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return v(this,null,function*(){try{yield Ni(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=K_()}_delete(){return v(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return v(this,null,function*(){if(Ce(this.app))return Promise.reject($t(this));let t=e?_e(e):null;return t&&F(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return v(this,null,function*(){if(!this._deleted)return e&&F(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>v(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return v(this,null,function*(){return Ce(this.app)?Promise.reject($t(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return Ce(this.app)?Promise.reject($t(this)):this.queue(()=>v(this,null,function*(){yield this.assertedPersistence.setPersistence(nt(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return v(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return v(this,null,function*(){let e=yield oy(this),t=new ra(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Oe("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return v(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield ny(this,r)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return v(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return v(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&nt(e)||this._popupRedirectResolver;F(t,this,"argument-error"),this.redirectPersistenceManager=yield Oi.create(this,[nt(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return v(this,null,function*(){var t,r;return this._isInitialized&&(yield this.queue(()=>v(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return v(this,null,function*(){if(e===this.currentUser)return this.queue(()=>v(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let o=typeof t=="function"?t:t.next.bind(t),a=!1,u=this._isInitialized?Promise.resolve():this._initializationPromise;if(F(u,this,"internal-error"),u.then(()=>{a||o(this.currentUser)}),typeof t=="function"){let h=e.addObserver(t,r,i);return()=>{a=!0,h()}}else{let h=e.addObserver(t);return()=>{a=!0,h()}}}directlySetCurrentUser(e){return v(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return F(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=wd(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return v(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();r&&(t["X-Firebase-Client"]=r);let i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return v(this,null,function*(){var e;if(Ce(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&z_(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function Ea(n){return _e(n)}var xi=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=Ih(t=>this.observer=t)}get next(){return F(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var wa={loadJS(){return v(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function cy(n){wa=n}function uy(n){return wa.loadJS(n)}function ly(){return wa.gapiScript}function Td(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function Ta(n,e){let t=dn(n,"auth");if(t.isInitialized()){let i=t.getImmediate(),o=t.getOptions();if(Be(o,e??{}))return i;St(i,"already-initialized")}return t.initialize({options:e})}function hy(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(nt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function Aa(n,e,t){let r=Ea(n);F(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!t?.disableWarnings,o=Ad(e),{host:a,port:u}=dy(e),h=u===null?"":`:${u}`,d={url:`${o}//${a}${h}/`},p=Object.freeze({host:a,port:u,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){F(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),F(Be(d,r.config.emulator)&&Be(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,yt(a)?(_i(`${o}//${a}${h}`),yi("Auth",!0)):i||fy()}function Ad(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function dy(n){let e=Ad(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let o=i[1];return{host:o,port:Jh(r.substr(o.length+1))}}else{let[o,a]=r.split(":");return{host:o,port:Jh(a)}}}function Jh(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function fy(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var Vi=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return tt("not implemented")}_getIdTokenResponse(e){return tt("not implemented")}_linkToIdToken(e,t){return tt("not implemented")}_getReauthenticationResolver(e){return tt("not implemented")}};function Yo(n,e){return v(this,null,function*(){return J_(n,"POST","/v1/accounts:signInWithIdp",ga(n,e))})}var Li=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var sa=class extends Li{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};var wr=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,r,i=!1){return v(this,null,function*(){let o=yield bt._fromIdTokenResponse(e,r,i),a=Xh(r);return new n({user:o,providerId:a,_tokenResponse:r,operationType:t})})}static _forOperation(e,t,r){return v(this,null,function*(){yield e._updateTokensIfNecessary(r,!0);let i=Xh(r);return new n({user:e,providerId:i,_tokenResponse:r,operationType:t})})}};function Xh(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var oa=class n extends be{constructor(e,t,r,i){var o;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:(o=e.tenantId)!==null&&o!==void 0?o:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new n(e,t,r,i)}};function bd(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?oa._fromErrorAndOperation(n,o,e,r):o})}function py(n,e,t=!1){return v(this,null,function*(){let r=yield Ir(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return wr._forOperation(n,"link",r)})}function my(n,e,t=!1){return v(this,null,function*(){let{auth:r}=n;if(Ce(r.app))return Promise.reject($t(r));let i="reauthenticate";try{let o=yield Ir(n,bd(r,i,e,n),t);F(o.idToken,r,"internal-error");let a=ya(o.idToken);F(a,r,"internal-error");let{sub:u}=a;return F(n.uid===u,r,"user-mismatch"),wr._forOperation(n,i,o)}catch(o){throw o?.code==="auth/user-not-found"&&St(r,"user-mismatch"),o}})}function gy(n,e,t=!1){return v(this,null,function*(){if(Ce(n.app))return Promise.reject($t(n));let r="signIn",i=yield bd(n,r,e),o=yield wr._fromIdTokenResponse(n,r,i);return t||(yield n._updateCurrentUser(o.user)),o})}function ba(n,e,t,r){return _e(n).onIdTokenChanged(e,t,r)}function Sa(n,e,t){return _e(n).beforeAuthStateChanged(e,t)}var Mi="__sak";var Fi=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Mi,"1"),this.storage.removeItem(Mi),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var _y=1e3,yy=10,vy=(()=>{class n extends Fi{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Ed(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let r of Object.keys(this.listeners)){let i=this.storage.getItem(r),o=this.localCache[r];i!==o&&t(r,o,i)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((u,h,d)=>{this.notifyListeners(u,d)});return}let i=t.key;r?this.detachListener():this.stopPolling();let o=()=>{let u=this.storage.getItem(i);!r&&this.localCache[i]===u||this.notifyListeners(i,u)},a=this.storage.getItem(i);sy()&&a!==t.newValue&&t.newValue!==t.oldValue?setTimeout(o,yy):o()}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let o of Array.from(i))o(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:i}),!0)})},_y)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,r){return v(this,null,function*(){yield gt(n.prototype,this,"_set").call(this,t,r),this.localCache[t]=JSON.stringify(r)})}_get(t){return v(this,null,function*(){let r=yield gt(n.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(r),r})}_remove(t){return v(this,null,function*(){yield gt(n.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return n.type="LOCAL",n})(),Sd=vy;var Iy=(()=>{class n extends Fi{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}return n.type="SESSION",n})(),Ra=Iy;function Ey(n){return Promise.all(n.map(e=>v(null,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}var wy=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let r=this.receivers.find(o=>o.isListeningto(t));if(r)return r;let i=new n(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}handleEvent(t){return v(this,null,function*(){let r=t,{eventId:i,eventType:o,data:a}=r.data,u=this.handlersMap[o];if(!u?.size)return;r.ports[0].postMessage({status:"ack",eventId:i,eventType:o});let h=Array.from(u).map(p=>v(this,null,function*(){return p(r.origin,a)})),d=yield Ey(h);r.ports[0].postMessage({status:"done",eventId:i,eventType:o,response:d})})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function Rd(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}var aa=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,r=50){return v(this,null,function*(){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let o,a;return new Promise((u,h)=>{let d=Rd("",20);i.port1.start();let p=setTimeout(()=>{h(new Error("unsupported_event"))},r);a={messageChannel:i,onMessage(y){let E=y;if(E.data.eventId===d)switch(E.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),u(E.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})})}};function je(){return window}function Ty(n){je().location.href=n}function Pd(){return typeof je().WorkerGlobalScope<"u"&&typeof je().importScripts=="function"}function Ay(){return v(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function by(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function Sy(){return Pd()?self:null}var Cd="firebaseLocalStorageDb",Ry=1,Ui="firebaseLocalStorage",kd="fbase_key",Wt=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function qi(n,e){return n.transaction([Ui],e?"readwrite":"readonly").objectStore(Ui)}function Py(){let n=indexedDB.deleteDatabase(Cd);return new Wt(n).toPromise()}function ca(){let n=indexedDB.open(Cd,Ry);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let r=n.result;try{r.createObjectStore(Ui,{keyPath:kd})}catch(i){t(i)}}),n.addEventListener("success",()=>v(null,null,function*(){let r=n.result;r.objectStoreNames.contains(Ui)?e(r):(r.close(),yield Py(),e(yield ca()))}))})}function Zh(n,e,t){return v(this,null,function*(){let r=qi(n,!0).put({[kd]:e,value:t});return new Wt(r).toPromise()})}function Cy(n,e){return v(this,null,function*(){let t=qi(n,!1).get(e),r=yield new Wt(t).toPromise();return r===void 0?null:r.value})}function ed(n,e){let t=qi(n,!0).delete(e);return new Wt(t).toPromise()}var ky=800,Dy=3,Ny=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return v(this,null,function*(){return this.db?this.db:(this.db=yield ca(),this.db)})}_withRetries(t){return v(this,null,function*(){let r=0;for(;;)try{let i=yield this._openDb();return yield t(i)}catch(i){if(r++>Dy)throw i;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return v(this,null,function*(){return Pd()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return v(this,null,function*(){this.receiver=wy._getInstance(Sy()),this.receiver._subscribe("keyChanged",(t,r)=>v(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(r.key)}})),this.receiver._subscribe("ping",(t,r)=>v(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return v(this,null,function*(){var t,r;if(this.activeServiceWorker=yield Ay(),!this.activeServiceWorker)return;this.sender=new aa(this.activeServiceWorker);let i=yield this.sender._send("ping",{},800);i&&!((t=i[0])===null||t===void 0)&&t.fulfilled&&!((r=i[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return v(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||by()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return v(this,null,function*(){try{if(!indexedDB)return!1;let t=yield ca();return yield Zh(t,Mi,"1"),yield ed(t,Mi),!0}catch{}return!1})}_withPendingWrite(t){return v(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,r){return v(this,null,function*(){return this._withPendingWrite(()=>v(this,null,function*(){return yield this._withRetries(i=>Zh(i,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)}))})}_get(t){return v(this,null,function*(){let r=yield this._withRetries(i=>Cy(i,t));return this.localCache[t]=r,r})}_remove(t){return v(this,null,function*(){return this._withPendingWrite(()=>v(this,null,function*(){return yield this._withRetries(r=>ed(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return v(this,null,function*(){let t=yield this._withRetries(o=>{let a=qi(o,!1).getAll();return new Wt(a).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let r=[],i=new Set;if(t.length!==0)for(let{fbase_key:o,value:a}of t)i.add(o),JSON.stringify(this.localCache[o])!==JSON.stringify(a)&&(this.notifyListeners(o,a),r.push(o));for(let o of Object.keys(this.localCache))this.localCache[o]&&!i.has(o)&&(this.notifyListeners(o,null),r.push(o));return r})}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let o of Array.from(i))o(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>v(this,null,function*(){return this._poll()}),ky)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),Dd=Ny;var _A=Td("rcb"),yA=new zt(3e4,6e4);function Oy(n,e){return e?nt(e):(F(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var Tr=class extends Vi{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Yo(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Yo(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Yo(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function xy(n){return gy(n.auth,new Tr(n),n.bypassAuthState)}function Vy(n){let{auth:e,user:t}=n;return F(t,e,"internal-error"),my(t,new Tr(n),n.bypassAuthState)}function Ly(n){return v(this,null,function*(){let{auth:e,user:t}=n;return F(t,e,"internal-error"),py(t,new Tr(n),n.bypassAuthState)})}var ua=class{constructor(e,t,r,i,o=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>v(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}}))}onAuthEvent(e){return v(this,null,function*(){let{urlResponse:t,sessionId:r,postBody:i,tenantId:o,error:a,type:u}=e;if(a){this.reject(a);return}let h={auth:this.auth,requestUri:t,sessionId:r,tenantId:o||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(u)(h))}catch(d){this.reject(d)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return xy;case"linkViaPopup":case"linkViaRedirect":return Ly;case"reauthViaPopup":case"reauthViaRedirect":return Vy;default:St(this.auth,"internal-error")}}resolve(e){Rt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Rt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var vA=new zt(2e3,1e4);var My="pendingRedirect",Ri=new Map,la=class n extends ua{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}execute(){return v(this,null,function*(){let e=Ri.get(this.auth._key());if(!e){try{let r=(yield Fy(this.resolver,this.auth))?yield gt(n.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Ri.set(this.auth._key(),e)}return this.bypassAuthState||Ri.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return v(this,null,function*(){if(e.type==="signInViaRedirect")return gt(n.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,gt(n.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return v(this,null,function*(){})}cleanUp(){}};function Fy(n,e){return v(this,null,function*(){let t=qy(e),r=By(n);if(!(yield r._isAvailable()))return!1;let i=(yield r._get(t))==="true";return yield r._remove(t),i})}function Uy(n,e){Ri.set(n._key(),e)}function By(n){return nt(n._redirectPersistence)}function qy(n){return Si(My,n.config.apiKey,n.name)}function $y(n,e,t=!1){return v(this,null,function*(){if(Ce(n.app))return Promise.reject($t(n));let r=Ea(n),i=Oy(r,e),a=yield new la(r,i,t).execute();return a&&!t&&(delete a.user._redirectEventId,yield r._persistUserIfCurrent(a.user),yield r._setRedirectUser(null,e)),a})}var jy=10*60*1e3,ha=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!zy(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!Nd(e)){let i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(jt(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=jy&&this.cachedEventUids.clear(),this.cachedEventUids.has(td(e))}saveEventToCache(e){this.cachedEventUids.add(td(e)),this.lastProcessedEventTime=Date.now()}};function td(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Nd({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function zy(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Nd(n);default:return!1}}function Wy(t){return v(this,arguments,function*(n,e={}){return gn(n,"GET","/v1/projects",e)})}var Gy=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Ky=/^https?/;function Hy(n){return v(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:e}=yield Wy(n);for(let t of e)try{if(Qy(t))return}catch{}St(n,"unauthorized-domain")})}function Qy(n){let e=Xo(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){let a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!Ky.test(t))return!1;if(Gy.test(n))return r===n;let i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}var Yy=new zt(3e4,6e4);function nd(){let n=je().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function Jy(n){return new Promise((e,t)=>{var r,i,o;function a(){nd(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{nd(),t(jt(n,"network-request-failed"))},timeout:Yy.get()})}if(!((i=(r=je().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((o=je().gapi)===null||o===void 0)&&o.load)a();else{let u=Td("iframefcb");return je()[u]=()=>{gapi.load?a():t(jt(n,"network-request-failed"))},uy(`${ly()}?onload=${u}`).catch(h=>t(h))}}).catch(e=>{throw Pi=null,e})}var Pi=null;function Xy(n){return Pi=Pi||Jy(n),Pi}var Zy=new zt(5e3,15e3),ev="__/auth/iframe",tv="emulator/auth/iframe",nv={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},rv=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function iv(n){let e=n.config;F(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?ma(e,tv):`https://${n.config.authDomain}/${ev}`,r={apiKey:e.apiKey,appName:n.name,v:It},i=rv.get(n.config.apiHost);i&&(r.eid=i);let o=n._getFrameworks();return o.length&&(r.fw=o.join(",")),`${t}?${dr(r).slice(1)}`}function sv(n){return v(this,null,function*(){let e=yield Xy(n),t=je().gapi;return F(t,n,"internal-error"),e.open({where:document.body,url:iv(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:nv,dontclear:!0},r=>new Promise((i,o)=>v(null,null,function*(){yield r.restyle({setHideOnLeave:!1});let a=jt(n,"network-request-failed"),u=je().setTimeout(()=>{o(a)},Zy.get());function h(){je().clearTimeout(u),i(r)}r.ping(h).then(h,()=>{o(a)})})))})}var ov={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},av=500,cv=600,uv="_blank",lv="http://localhost",Bi=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function hv(n,e,t,r=av,i=cv){let o=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString(),u="",h=Object.assign(Object.assign({},ov),{width:r.toString(),height:i.toString(),top:o,left:a}),d=ce().toLowerCase();t&&(u=gd(d)?uv:t),pd(d)&&(e=e||lv,h.scrollbars="yes");let p=Object.entries(h).reduce((E,[R,k])=>`${E}${R}=${k},`,"");if(iy(d)&&u!=="_self")return dv(e||"",u),new Bi(null);let y=window.open(e||"",u,p);F(y,n,"popup-blocked");try{y.focus()}catch{}return new Bi(y)}function dv(n,e){let t=document.createElement("a");t.href=n,t.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}var fv="__/auth/handler",pv="emulator/auth/handler",mv=encodeURIComponent("fac");function rd(n,e,t,r,i,o){return v(this,null,function*(){F(n.config.authDomain,n,"auth-domain-config-required"),F(n.config.apiKey,n,"invalid-api-key");let a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:It,eventId:i};if(e instanceof Li){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",vh(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(let[p,y]of Object.entries(o||{}))a[p]=y}if(e instanceof sa){let p=e.getScopes().filter(y=>y!=="");p.length>0&&(a.scopes=p.join(","))}n.tenantId&&(a.tid=n.tenantId);let u=a;for(let p of Object.keys(u))u[p]===void 0&&delete u[p];let h=yield n._getAppCheckToken(),d=h?`#${mv}=${encodeURIComponent(h)}`:"";return`${gv(n)}?${dr(u).slice(1)}${d}`})}function gv({config:n}){return n.emulator?ma(n,pv):`https://${n.authDomain}/${fv}`}var Jo="webStorageSupport",da=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ra,this._completeRedirectFn=$y,this._overrideRedirectResult=Uy}_openPopup(e,t,r,i){return v(this,null,function*(){var o;Rt((o=this.eventManagers[e._key()])===null||o===void 0?void 0:o.manager,"_initialize() not called before _openPopup()");let a=yield rd(e,t,r,Xo(),i);return hv(e,a,Rd())})}_openRedirect(e,t,r,i){return v(this,null,function*(){yield this._originValidation(e);let o=yield rd(e,t,r,Xo(),i);return Ty(o),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:o}=this.eventManagers[t];return i?Promise.resolve(i):(Rt(o,"If manager is not set, promise should be"),o)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}initAndGetManager(e){return v(this,null,function*(){let t=yield sv(e),r=new ha(e);return t.register("authEvent",i=>(F(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Jo,{type:Jo},i=>{var o;let a=(o=i?.[0])===null||o===void 0?void 0:o[Jo];a!==void 0&&t(!!a),St(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Hy(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Ed()||md()||Ia()}},Od=da;var id="@firebase/auth",sd="1.10.7";var fa=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return v(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){F(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function _v(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function yv(n){xe(new Te("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:u}=r.options;F(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let h={apiKey:a,authDomain:u,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:wd(n)},d=new ia(r,i,o,h);return hy(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),xe(new Te("auth-internal",e=>{let t=Ea(e.getProvider("auth").getImmediate());return(r=>new fa(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),re(id,sd,_v(n)),re(id,sd,"esm2017")}var vv=5*60,Iv=bo("authIdTokenMaxAge")||vv,od=null,Ev=n=>e=>v(null,null,function*(){let t=e&&(yield e.getIdTokenResult()),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>Iv)return;let i=t?.token;od!==i&&(od=i,yield fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});function Pa(n=Ut()){let e=dn(n,"auth");if(e.isInitialized())return e.getImmediate();let t=Ta(n,{popupRedirectResolver:Od,persistence:[Dd,Sd,Ra]}),r=bo("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let o=new URL(r,location.origin);if(location.origin===o.origin){let a=Ev(o.toString());Sa(t,a,()=>a(t.currentUser)),ba(t,u=>a(u))}}let i=To("auth");return i&&Aa(t,`http://${i}`),t}function wv(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}cy({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let o=jt("internal-error");o.customData=i,t(o)},r.type="text/javascript",r.charset="UTF-8",wv().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});yv("Browser");var xd="auth",Ar=class{constructor(e){return e}},br=class{constructor(){return pn(xd)}};var Ca=new ln("angularfire2.auth-instances");function mI(n,e){let t=mr(xd,n,e);return t&&new Ar(t)}function gI(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Ar(r)}}var _I={provide:br,deps:[[new Pe,Ca]]},yI={provide:Ar,useFactory:mI,deps:[[new Pe,Ca],et]};function cb(n,...e){return re("angularfire",Et.full,"auth"),hn([yI,_I,{provide:Ca,useFactory:gI(n),multi:!0,deps:[Ue,_t,wt,qt,[new Pe,mn],...e]}])}var ub=ke(Pa,!0);var Vd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ld={};var rt,ka;(function(){var n;function e(w,m){function _(){}_.prototype=m.prototype,w.D=m.prototype,w.prototype=new _,w.prototype.constructor=w,w.C=function(I,T,b){for(var g=Array(arguments.length-2),Qe=2;Qe<arguments.length;Qe++)g[Qe-2]=arguments[Qe];return m.prototype[T].apply(I,g)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(w,m,_){_||(_=0);var I=Array(16);if(typeof m=="string")for(var T=0;16>T;++T)I[T]=m.charCodeAt(_++)|m.charCodeAt(_++)<<8|m.charCodeAt(_++)<<16|m.charCodeAt(_++)<<24;else for(T=0;16>T;++T)I[T]=m[_++]|m[_++]<<8|m[_++]<<16|m[_++]<<24;m=w.g[0],_=w.g[1],T=w.g[2];var b=w.g[3],g=m+(b^_&(T^b))+I[0]+3614090360&4294967295;m=_+(g<<7&4294967295|g>>>25),g=b+(T^m&(_^T))+I[1]+3905402710&4294967295,b=m+(g<<12&4294967295|g>>>20),g=T+(_^b&(m^_))+I[2]+606105819&4294967295,T=b+(g<<17&4294967295|g>>>15),g=_+(m^T&(b^m))+I[3]+3250441966&4294967295,_=T+(g<<22&4294967295|g>>>10),g=m+(b^_&(T^b))+I[4]+4118548399&4294967295,m=_+(g<<7&4294967295|g>>>25),g=b+(T^m&(_^T))+I[5]+1200080426&4294967295,b=m+(g<<12&4294967295|g>>>20),g=T+(_^b&(m^_))+I[6]+2821735955&4294967295,T=b+(g<<17&4294967295|g>>>15),g=_+(m^T&(b^m))+I[7]+4249261313&4294967295,_=T+(g<<22&4294967295|g>>>10),g=m+(b^_&(T^b))+I[8]+1770035416&4294967295,m=_+(g<<7&4294967295|g>>>25),g=b+(T^m&(_^T))+I[9]+2336552879&4294967295,b=m+(g<<12&4294967295|g>>>20),g=T+(_^b&(m^_))+I[10]+4294925233&4294967295,T=b+(g<<17&4294967295|g>>>15),g=_+(m^T&(b^m))+I[11]+2304563134&4294967295,_=T+(g<<22&4294967295|g>>>10),g=m+(b^_&(T^b))+I[12]+1804603682&4294967295,m=_+(g<<7&4294967295|g>>>25),g=b+(T^m&(_^T))+I[13]+4254626195&4294967295,b=m+(g<<12&4294967295|g>>>20),g=T+(_^b&(m^_))+I[14]+2792965006&4294967295,T=b+(g<<17&4294967295|g>>>15),g=_+(m^T&(b^m))+I[15]+1236535329&4294967295,_=T+(g<<22&4294967295|g>>>10),g=m+(T^b&(_^T))+I[1]+4129170786&4294967295,m=_+(g<<5&4294967295|g>>>27),g=b+(_^T&(m^_))+I[6]+3225465664&4294967295,b=m+(g<<9&4294967295|g>>>23),g=T+(m^_&(b^m))+I[11]+643717713&4294967295,T=b+(g<<14&4294967295|g>>>18),g=_+(b^m&(T^b))+I[0]+3921069994&4294967295,_=T+(g<<20&4294967295|g>>>12),g=m+(T^b&(_^T))+I[5]+3593408605&4294967295,m=_+(g<<5&4294967295|g>>>27),g=b+(_^T&(m^_))+I[10]+38016083&4294967295,b=m+(g<<9&4294967295|g>>>23),g=T+(m^_&(b^m))+I[15]+3634488961&4294967295,T=b+(g<<14&4294967295|g>>>18),g=_+(b^m&(T^b))+I[4]+3889429448&4294967295,_=T+(g<<20&4294967295|g>>>12),g=m+(T^b&(_^T))+I[9]+568446438&4294967295,m=_+(g<<5&4294967295|g>>>27),g=b+(_^T&(m^_))+I[14]+3275163606&4294967295,b=m+(g<<9&4294967295|g>>>23),g=T+(m^_&(b^m))+I[3]+4107603335&4294967295,T=b+(g<<14&4294967295|g>>>18),g=_+(b^m&(T^b))+I[8]+1163531501&4294967295,_=T+(g<<20&4294967295|g>>>12),g=m+(T^b&(_^T))+I[13]+2850285829&4294967295,m=_+(g<<5&4294967295|g>>>27),g=b+(_^T&(m^_))+I[2]+4243563512&4294967295,b=m+(g<<9&4294967295|g>>>23),g=T+(m^_&(b^m))+I[7]+1735328473&4294967295,T=b+(g<<14&4294967295|g>>>18),g=_+(b^m&(T^b))+I[12]+2368359562&4294967295,_=T+(g<<20&4294967295|g>>>12),g=m+(_^T^b)+I[5]+4294588738&4294967295,m=_+(g<<4&4294967295|g>>>28),g=b+(m^_^T)+I[8]+2272392833&4294967295,b=m+(g<<11&4294967295|g>>>21),g=T+(b^m^_)+I[11]+1839030562&4294967295,T=b+(g<<16&4294967295|g>>>16),g=_+(T^b^m)+I[14]+4259657740&4294967295,_=T+(g<<23&4294967295|g>>>9),g=m+(_^T^b)+I[1]+2763975236&4294967295,m=_+(g<<4&4294967295|g>>>28),g=b+(m^_^T)+I[4]+1272893353&4294967295,b=m+(g<<11&4294967295|g>>>21),g=T+(b^m^_)+I[7]+4139469664&4294967295,T=b+(g<<16&4294967295|g>>>16),g=_+(T^b^m)+I[10]+3200236656&4294967295,_=T+(g<<23&4294967295|g>>>9),g=m+(_^T^b)+I[13]+681279174&4294967295,m=_+(g<<4&4294967295|g>>>28),g=b+(m^_^T)+I[0]+3936430074&4294967295,b=m+(g<<11&4294967295|g>>>21),g=T+(b^m^_)+I[3]+3572445317&4294967295,T=b+(g<<16&4294967295|g>>>16),g=_+(T^b^m)+I[6]+76029189&4294967295,_=T+(g<<23&4294967295|g>>>9),g=m+(_^T^b)+I[9]+3654602809&4294967295,m=_+(g<<4&4294967295|g>>>28),g=b+(m^_^T)+I[12]+3873151461&4294967295,b=m+(g<<11&4294967295|g>>>21),g=T+(b^m^_)+I[15]+530742520&4294967295,T=b+(g<<16&4294967295|g>>>16),g=_+(T^b^m)+I[2]+3299628645&4294967295,_=T+(g<<23&4294967295|g>>>9),g=m+(T^(_|~b))+I[0]+4096336452&4294967295,m=_+(g<<6&4294967295|g>>>26),g=b+(_^(m|~T))+I[7]+1126891415&4294967295,b=m+(g<<10&4294967295|g>>>22),g=T+(m^(b|~_))+I[14]+2878612391&4294967295,T=b+(g<<15&4294967295|g>>>17),g=_+(b^(T|~m))+I[5]+4237533241&4294967295,_=T+(g<<21&4294967295|g>>>11),g=m+(T^(_|~b))+I[12]+1700485571&4294967295,m=_+(g<<6&4294967295|g>>>26),g=b+(_^(m|~T))+I[3]+2399980690&4294967295,b=m+(g<<10&4294967295|g>>>22),g=T+(m^(b|~_))+I[10]+4293915773&4294967295,T=b+(g<<15&4294967295|g>>>17),g=_+(b^(T|~m))+I[1]+2240044497&4294967295,_=T+(g<<21&4294967295|g>>>11),g=m+(T^(_|~b))+I[8]+1873313359&4294967295,m=_+(g<<6&4294967295|g>>>26),g=b+(_^(m|~T))+I[15]+4264355552&4294967295,b=m+(g<<10&4294967295|g>>>22),g=T+(m^(b|~_))+I[6]+2734768916&4294967295,T=b+(g<<15&4294967295|g>>>17),g=_+(b^(T|~m))+I[13]+1309151649&4294967295,_=T+(g<<21&4294967295|g>>>11),g=m+(T^(_|~b))+I[4]+4149444226&4294967295,m=_+(g<<6&4294967295|g>>>26),g=b+(_^(m|~T))+I[11]+3174756917&4294967295,b=m+(g<<10&4294967295|g>>>22),g=T+(m^(b|~_))+I[2]+718787259&4294967295,T=b+(g<<15&4294967295|g>>>17),g=_+(b^(T|~m))+I[9]+3951481745&4294967295,w.g[0]=w.g[0]+m&4294967295,w.g[1]=w.g[1]+(T+(g<<21&4294967295|g>>>11))&4294967295,w.g[2]=w.g[2]+T&4294967295,w.g[3]=w.g[3]+b&4294967295}r.prototype.u=function(w,m){m===void 0&&(m=w.length);for(var _=m-this.blockSize,I=this.B,T=this.h,b=0;b<m;){if(T==0)for(;b<=_;)i(this,w,b),b+=this.blockSize;if(typeof w=="string"){for(;b<m;)if(I[T++]=w.charCodeAt(b++),T==this.blockSize){i(this,I),T=0;break}}else for(;b<m;)if(I[T++]=w[b++],T==this.blockSize){i(this,I),T=0;break}}this.h=T,this.o+=m},r.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var m=1;m<w.length-8;++m)w[m]=0;var _=8*this.o;for(m=w.length-8;m<w.length;++m)w[m]=_&255,_/=256;for(this.u(w),w=Array(16),m=_=0;4>m;++m)for(var I=0;32>I;I+=8)w[_++]=this.g[m]>>>I&255;return w};function o(w,m){var _=u;return Object.prototype.hasOwnProperty.call(_,w)?_[w]:_[w]=m(w)}function a(w,m){this.h=m;for(var _=[],I=!0,T=w.length-1;0<=T;T--){var b=w[T]|0;I&&b==m||(_[T]=b,I=!1)}this.g=_}var u={};function h(w){return-128<=w&&128>w?o(w,function(m){return new a([m|0],0>m?-1:0)}):new a([w|0],0>w?-1:0)}function d(w){if(isNaN(w)||!isFinite(w))return y;if(0>w)return D(d(-w));for(var m=[],_=1,I=0;w>=_;I++)m[I]=w/_|0,_*=4294967296;return new a(m,0)}function p(w,m){if(w.length==0)throw Error("number format error: empty string");if(m=m||10,2>m||36<m)throw Error("radix out of range: "+m);if(w.charAt(0)=="-")return D(p(w.substring(1),m));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var _=d(Math.pow(m,8)),I=y,T=0;T<w.length;T+=8){var b=Math.min(8,w.length-T),g=parseInt(w.substring(T,T+b),m);8>b?(b=d(Math.pow(m,b)),I=I.j(b).add(d(g))):(I=I.j(_),I=I.add(d(g)))}return I}var y=h(0),E=h(1),R=h(16777216);n=a.prototype,n.m=function(){if(x(this))return-D(this).m();for(var w=0,m=1,_=0;_<this.g.length;_++){var I=this.i(_);w+=(0<=I?I:4294967296+I)*m,m*=4294967296}return w},n.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(k(this))return"0";if(x(this))return"-"+D(this).toString(w);for(var m=d(Math.pow(w,6)),_=this,I="";;){var T=J(_,m).g;_=$(_,T.j(m));var b=((0<_.g.length?_.g[0]:_.h)>>>0).toString(w);if(_=T,k(_))return b+I;for(;6>b.length;)b="0"+b;I=b+I}},n.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function k(w){if(w.h!=0)return!1;for(var m=0;m<w.g.length;m++)if(w.g[m]!=0)return!1;return!0}function x(w){return w.h==-1}n.l=function(w){return w=$(this,w),x(w)?-1:k(w)?0:1};function D(w){for(var m=w.g.length,_=[],I=0;I<m;I++)_[I]=~w.g[I];return new a(_,~w.h).add(E)}n.abs=function(){return x(this)?D(this):this},n.add=function(w){for(var m=Math.max(this.g.length,w.g.length),_=[],I=0,T=0;T<=m;T++){var b=I+(this.i(T)&65535)+(w.i(T)&65535),g=(b>>>16)+(this.i(T)>>>16)+(w.i(T)>>>16);I=g>>>16,b&=65535,g&=65535,_[T]=g<<16|b}return new a(_,_[_.length-1]&-2147483648?-1:0)};function $(w,m){return w.add(D(m))}n.j=function(w){if(k(this)||k(w))return y;if(x(this))return x(w)?D(this).j(D(w)):D(D(this).j(w));if(x(w))return D(this.j(D(w)));if(0>this.l(R)&&0>w.l(R))return d(this.m()*w.m());for(var m=this.g.length+w.g.length,_=[],I=0;I<2*m;I++)_[I]=0;for(I=0;I<this.g.length;I++)for(var T=0;T<w.g.length;T++){var b=this.i(I)>>>16,g=this.i(I)&65535,Qe=w.i(T)>>>16,zn=w.i(T)&65535;_[2*I+2*T]+=g*zn,U(_,2*I+2*T),_[2*I+2*T+1]+=b*zn,U(_,2*I+2*T+1),_[2*I+2*T+1]+=g*Qe,U(_,2*I+2*T+1),_[2*I+2*T+2]+=b*Qe,U(_,2*I+2*T+2)}for(I=0;I<m;I++)_[I]=_[2*I+1]<<16|_[2*I];for(I=m;I<2*m;I++)_[I]=0;return new a(_,0)};function U(w,m){for(;(w[m]&65535)!=w[m];)w[m+1]+=w[m]>>>16,w[m]&=65535,m++}function j(w,m){this.g=w,this.h=m}function J(w,m){if(k(m))throw Error("division by zero");if(k(w))return new j(y,y);if(x(w))return m=J(D(w),m),new j(D(m.g),D(m.h));if(x(m))return m=J(w,D(m)),new j(D(m.g),m.h);if(30<w.g.length){if(x(w)||x(m))throw Error("slowDivide_ only works with positive integers.");for(var _=E,I=m;0>=I.l(w);)_=Ie(_),I=Ie(I);var T=Y(_,1),b=Y(I,1);for(I=Y(I,2),_=Y(_,2);!k(I);){var g=b.add(I);0>=g.l(w)&&(T=T.add(_),b=g),I=Y(I,1),_=Y(_,1)}return m=$(w,T.j(m)),new j(T,m)}for(T=y;0<=w.l(m);){for(_=Math.max(1,Math.floor(w.m()/m.m())),I=Math.ceil(Math.log(_)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),b=d(_),g=b.j(m);x(g)||0<g.l(w);)_-=I,b=d(_),g=b.j(m);k(b)&&(b=E),T=T.add(b),w=$(w,g)}return new j(T,w)}n.A=function(w){return J(this,w).h},n.and=function(w){for(var m=Math.max(this.g.length,w.g.length),_=[],I=0;I<m;I++)_[I]=this.i(I)&w.i(I);return new a(_,this.h&w.h)},n.or=function(w){for(var m=Math.max(this.g.length,w.g.length),_=[],I=0;I<m;I++)_[I]=this.i(I)|w.i(I);return new a(_,this.h|w.h)},n.xor=function(w){for(var m=Math.max(this.g.length,w.g.length),_=[],I=0;I<m;I++)_[I]=this.i(I)^w.i(I);return new a(_,this.h^w.h)};function Ie(w){for(var m=w.g.length+1,_=[],I=0;I<m;I++)_[I]=w.i(I)<<1|w.i(I-1)>>>31;return new a(_,w.h)}function Y(w,m){var _=m>>5;m%=32;for(var I=w.g.length-_,T=[],b=0;b<I;b++)T[b]=0<m?w.i(b+_)>>>m|w.i(b+_+1)<<32-m:w.i(b+_);return new a(T,w.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,ka=Ld.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,rt=Ld.Integer=a}).apply(typeof Vd<"u"?Vd:typeof self<"u"?self:typeof window<"u"?window:{});var $i=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},it={};var Da,vI,_n,Na,Sr,ji,Oa,xa,Va;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(s,c,l){return s==Array.prototype||s==Object.prototype||(s[c]=l.value),s};function t(s){s=[typeof globalThis=="object"&&globalThis,s,typeof window=="object"&&window,typeof self=="object"&&self,typeof $i=="object"&&$i];for(var c=0;c<s.length;++c){var l=s[c];if(l&&l.Math==Math)return l}throw Error("Cannot find global object")}var r=t(this);function i(s,c){if(c)e:{var l=r;s=s.split(".");for(var f=0;f<s.length-1;f++){var A=s[f];if(!(A in l))break e;l=l[A]}s=s[s.length-1],f=l[s],c=c(f),c!=f&&c!=null&&e(l,s,{configurable:!0,writable:!0,value:c})}}function o(s,c){s instanceof String&&(s+="");var l=0,f=!1,A={next:function(){if(!f&&l<s.length){var S=l++;return{value:c(S,s[S]),done:!1}}return f=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}i("Array.prototype.values",function(s){return s||function(){return o(this,function(c,l){return l})}});var a=a||{},u=this||self;function h(s){var c=typeof s;return c=c!="object"?c:s?Array.isArray(s)?"array":c:"null",c=="array"||c=="object"&&typeof s.length=="number"}function d(s){var c=typeof s;return c=="object"&&s!=null||c=="function"}function p(s,c,l){return s.call.apply(s.bind,arguments)}function y(s,c,l){if(!s)throw Error();if(2<arguments.length){var f=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,f),s.apply(c,A)}}return function(){return s.apply(c,arguments)}}function E(s,c,l){return E=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?p:y,E.apply(null,arguments)}function R(s,c){var l=Array.prototype.slice.call(arguments,1);return function(){var f=l.slice();return f.push.apply(f,arguments),s.apply(this,f)}}function k(s,c){function l(){}l.prototype=c.prototype,s.aa=c.prototype,s.prototype=new l,s.prototype.constructor=s,s.Qb=function(f,A,S){for(var N=Array(arguments.length-2),X=2;X<arguments.length;X++)N[X-2]=arguments[X];return c.prototype[A].apply(f,N)}}function x(s){let c=s.length;if(0<c){let l=Array(c);for(let f=0;f<c;f++)l[f]=s[f];return l}return[]}function D(s,c){for(let l=1;l<arguments.length;l++){let f=arguments[l];if(h(f)){let A=s.length||0,S=f.length||0;s.length=A+S;for(let N=0;N<S;N++)s[A+N]=f[N]}else s.push(f)}}class ${constructor(c,l){this.i=c,this.j=l,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function U(s){return/^[\s\xa0]*$/.test(s)}function j(){var s=u.navigator;return s&&(s=s.userAgent)?s:""}function J(s){return J[" "](s),s}J[" "]=function(){};var Ie=j().indexOf("Gecko")!=-1&&!(j().toLowerCase().indexOf("webkit")!=-1&&j().indexOf("Edge")==-1)&&!(j().indexOf("Trident")!=-1||j().indexOf("MSIE")!=-1)&&j().indexOf("Edge")==-1;function Y(s,c,l){for(let f in s)c.call(l,s[f],f,s)}function w(s,c){for(let l in s)c.call(void 0,s[l],l,s)}function m(s){let c={};for(let l in s)c[l]=s[l];return c}let _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(s,c){let l,f;for(let A=1;A<arguments.length;A++){f=arguments[A];for(l in f)s[l]=f[l];for(let S=0;S<_.length;S++)l=_[S],Object.prototype.hasOwnProperty.call(f,l)&&(s[l]=f[l])}}function T(s){var c=1;s=s.split(":");let l=[];for(;0<c&&s.length;)l.push(s.shift()),c--;return s.length&&l.push(s.join(":")),l}function b(s){u.setTimeout(()=>{throw s},0)}function g(){var s=Bs;let c=null;return s.g&&(c=s.g,s.g=s.g.next,s.g||(s.h=null),c.next=null),c}class Qe{constructor(){this.h=this.g=null}add(c,l){let f=zn.get();f.set(c,l),this.h?this.h.next=f:this.g=f,this.h=f}}var zn=new $(()=>new mm,s=>s.reset());class mm{constructor(){this.next=this.g=this.h=null}set(c,l){this.h=c,this.g=l,this.next=null}reset(){this.next=this.g=this.h=null}}let Wn,Gn=!1,Bs=new Qe,Ju=()=>{let s=u.Promise.resolve(void 0);Wn=()=>{s.then(gm)}};var gm=()=>{for(var s;s=g();){try{s.h.call(s.g)}catch(l){b(l)}var c=zn;c.j(s),100>c.h&&(c.h++,s.next=c.g,c.g=s)}Gn=!1};function dt(){this.s=this.s,this.C=this.C}dt.prototype.s=!1,dt.prototype.ma=function(){this.s||(this.s=!0,this.N())},dt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function fe(s,c){this.type=s,this.g=this.target=c,this.defaultPrevented=!1}fe.prototype.h=function(){this.defaultPrevented=!0};var _m=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var s=!1,c=Object.defineProperty({},"passive",{get:function(){s=!0}});try{let l=()=>{};u.addEventListener("test",l,c),u.removeEventListener("test",l,c)}catch{}return s}();function Kn(s,c){if(fe.call(this,s?s.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,s){var l=this.type=s.type,f=s.changedTouches&&s.changedTouches.length?s.changedTouches[0]:null;if(this.target=s.target||s.srcElement,this.g=c,c=s.relatedTarget){if(Ie){e:{try{J(c.nodeName);var A=!0;break e}catch{}A=!1}A||(c=null)}}else l=="mouseover"?c=s.fromElement:l=="mouseout"&&(c=s.toElement);this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0),this.button=s.button,this.key=s.key||"",this.ctrlKey=s.ctrlKey,this.altKey=s.altKey,this.shiftKey=s.shiftKey,this.metaKey=s.metaKey,this.pointerId=s.pointerId||0,this.pointerType=typeof s.pointerType=="string"?s.pointerType:ym[s.pointerType]||"",this.state=s.state,this.i=s,s.defaultPrevented&&Kn.aa.h.call(this)}}k(Kn,fe);var ym={2:"touch",3:"pen",4:"mouse"};Kn.prototype.h=function(){Kn.aa.h.call(this);var s=this.i;s.preventDefault?s.preventDefault():s.returnValue=!1};var Hn="closure_listenable_"+(1e6*Math.random()|0),vm=0;function Im(s,c,l,f,A){this.listener=s,this.proxy=null,this.src=c,this.type=l,this.capture=!!f,this.ha=A,this.key=++vm,this.da=this.fa=!1}function Qr(s){s.da=!0,s.listener=null,s.proxy=null,s.src=null,s.ha=null}function Yr(s){this.src=s,this.g={},this.h=0}Yr.prototype.add=function(s,c,l,f,A){var S=s.toString();s=this.g[S],s||(s=this.g[S]=[],this.h++);var N=$s(s,c,f,A);return-1<N?(c=s[N],l||(c.fa=!1)):(c=new Im(c,this.src,S,!!f,A),c.fa=l,s.push(c)),c};function qs(s,c){var l=c.type;if(l in s.g){var f=s.g[l],A=Array.prototype.indexOf.call(f,c,void 0),S;(S=0<=A)&&Array.prototype.splice.call(f,A,1),S&&(Qr(c),s.g[l].length==0&&(delete s.g[l],s.h--))}}function $s(s,c,l,f){for(var A=0;A<s.length;++A){var S=s[A];if(!S.da&&S.listener==c&&S.capture==!!l&&S.ha==f)return A}return-1}var js="closure_lm_"+(1e6*Math.random()|0),zs={};function Xu(s,c,l,f,A){if(f&&f.once)return el(s,c,l,f,A);if(Array.isArray(c)){for(var S=0;S<c.length;S++)Xu(s,c[S],l,f,A);return null}return l=Hs(l),s&&s[Hn]?s.K(c,l,d(f)?!!f.capture:!!f,A):Zu(s,c,l,!1,f,A)}function Zu(s,c,l,f,A,S){if(!c)throw Error("Invalid event type");var N=d(A)?!!A.capture:!!A,X=Gs(s);if(X||(s[js]=X=new Yr(s)),l=X.add(c,l,f,N,S),l.proxy)return l;if(f=Em(),l.proxy=f,f.src=s,f.listener=l,s.addEventListener)_m||(A=N),A===void 0&&(A=!1),s.addEventListener(c.toString(),f,A);else if(s.attachEvent)s.attachEvent(nl(c.toString()),f);else if(s.addListener&&s.removeListener)s.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return l}function Em(){function s(l){return c.call(s.src,s.listener,l)}let c=wm;return s}function el(s,c,l,f,A){if(Array.isArray(c)){for(var S=0;S<c.length;S++)el(s,c[S],l,f,A);return null}return l=Hs(l),s&&s[Hn]?s.L(c,l,d(f)?!!f.capture:!!f,A):Zu(s,c,l,!0,f,A)}function tl(s,c,l,f,A){if(Array.isArray(c))for(var S=0;S<c.length;S++)tl(s,c[S],l,f,A);else f=d(f)?!!f.capture:!!f,l=Hs(l),s&&s[Hn]?(s=s.i,c=String(c).toString(),c in s.g&&(S=s.g[c],l=$s(S,l,f,A),-1<l&&(Qr(S[l]),Array.prototype.splice.call(S,l,1),S.length==0&&(delete s.g[c],s.h--)))):s&&(s=Gs(s))&&(c=s.g[c.toString()],s=-1,c&&(s=$s(c,l,f,A)),(l=-1<s?c[s]:null)&&Ws(l))}function Ws(s){if(typeof s!="number"&&s&&!s.da){var c=s.src;if(c&&c[Hn])qs(c.i,s);else{var l=s.type,f=s.proxy;c.removeEventListener?c.removeEventListener(l,f,s.capture):c.detachEvent?c.detachEvent(nl(l),f):c.addListener&&c.removeListener&&c.removeListener(f),(l=Gs(c))?(qs(l,s),l.h==0&&(l.src=null,c[js]=null)):Qr(s)}}}function nl(s){return s in zs?zs[s]:zs[s]="on"+s}function wm(s,c){if(s.da)s=!0;else{c=new Kn(c,this);var l=s.listener,f=s.ha||s.src;s.fa&&Ws(s),s=l.call(f,c)}return s}function Gs(s){return s=s[js],s instanceof Yr?s:null}var Ks="__closure_events_fn_"+(1e9*Math.random()>>>0);function Hs(s){return typeof s=="function"?s:(s[Ks]||(s[Ks]=function(c){return s.handleEvent(c)}),s[Ks])}function pe(){dt.call(this),this.i=new Yr(this),this.M=this,this.F=null}k(pe,dt),pe.prototype[Hn]=!0,pe.prototype.removeEventListener=function(s,c,l,f){tl(this,s,c,l,f)};function Ee(s,c){var l,f=s.F;if(f)for(l=[];f;f=f.F)l.push(f);if(s=s.M,f=c.type||c,typeof c=="string")c=new fe(c,s);else if(c instanceof fe)c.target=c.target||s;else{var A=c;c=new fe(f,s),I(c,A)}if(A=!0,l)for(var S=l.length-1;0<=S;S--){var N=c.g=l[S];A=Jr(N,f,!0,c)&&A}if(N=c.g=s,A=Jr(N,f,!0,c)&&A,A=Jr(N,f,!1,c)&&A,l)for(S=0;S<l.length;S++)N=c.g=l[S],A=Jr(N,f,!1,c)&&A}pe.prototype.N=function(){if(pe.aa.N.call(this),this.i){var s=this.i,c;for(c in s.g){for(var l=s.g[c],f=0;f<l.length;f++)Qr(l[f]);delete s.g[c],s.h--}}this.F=null},pe.prototype.K=function(s,c,l,f){return this.i.add(String(s),c,!1,l,f)},pe.prototype.L=function(s,c,l,f){return this.i.add(String(s),c,!0,l,f)};function Jr(s,c,l,f){if(c=s.i.g[String(c)],!c)return!0;c=c.concat();for(var A=!0,S=0;S<c.length;++S){var N=c[S];if(N&&!N.da&&N.capture==l){var X=N.listener,he=N.ha||N.src;N.fa&&qs(s.i,N),A=X.call(he,f)!==!1&&A}}return A&&!f.defaultPrevented}function rl(s,c,l){if(typeof s=="function")l&&(s=E(s,l));else if(s&&typeof s.handleEvent=="function")s=E(s.handleEvent,s);else throw Error("Invalid listener argument");return 2147483647<Number(c)?-1:u.setTimeout(s,c||0)}function il(s){s.g=rl(()=>{s.g=null,s.i&&(s.i=!1,il(s))},s.l);let c=s.h;s.h=null,s.m.apply(null,c)}class Tm extends dt{constructor(c,l){super(),this.m=c,this.l=l,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:il(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Qn(s){dt.call(this),this.h=s,this.g={}}k(Qn,dt);var sl=[];function ol(s){Y(s.g,function(c,l){this.g.hasOwnProperty(l)&&Ws(c)},s),s.g={}}Qn.prototype.N=function(){Qn.aa.N.call(this),ol(this)},Qn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Qs=u.JSON.stringify,Am=u.JSON.parse,bm=class{stringify(s){return u.JSON.stringify(s,void 0)}parse(s){return u.JSON.parse(s,void 0)}};function Ys(){}Ys.prototype.h=null;function al(s){return s.h||(s.h=s.i())}function cl(){}var Yn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Js(){fe.call(this,"d")}k(Js,fe);function Xs(){fe.call(this,"c")}k(Xs,fe);var Nt={},ul=null;function Xr(){return ul=ul||new pe}Nt.La="serverreachability";function ll(s){fe.call(this,Nt.La,s)}k(ll,fe);function Jn(s){let c=Xr();Ee(c,new ll(c))}Nt.STAT_EVENT="statevent";function hl(s,c){fe.call(this,Nt.STAT_EVENT,s),this.stat=c}k(hl,fe);function we(s){let c=Xr();Ee(c,new hl(c,s))}Nt.Ma="timingevent";function dl(s,c){fe.call(this,Nt.Ma,s),this.size=c}k(dl,fe);function Xn(s,c){if(typeof s!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){s()},c)}function Zn(){this.g=!0}Zn.prototype.xa=function(){this.g=!1};function Sm(s,c,l,f,A,S){s.info(function(){if(s.g)if(S)for(var N="",X=S.split("&"),he=0;he<X.length;he++){var H=X[he].split("=");if(1<H.length){var me=H[0];H=H[1];var ge=me.split("_");N=2<=ge.length&&ge[1]=="type"?N+(me+"="+H+"&"):N+(me+"=redacted&")}}else N=null;else N=S;return"XMLHTTP REQ ("+f+") [attempt "+A+"]: "+c+`
`+l+`
`+N})}function Rm(s,c,l,f,A,S,N){s.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+A+"]: "+c+`
`+l+`
`+S+" "+N})}function on(s,c,l,f){s.info(function(){return"XMLHTTP TEXT ("+c+"): "+Cm(s,l)+(f?" "+f:"")})}function Pm(s,c){s.info(function(){return"TIMEOUT: "+c})}Zn.prototype.info=function(){};function Cm(s,c){if(!s.g)return c;if(!c)return null;try{var l=JSON.parse(c);if(l){for(s=0;s<l.length;s++)if(Array.isArray(l[s])){var f=l[s];if(!(2>f.length)){var A=f[1];if(Array.isArray(A)&&!(1>A.length)){var S=A[0];if(S!="noop"&&S!="stop"&&S!="close")for(var N=1;N<A.length;N++)A[N]=""}}}}return Qs(l)}catch{return c}}var Zr={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},fl={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Zs;function ei(){}k(ei,Ys),ei.prototype.g=function(){return new XMLHttpRequest},ei.prototype.i=function(){return{}},Zs=new ei;function ft(s,c,l,f){this.j=s,this.i=c,this.l=l,this.R=f||1,this.U=new Qn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new pl}function pl(){this.i=null,this.g="",this.h=!1}var ml={},eo={};function to(s,c,l){s.L=1,s.v=ii(Ye(c)),s.m=l,s.P=!0,gl(s,null)}function gl(s,c){s.F=Date.now(),ti(s),s.A=Ye(s.v);var l=s.A,f=s.R;Array.isArray(f)||(f=[String(f)]),kl(l.i,"t",f),s.C=0,l=s.j.J,s.h=new pl,s.g=Hl(s.j,l?c:null,!s.m),0<s.O&&(s.M=new Tm(E(s.Y,s,s.g),s.O)),c=s.U,l=s.g,f=s.ca;var A="readystatechange";Array.isArray(A)||(A&&(sl[0]=A.toString()),A=sl);for(var S=0;S<A.length;S++){var N=Xu(l,A[S],f||c.handleEvent,!1,c.h||c);if(!N)break;c.g[N.key]=N}c=s.H?m(s.H):{},s.m?(s.u||(s.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",s.g.ea(s.A,s.u,s.m,c)):(s.u="GET",s.g.ea(s.A,s.u,null,c)),Jn(),Sm(s.i,s.u,s.A,s.l,s.R,s.m)}ft.prototype.ca=function(s){s=s.target;let c=this.M;c&&Je(s)==3?c.j():this.Y(s)},ft.prototype.Y=function(s){try{if(s==this.g)e:{let ge=Je(this.g);var c=this.g.Ba();let un=this.g.Z();if(!(3>ge)&&(ge!=3||this.g&&(this.h.h||this.g.oa()||Ml(this.g)))){this.J||ge!=4||c==7||(c==8||0>=un?Jn(3):Jn(2)),no(this);var l=this.g.Z();this.X=l;t:if(_l(this)){var f=Ml(this.g);s="";var A=f.length,S=Je(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ot(this),er(this);var N="";break t}this.h.i=new u.TextDecoder}for(c=0;c<A;c++)this.h.h=!0,s+=this.h.i.decode(f[c],{stream:!(S&&c==A-1)});f.length=0,this.h.g+=s,this.C=0,N=this.h.g}else N=this.g.oa();if(this.o=l==200,Rm(this.i,this.u,this.A,this.l,this.R,ge,l),this.o){if(this.T&&!this.K){t:{if(this.g){var X,he=this.g;if((X=he.g?he.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!U(X)){var H=X;break t}}H=null}if(l=H)on(this.i,this.l,l,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ro(this,l);else{this.o=!1,this.s=3,we(12),Ot(this),er(this);break e}}if(this.P){l=!0;let Ne;for(;!this.J&&this.C<N.length;)if(Ne=km(this,N),Ne==eo){ge==4&&(this.s=4,we(14),l=!1),on(this.i,this.l,null,"[Incomplete Response]");break}else if(Ne==ml){this.s=4,we(15),on(this.i,this.l,N,"[Invalid Chunk]"),l=!1;break}else on(this.i,this.l,Ne,null),ro(this,Ne);if(_l(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ge!=4||N.length!=0||this.h.h||(this.s=1,we(16),l=!1),this.o=this.o&&l,!l)on(this.i,this.l,N,"[Invalid Chunked Response]"),Ot(this),er(this);else if(0<N.length&&!this.W){this.W=!0;var me=this.j;me.g==this&&me.ba&&!me.M&&(me.j.info("Great, no buffering proxy detected. Bytes received: "+N.length),uo(me),me.M=!0,we(11))}}else on(this.i,this.l,N,null),ro(this,N);ge==4&&Ot(this),this.o&&!this.J&&(ge==4?zl(this.j,this):(this.o=!1,ti(this)))}else Km(this.g),l==400&&0<N.indexOf("Unknown SID")?(this.s=3,we(12)):(this.s=0,we(13)),Ot(this),er(this)}}}catch{}finally{}};function _l(s){return s.g?s.u=="GET"&&s.L!=2&&s.j.Ca:!1}function km(s,c){var l=s.C,f=c.indexOf(`
`,l);return f==-1?eo:(l=Number(c.substring(l,f)),isNaN(l)?ml:(f+=1,f+l>c.length?eo:(c=c.slice(f,f+l),s.C=f+l,c)))}ft.prototype.cancel=function(){this.J=!0,Ot(this)};function ti(s){s.S=Date.now()+s.I,yl(s,s.I)}function yl(s,c){if(s.B!=null)throw Error("WatchDog timer not null");s.B=Xn(E(s.ba,s),c)}function no(s){s.B&&(u.clearTimeout(s.B),s.B=null)}ft.prototype.ba=function(){this.B=null;let s=Date.now();0<=s-this.S?(Pm(this.i,this.A),this.L!=2&&(Jn(),we(17)),Ot(this),this.s=2,er(this)):yl(this,this.S-s)};function er(s){s.j.G==0||s.J||zl(s.j,s)}function Ot(s){no(s);var c=s.M;c&&typeof c.ma=="function"&&c.ma(),s.M=null,ol(s.U),s.g&&(c=s.g,s.g=null,c.abort(),c.ma())}function ro(s,c){try{var l=s.j;if(l.G!=0&&(l.g==s||io(l.h,s))){if(!s.K&&io(l.h,s)&&l.G==3){try{var f=l.Da.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var A=f;if(A[0]==0){e:if(!l.u){if(l.g)if(l.g.F+3e3<s.F)ui(l),ai(l);else break e;co(l),we(18)}}else l.za=A[1],0<l.za-l.T&&37500>A[2]&&l.F&&l.v==0&&!l.C&&(l.C=Xn(E(l.Za,l),6e3));if(1>=El(l.h)&&l.ca){try{l.ca()}catch{}l.ca=void 0}}else Vt(l,11)}else if((s.K||l.g==s)&&ui(l),!U(c))for(A=l.Da.g.parse(c),c=0;c<A.length;c++){let H=A[c];if(l.T=H[0],H=H[1],l.G==2)if(H[0]=="c"){l.K=H[1],l.ia=H[2];let me=H[3];me!=null&&(l.la=me,l.j.info("VER="+l.la));let ge=H[4];ge!=null&&(l.Aa=ge,l.j.info("SVER="+l.Aa));let un=H[5];un!=null&&typeof un=="number"&&0<un&&(f=1.5*un,l.L=f,l.j.info("backChannelRequestTimeoutMs_="+f)),f=l;let Ne=s.g;if(Ne){let hi=Ne.g?Ne.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(hi){var S=f.h;S.g||hi.indexOf("spdy")==-1&&hi.indexOf("quic")==-1&&hi.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(so(S,S.h),S.h=null))}if(f.D){let lo=Ne.g?Ne.g.getResponseHeader("X-HTTP-Session-Id"):null;lo&&(f.ya=lo,Z(f.I,f.D,lo))}}l.G=3,l.l&&l.l.ua(),l.ba&&(l.R=Date.now()-s.F,l.j.info("Handshake RTT: "+l.R+"ms")),f=l;var N=s;if(f.qa=Kl(f,f.J?f.ia:null,f.W),N.K){wl(f.h,N);var X=N,he=f.L;he&&(X.I=he),X.B&&(no(X),ti(X)),f.g=N}else $l(f);0<l.i.length&&ci(l)}else H[0]!="stop"&&H[0]!="close"||Vt(l,7);else l.G==3&&(H[0]=="stop"||H[0]=="close"?H[0]=="stop"?Vt(l,7):ao(l):H[0]!="noop"&&l.l&&l.l.ta(H),l.v=0)}}Jn(4)}catch{}}var Dm=class{constructor(s,c){this.g=s,this.map=c}};function vl(s){this.l=s||10,u.PerformanceNavigationTiming?(s=u.performance.getEntriesByType("navigation"),s=0<s.length&&(s[0].nextHopProtocol=="hq"||s[0].nextHopProtocol=="h2")):s=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=s?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Il(s){return s.h?!0:s.g?s.g.size>=s.j:!1}function El(s){return s.h?1:s.g?s.g.size:0}function io(s,c){return s.h?s.h==c:s.g?s.g.has(c):!1}function so(s,c){s.g?s.g.add(c):s.h=c}function wl(s,c){s.h&&s.h==c?s.h=null:s.g&&s.g.has(c)&&s.g.delete(c)}vl.prototype.cancel=function(){if(this.i=Tl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let s of this.g.values())s.cancel();this.g.clear()}};function Tl(s){if(s.h!=null)return s.i.concat(s.h.D);if(s.g!=null&&s.g.size!==0){let c=s.i;for(let l of s.g.values())c=c.concat(l.D);return c}return x(s.i)}function Nm(s){if(s.V&&typeof s.V=="function")return s.V();if(typeof Map<"u"&&s instanceof Map||typeof Set<"u"&&s instanceof Set)return Array.from(s.values());if(typeof s=="string")return s.split("");if(h(s)){for(var c=[],l=s.length,f=0;f<l;f++)c.push(s[f]);return c}c=[],l=0;for(f in s)c[l++]=s[f];return c}function Om(s){if(s.na&&typeof s.na=="function")return s.na();if(!s.V||typeof s.V!="function"){if(typeof Map<"u"&&s instanceof Map)return Array.from(s.keys());if(!(typeof Set<"u"&&s instanceof Set)){if(h(s)||typeof s=="string"){var c=[];s=s.length;for(var l=0;l<s;l++)c.push(l);return c}c=[],l=0;for(let f in s)c[l++]=f;return c}}}function Al(s,c){if(s.forEach&&typeof s.forEach=="function")s.forEach(c,void 0);else if(h(s)||typeof s=="string")Array.prototype.forEach.call(s,c,void 0);else for(var l=Om(s),f=Nm(s),A=f.length,S=0;S<A;S++)c.call(void 0,f[S],l&&l[S],s)}var bl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function xm(s,c){if(s){s=s.split("&");for(var l=0;l<s.length;l++){var f=s[l].indexOf("="),A=null;if(0<=f){var S=s[l].substring(0,f);A=s[l].substring(f+1)}else S=s[l];c(S,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function xt(s){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,s instanceof xt){this.h=s.h,ni(this,s.j),this.o=s.o,this.g=s.g,ri(this,s.s),this.l=s.l;var c=s.i,l=new rr;l.i=c.i,c.g&&(l.g=new Map(c.g),l.h=c.h),Sl(this,l),this.m=s.m}else s&&(c=String(s).match(bl))?(this.h=!1,ni(this,c[1]||"",!0),this.o=tr(c[2]||""),this.g=tr(c[3]||"",!0),ri(this,c[4]),this.l=tr(c[5]||"",!0),Sl(this,c[6]||"",!0),this.m=tr(c[7]||"")):(this.h=!1,this.i=new rr(null,this.h))}xt.prototype.toString=function(){var s=[],c=this.j;c&&s.push(nr(c,Rl,!0),":");var l=this.g;return(l||c=="file")&&(s.push("//"),(c=this.o)&&s.push(nr(c,Rl,!0),"@"),s.push(encodeURIComponent(String(l)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l=this.s,l!=null&&s.push(":",String(l))),(l=this.l)&&(this.g&&l.charAt(0)!="/"&&s.push("/"),s.push(nr(l,l.charAt(0)=="/"?Mm:Lm,!0))),(l=this.i.toString())&&s.push("?",l),(l=this.m)&&s.push("#",nr(l,Um)),s.join("")};function Ye(s){return new xt(s)}function ni(s,c,l){s.j=l?tr(c,!0):c,s.j&&(s.j=s.j.replace(/:$/,""))}function ri(s,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);s.s=c}else s.s=null}function Sl(s,c,l){c instanceof rr?(s.i=c,Bm(s.i,s.h)):(l||(c=nr(c,Fm)),s.i=new rr(c,s.h))}function Z(s,c,l){s.i.set(c,l)}function ii(s){return Z(s,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),s}function tr(s,c){return s?c?decodeURI(s.replace(/%25/g,"%2525")):decodeURIComponent(s):""}function nr(s,c,l){return typeof s=="string"?(s=encodeURI(s).replace(c,Vm),l&&(s=s.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),s):null}function Vm(s){return s=s.charCodeAt(0),"%"+(s>>4&15).toString(16)+(s&15).toString(16)}var Rl=/[#\/\?@]/g,Lm=/[#\?:]/g,Mm=/[#\?]/g,Fm=/[#\?@]/g,Um=/#/g;function rr(s,c){this.h=this.g=null,this.i=s||null,this.j=!!c}function pt(s){s.g||(s.g=new Map,s.h=0,s.i&&xm(s.i,function(c,l){s.add(decodeURIComponent(c.replace(/\+/g," ")),l)}))}n=rr.prototype,n.add=function(s,c){pt(this),this.i=null,s=an(this,s);var l=this.g.get(s);return l||this.g.set(s,l=[]),l.push(c),this.h+=1,this};function Pl(s,c){pt(s),c=an(s,c),s.g.has(c)&&(s.i=null,s.h-=s.g.get(c).length,s.g.delete(c))}function Cl(s,c){return pt(s),c=an(s,c),s.g.has(c)}n.forEach=function(s,c){pt(this),this.g.forEach(function(l,f){l.forEach(function(A){s.call(c,A,f,this)},this)},this)},n.na=function(){pt(this);let s=Array.from(this.g.values()),c=Array.from(this.g.keys()),l=[];for(let f=0;f<c.length;f++){let A=s[f];for(let S=0;S<A.length;S++)l.push(c[f])}return l},n.V=function(s){pt(this);let c=[];if(typeof s=="string")Cl(this,s)&&(c=c.concat(this.g.get(an(this,s))));else{s=Array.from(this.g.values());for(let l=0;l<s.length;l++)c=c.concat(s[l])}return c},n.set=function(s,c){return pt(this),this.i=null,s=an(this,s),Cl(this,s)&&(this.h-=this.g.get(s).length),this.g.set(s,[c]),this.h+=1,this},n.get=function(s,c){return s?(s=this.V(s),0<s.length?String(s[0]):c):c};function kl(s,c,l){Pl(s,c),0<l.length&&(s.i=null,s.g.set(an(s,c),x(l)),s.h+=l.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let s=[],c=Array.from(this.g.keys());for(var l=0;l<c.length;l++){var f=c[l];let S=encodeURIComponent(String(f)),N=this.V(f);for(f=0;f<N.length;f++){var A=S;N[f]!==""&&(A+="="+encodeURIComponent(String(N[f]))),s.push(A)}}return this.i=s.join("&")};function an(s,c){return c=String(c),s.j&&(c=c.toLowerCase()),c}function Bm(s,c){c&&!s.j&&(pt(s),s.i=null,s.g.forEach(function(l,f){var A=f.toLowerCase();f!=A&&(Pl(this,f),kl(this,A,l))},s)),s.j=c}function qm(s,c){let l=new Zn;if(u.Image){let f=new Image;f.onload=R(mt,l,"TestLoadImage: loaded",!0,c,f),f.onerror=R(mt,l,"TestLoadImage: error",!1,c,f),f.onabort=R(mt,l,"TestLoadImage: abort",!1,c,f),f.ontimeout=R(mt,l,"TestLoadImage: timeout",!1,c,f),u.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=s}else c(!1)}function $m(s,c){let l=new Zn,f=new AbortController,A=setTimeout(()=>{f.abort(),mt(l,"TestPingServer: timeout",!1,c)},1e4);fetch(s,{signal:f.signal}).then(S=>{clearTimeout(A),S.ok?mt(l,"TestPingServer: ok",!0,c):mt(l,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(A),mt(l,"TestPingServer: error",!1,c)})}function mt(s,c,l,f,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),f(l)}catch{}}function jm(){this.g=new bm}function zm(s,c,l){let f=l||"";try{Al(s,function(A,S){let N=A;d(A)&&(N=Qs(A)),c.push(f+S+"="+encodeURIComponent(N))})}catch(A){throw c.push(f+"type="+encodeURIComponent("_badmap")),A}}function ir(s){this.l=s.Ub||null,this.j=s.eb||!1}k(ir,Ys),ir.prototype.g=function(){return new si(this.l,this.j)},ir.prototype.i=function(s){return function(){return s}}({});function si(s,c){pe.call(this),this.D=s,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}k(si,pe),n=si.prototype,n.open=function(s,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=s,this.A=c,this.readyState=1,or(this)},n.send=function(s){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};s&&(c.body=s),(this.D||u).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,sr(this)),this.readyState=0},n.Sa=function(s){if(this.g&&(this.l=s,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=s.headers,this.readyState=2,or(this)),this.g&&(this.readyState=3,or(this),this.g)))if(this.responseType==="arraybuffer")s.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in s){if(this.j=s.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Dl(this)}else s.text().then(this.Ra.bind(this),this.ga.bind(this))};function Dl(s){s.j.read().then(s.Pa.bind(s)).catch(s.ga.bind(s))}n.Pa=function(s){if(this.g){if(this.o&&s.value)this.response.push(s.value);else if(!this.o){var c=s.value?s.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!s.done}))&&(this.response=this.responseText+=c)}s.done?sr(this):or(this),this.readyState==3&&Dl(this)}},n.Ra=function(s){this.g&&(this.response=this.responseText=s,sr(this))},n.Qa=function(s){this.g&&(this.response=s,sr(this))},n.ga=function(){this.g&&sr(this)};function sr(s){s.readyState=4,s.l=null,s.j=null,s.v=null,or(s)}n.setRequestHeader=function(s,c){this.u.append(s,c)},n.getResponseHeader=function(s){return this.h&&this.h.get(s.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let s=[],c=this.h.entries();for(var l=c.next();!l.done;)l=l.value,s.push(l[0]+": "+l[1]),l=c.next();return s.join(`\r
`)};function or(s){s.onreadystatechange&&s.onreadystatechange.call(s)}Object.defineProperty(si.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(s){this.m=s?"include":"same-origin"}});function Nl(s){let c="";return Y(s,function(l,f){c+=f,c+=":",c+=l,c+=`\r
`}),c}function oo(s,c,l){e:{for(f in l){var f=!1;break e}f=!0}f||(l=Nl(l),typeof s=="string"?l!=null&&encodeURIComponent(String(l)):Z(s,c,l))}function ne(s){pe.call(this),this.headers=new Map,this.o=s||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}k(ne,pe);var Wm=/^https?$/i,Gm=["POST","PUT"];n=ne.prototype,n.Ha=function(s){this.J=s},n.ea=function(s,c,l,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+s);c=c?c.toUpperCase():"GET",this.D=s,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Zs.g(),this.v=this.o?al(this.o):al(Zs),this.g.onreadystatechange=E(this.Ea,this);try{this.B=!0,this.g.open(c,String(s),!0),this.B=!1}catch(S){Ol(this,S);return}if(s=l||"",l=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var A in f)l.set(A,f[A]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(let S of f.keys())l.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(l.keys()).find(S=>S.toLowerCase()=="content-type"),A=u.FormData&&s instanceof u.FormData,!(0<=Array.prototype.indexOf.call(Gm,c,void 0))||f||A||l.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[S,N]of l)this.g.setRequestHeader(S,N);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Ll(this),this.u=!0,this.g.send(s),this.u=!1}catch(S){Ol(this,S)}};function Ol(s,c){s.h=!1,s.g&&(s.j=!0,s.g.abort(),s.j=!1),s.l=c,s.m=5,xl(s),oi(s)}function xl(s){s.A||(s.A=!0,Ee(s,"complete"),Ee(s,"error"))}n.abort=function(s){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=s||7,Ee(this,"complete"),Ee(this,"abort"),oi(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),oi(this,!0)),ne.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Vl(this):this.bb())},n.bb=function(){Vl(this)};function Vl(s){if(s.h&&typeof a<"u"&&(!s.v[1]||Je(s)!=4||s.Z()!=2)){if(s.u&&Je(s)==4)rl(s.Ea,0,s);else if(Ee(s,"readystatechange"),Je(s)==4){s.h=!1;try{let N=s.Z();e:switch(N){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var l;if(!(l=c)){var f;if(f=N===0){var A=String(s.D).match(bl)[1]||null;!A&&u.self&&u.self.location&&(A=u.self.location.protocol.slice(0,-1)),f=!Wm.test(A?A.toLowerCase():"")}l=f}if(l)Ee(s,"complete"),Ee(s,"success");else{s.m=6;try{var S=2<Je(s)?s.g.statusText:""}catch{S=""}s.l=S+" ["+s.Z()+"]",xl(s)}}finally{oi(s)}}}}function oi(s,c){if(s.g){Ll(s);let l=s.g,f=s.v[0]?()=>{}:null;s.g=null,s.v=null,c||Ee(s,"ready");try{l.onreadystatechange=f}catch{}}}function Ll(s){s.I&&(u.clearTimeout(s.I),s.I=null)}n.isActive=function(){return!!this.g};function Je(s){return s.g?s.g.readyState:0}n.Z=function(){try{return 2<Je(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(s){if(this.g){var c=this.g.responseText;return s&&c.indexOf(s)==0&&(c=c.substring(s.length)),Am(c)}};function Ml(s){try{if(!s.g)return null;if("response"in s.g)return s.g.response;switch(s.H){case"":case"text":return s.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in s.g)return s.g.mozResponseArrayBuffer}return null}catch{return null}}function Km(s){let c={};s=(s.g&&2<=Je(s)&&s.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<s.length;f++){if(U(s[f]))continue;var l=T(s[f]);let A=l[0];if(l=l[1],typeof l!="string")continue;l=l.trim();let S=c[A]||[];c[A]=S,S.push(l)}w(c,function(f){return f.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ar(s,c,l){return l&&l.internalChannelParams&&l.internalChannelParams[s]||c}function Fl(s){this.Aa=0,this.i=[],this.j=new Zn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ar("failFast",!1,s),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ar("baseRetryDelayMs",5e3,s),this.cb=ar("retryDelaySeedMs",1e4,s),this.Wa=ar("forwardChannelMaxRetries",2,s),this.wa=ar("forwardChannelRequestTimeoutMs",2e4,s),this.pa=s&&s.xmlHttpFactory||void 0,this.Xa=s&&s.Tb||void 0,this.Ca=s&&s.useFetchStreams||!1,this.L=void 0,this.J=s&&s.supportsCrossDomainXhr||!1,this.K="",this.h=new vl(s&&s.concurrentRequestLimit),this.Da=new jm,this.P=s&&s.fastHandshake||!1,this.O=s&&s.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=s&&s.Rb||!1,s&&s.xa&&this.j.xa(),s&&s.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&s&&s.detectBufferingProxy||!1,this.ja=void 0,s&&s.longPollingTimeout&&0<s.longPollingTimeout&&(this.ja=s.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Fl.prototype,n.la=8,n.G=1,n.connect=function(s,c,l,f){we(0),this.W=s,this.H=c||{},l&&f!==void 0&&(this.H.OSID=l,this.H.OAID=f),this.F=this.X,this.I=Kl(this,null,this.W),ci(this)};function ao(s){if(Ul(s),s.G==3){var c=s.U++,l=Ye(s.I);if(Z(l,"SID",s.K),Z(l,"RID",c),Z(l,"TYPE","terminate"),cr(s,l),c=new ft(s,s.j,c),c.L=2,c.v=ii(Ye(l)),l=!1,u.navigator&&u.navigator.sendBeacon)try{l=u.navigator.sendBeacon(c.v.toString(),"")}catch{}!l&&u.Image&&(new Image().src=c.v,l=!0),l||(c.g=Hl(c.j,null),c.g.ea(c.v)),c.F=Date.now(),ti(c)}Gl(s)}function ai(s){s.g&&(uo(s),s.g.cancel(),s.g=null)}function Ul(s){ai(s),s.u&&(u.clearTimeout(s.u),s.u=null),ui(s),s.h.cancel(),s.s&&(typeof s.s=="number"&&u.clearTimeout(s.s),s.s=null)}function ci(s){if(!Il(s.h)&&!s.s){s.s=!0;var c=s.Ga;Wn||Ju(),Gn||(Wn(),Gn=!0),Bs.add(c,s),s.B=0}}function Hm(s,c){return El(s.h)>=s.h.j-(s.s?1:0)?!1:s.s?(s.i=c.D.concat(s.i),!0):s.G==1||s.G==2||s.B>=(s.Va?0:s.Wa)?!1:(s.s=Xn(E(s.Ga,s,c),Wl(s,s.B)),s.B++,!0)}n.Ga=function(s){if(this.s)if(this.s=null,this.G==1){if(!s){this.U=Math.floor(1e5*Math.random()),s=this.U++;let A=new ft(this,this.j,s),S=this.o;if(this.S&&(S?(S=m(S),I(S,this.S)):S=this.S),this.m!==null||this.O||(A.H=S,S=null),this.P)e:{for(var c=0,l=0;l<this.i.length;l++){t:{var f=this.i[l];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(c+=f,4096<c){c=l;break e}if(c===4096||l===this.i.length-1){c=l+1;break e}}c=1e3}else c=1e3;c=ql(this,A,c),l=Ye(this.I),Z(l,"RID",s),Z(l,"CVER",22),this.D&&Z(l,"X-HTTP-Session-Id",this.D),cr(this,l),S&&(this.O?c="headers="+encodeURIComponent(String(Nl(S)))+"&"+c:this.m&&oo(l,this.m,S)),so(this.h,A),this.Ua&&Z(l,"TYPE","init"),this.P?(Z(l,"$req",c),Z(l,"SID","null"),A.T=!0,to(A,l,null)):to(A,l,c),this.G=2}}else this.G==3&&(s?Bl(this,s):this.i.length==0||Il(this.h)||Bl(this))};function Bl(s,c){var l;c?l=c.l:l=s.U++;let f=Ye(s.I);Z(f,"SID",s.K),Z(f,"RID",l),Z(f,"AID",s.T),cr(s,f),s.m&&s.o&&oo(f,s.m,s.o),l=new ft(s,s.j,l,s.B+1),s.m===null&&(l.H=s.o),c&&(s.i=c.D.concat(s.i)),c=ql(s,l,1e3),l.I=Math.round(.5*s.wa)+Math.round(.5*s.wa*Math.random()),so(s.h,l),to(l,f,c)}function cr(s,c){s.H&&Y(s.H,function(l,f){Z(c,f,l)}),s.l&&Al({},function(l,f){Z(c,f,l)})}function ql(s,c,l){l=Math.min(s.i.length,l);var f=s.l?E(s.l.Na,s.l,s):null;e:{var A=s.i;let S=-1;for(;;){let N=["count="+l];S==-1?0<l?(S=A[0].g,N.push("ofs="+S)):S=0:N.push("ofs="+S);let X=!0;for(let he=0;he<l;he++){let H=A[he].g,me=A[he].map;if(H-=S,0>H)S=Math.max(0,A[he].g-100),X=!1;else try{zm(me,N,"req"+H+"_")}catch{f&&f(me)}}if(X){f=N.join("&");break e}}}return s=s.i.splice(0,l),c.D=s,f}function $l(s){if(!s.g&&!s.u){s.Y=1;var c=s.Fa;Wn||Ju(),Gn||(Wn(),Gn=!0),Bs.add(c,s),s.v=0}}function co(s){return s.g||s.u||3<=s.v?!1:(s.Y++,s.u=Xn(E(s.Fa,s),Wl(s,s.v)),s.v++,!0)}n.Fa=function(){if(this.u=null,jl(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var s=2*this.R;this.j.info("BP detection timer enabled: "+s),this.A=Xn(E(this.ab,this),s)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,we(10),ai(this),jl(this))};function uo(s){s.A!=null&&(u.clearTimeout(s.A),s.A=null)}function jl(s){s.g=new ft(s,s.j,"rpc",s.Y),s.m===null&&(s.g.H=s.o),s.g.O=0;var c=Ye(s.qa);Z(c,"RID","rpc"),Z(c,"SID",s.K),Z(c,"AID",s.T),Z(c,"CI",s.F?"0":"1"),!s.F&&s.ja&&Z(c,"TO",s.ja),Z(c,"TYPE","xmlhttp"),cr(s,c),s.m&&s.o&&oo(c,s.m,s.o),s.L&&(s.g.I=s.L);var l=s.g;s=s.ia,l.L=1,l.v=ii(Ye(c)),l.m=null,l.P=!0,gl(l,s)}n.Za=function(){this.C!=null&&(this.C=null,ai(this),co(this),we(19))};function ui(s){s.C!=null&&(u.clearTimeout(s.C),s.C=null)}function zl(s,c){var l=null;if(s.g==c){ui(s),uo(s),s.g=null;var f=2}else if(io(s.h,c))l=c.D,wl(s.h,c),f=1;else return;if(s.G!=0){if(c.o)if(f==1){l=c.m?c.m.length:0,c=Date.now()-c.F;var A=s.B;f=Xr(),Ee(f,new dl(f,l)),ci(s)}else $l(s);else if(A=c.s,A==3||A==0&&0<c.X||!(f==1&&Hm(s,c)||f==2&&co(s)))switch(l&&0<l.length&&(c=s.h,c.i=c.i.concat(l)),A){case 1:Vt(s,5);break;case 4:Vt(s,10);break;case 3:Vt(s,6);break;default:Vt(s,2)}}}function Wl(s,c){let l=s.Ta+Math.floor(Math.random()*s.cb);return s.isActive()||(l*=2),l*c}function Vt(s,c){if(s.j.info("Error code "+c),c==2){var l=E(s.fb,s),f=s.Xa;let A=!f;f=new xt(f||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||ni(f,"https"),ii(f),A?qm(f.toString(),l):$m(f.toString(),l)}else we(2);s.G=0,s.l&&s.l.sa(c),Gl(s),Ul(s)}n.fb=function(s){s?(this.j.info("Successfully pinged google.com"),we(2)):(this.j.info("Failed to ping google.com"),we(1))};function Gl(s){if(s.G=0,s.ka=[],s.l){let c=Tl(s.h);(c.length!=0||s.i.length!=0)&&(D(s.ka,c),D(s.ka,s.i),s.h.i.length=0,x(s.i),s.i.length=0),s.l.ra()}}function Kl(s,c,l){var f=l instanceof xt?Ye(l):new xt(l);if(f.g!="")c&&(f.g=c+"."+f.g),ri(f,f.s);else{var A=u.location;f=A.protocol,c=c?c+"."+A.hostname:A.hostname,A=+A.port;var S=new xt(null);f&&ni(S,f),c&&(S.g=c),A&&ri(S,A),l&&(S.l=l),f=S}return l=s.D,c=s.ya,l&&c&&Z(f,l,c),Z(f,"VER",s.la),cr(s,f),f}function Hl(s,c,l){if(c&&!s.J)throw Error("Can't create secondary domain capable XhrIo object.");return c=s.Ca&&!s.pa?new ne(new ir({eb:l})):new ne(s.pa),c.Ha(s.J),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ql(){}n=Ql.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function li(){}li.prototype.g=function(s,c){return new Ae(s,c)};function Ae(s,c){pe.call(this),this.g=new Fl(c),this.l=s,this.h=c&&c.messageUrlParams||null,s=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(s?s["X-Client-Protocol"]="webchannel":s={"X-Client-Protocol":"webchannel"}),this.g.o=s,s=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(s?s["X-WebChannel-Content-Type"]=c.messageContentType:s={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(s?s["X-WebChannel-Client-Profile"]=c.va:s={"X-WebChannel-Client-Profile":c.va}),this.g.S=s,(s=c&&c.Sb)&&!U(s)&&(this.g.m=s),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!U(c)&&(this.g.D=c,s=this.h,s!==null&&c in s&&(s=this.h,c in s&&delete s[c])),this.j=new cn(this)}k(Ae,pe),Ae.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ae.prototype.close=function(){ao(this.g)},Ae.prototype.o=function(s){var c=this.g;if(typeof s=="string"){var l={};l.__data__=s,s=l}else this.u&&(l={},l.__data__=Qs(s),s=l);c.i.push(new Dm(c.Ya++,s)),c.G==3&&ci(c)},Ae.prototype.N=function(){this.g.l=null,delete this.j,ao(this.g),delete this.g,Ae.aa.N.call(this)};function Yl(s){Js.call(this),s.__headers__&&(this.headers=s.__headers__,this.statusCode=s.__status__,delete s.__headers__,delete s.__status__);var c=s.__sm__;if(c){e:{for(let l in c){s=l;break e}s=void 0}(this.i=s)&&(s=this.i,c=c!==null&&s in c?c[s]:void 0),this.data=c}else this.data=s}k(Yl,Js);function Jl(){Xs.call(this),this.status=1}k(Jl,Xs);function cn(s){this.g=s}k(cn,Ql),cn.prototype.ua=function(){Ee(this.g,"a")},cn.prototype.ta=function(s){Ee(this.g,new Yl(s))},cn.prototype.sa=function(s){Ee(this.g,new Jl)},cn.prototype.ra=function(){Ee(this.g,"b")},li.prototype.createWebChannel=li.prototype.g,Ae.prototype.send=Ae.prototype.o,Ae.prototype.open=Ae.prototype.m,Ae.prototype.close=Ae.prototype.close,Va=it.createWebChannelTransport=function(){return new li},xa=it.getStatEventTarget=function(){return Xr()},Oa=it.Event=Nt,ji=it.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Zr.NO_ERROR=0,Zr.TIMEOUT=8,Zr.HTTP_ERROR=6,Sr=it.ErrorCode=Zr,fl.COMPLETE="complete",Na=it.EventType=fl,cl.EventType=Yn,Yn.OPEN="a",Yn.CLOSE="b",Yn.ERROR="c",Yn.MESSAGE="d",pe.prototype.listen=pe.prototype.K,_n=it.WebChannel=cl,vI=it.FetchXmlHttpFactory=ir,ne.prototype.listenOnce=ne.prototype.L,ne.prototype.getLastError=ne.prototype.Ka,ne.prototype.getLastErrorCode=ne.prototype.Ba,ne.prototype.getStatus=ne.prototype.Z,ne.prototype.getResponseJson=ne.prototype.Oa,ne.prototype.getResponseText=ne.prototype.oa,ne.prototype.send=ne.prototype.ea,ne.prototype.setWithCredentials=ne.prototype.Ha,Da=it.XhrIo=ne}).apply(typeof $i<"u"?$i:typeof self<"u"?self:typeof window<"u"?window:{});var Md="@firebase/firestore",Fd="4.7.17";var ue=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};ue.UNAUTHENTICATED=new ue(null),ue.GOOGLE_CREDENTIALS=new ue("google-credentials-uid"),ue.FIRST_PARTY=new ue("first-party-uid"),ue.MOCK_USER=new ue("mock-user");var Bn="11.9.0";var Yt=new qe("@firebase/firestore");function yn(){return Yt.logLevel}function O(n,...e){if(Yt.logLevel<=W.DEBUG){let t=e.map(bu);Yt.debug(`Firestore (${Bn}): ${n}`,...t)}}function ot(n,...e){if(Yt.logLevel<=W.ERROR){let t=e.map(bu);Yt.error(`Firestore (${Bn}): ${n}`,...t)}}function bn(n,...e){if(Yt.logLevel<=W.WARN){let t=e.map(bu);Yt.warn(`Firestore (${Bn}): ${n}`,...t)}}function bu(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function M(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,Nf(n,r,t)}function Nf(n,e,t){let r=`FIRESTORE (${Bn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw ot(r),new Error(r)}function Q(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||Nf(e,i,r)}function B(n,e){return n}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},V=class extends be{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var st=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Yi=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Ba=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ue.UNAUTHENTICATED))}shutdown(){}},qa=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},$a=class{constructor(e){this.t=e,this.currentUser=ue.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Q(this.o===void 0,42304);let r=this.i,i=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve(),o=new st;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new st,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let h=o;e.enqueueRetryable(()=>v(this,null,function*(){yield h.promise,yield i(this.currentUser)}))},u=h=>{O("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(h=>u(h)),setTimeout(()=>{if(!this.auth){let h=this.t.getImmediate({optional:!0});h?u(h):(O("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new st)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(O("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Q(typeof r.accessToken=="string",31837,{l:r}),new Yi(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return Q(e===null||typeof e=="string",2055,{h:e}),new ue(e)}},ja=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=ue.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},za=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new ja(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(ue.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ji=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Wa=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ce(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Q(this.o===void 0,3512);let r=o=>{o.error!=null&&O("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);let a=o.token!==this.m;return this.m=o.token,O("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>r(o))};let i=o=>{O("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){let o=this.V.getImmediate({optional:!0});o?i(o):O("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Ji(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Q(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Ji(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function II(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}function Of(){return new TextEncoder}var Xi=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=II(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<t&&(r+=e.charAt(i[o]%62))}return r}};function z(n,e){return n<e?-1:n>e?1:0}function Ga(n,e){let t=0;for(;t<n.length&&t<e.length;){let r=n.codePointAt(t),i=e.codePointAt(t);if(r!==i){if(r<128&&i<128)return z(r,i);{let o=Of(),a=EI(o.encode(Ud(n,t)),o.encode(Ud(e,t)));return a!==0?a:z(r,i)}}t+=r>65535?2:1}return z(n.length,e.length)}function Ud(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function EI(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return z(n[t],e[t]);return z(n.length,e.length)}function Sn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var Bd=-62135596800,qd=1e6,de=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*qd);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new V(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new V(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Bd)throw new V(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new V(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/qd}_compareTo(e){return this.seconds===e.seconds?z(this.nanoseconds,e.nanoseconds):z(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-Bd;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var q=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new de(0,0))}static max(){return new n(new de(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var $d="__name__",Zi=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&M(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&M(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let o=n.compareSegments(e.get(i),t.get(i));if(o!==0)return o}return z(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):Ga(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return rt.fromString(e.substring(4,e.length-2))}},te=class n extends Zi{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new V(P.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},wI=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Se=class n extends Zi{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return wI.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===$d}static keyField(){return new n([$d])}static fromServerFormat(e){let t=[],r="",i=0,o=()=>{if(r.length===0)throw new V(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},a=!1;for(;i<e.length;){let u=e[i];if(u==="\\"){if(i+1===e.length)throw new V(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new V(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(r+=u,i++):(o(),i++)}if(o(),a)throw new V(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var L=class n{constructor(e){this.path=e}static fromPath(e){return new n(te.fromString(e))}static fromName(e){return new n(te.fromString(e).popFirst(5))}static empty(){return new n(te.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&te.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return te.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new te(e.slice()))}};var Or=-1,Ka=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};Ka.UNKNOWN_ID=-1;function TI(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=q.fromTimestamp(r===1e9?new de(t+1,0):new de(t,r));return new Jt(i,L.empty(),e)}function AI(n){return new Jt(n.readTime,n.key,Or)}var Jt=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(q.min(),L.empty(),Or)}static max(){return new n(q.max(),L.empty(),Or)}};function bI(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=L.comparator(n.documentKey,e.documentKey),t!==0?t:z(n.largestBatchId,e.largestBatchId))}var SI="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ha=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function qn(n){return v(this,null,function*(){if(n.code!==P.FAILED_PRECONDITION||n.message!==SI)throw n;O("LocalStore","Unexpectedly lost primary lease")})}var C=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&M(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,o=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++o,a&&o===i&&t()},h=>r(h))}),a=!0,o===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,o)=>{r.push(t.call(this,i,o))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let o=e.length,a=new Array(o),u=0;for(let h=0;h<o;h++){let d=h;t(e[d]).next(p=>{a[d]=p,++u,u===o&&r(a)},p=>i(p))}})}static doWhile(e,t){return new n((r,i)=>{let o=()=>{e()===!0?t().next(()=>{o()},i):r()};o()})}};function RI(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function $n(n){return n.name==="IndexedDbTransactionError"}var Su=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ue(i),this.ce=i=>r.writeSequenceNumber(i))}ue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ce&&this.ce(t),t}}n.le=-1;return n})(),Ru=-1;function Ds(n){return n==null}function xr(n){return n===0&&1/n==-1/0}function PI(n){return typeof n=="number"&&Number.isInteger(n)&&!xr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var xf="";function CI(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=jd(e)),e=kI(n.get(t),e);return jd(e)}function kI(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let o=n.charAt(i);switch(o){case"\0":t+="";break;case xf:t+="";break;default:t+=o}}return t}function jd(n){return n+xf+""}var DI="remoteDocuments",Vf="owner";var Lf="mutationQueues";var Mf="mutations";var Ff="documentMutations",NI="remoteDocumentsV14";var Uf="remoteDocumentGlobal";var Bf="targets";var qf="targetDocuments";var $f="targetGlobal",jf="collectionParents";var zf="clientMetadata";var Wf="bundles";var Gf="namedQueries";var OI="indexConfiguration";var xI="indexState";var VI="indexEntries";var Kf="documentOverlays";var LI="globals";var MI=[Lf,Mf,Ff,DI,Bf,Vf,$f,qf,zf,Uf,jf,Wf,Gf],Ab=[...MI,Kf],FI=[Lf,Mf,Ff,NI,Bf,Vf,$f,qf,zf,Uf,jf,Wf,Gf,Kf],UI=FI,BI=[...UI,OI,xI,VI];var bb=[...BI,LI];function zd(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function rn(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Hf(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ie=class n{constructor(e,t){this.comparator=e,this.root=t||We.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,We.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,We.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new wn(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new wn(this.root,e,this.comparator,!1)}getReverseIterator(){return new wn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new wn(this.root,e,this.comparator,!0)}},wn=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},We=class n{constructor(e,t,r,i,o){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,o){return new n(e??this.key,t??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,t,r),null):o===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw M(43730,{key:this.key,value:this.value});if(this.right.isRed())throw M(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw M(27949);return e+(this.isRed()?0:1)}};We.EMPTY=null,We.RED=!0,We.BLACK=!1;We.EMPTY=new class{constructor(){this.size=0}get key(){throw M(57766)}get value(){throw M(16141)}get color(){throw M(16727)}get left(){throw M(29726)}get right(){throw M(36894)}copy(e,t,r,i,o){return this}insert(e,t,r){return new We(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var le=class n{constructor(e){this.comparator=e,this.data=new ie(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new es(this.data.getIterator())}getIteratorFrom(e){return new es(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},es=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var ze=class n{constructor(e){this.fields=e,e.sort(Se.comparator)}static empty(){return new n([])}unionWith(e){let t=new le(Se.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Sn(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var ts=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var ve=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new ts("Invalid base64 string: "+o):o}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let o="";for(let a=0;a<i.length;++a)o+=String.fromCharCode(i[a]);return o}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return z(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};ve.EMPTY_BYTE_STRING=new ve("");var qI=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function at(n){if(Q(!!n,39018),typeof n=="string"){let e=0,t=qI.exec(n);if(Q(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ee(n.seconds),nanos:ee(n.nanos)}}function ee(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ct(n){return typeof n=="string"?ve.fromBase64String(n):ve.fromUint8Array(n)}var Qf="server_timestamp",Yf="__type__",Jf="__previous_value__",Xf="__local_write_time__";function Pu(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Yf])===null||t===void 0?void 0:t.stringValue)===Qf}function Ns(n){let e=n.mapValue.fields[Jf];return Pu(e)?Ns(e):e}function Vr(n){let e=at(n.mapValue.fields[Xf].timestampValue);return new de(e.seconds,e.nanos)}var Qa=class{constructor(e,t,r,i,o,a,u,h,d,p){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=d,this.isUsingEmulator=p}},ns="(default)",rs=class n{constructor(e,t){this.projectId=e,this.database=t||ns}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===ns}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Cu="__type__",Zf="__max__",zi={mapValue:{fields:{__type__:{stringValue:Zf}}}},ku="__vector__",Rn="value";function Ct(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Pu(n)?4:tp(n)?9007199254740991:ep(n)?10:11:M(28295,{value:n})}function He(n,e){if(n===e)return!0;let t=Ct(n);if(t!==Ct(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Vr(n).isEqual(Vr(e));case 3:return function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;let a=at(i.timestampValue),u=at(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,o){return ct(i.bytesValue).isEqual(ct(o.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,o){return ee(i.geoPointValue.latitude)===ee(o.geoPointValue.latitude)&&ee(i.geoPointValue.longitude)===ee(o.geoPointValue.longitude)}(n,e);case 2:return function(i,o){if("integerValue"in i&&"integerValue"in o)return ee(i.integerValue)===ee(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){let a=ee(i.doubleValue),u=ee(o.doubleValue);return a===u?xr(a)===xr(u):isNaN(a)&&isNaN(u)}return!1}(n,e);case 9:return Sn(n.arrayValue.values||[],e.arrayValue.values||[],He);case 10:case 11:return function(i,o){let a=i.mapValue.fields||{},u=o.mapValue.fields||{};if(zd(a)!==zd(u))return!1;for(let h in a)if(a.hasOwnProperty(h)&&(u[h]===void 0||!He(a[h],u[h])))return!1;return!0}(n,e);default:return M(52216,{left:n})}}function Lr(n,e){return(n.values||[]).find(t=>He(t,e))!==void 0}function Pn(n,e){if(n===e)return 0;let t=Ct(n),r=Ct(e);if(t!==r)return z(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return z(n.booleanValue,e.booleanValue);case 2:return function(o,a){let u=ee(o.integerValue||o.doubleValue),h=ee(a.integerValue||a.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1}(n,e);case 3:return Wd(n.timestampValue,e.timestampValue);case 4:return Wd(Vr(n),Vr(e));case 5:return Ga(n.stringValue,e.stringValue);case 6:return function(o,a){let u=ct(o),h=ct(a);return u.compareTo(h)}(n.bytesValue,e.bytesValue);case 7:return function(o,a){let u=o.split("/"),h=a.split("/");for(let d=0;d<u.length&&d<h.length;d++){let p=z(u[d],h[d]);if(p!==0)return p}return z(u.length,h.length)}(n.referenceValue,e.referenceValue);case 8:return function(o,a){let u=z(ee(o.latitude),ee(a.latitude));return u!==0?u:z(ee(o.longitude),ee(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Gd(n.arrayValue,e.arrayValue);case 10:return function(o,a){var u,h,d,p;let y=o.fields||{},E=a.fields||{},R=(u=y[Rn])===null||u===void 0?void 0:u.arrayValue,k=(h=E[Rn])===null||h===void 0?void 0:h.arrayValue,x=z(((d=R?.values)===null||d===void 0?void 0:d.length)||0,((p=k?.values)===null||p===void 0?void 0:p.length)||0);return x!==0?x:Gd(R,k)}(n.mapValue,e.mapValue);case 11:return function(o,a){if(o===zi.mapValue&&a===zi.mapValue)return 0;if(o===zi.mapValue)return 1;if(a===zi.mapValue)return-1;let u=o.fields||{},h=Object.keys(u),d=a.fields||{},p=Object.keys(d);h.sort(),p.sort();for(let y=0;y<h.length&&y<p.length;++y){let E=Ga(h[y],p[y]);if(E!==0)return E;let R=Pn(u[h[y]],d[p[y]]);if(R!==0)return R}return z(h.length,p.length)}(n.mapValue,e.mapValue);default:throw M(23264,{Pe:t})}}function Wd(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return z(n,e);let t=at(n),r=at(e),i=z(t.seconds,r.seconds);return i!==0?i:z(t.nanos,r.nanos)}function Gd(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let o=Pn(t[i],r[i]);if(o)return o}return z(t.length,r.length)}function Cn(n){return Ya(n)}function Ya(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=at(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return ct(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return L.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let o of t.values||[])i?i=!1:r+=",",r+=Ya(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",o=!0;for(let a of r)o?o=!1:i+=",",i+=`${a}:${Ya(t.fields[a])}`;return i+"}"}(n.mapValue):M(61005,{value:n})}function Ki(n){switch(Ct(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=Ns(n);return e?16+Ki(e):16;case 5:return 2*n.stringValue.length;case 6:return ct(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,o)=>i+Ki(o),0)}(n.arrayValue);case 10:case 11:return function(r){let i=0;return rn(r.fields,(o,a)=>{i+=o.length+Ki(a)}),i}(n.mapValue);default:throw M(13486,{value:n})}}function Kd(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Ja(n){return!!n&&"integerValue"in n}function Du(n){return!!n&&"arrayValue"in n}function Hd(n){return!!n&&"nullValue"in n}function Qd(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Hi(n){return!!n&&"mapValue"in n}function ep(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Cu])===null||t===void 0?void 0:t.stringValue)===ku}function Pr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return rn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Pr(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Pr(n.arrayValue.values[t]);return e}return Object.assign({},n)}function tp(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Zf}var Rb={mapValue:{fields:{[Cu]:{stringValue:ku},[Rn]:{arrayValue:{}}}}};var Le=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Hi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Pr(t)}setAll(e){let t=Se.emptyPath(),r={},i=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){let h=this.getFieldsMap(t);this.applyChanges(h,r,i),r={},i=[],t=u.popLast()}a?r[u.lastSegment()]=Pr(a):i.push(u.lastSegment())});let o=this.getFieldsMap(t);this.applyChanges(o,r,i)}delete(e){let t=this.field(e.popLast());Hi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return He(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Hi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){rn(t,(i,o)=>e[i]=o);for(let i of r)delete e[i]}clone(){return new n(Pr(this.value))}};function np(n){let e=[];return rn(n.fields,(t,r)=>{let i=new Se([t]);if(Hi(r)){let o=np(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new ze(e)}var Me=class n{constructor(e,t,r,i,o,a,u){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(e){return new n(e,0,q.min(),q.min(),q.min(),Le.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,q.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,q.min(),q.min(),Le.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,q.min(),q.min(),Le.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(q.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Le.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Le.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=q.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var kn=class{constructor(e,t){this.position=e,this.inclusive=t}};function Yd(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let o=e[i],a=n.position[i];if(o.field.isKeyField()?r=L.comparator(L.fromName(a.referenceValue),t.key):r=Pn(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Jd(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!He(n.position[t],e.position[t]))return!1;return!0}var Dn=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function $I(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var is=class{},ae=class n extends is{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Za(e,t,r):t==="array-contains"?new nc(e,r):t==="in"?new rc(e,r):t==="not-in"?new ic(e,r):t==="array-contains-any"?new sc(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new ec(e,r):new tc(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Pn(t,this.value)):t!==null&&Ct(this.value)===Ct(t)&&this.matchesComparison(Pn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return M(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Fe=class n extends is{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new n(e,t)}matches(e){return rp(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Te!==null||(this.Te=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}};function rp(n){return n.op==="and"}function ip(n){return jI(n)&&rp(n)}function jI(n){for(let e of n.filters)if(e instanceof Fe)return!1;return!0}function Xa(n){if(n instanceof ae)return n.field.canonicalString()+n.op.toString()+Cn(n.value);if(ip(n))return n.filters.map(e=>Xa(e)).join(",");{let e=n.filters.map(t=>Xa(t)).join(",");return`${n.op}(${e})`}}function sp(n,e){return n instanceof ae?function(r,i){return i instanceof ae&&r.op===i.op&&r.field.isEqual(i.field)&&He(r.value,i.value)}(n,e):n instanceof Fe?function(r,i){return i instanceof Fe&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((o,a,u)=>o&&sp(a,i.filters[u]),!0):!1}(n,e):void M(19439)}function op(n){return n instanceof ae?function(t){return`${t.field.canonicalString()} ${t.op} ${Cn(t.value)}`}(n):n instanceof Fe?function(t){return t.op.toString()+" {"+t.getFilters().map(op).join(" ,")+"}"}(n):"Filter"}var Za=class extends ae{constructor(e,t,r){super(e,t,r),this.key=L.fromName(r.referenceValue)}matches(e){let t=L.comparator(e.key,this.key);return this.matchesComparison(t)}},ec=class extends ae{constructor(e,t){super(e,"in",t),this.keys=ap("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},tc=class extends ae{constructor(e,t){super(e,"not-in",t),this.keys=ap("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function ap(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>L.fromName(r.referenceValue))}var nc=class extends ae{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Du(t)&&Lr(t.arrayValue,this.value)}},rc=class extends ae{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Lr(this.value.arrayValue,t)}},ic=class extends ae{constructor(e,t){super(e,"not-in",t)}matches(e){if(Lr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Lr(this.value.arrayValue,t)}},sc=class extends ae{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Du(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Lr(this.value.arrayValue,r))}};var oc=class{constructor(e,t=null,r=[],i=[],o=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=a,this.endAt=u,this.Ie=null}};function Xd(n,e=null,t=[],r=[],i=null,o=null,a=null){return new oc(n,e,t,r,i,o,a)}function Nu(n){let e=B(n);if(e.Ie===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Xa(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(o){return o.field.canonicalString()+o.dir}(r)).join(","),Ds(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Cn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Cn(r)).join(",")),e.Ie=t}return e.Ie}function Ou(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!$I(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!sp(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Jd(n.startAt,e.startAt)&&Jd(n.endAt,e.endAt)}function ac(n){return L.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var Xt=class{constructor(e,t=null,r=[],i=[],o=null,a="F",u=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=h,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}};function zI(n,e,t,r,i,o,a,u){return new Xt(n,e,t,r,i,o,a,u)}function xu(n){return new Xt(n)}function Zd(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function cp(n){return n.collectionGroup!==null}function Cr(n){let e=B(n);if(e.Ee===null){e.Ee=[];let t=new Set;for(let o of e.explicitOrderBy)e.Ee.push(o),t.add(o.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new le(Se.comparator);return a.filters.forEach(h=>{h.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ee.push(new Dn(o,r))}),t.has(Se.keyField().canonicalString())||e.Ee.push(new Dn(Se.keyField(),r))}return e.Ee}function Ge(n){let e=B(n);return e.de||(e.de=WI(e,Cr(n))),e.de}function WI(n,e){if(n.limitType==="F")return Xd(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let o=i.dir==="desc"?"asc":"desc";return new Dn(i.field,o)});let t=n.endAt?new kn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new kn(n.startAt.position,n.startAt.inclusive):null;return Xd(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function cc(n,e){let t=n.filters.concat([e]);return new Xt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function uc(n,e,t){return new Xt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Os(n,e){return Ou(Ge(n),Ge(e))&&n.limitType===e.limitType}function up(n){return`${Nu(Ge(n))}|lt:${n.limitType}`}function vn(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>op(i)).join(", ")}]`),Ds(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Cn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Cn(i)).join(",")),`Target(${r})`}(Ge(n))}; limitType=${n.limitType})`}function xs(n,e){return e.isFoundDocument()&&function(r,i){let o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):L.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(n,e)&&function(r,i){for(let o of Cr(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let o of r.filters)if(!o.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(a,u,h){let d=Yd(a,u,h);return a.inclusive?d<=0:d<0}(r.startAt,Cr(r),i)||r.endAt&&!function(a,u,h){let d=Yd(a,u,h);return a.inclusive?d>=0:d>0}(r.endAt,Cr(r),i))}(n,e)}function GI(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function lp(n){return(e,t)=>{let r=!1;for(let i of Cr(n)){let o=KI(i,e,t);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function KI(n,e,t){let r=n.field.isKeyField()?L.comparator(e.key,t.key):function(o,a,u){let h=a.data.field(o),d=u.data.field(o);return h!==null&&d!==null?Pn(h,d):M(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return M(19790,{direction:n.dir})}}var ut=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){rn(this.inner,(t,r)=>{for(let[i,o]of r)e(i,o)})}isEmpty(){return Hf(this.inner)}size(){return this.innerSize}};var HI=new ie(L.comparator);function lt(){return HI}var hp=new ie(L.comparator);function Rr(...n){let e=hp;for(let t of n)e=e.insert(t.key,t);return e}function dp(n){let e=hp;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Gt(){return kr()}function fp(){return kr()}function kr(){return new ut(n=>n.toString(),(n,e)=>n.isEqual(e))}var QI=new ie(L.comparator),YI=new le(L.comparator);function G(...n){let e=YI;for(let t of n)e=e.add(t);return e}var JI=new le(z);function XI(){return JI}function Vu(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:xr(e)?"-0":e}}function pp(n){return{integerValue:""+n}}function ZI(n,e){return PI(e)?pp(e):Vu(n,e)}var Nn=class{constructor(){this._=void 0}};function eE(n,e,t){return n instanceof On?function(i,o){let a={fields:{[Yf]:{stringValue:Qf},[Xf]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&Pu(o)&&(o=Ns(o)),o&&(a.fields[Jf]=o),{mapValue:a}}(t,e):n instanceof Zt?gp(n,e):n instanceof en?_p(n,e):function(i,o){let a=mp(i,o),u=ef(a)+ef(i.Re);return Ja(a)&&Ja(i.Re)?pp(u):Vu(i.serializer,u)}(n,e)}function tE(n,e,t){return n instanceof Zt?gp(n,e):n instanceof en?_p(n,e):t}function mp(n,e){return n instanceof xn?function(r){return Ja(r)||function(o){return!!o&&"doubleValue"in o}(r)}(e)?e:{integerValue:0}:null}var On=class extends Nn{},Zt=class extends Nn{constructor(e){super(),this.elements=e}};function gp(n,e){let t=yp(e);for(let r of n.elements)t.some(i=>He(i,r))||t.push(r);return{arrayValue:{values:t}}}var en=class extends Nn{constructor(e){super(),this.elements=e}};function _p(n,e){let t=yp(e);for(let r of n.elements)t=t.filter(i=>!He(i,r));return{arrayValue:{values:t}}}var xn=class extends Nn{constructor(e,t){super(),this.serializer=e,this.Re=t}};function ef(n){return ee(n.integerValue||n.doubleValue)}function yp(n){return Du(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function nE(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof Zt&&i instanceof Zt||r instanceof en&&i instanceof en?Sn(r.elements,i.elements,He):r instanceof xn&&i instanceof xn?He(r.Re,i.Re):r instanceof On&&i instanceof On}(n.transform,e.transform)}var lc=class{constructor(e,t){this.version=e,this.transformResults=t}},Qt=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Qi(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Vn=class{};function vp(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new ss(n.key,Qt.none()):new tn(n.key,n.data,Qt.none());{let t=n.data,r=Le.empty(),i=new le(Se.comparator);for(let o of e.fields)if(!i.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),i=i.add(o)}return new ht(n.key,r,new ze(i.toArray()),Qt.none())}}function rE(n,e,t){n instanceof tn?function(i,o,a){let u=i.value.clone(),h=nf(i.fieldTransforms,o,a.transformResults);u.setAll(h),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(n,e,t):n instanceof ht?function(i,o,a){if(!Qi(i.precondition,o))return void o.convertToUnknownDocument(a.version);let u=nf(i.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(Ip(i)),h.setAll(u),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()}(n,e,t):function(i,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function Dr(n,e,t,r){return n instanceof tn?function(o,a,u,h){if(!Qi(o.precondition,a))return u;let d=o.value.clone(),p=rf(o.fieldTransforms,h,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(n,e,t,r):n instanceof ht?function(o,a,u,h){if(!Qi(o.precondition,a))return u;let d=rf(o.fieldTransforms,h,a),p=a.data;return p.setAll(Ip(o)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(y=>y.field))}(n,e,t,r):function(o,a,u){return Qi(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(n,e,t)}function iE(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),o=mp(r.transform,i||null);o!=null&&(t===null&&(t=Le.empty()),t.set(r.field,o))}return t||null}function tf(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Sn(r,i,(o,a)=>nE(o,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var tn=class extends Vn{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},ht=class extends Vn{constructor(e,t,r,i,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}};function Ip(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function nf(n,e,t){let r=new Map;Q(n.length===t.length,32656,{Ve:t.length,me:n.length});for(let i=0;i<t.length;i++){let o=n[i],a=o.transform,u=e.data.field(o.field);r.set(o.field,tE(a,u,t[i]))}return r}function rf(n,e,t){let r=new Map;for(let i of n){let o=i.transform,a=t.data.field(i.field);r.set(i.field,eE(o,a,e))}return r}var ss=class extends Vn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},hc=class extends Vn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var dc=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let o=this.mutations[i];o.key.isEqual(e.key)&&rE(o,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Dr(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Dr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=fp();return this.mutations.forEach(i=>{let o=e.get(i.key),a=o.overlayedDocument,u=this.applyToLocalView(a,o.mutatedFields);u=t.has(i.key)?null:u;let h=vp(a,u);h!==null&&r.set(i.key,h),a.isValidDocument()||a.convertToNoDocument(q.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),G())}isEqual(e){return this.batchId===e.batchId&&Sn(this.mutations,e.mutations,(t,r)=>tf(t,r))&&Sn(this.baseMutations,e.baseMutations,(t,r)=>tf(t,r))}},fc=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Q(e.mutations.length===r.length,58842,{fe:e.mutations.length,ge:r.length});let i=function(){return QI}(),o=e.mutations;for(let a=0;a<o.length;a++)i=i.insert(o[a].key,r[a].version);return new n(e,t,r,i)}};var pc=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var mc=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var se,K;function sE(n){switch(n){case P.OK:return M(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return M(15467,{code:n})}}function Ep(n){if(n===void 0)return ot("GRPC error has no .code"),P.UNKNOWN;switch(n){case se.OK:return P.OK;case se.CANCELLED:return P.CANCELLED;case se.UNKNOWN:return P.UNKNOWN;case se.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case se.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case se.INTERNAL:return P.INTERNAL;case se.UNAVAILABLE:return P.UNAVAILABLE;case se.UNAUTHENTICATED:return P.UNAUTHENTICATED;case se.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case se.NOT_FOUND:return P.NOT_FOUND;case se.ALREADY_EXISTS:return P.ALREADY_EXISTS;case se.PERMISSION_DENIED:return P.PERMISSION_DENIED;case se.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case se.ABORTED:return P.ABORTED;case se.OUT_OF_RANGE:return P.OUT_OF_RANGE;case se.UNIMPLEMENTED:return P.UNIMPLEMENTED;case se.DATA_LOSS:return P.DATA_LOSS;default:return M(39323,{code:n})}}(K=se||(se={}))[K.OK=0]="OK",K[K.CANCELLED=1]="CANCELLED",K[K.UNKNOWN=2]="UNKNOWN",K[K.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",K[K.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",K[K.NOT_FOUND=5]="NOT_FOUND",K[K.ALREADY_EXISTS=6]="ALREADY_EXISTS",K[K.PERMISSION_DENIED=7]="PERMISSION_DENIED",K[K.UNAUTHENTICATED=16]="UNAUTHENTICATED",K[K.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",K[K.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",K[K.ABORTED=10]="ABORTED",K[K.OUT_OF_RANGE=11]="OUT_OF_RANGE",K[K.UNIMPLEMENTED=12]="UNIMPLEMENTED",K[K.INTERNAL=13]="INTERNAL",K[K.UNAVAILABLE=14]="UNAVAILABLE",K[K.DATA_LOSS=15]="DATA_LOSS";var sf=null;var oE=new rt([4294967295,4294967295],0);function of(n){let e=Of().encode(n),t=new ka;return t.update(e),new Uint8Array(t.digest())}function af(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new rt([t,r],0),new rt([i,o],0)]}var gc=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Kt(`Invalid padding: ${t}`);if(r<0)throw new Kt(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Kt(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Kt(`Invalid padding when bitmap length is 0: ${t}`);this.pe=8*e.length-t,this.ye=rt.fromNumber(this.pe)}we(e,t,r){let i=e.add(t.multiply(rt.fromNumber(r)));return i.compare(oE)===1&&(i=new rt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ye).toNumber()}be(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.pe===0)return!1;let t=of(e),[r,i]=af(t);for(let o=0;o<this.hashCount;o++){let a=this.we(r,i,o);if(!this.be(a))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new n(o,i,t);return r.forEach(u=>a.insert(u)),a}insert(e){if(this.pe===0)return;let t=of(e),[r,i]=af(t);for(let o=0;o<this.hashCount;o++){let a=this.we(r,i,o);this.Se(a)}}Se(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Kt=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var os=class n{constructor(e,t,r,i,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Mr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(q.min(),i,new ie(z),lt(),G())}},Mr=class n{constructor(e,t,r,i,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,G(),G(),G())}};var Tn=class{constructor(e,t,r,i){this.De=e,this.removedTargetIds=t,this.key=r,this.ve=i}},as=class{constructor(e,t){this.targetId=e,this.Ce=t}},cs=class{constructor(e,t,r=ve.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},us=class{constructor(){this.Fe=0,this.Me=cf(),this.xe=ve.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return this.Fe!==0}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=G(),t=G(),r=G();return this.Me.forEach((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:M(38017,{changeType:o})}}),new Mr(this.xe,this.Oe,e,t,r)}Qe(){this.Ne=!1,this.Me=cf()}$e(e,t){this.Ne=!0,this.Me=this.Me.insert(e,t)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,Q(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}},_c=class{constructor(e){this.ze=e,this.je=new Map,this.He=lt(),this.Je=Wi(),this.Ye=Wi(),this.Ze=new ie(z)}Xe(e){for(let t of e.De)e.ve&&e.ve.isFoundDocument()?this.et(t,e.ve):this.tt(t,e.key,e.ve);for(let t of e.removedTargetIds)this.tt(t,e.key,e.ve)}nt(e){this.forEachTarget(e,t=>{let r=this.rt(t);switch(e.state){case 0:this.it(t)&&r.ke(e.resumeToken);break;case 1:r.We(),r.Be||r.Qe(),r.ke(e.resumeToken);break;case 2:r.We(),r.Be||this.removeTarget(t);break;case 3:this.it(t)&&(r.Ge(),r.ke(e.resumeToken));break;case 4:this.it(t)&&(this.st(t),r.ke(e.resumeToken));break;default:M(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.je.forEach((r,i)=>{this.it(i)&&t(i)})}ot(e){let t=e.targetId,r=e.Ce.count,i=this._t(t);if(i){let o=i.target;if(ac(o))if(r===0){let a=new L(o.path);this.tt(t,a,Me.newNoDocument(a,q.min()))}else Q(r===1,20013,{expectedCount:r});else{let a=this.ut(t);if(a!==r){let u=this.ct(e),h=u?this.lt(u,e,a):1;if(h!==0){this.st(t);let d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,d)}sf?.ht(function(p,y,E,R,k){var x,D,$,U,j,J;let Ie={localCacheCount:p,existenceFilterCount:y.count,databaseId:E.database,projectId:E.projectId},Y=y.unchangedNames;return Y&&(Ie.bloomFilter={applied:k===0,hashCount:(x=Y?.hashCount)!==null&&x!==void 0?x:0,bitmapLength:(U=($=(D=Y?.bits)===null||D===void 0?void 0:D.bitmap)===null||$===void 0?void 0:$.length)!==null&&U!==void 0?U:0,padding:(J=(j=Y?.bits)===null||j===void 0?void 0:j.padding)!==null&&J!==void 0?J:0,mightContain:w=>{var m;return(m=R?.mightContain(w))!==null&&m!==void 0&&m}}),Ie}(a,e.Ce,this.ze.Pt(),u,h))}}}}ct(e){let t=e.Ce.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=t,a,u;try{a=ct(r).toUint8Array()}catch(h){if(h instanceof ts)return bn("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new gc(a,i,o)}catch(h){return bn(h instanceof Kt?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.pe===0?null:u}lt(e,t,r){return t.Ce.count===r-this.Tt(e,t.targetId)?0:2}Tt(e,t){let r=this.ze.getRemoteKeysForTarget(t),i=0;return r.forEach(o=>{let a=this.ze.Pt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.tt(t,o,null),i++)}),i}It(e){let t=new Map;this.je.forEach((o,a)=>{let u=this._t(a);if(u){if(o.current&&ac(u.target)){let h=new L(u.target.path);this.Et(h).has(a)||this.dt(a,h)||this.tt(a,h,Me.newNoDocument(h,e))}o.Le&&(t.set(a,o.qe()),o.Qe())}});let r=G();this.Ye.forEach((o,a)=>{let u=!0;a.forEachWhile(h=>{let d=this._t(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(r=r.add(o))}),this.He.forEach((o,a)=>a.setReadTime(e));let i=new os(e,t,this.Ze,this.He,r);return this.He=lt(),this.Je=Wi(),this.Ye=Wi(),this.Ze=new ie(z),i}et(e,t){if(!this.it(e))return;let r=this.dt(e,t.key)?2:0;this.rt(e).$e(t.key,r),this.He=this.He.insert(t.key,t),this.Je=this.Je.insert(t.key,this.Et(t.key).add(e)),this.Ye=this.Ye.insert(t.key,this.At(t.key).add(e))}tt(e,t,r){if(!this.it(e))return;let i=this.rt(e);this.dt(e,t)?i.$e(t,1):i.Ue(t),this.Ye=this.Ye.insert(t,this.At(t).delete(e)),this.Ye=this.Ye.insert(t,this.At(t).add(e)),r&&(this.He=this.He.insert(t,r))}removeTarget(e){this.je.delete(e)}ut(e){let t=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let t=this.je.get(e);return t||(t=new us,this.je.set(e,t)),t}At(e){let t=this.Ye.get(e);return t||(t=new le(z),this.Ye=this.Ye.insert(e,t)),t}Et(e){let t=this.Je.get(e);return t||(t=new le(z),this.Je=this.Je.insert(e,t)),t}it(e){let t=this._t(e)!==null;return t||O("WatchChangeAggregator","Detected inactive target",e),t}_t(e){let t=this.je.get(e);return t&&t.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new us),this.ze.getRemoteKeysForTarget(e).forEach(t=>{this.tt(e,t,null)})}dt(e,t){return this.ze.getRemoteKeysForTarget(e).has(t)}};function Wi(){return new ie(L.comparator)}function cf(){return new ie(L.comparator)}var aE={asc:"ASCENDING",desc:"DESCENDING"},cE={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},uE={and:"AND",or:"OR"},yc=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function vc(n,e){return n.useProto3Json||Ds(e)?e:{value:e}}function ls(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function wp(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function lE(n,e){return ls(n,e.toTimestamp())}function Ke(n){return Q(!!n,49232),q.fromTimestamp(function(t){let r=at(t);return new de(r.seconds,r.nanos)}(n))}function Lu(n,e){return Ic(n,e).canonicalString()}function Ic(n,e){let t=function(i){return new te(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function Tp(n){let e=te.fromString(n);return Q(Pp(e),10190,{key:e.toString()}),e}function Ec(n,e){return Lu(n.databaseId,e.path)}function La(n,e){let t=Tp(e);if(t.get(1)!==n.databaseId.projectId)throw new V(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new V(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new L(bp(t))}function Ap(n,e){return Lu(n.databaseId,e)}function hE(n){let e=Tp(n);return e.length===4?te.emptyPath():bp(e)}function wc(n){return new te(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function bp(n){return Q(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function uf(n,e,t){return{name:Ec(n,e),fields:t.value.mapValue.fields}}function dE(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:M(39313,{state:d})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(d,p){return d.useProto3Json?(Q(p===void 0||typeof p=="string",58123),ve.fromBase64String(p||"")):(Q(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),ve.fromUint8Array(p||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(d){let p=d.code===void 0?P.UNKNOWN:Ep(d.code);return new V(p,d.message||"")}(a);t=new cs(r,i,o,u||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=La(n,r.document.name),o=Ke(r.document.updateTime),a=r.document.createTime?Ke(r.document.createTime):q.min(),u=new Le({mapValue:{fields:r.document.fields}}),h=Me.newFoundDocument(i,o,a,u),d=r.targetIds||[],p=r.removedTargetIds||[];t=new Tn(d,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=La(n,r.document),o=r.readTime?Ke(r.readTime):q.min(),a=Me.newNoDocument(i,o),u=r.removedTargetIds||[];t=new Tn([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=La(n,r.document),o=r.removedTargetIds||[];t=new Tn([],o,i,null)}else{if(!("filter"in e))return M(11601,{Vt:e});{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:o}=r,a=new mc(i,o),u=r.targetId;t=new as(u,a)}}return t}function fE(n,e){let t;if(e instanceof tn)t={update:uf(n,e.key,e.value)};else if(e instanceof ss)t={delete:Ec(n,e.key)};else if(e instanceof ht)t={update:uf(n,e.key,e.data),updateMask:wE(e.fieldMask)};else{if(!(e instanceof hc))return M(16599,{ft:e.type});t={verify:Ec(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(o,a){let u=a.transform;if(u instanceof On)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Zt)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof en)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof xn)return{fieldPath:a.field.canonicalString(),increment:u.Re};throw M(20930,{transform:a.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,o){return o.updateTime!==void 0?{updateTime:lE(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:M(27497)}(n,e.precondition)),t}function pE(n,e){return n&&n.length>0?(Q(e!==void 0,14353),n.map(t=>function(i,o){let a=i.updateTime?Ke(i.updateTime):Ke(o);return a.isEqual(q.min())&&(a=Ke(o)),new lc(a,i.transformResults||[])}(t,e))):[]}function mE(n,e){return{documents:[Ap(n,e.path)]}}function gE(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Ap(n,i);let o=function(d){if(d.length!==0)return Rp(Fe.create(d,"and"))}(e.filters);o&&(t.structuredQuery.where=o);let a=function(d){if(d.length!==0)return d.map(p=>function(E){return{field:In(E.field),direction:vE(E.dir)}}(p))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);let u=vc(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{gt:t,parent:i}}function _E(n){let e=hE(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){Q(r===1,65062);let p=t.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let o=[];t.where&&(o=function(y){let E=Sp(y);return E instanceof Fe&&ip(E)?E.getFilters():[E]}(t.where));let a=[];t.orderBy&&(a=function(y){return y.map(E=>function(k){return new Dn(En(k.field),function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(k.direction))}(E))}(t.orderBy));let u=null;t.limit&&(u=function(y){let E;return E=typeof y=="object"?y.value:y,Ds(E)?null:E}(t.limit));let h=null;t.startAt&&(h=function(y){let E=!!y.before,R=y.values||[];return new kn(R,E)}(t.startAt));let d=null;return t.endAt&&(d=function(y){let E=!y.before,R=y.values||[];return new kn(R,E)}(t.endAt)),zI(e,i,a,o,u,"F",h,d)}function yE(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return M(28987,{purpose:i})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Sp(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=En(t.unaryFilter.field);return ae.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=En(t.unaryFilter.field);return ae.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let o=En(t.unaryFilter.field);return ae.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=En(t.unaryFilter.field);return ae.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return M(61313);default:return M(60726)}}(n):n.fieldFilter!==void 0?function(t){return ae.create(En(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return M(58110);default:return M(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Fe.create(t.compositeFilter.filters.map(r=>Sp(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return M(1026)}}(t.compositeFilter.op))}(n):M(30097,{filter:n})}function vE(n){return aE[n]}function IE(n){return cE[n]}function EE(n){return uE[n]}function In(n){return{fieldPath:n.canonicalString()}}function En(n){return Se.fromServerFormat(n.fieldPath)}function Rp(n){return n instanceof ae?function(t){if(t.op==="=="){if(Qd(t.value))return{unaryFilter:{field:In(t.field),op:"IS_NAN"}};if(Hd(t.value))return{unaryFilter:{field:In(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Qd(t.value))return{unaryFilter:{field:In(t.field),op:"IS_NOT_NAN"}};if(Hd(t.value))return{unaryFilter:{field:In(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:In(t.field),op:IE(t.op),value:t.value}}}(n):n instanceof Fe?function(t){let r=t.getFilters().map(i=>Rp(i));return r.length===1?r[0]:{compositeFilter:{op:EE(t.op),filters:r}}}(n):M(54877,{filter:n})}function wE(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Pp(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Fr=class n{constructor(e,t,r,i,o=q.min(),a=q.min(),u=ve.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Tc=class{constructor(e){this.wt=e}};function TE(n){let e=_E({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?uc(e,e.limit,"L"):e}var hs=class{constructor(){}vt(e,t){this.Ct(e,t),t.Ft()}Ct(e,t){if("nullValue"in e)this.Mt(t,5);else if("booleanValue"in e)this.Mt(t,10),t.xt(e.booleanValue?1:0);else if("integerValue"in e)this.Mt(t,15),t.xt(ee(e.integerValue));else if("doubleValue"in e){let r=ee(e.doubleValue);isNaN(r)?this.Mt(t,13):(this.Mt(t,15),xr(r)?t.xt(0):t.xt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Mt(t,20),typeof r=="string"&&(r=at(r)),t.Ot(`${r.seconds||""}`),t.xt(r.nanos||0)}else if("stringValue"in e)this.Nt(e.stringValue,t),this.Bt(t);else if("bytesValue"in e)this.Mt(t,30),t.Lt(ct(e.bytesValue)),this.Bt(t);else if("referenceValue"in e)this.kt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Mt(t,45),t.xt(r.latitude||0),t.xt(r.longitude||0)}else"mapValue"in e?tp(e)?this.Mt(t,Number.MAX_SAFE_INTEGER):ep(e)?this.qt(e.mapValue,t):(this.Qt(e.mapValue,t),this.Bt(t)):"arrayValue"in e?(this.$t(e.arrayValue,t),this.Bt(t)):M(19022,{Ut:e})}Nt(e,t){this.Mt(t,25),this.Kt(e,t)}Kt(e,t){t.Ot(e)}Qt(e,t){let r=e.fields||{};this.Mt(t,55);for(let i of Object.keys(r))this.Nt(i,t),this.Ct(r[i],t)}qt(e,t){var r,i;let o=e.fields||{};this.Mt(t,53);let a=Rn,u=((i=(r=o[a].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.Mt(t,15),t.xt(ee(u)),this.Nt(a,t),this.Ct(o[a],t)}$t(e,t){let r=e.values||[];this.Mt(t,50);for(let i of r)this.Ct(i,t)}kt(e,t){this.Mt(t,37),L.fromName(e).path.forEach(r=>{this.Mt(t,60),this.Kt(r,t)})}Mt(e,t){e.xt(t)}Bt(e){e.xt(2)}};hs.Wt=new hs;var Ac=class{constructor(){this.Cn=new bc}addToCollectionParentIndex(e,t){return this.Cn.add(t),C.resolve()}getCollectionParents(e,t){return C.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return C.resolve()}deleteFieldIndex(e,t){return C.resolve()}deleteAllFieldIndexes(e){return C.resolve()}createTargetIndexes(e,t){return C.resolve()}getDocumentsMatchingTarget(e,t){return C.resolve(null)}getIndexType(e,t){return C.resolve(0)}getFieldIndexes(e,t){return C.resolve([])}getNextCollectionGroupToUpdate(e){return C.resolve(null)}getMinOffset(e,t){return C.resolve(Jt.min())}getMinOffsetFromCollectionGroup(e,t){return C.resolve(Jt.min())}updateCollectionGroup(e,t,r){return C.resolve()}updateIndexEntries(e,t){return C.resolve()}},bc=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new le(te.comparator),o=!i.has(r);return this.index[t]=i.add(r),o}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new le(te.comparator)).toArray()}};var Pb=new Uint8Array(0);var lf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Cp=41943040,De=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};De.DEFAULT_COLLECTION_PERCENTILE=10,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,De.DEFAULT=new De(Cp,De.DEFAULT_COLLECTION_PERCENTILE,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),De.DISABLED=new De(-1,0,0);var Ur=class n{constructor(e){this.ur=e}next(){return this.ur+=2,this.ur}static cr(){return new n(0)}static lr(){return new n(-1)}};var hf="LruGarbageCollector",AE=1048576;function df([n,e],[t,r]){let i=z(n,t);return i===0?z(e,r):i}var Sc=class{constructor(e){this.Er=e,this.buffer=new le(df),this.dr=0}Ar(){return++this.dr}Rr(e){let t=[e,this.Ar()];if(this.buffer.size<this.Er)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();df(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},Rc=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Vr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.mr(6e4)}stop(){this.Vr&&(this.Vr.cancel(),this.Vr=null)}get started(){return this.Vr!==null}mr(e){O(hf,`Garbage collection scheduled in ${e}ms`),this.Vr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>v(this,null,function*(){this.Vr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){$n(t)?O(hf,"Ignoring IndexedDB error during garbage collection: ",t):yield qn(t)}yield this.mr(3e5)}))}},Pc=class{constructor(e,t){this.gr=e,this.params=t}calculateTargetCount(e,t){return this.gr.pr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return C.resolve(Su.le);let r=new Sc(t);return this.gr.forEachTarget(e,i=>r.Rr(i.sequenceNumber)).next(()=>this.gr.yr(e,i=>r.Rr(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.gr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.gr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(O("LruGarbageCollector","Garbage collection skipped; disabled"),C.resolve(lf)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(O("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),lf):this.wr(e,t))}getCacheSize(e){return this.gr.getCacheSize(e)}wr(e,t){let r,i,o,a,u,h,d,p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(y=>(y>this.params.maximumSequenceNumbersToCollect?(O("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${y}`),i=this.params.maximumSequenceNumbersToCollect):i=y,a=Date.now(),this.nthSequenceNumber(e,i))).next(y=>(r=y,u=Date.now(),this.removeTargets(e,r,t))).next(y=>(o=y,h=Date.now(),this.removeOrphanedDocuments(e,r))).next(y=>(d=Date.now(),yn()<=W.DEBUG&&O("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${y} documents in `+(d-h)+`ms
Total Duration: ${d-p}ms`),C.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:y})))}};function bE(n,e){return new Pc(n,e)}var Cc=class{constructor(){this.changes=new ut(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Me.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?C.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var kc=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Dc=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Dr(r.mutation,i,ze.empty(),de.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,G()).next(()=>r))}getLocalViewOfDocuments(e,t,r=G()){let i=Gt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(o=>{let a=Rr();return o.forEach((u,h)=>{a=a.insert(u,h.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let r=Gt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,G()))}populateOverlays(e,t,r){let i=[];return r.forEach(o=>{t.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(e,i).next(o=>{o.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,r,i){let o=lt(),a=kr(),u=function(){return kr()}();return t.forEach((h,d)=>{let p=r.get(d.key);i.has(d.key)&&(p===void 0||p.mutation instanceof ht)?o=o.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),Dr(p.mutation,d,p.mutation.getFieldMask(),de.now())):a.set(d.key,ze.empty())}),this.recalculateAndSaveOverlays(e,o).next(h=>(h.forEach((d,p)=>a.set(d,p)),t.forEach((d,p)=>{var y;return u.set(d,new kc(p,(y=a.get(d))!==null&&y!==void 0?y:null))}),u))}recalculateAndSaveOverlays(e,t){let r=kr(),i=new ie((a,u)=>a-u),o=G();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let u of a)u.keys().forEach(h=>{let d=t.get(h);if(d===null)return;let p=r.get(h)||ze.empty();p=u.applyToLocalView(d,p),r.set(h,p);let y=(i.get(u.batchId)||G()).add(h);i=i.insert(u.batchId,y)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let h=u.getNext(),d=h.key,p=h.value,y=fp();p.forEach(E=>{if(!o.has(E)){let R=vp(t.get(E),r.get(E));R!==null&&y.set(E,R),o=o.add(E)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,y))}return C.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(a){return L.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):cp(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(o=>{let a=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-o.size):C.resolve(Gt()),u=Or,h=o;return a.next(d=>C.forEach(d,(p,y)=>(u<y.largestBatchId&&(u=y.largestBatchId),o.get(p)?C.resolve():this.remoteDocumentCache.getEntry(e,p).next(E=>{h=h.insert(p,E)}))).next(()=>this.populateOverlays(e,d,o)).next(()=>this.computeViews(e,h,d,G())).next(p=>({batchId:u,changes:dp(p)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next(r=>{let i=Rr();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let o=t.collectionGroup,a=Rr();return this.indexManager.getCollectionParents(e,o).next(u=>C.forEach(u,h=>{let d=function(y,E){return new Xt(E,null,y.explicitOrderBy.slice(),y.filters.slice(),y.limit,y.limitType,y.startAt,y.endAt)}(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,d,r,i).next(p=>{p.forEach((y,E)=>{a=a.insert(y,E)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,i))).next(a=>{o.forEach((h,d)=>{let p=d.getKey();a.get(p)===null&&(a=a.insert(p,Me.newInvalidDocument(p)))});let u=Rr();return a.forEach((h,d)=>{let p=o.get(h);p!==void 0&&Dr(p.mutation,d,ze.empty(),de.now()),xs(t,d)&&(u=u.insert(h,d))}),u})}};var Nc=class{constructor(e){this.serializer=e,this.kr=new Map,this.qr=new Map}getBundleMetadata(e,t){return C.resolve(this.kr.get(t))}saveBundleMetadata(e,t){return this.kr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Ke(i.createTime)}}(t)),C.resolve()}getNamedQuery(e,t){return C.resolve(this.qr.get(t))}saveNamedQuery(e,t){return this.qr.set(t.name,function(i){return{name:i.name,query:TE(i.bundledQuery),readTime:Ke(i.readTime)}}(t)),C.resolve()}};var Oc=class{constructor(){this.overlays=new ie(L.comparator),this.Qr=new Map}getOverlay(e,t){return C.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Gt();return C.forEach(t,i=>this.getOverlay(e,i).next(o=>{o!==null&&r.set(i,o)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,o)=>{this.St(e,t,o)}),C.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.Qr.get(r);return i!==void 0&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.Qr.delete(r)),C.resolve()}getOverlaysForCollection(e,t,r){let i=Gt(),o=t.length+1,a=new L(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let h=u.getNext().value,d=h.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===o&&h.largestBatchId>r&&i.set(h.getKey(),h)}return C.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let o=new ie((d,p)=>d-p),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let p=o.get(d.largestBatchId);p===null&&(p=Gt(),o=o.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}let u=Gt(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((d,p)=>u.set(d,p)),!(u.size()>=i)););return C.resolve(u)}St(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let a=this.Qr.get(i.largestBatchId).delete(r.key);this.Qr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new pc(t,r));let o=this.Qr.get(t);o===void 0&&(o=G(),this.Qr.set(t,o)),this.Qr.set(t,o.add(r.key))}};var xc=class{constructor(){this.sessionToken=ve.EMPTY_BYTE_STRING}getSessionToken(e){return C.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,C.resolve()}};var Br=class{constructor(){this.$r=new le(oe.Ur),this.Kr=new le(oe.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(e,t){let r=new oe(e,t);this.$r=this.$r.add(r),this.Kr=this.Kr.add(r)}Gr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.zr(new oe(e,t))}jr(e,t){e.forEach(r=>this.removeReference(r,t))}Hr(e){let t=new L(new te([])),r=new oe(t,e),i=new oe(t,e+1),o=[];return this.Kr.forEachInRange([r,i],a=>{this.zr(a),o.push(a.key)}),o}Jr(){this.$r.forEach(e=>this.zr(e))}zr(e){this.$r=this.$r.delete(e),this.Kr=this.Kr.delete(e)}Yr(e){let t=new L(new te([])),r=new oe(t,e),i=new oe(t,e+1),o=G();return this.Kr.forEachInRange([r,i],a=>{o=o.add(a.key)}),o}containsKey(e){let t=new oe(e,0),r=this.$r.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},oe=class{constructor(e,t){this.key=e,this.Zr=t}static Ur(e,t){return L.comparator(e.key,t.key)||z(e.Zr,t.Zr)}static Wr(e,t){return z(e.Zr,t.Zr)||L.comparator(e.key,t.key)}};var Vc=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nr=1,this.Xr=new le(oe.Ur)}checkEmpty(e){return C.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let o=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new dc(o,t,r,i);this.mutationQueue.push(a);for(let u of i)this.Xr=this.Xr.add(new oe(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return C.resolve(a)}lookupMutationBatch(e,t){return C.resolve(this.ei(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.ti(r),o=i<0?0:i;return C.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return C.resolve(this.mutationQueue.length===0?Ru:this.nr-1)}getAllMutationBatches(e){return C.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new oe(t,0),i=new oe(t,Number.POSITIVE_INFINITY),o=[];return this.Xr.forEachInRange([r,i],a=>{let u=this.ei(a.Zr);o.push(u)}),C.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new le(z);return t.forEach(i=>{let o=new oe(i,0),a=new oe(i,Number.POSITIVE_INFINITY);this.Xr.forEachInRange([o,a],u=>{r=r.add(u.Zr)})}),C.resolve(this.ni(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,o=r;L.isDocumentKey(o)||(o=o.child(""));let a=new oe(new L(o),0),u=new le(z);return this.Xr.forEachWhile(h=>{let d=h.key.path;return!!r.isPrefixOf(d)&&(d.length===i&&(u=u.add(h.Zr)),!0)},a),C.resolve(this.ni(u))}ni(e){let t=[];return e.forEach(r=>{let i=this.ei(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){Q(this.ri(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Xr;return C.forEach(t.mutations,i=>{let o=new oe(i.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Xr=r})}sr(e){}containsKey(e,t){let r=new oe(t,0),i=this.Xr.firstAfterOrEqual(r);return C.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,C.resolve()}ri(e,t){return this.ti(e)}ti(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}ei(e){let t=this.ti(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Lc=class{constructor(e){this.ii=e,this.docs=function(){return new ie(L.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),o=i?i.size:0,a=this.ii(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return C.resolve(r?r.document.mutableCopy():Me.newInvalidDocument(t))}getEntries(e,t){let r=lt();return t.forEach(i=>{let o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():Me.newInvalidDocument(i))}),C.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let o=lt(),a=t.path,u=new L(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){let{key:d,value:{document:p}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||bI(AI(p),r)<=0||(i.has(p.key)||xs(t,p))&&(o=o.insert(p.key,p.mutableCopy()))}return C.resolve(o)}getAllFromCollectionGroup(e,t,r,i){M(9500)}si(e,t){return C.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Mc(this)}getSize(e){return C.resolve(this.size)}},Mc=class extends Cc{constructor(e){super(),this.Br=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Br.addEntry(e,i)):this.Br.removeEntry(r)}),C.waitFor(t)}getFromCache(e,t){return this.Br.getEntry(e,t)}getAllFromCache(e,t){return this.Br.getEntries(e,t)}};var Fc=class{constructor(e){this.persistence=e,this.oi=new ut(t=>Nu(t),Ou),this.lastRemoteSnapshotVersion=q.min(),this.highestTargetId=0,this._i=0,this.ai=new Br,this.targetCount=0,this.ui=Ur.cr()}forEachTarget(e,t){return this.oi.forEach((r,i)=>t(i)),C.resolve()}getLastRemoteSnapshotVersion(e){return C.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return C.resolve(this._i)}allocateTargetId(e){return this.highestTargetId=this.ui.next(),C.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this._i&&(this._i=t),C.resolve()}Tr(e){this.oi.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ui=new Ur(t),this.highestTargetId=t),e.sequenceNumber>this._i&&(this._i=e.sequenceNumber)}addTargetData(e,t){return this.Tr(t),this.targetCount+=1,C.resolve()}updateTargetData(e,t){return this.Tr(t),C.resolve()}removeTargetData(e,t){return this.oi.delete(t.target),this.ai.Hr(t.targetId),this.targetCount-=1,C.resolve()}removeTargets(e,t,r){let i=0,o=[];return this.oi.forEach((a,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.oi.delete(a),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),C.waitFor(o).next(()=>i)}getTargetCount(e){return C.resolve(this.targetCount)}getTargetData(e,t){let r=this.oi.get(t)||null;return C.resolve(r)}addMatchingKeys(e,t,r){return this.ai.Gr(t,r),C.resolve()}removeMatchingKeys(e,t,r){this.ai.jr(t,r);let i=this.persistence.referenceDelegate,o=[];return i&&t.forEach(a=>{o.push(i.markPotentiallyOrphaned(e,a))}),C.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.ai.Hr(t),C.resolve()}getMatchingKeysForTargetId(e,t){let r=this.ai.Yr(t);return C.resolve(r)}containsKey(e,t){return C.resolve(this.ai.containsKey(t))}};var ds=class{constructor(e,t){this.ci={},this.overlays={},this.li=new Su(0),this.hi=!1,this.hi=!0,this.Pi=new xc,this.referenceDelegate=e(this),this.Ti=new Fc(this),this.indexManager=new Ac,this.remoteDocumentCache=function(i){return new Lc(i)}(r=>this.referenceDelegate.Ii(r)),this.serializer=new Tc(t),this.Ei=new Nc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Oc,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ci[e.toKey()];return r||(r=new Vc(t,this.referenceDelegate),this.ci[e.toKey()]=r),r}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(e,t,r){O("MemoryPersistence","Starting transaction:",e);let i=new Uc(this.li.next());return this.referenceDelegate.di(),r(i).next(o=>this.referenceDelegate.Ai(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}Ri(e,t){return C.or(Object.values(this.ci).map(r=>()=>r.containsKey(e,t)))}},Uc=class extends Ha{constructor(e){super(),this.currentSequenceNumber=e}},Bc=class n{constructor(e){this.persistence=e,this.Vi=new Br,this.mi=null}static fi(e){return new n(e)}get gi(){if(this.mi)return this.mi;throw M(60996)}addReference(e,t,r){return this.Vi.addReference(r,t),this.gi.delete(r.toString()),C.resolve()}removeReference(e,t,r){return this.Vi.removeReference(r,t),this.gi.add(r.toString()),C.resolve()}markPotentiallyOrphaned(e,t){return this.gi.add(t.toString()),C.resolve()}removeTarget(e,t){this.Vi.Hr(t.targetId).forEach(i=>this.gi.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(o=>this.gi.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}di(){this.mi=new Set}Ai(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return C.forEach(this.gi,r=>{let i=L.fromPath(r);return this.pi(e,i).next(o=>{o||t.removeEntry(i,q.min())})}).next(()=>(this.mi=null,t.apply(e)))}updateLimboDocument(e,t){return this.pi(e,t).next(r=>{r?this.gi.delete(t.toString()):this.gi.add(t.toString())})}Ii(e){return 0}pi(e,t){return C.or([()=>C.resolve(this.Vi.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ri(e,t)])}},fs=class n{constructor(e,t){this.persistence=e,this.yi=new ut(r=>CI(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=bE(this,t)}static fi(e,t){return new n(e,t)}di(){}Ai(e){return C.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}pr(e){let t=this.br(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}br(e){let t=0;return this.yr(e,r=>{t++}).next(()=>t)}yr(e,t){return C.forEach(this.yi,(r,i)=>this.Dr(e,r,i).next(o=>o?C.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.si(e,a=>this.Dr(e,a,t).next(u=>{u||(r++,o.removeEntry(a,q.min()))})).next(()=>o.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.yi.set(t,e.currentSequenceNumber),C.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.yi.set(r,e.currentSequenceNumber),C.resolve()}removeReference(e,t,r){return this.yi.set(r,e.currentSequenceNumber),C.resolve()}updateLimboDocument(e,t){return this.yi.set(t,e.currentSequenceNumber),C.resolve()}Ii(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Ki(e.data.value)),t}Dr(e,t,r){return C.or([()=>this.persistence.Ri(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.yi.get(t);return C.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var qc=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.ds=r,this.As=i}static Rs(e,t){let r=G(),i=G();for(let o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new n(e,t.fromCache,r,i)}};var $c=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var jc=class{constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=function(){return _h()?8:RI(ce())>0?6:4}()}initialize(e,t){this.ys=e,this.indexManager=t,this.Vs=!0}getDocumentsMatchingQuery(e,t,r,i){let o={result:null};return this.ws(e,t).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.bs(e,t,i,r).next(a=>{o.result=a})}).next(()=>{if(o.result)return;let a=new $c;return this.Ss(e,t,a).next(u=>{if(o.result=u,this.fs)return this.Ds(e,t,a,u.size)})}).next(()=>o.result)}Ds(e,t,r,i){return r.documentReadCount<this.gs?(yn()<=W.DEBUG&&O("QueryEngine","SDK will not create cache indexes for query:",vn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),C.resolve()):(yn()<=W.DEBUG&&O("QueryEngine","Query:",vn(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.ps*i?(yn()<=W.DEBUG&&O("QueryEngine","The SDK decides to create cache indexes for query:",vn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ge(t))):C.resolve())}ws(e,t){if(Zd(t))return C.resolve(null);let r=Ge(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=uc(t,null,"F"),r=Ge(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(o=>{let a=G(...o);return this.ys.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,r).next(h=>{let d=this.vs(t,u);return this.Cs(t,d,a,h.readTime)?this.ws(e,uc(t,null,"F")):this.Fs(e,d,t,h)}))})))}bs(e,t,r,i){return Zd(t)||i.isEqual(q.min())?C.resolve(null):this.ys.getDocuments(e,r).next(o=>{let a=this.vs(t,o);return this.Cs(t,a,r,i)?C.resolve(null):(yn()<=W.DEBUG&&O("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),vn(t)),this.Fs(e,a,t,TI(i,Or)).next(u=>u))})}vs(e,t){let r=new le(lp(e));return t.forEach((i,o)=>{xs(e,o)&&(r=r.add(o))}),r}Cs(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Ss(e,t,r){return yn()<=W.DEBUG&&O("QueryEngine","Using full collection scan to execute query:",vn(t)),this.ys.getDocumentsMatchingQuery(e,t,Jt.min(),r)}Fs(e,t,r,i){return this.ys.getDocumentsMatchingQuery(e,r,i).next(o=>(t.forEach(a=>{o=o.insert(a.key,a)}),o))}};var Mu="LocalStore",SE=3e8,zc=class{constructor(e,t,r,i){this.persistence=e,this.Ms=t,this.serializer=i,this.xs=new ie(z),this.Os=new ut(o=>Nu(o),Ou),this.Ns=new Map,this.Bs=e.getRemoteDocumentCache(),this.Ti=e.getTargetCache(),this.Ei=e.getBundleCache(),this.Ls(r)}Ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Dc(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.xs))}};function RE(n,e,t,r){return new zc(n,e,t,r)}function kp(n,e){return v(this,null,function*(){let t=B(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(o=>(i=o,t.Ls(e),t.mutationQueue.getAllMutationBatches(r))).next(o=>{let a=[],u=[],h=G();for(let d of i){a.push(d.batchId);for(let p of d.mutations)h=h.add(p.key)}for(let d of o){u.push(d.batchId);for(let p of d.mutations)h=h.add(p.key)}return t.localDocuments.getDocuments(r,h).next(d=>({ks:d,removedBatchIds:a,addedBatchIds:u}))})})})}function PE(n,e){let t=B(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),o=t.Bs.newChangeBuffer({trackRemovals:!0});return function(u,h,d,p){let y=d.batch,E=y.keys(),R=C.resolve();return E.forEach(k=>{R=R.next(()=>p.getEntry(h,k)).next(x=>{let D=d.docVersions.get(k);Q(D!==null,48541),x.version.compareTo(D)<0&&(y.applyToRemoteDocument(x,d),x.isValidDocument()&&(x.setReadTime(d.commitVersion),p.addEntry(x)))})}),R.next(()=>u.mutationQueue.removeMutationBatch(h,y))}(t,r,e,o).next(()=>o.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(u){let h=G();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(h=h.add(u.batch.mutations[d].key));return h}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Dp(n){let e=B(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ti.getLastRemoteSnapshotVersion(t))}function CE(n,e){let t=B(n),r=e.snapshotVersion,i=t.xs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{let a=t.Bs.newChangeBuffer({trackRemovals:!0});i=t.xs;let u=[];e.targetChanges.forEach((p,y)=>{let E=i.get(y);if(!E)return;u.push(t.Ti.removeMatchingKeys(o,p.removedDocuments,y).next(()=>t.Ti.addMatchingKeys(o,p.addedDocuments,y)));let R=E.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(y)!==null?R=R.withResumeToken(ve.EMPTY_BYTE_STRING,q.min()).withLastLimboFreeSnapshotVersion(q.min()):p.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(p.resumeToken,r)),i=i.insert(y,R),function(x,D,$){return x.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=SE?!0:$.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size>0}(E,R,p)&&u.push(t.Ti.updateTargetData(o,R))});let h=lt(),d=G();if(e.documentUpdates.forEach(p=>{e.resolvedLimboDocuments.has(p)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(o,p))}),u.push(kE(o,a,e.documentUpdates).next(p=>{h=p.qs,d=p.Qs})),!r.isEqual(q.min())){let p=t.Ti.getLastRemoteSnapshotVersion(o).next(y=>t.Ti.setTargetsMetadata(o,o.currentSequenceNumber,r));u.push(p)}return C.waitFor(u).next(()=>a.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,h,d)).next(()=>h)}).then(o=>(t.xs=i,o))}function kE(n,e,t){let r=G(),i=G();return t.forEach(o=>r=r.add(o)),e.getEntries(n,r).next(o=>{let a=lt();return t.forEach((u,h)=>{let d=o.get(u);h.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(u)),h.isNoDocument()&&h.version.isEqual(q.min())?(e.removeEntry(u,h.readTime),a=a.insert(u,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(h),a=a.insert(u,h)):O(Mu,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",h.version)}),{qs:a,Qs:i}})}function DE(n,e){let t=B(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Ru),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function NE(n,e){let t=B(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Ti.getTargetData(r,e).next(o=>o?(i=o,C.resolve(i)):t.Ti.allocateTargetId(r).next(a=>(i=new Fr(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Ti.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.xs.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.xs=t.xs.insert(r.targetId,r),t.Os.set(e,r.targetId)),r})}function Wc(n,e,t){return v(this,null,function*(){let r=B(n),i=r.xs.get(e),o=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",o,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!$n(a))throw a;O(Mu,`Failed to update sequence numbers for target ${e}: ${a}`)}r.xs=r.xs.remove(e),r.Os.delete(i.target)})}function ff(n,e,t){let r=B(n),i=q.min(),o=G();return r.persistence.runTransaction("Execute query","readwrite",a=>function(h,d,p){let y=B(h),E=y.Os.get(p);return E!==void 0?C.resolve(y.xs.get(E)):y.Ti.getTargetData(d,p)}(r,a,Ge(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.Ti.getMatchingKeysForTargetId(a,u.targetId).next(h=>{o=h})}).next(()=>r.Ms.getDocumentsMatchingQuery(a,e,t?i:q.min(),t?o:G())).next(u=>(OE(r,GI(e),u),{documents:u,$s:o})))}function OE(n,e,t){let r=n.Ns.get(e)||q.min();t.forEach((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.Ns.set(e,r)}var ps=class{constructor(){this.activeTargetIds=XI()}js(e){this.activeTargetIds=this.activeTargetIds.add(e)}Hs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}zs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var Gc=class{constructor(){this.xo=new ps,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.xo.js(e),this.Oo[e]||"not-current"}updateQueryState(e,t,r){this.Oo[e]=t}removeLocalQueryTarget(e){this.xo.Hs(e)}isLocalQueryTarget(e){return this.xo.activeTargetIds.has(e)}clearQueryState(e){delete this.Oo[e]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(e){return this.xo.activeTargetIds.has(e)}start(){return this.xo=new ps,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Kc=class{No(e){}shutdown(){}};var pf="ConnectivityMonitor",ms=class{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(e){this.Qo.push(e)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){O(pf,"Network connectivity changed: AVAILABLE");for(let e of this.Qo)e(0)}qo(){O(pf,"Network connectivity changed: UNAVAILABLE");for(let e of this.Qo)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Gi=null;function Hc(){return Gi===null?Gi=function(){return 268435456+Math.round(2147483648*Math.random())}():Gi++,"0x"+Gi.toString(16)}var Ma="RestConnection",xE={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},Qc=class{get Uo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Ko=t+"://"+e.host,this.Wo=`projects/${r}/databases/${i}`,this.Go=this.databaseId.database===ns?`project_id=${r}`:`project_id=${r}&database_id=${i}`}zo(e,t,r,i,o){let a=Hc(),u=this.jo(e,t.toUriEncodedString());O(Ma,`Sending RPC '${e}' ${a}:`,u,r);let h={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(h,i,o);let{host:d}=new URL(u),p=yt(d);return this.Jo(e,u,h,r,p).then(y=>(O(Ma,`Received RPC '${e}' ${a}: `,y),y),y=>{throw bn(Ma,`RPC '${e}' ${a} failed with error: `,y,"url: ",u,"request:",r),y})}Yo(e,t,r,i,o,a){return this.zo(e,t,r,i,o)}Ho(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Bn}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,o)=>e[o]=i),r&&r.headers.forEach((i,o)=>e[o]=i)}jo(e,t){let r=xE[e];return`${this.Ko}/v1/${t}:${r}`}terminate(){}};var Yc=class{constructor(e){this.Zo=e.Zo,this.Xo=e.Xo}e_(e){this.t_=e}n_(e){this.r_=e}i_(e){this.s_=e}onMessage(e){this.o_=e}close(){this.Xo()}send(e){this.Zo(e)}__(){this.t_()}a_(){this.r_()}u_(e){this.s_(e)}c_(e){this.o_(e)}};var ye="WebChannelConnection",Jc=class extends Qc{constructor(e){super(e),this.l_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,i,o){let a=Hc();return new Promise((u,h)=>{let d=new Da;d.setWithCredentials(!0),d.listenOnce(Na.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Sr.NO_ERROR:let y=d.getResponseJson();O(ye,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(y)),u(y);break;case Sr.TIMEOUT:O(ye,`RPC '${e}' ${a} timed out`),h(new V(P.DEADLINE_EXCEEDED,"Request time out"));break;case Sr.HTTP_ERROR:let E=d.getStatus();if(O(ye,`RPC '${e}' ${a} failed with status:`,E,"response text:",d.getResponseText()),E>0){let R=d.getResponseJson();Array.isArray(R)&&(R=R[0]);let k=R?.error;if(k&&k.status&&k.message){let x=function($){let U=$.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(U)>=0?U:P.UNKNOWN}(k.status);h(new V(x,k.message))}else h(new V(P.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new V(P.UNAVAILABLE,"Connection failed."));break;default:M(9055,{h_:e,streamId:a,P_:d.getLastErrorCode(),T_:d.getLastError()})}}finally{O(ye,`RPC '${e}' ${a} completed.`)}});let p=JSON.stringify(i);O(ye,`RPC '${e}' ${a} sending request:`,i),d.send(t,"POST",p,r,15)})}I_(e,t,r){let i=Hc(),o=[this.Ko,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Va(),u=xa(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(h.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(h.useFetchStreams=!0),this.Ho(h.initMessageHeaders,t,r),h.encodeInitMessageHeaders=!0;let p=o.join("");O(ye,`Creating RPC '${e}' stream ${i}: ${p}`,h);let y=a.createWebChannel(p,h);this.E_(y);let E=!1,R=!1,k=new Yc({Zo:D=>{R?O(ye,`Not sending because RPC '${e}' stream ${i} is closed:`,D):(E||(O(ye,`Opening RPC '${e}' stream ${i} transport.`),y.open(),E=!0),O(ye,`RPC '${e}' stream ${i} sending:`,D),y.send(D))},Xo:()=>y.close()}),x=(D,$,U)=>{D.listen($,j=>{try{U(j)}catch(J){setTimeout(()=>{throw J},0)}})};return x(y,_n.EventType.OPEN,()=>{R||(O(ye,`RPC '${e}' stream ${i} transport opened.`),k.__())}),x(y,_n.EventType.CLOSE,()=>{R||(R=!0,O(ye,`RPC '${e}' stream ${i} transport closed`),k.u_(),this.d_(y))}),x(y,_n.EventType.ERROR,D=>{R||(R=!0,bn(ye,`RPC '${e}' stream ${i} transport errored. Name:`,D.name,"Message:",D.message),k.u_(new V(P.UNAVAILABLE,"The operation could not be completed")))}),x(y,_n.EventType.MESSAGE,D=>{var $;if(!R){let U=D.data[0];Q(!!U,16349);let j=U,J=j?.error||(($=j[0])===null||$===void 0?void 0:$.error);if(J){O(ye,`RPC '${e}' stream ${i} received error:`,J);let Ie=J.status,Y=function(_){let I=se[_];if(I!==void 0)return Ep(I)}(Ie),w=J.message;Y===void 0&&(Y=P.INTERNAL,w="Unknown error status: "+Ie+" with message "+J.message),R=!0,k.u_(new V(Y,w)),y.close()}else O(ye,`RPC '${e}' stream ${i} received:`,U),k.c_(U)}}),x(u,Oa.STAT_EVENT,D=>{D.stat===ji.PROXY?O(ye,`RPC '${e}' stream ${i} detected buffering proxy`):D.stat===ji.NOPROXY&&O(ye,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{k.a_()},0),k}terminate(){this.l_.forEach(e=>e.close()),this.l_=[]}E_(e){this.l_.push(e)}d_(e){this.l_=this.l_.filter(t=>t===e)}};function Fa(){return typeof document<"u"?document:null}function Vs(n){return new yc(n,!0)}var gs=class{constructor(e,t,r=1e3,i=1.5,o=6e4){this.xi=e,this.timerId=t,this.A_=r,this.R_=i,this.V_=o,this.m_=0,this.f_=null,this.g_=Date.now(),this.reset()}reset(){this.m_=0}p_(){this.m_=this.V_}y_(e){this.cancel();let t=Math.floor(this.m_+this.w_()),r=Math.max(0,Date.now()-this.g_),i=Math.max(0,t-r);i>0&&O("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.m_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.f_=this.xi.enqueueAfterDelay(this.timerId,i,()=>(this.g_=Date.now(),e())),this.m_*=this.R_,this.m_<this.A_&&(this.m_=this.A_),this.m_>this.V_&&(this.m_=this.V_)}b_(){this.f_!==null&&(this.f_.skipDelay(),this.f_=null)}cancel(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}w_(){return(Math.random()-.5)*this.m_}};var mf="PersistentStream",_s=class{constructor(e,t,r,i,o,a,u,h){this.xi=e,this.S_=r,this.D_=i,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.v_=0,this.C_=null,this.F_=null,this.stream=null,this.M_=0,this.x_=new gs(e,t)}O_(){return this.state===1||this.state===5||this.N_()}N_(){return this.state===2||this.state===3}start(){this.M_=0,this.state!==4?this.auth():this.B_()}stop(){return v(this,null,function*(){this.O_()&&(yield this.close(0))})}L_(){this.state=0,this.x_.reset()}k_(){this.N_()&&this.C_===null&&(this.C_=this.xi.enqueueAfterDelay(this.S_,6e4,()=>this.q_()))}Q_(e){this.U_(),this.stream.send(e)}q_(){return v(this,null,function*(){if(this.N_())return this.close(0)})}U_(){this.C_&&(this.C_.cancel(),this.C_=null)}K_(){this.F_&&(this.F_.cancel(),this.F_=null)}close(e,t){return v(this,null,function*(){this.U_(),this.K_(),this.x_.cancel(),this.v_++,e!==4?this.x_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(ot(t.toString()),ot("Using maximum backoff delay to prevent overloading the backend."),this.x_.p_()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.i_(t)})}W_(){}auth(){this.state=1;let e=this.G_(this.v_),t=this.v_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.v_===t&&this.z_(r,i)},r=>{e(()=>{let i=new V(P.UNKNOWN,"Fetching auth token failed: "+r.message);return this.j_(i)})})}z_(e,t){let r=this.G_(this.v_);this.stream=this.H_(e,t),this.stream.e_(()=>{r(()=>this.listener.e_())}),this.stream.n_(()=>{r(()=>(this.state=2,this.F_=this.xi.enqueueAfterDelay(this.D_,1e4,()=>(this.N_()&&(this.state=3),Promise.resolve())),this.listener.n_()))}),this.stream.i_(i=>{r(()=>this.j_(i))}),this.stream.onMessage(i=>{r(()=>++this.M_==1?this.J_(i):this.onNext(i))})}B_(){this.state=5,this.x_.y_(()=>v(this,null,function*(){this.state=0,this.start()}))}j_(e){return O(mf,`close with error: ${e}`),this.stream=null,this.close(4,e)}G_(e){return t=>{this.xi.enqueueAndForget(()=>this.v_===e?t():(O(mf,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Xc=class extends _s{constructor(e,t,r,i,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}H_(e,t){return this.connection.I_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.x_.reset();let t=dE(this.serializer,e),r=function(o){if(!("targetChange"in o))return q.min();let a=o.targetChange;return a.targetIds&&a.targetIds.length?q.min():a.readTime?Ke(a.readTime):q.min()}(e);return this.listener.Y_(t,r)}Z_(e){let t={};t.database=wc(this.serializer),t.addTarget=function(o,a){let u,h=a.target;if(u=ac(h)?{documents:mE(o,h)}:{query:gE(o,h).gt},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=wp(o,a.resumeToken);let d=vc(o,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(q.min())>0){u.readTime=ls(o,a.snapshotVersion.toTimestamp());let d=vc(o,a.expectedCount);d!==null&&(u.expectedCount=d)}return u}(this.serializer,e);let r=yE(this.serializer,e);r&&(t.labels=r),this.Q_(t)}X_(e){let t={};t.database=wc(this.serializer),t.removeTarget=e,this.Q_(t)}},Zc=class extends _s{constructor(e,t,r,i,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}get ea(){return this.M_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.ea&&this.ta([])}H_(e,t){return this.connection.I_("Write",e,t)}J_(e){return Q(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Q(!e.writeResults||e.writeResults.length===0,55816),this.listener.na()}onNext(e){Q(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.x_.reset();let t=pE(e.writeResults,e.commitTime),r=Ke(e.commitTime);return this.listener.ra(r,t)}ia(){let e={};e.database=wc(this.serializer),this.Q_(e)}ta(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>fE(this.serializer,r))};this.Q_(t)}};var eu=class{},tu=class extends eu{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.sa=!1}oa(){if(this.sa)throw new V(P.FAILED_PRECONDITION,"The client has already been terminated.")}zo(e,t,r,i){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.zo(e,Ic(t,r),i,o,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new V(P.UNKNOWN,o.toString())})}Yo(e,t,r,i,o){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Yo(e,Ic(t,r),i,a,u,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new V(P.UNKNOWN,a.toString())})}terminate(){this.sa=!0,this.connection.terminate()}},nu=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this._a=0,this.aa=null,this.ua=!0}ca(){this._a===0&&(this.la("Unknown"),this.aa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.aa=null,this.ha("Backend didn't respond within 10 seconds."),this.la("Offline"),Promise.resolve())))}Pa(e){this.state==="Online"?this.la("Unknown"):(this._a++,this._a>=1&&(this.Ta(),this.ha(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.la("Offline")))}set(e){this.Ta(),this._a=0,e==="Online"&&(this.ua=!1),this.la(e)}la(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ha(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ua?(ot(t),this.ua=!1):O("OnlineStateTracker",t)}Ta(){this.aa!==null&&(this.aa.cancel(),this.aa=null)}};var nn="RemoteStore",ru=class{constructor(e,t,r,i,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ia=[],this.Ea=new Map,this.da=new Set,this.Aa=[],this.Ra=o,this.Ra.No(a=>{r.enqueueAndForget(()=>v(this,null,function*(){sn(this)&&(O(nn,"Restarting streams for network reachability change."),yield function(h){return v(this,null,function*(){let d=B(h);d.da.add(4),yield Gr(d),d.Va.set("Unknown"),d.da.delete(4),yield Ls(d)})}(this))}))}),this.Va=new nu(r,i)}};function Ls(n){return v(this,null,function*(){if(sn(n))for(let e of n.Aa)yield e(!0)})}function Gr(n){return v(this,null,function*(){for(let e of n.Aa)yield e(!1)})}function Np(n,e){let t=B(n);t.Ea.has(e.targetId)||(t.Ea.set(e.targetId,e),qu(t)?Bu(t):jn(t).N_()&&Uu(t,e))}function Fu(n,e){let t=B(n),r=jn(t);t.Ea.delete(e),r.N_()&&Op(t,e),t.Ea.size===0&&(r.N_()?r.k_():sn(t)&&t.Va.set("Unknown"))}function Uu(n,e){if(n.ma.Ke(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(q.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}jn(n).Z_(e)}function Op(n,e){n.ma.Ke(e),jn(n).X_(e)}function Bu(n){n.ma=new _c({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Rt:e=>n.Ea.get(e)||null,Pt:()=>n.datastore.serializer.databaseId}),jn(n).start(),n.Va.ca()}function qu(n){return sn(n)&&!jn(n).O_()&&n.Ea.size>0}function sn(n){return B(n).da.size===0}function xp(n){n.ma=void 0}function VE(n){return v(this,null,function*(){n.Va.set("Online")})}function LE(n){return v(this,null,function*(){n.Ea.forEach((e,t)=>{Uu(n,e)})})}function ME(n,e){return v(this,null,function*(){xp(n),qu(n)?(n.Va.Pa(e),Bu(n)):n.Va.set("Unknown")})}function FE(n,e,t){return v(this,null,function*(){if(n.Va.set("Online"),e instanceof cs&&e.state===2&&e.cause)try{yield function(i,o){return v(this,null,function*(){let a=o.cause;for(let u of o.targetIds)i.Ea.has(u)&&(yield i.remoteSyncer.rejectListen(u,a),i.Ea.delete(u),i.ma.removeTarget(u))})}(n,e)}catch(r){O(nn,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield ys(n,r)}else if(e instanceof Tn?n.ma.Xe(e):e instanceof as?n.ma.ot(e):n.ma.nt(e),!t.isEqual(q.min()))try{let r=yield Dp(n.localStore);t.compareTo(r)>=0&&(yield function(o,a){let u=o.ma.It(a);return u.targetChanges.forEach((h,d)=>{if(h.resumeToken.approximateByteSize()>0){let p=o.Ea.get(d);p&&o.Ea.set(d,p.withResumeToken(h.resumeToken,a))}}),u.targetMismatches.forEach((h,d)=>{let p=o.Ea.get(h);if(!p)return;o.Ea.set(h,p.withResumeToken(ve.EMPTY_BYTE_STRING,p.snapshotVersion)),Op(o,h);let y=new Fr(p.target,h,d,p.sequenceNumber);Uu(o,y)}),o.remoteSyncer.applyRemoteEvent(u)}(n,t))}catch(r){O(nn,"Failed to raise snapshot:",r),yield ys(n,r)}})}function ys(n,e,t){return v(this,null,function*(){if(!$n(e))throw e;n.da.add(1),yield Gr(n),n.Va.set("Offline"),t||(t=()=>Dp(n.localStore)),n.asyncQueue.enqueueRetryable(()=>v(null,null,function*(){O(nn,"Retrying IndexedDB access"),yield t(),n.da.delete(1),yield Ls(n)}))})}function Vp(n,e){return e().catch(t=>ys(n,t,e))}function Ms(n){return v(this,null,function*(){let e=B(n),t=kt(e),r=e.Ia.length>0?e.Ia[e.Ia.length-1].batchId:Ru;for(;UE(e);)try{let i=yield DE(e.localStore,r);if(i===null){e.Ia.length===0&&t.k_();break}r=i.batchId,BE(e,i)}catch(i){yield ys(e,i)}Lp(e)&&Mp(e)})}function UE(n){return sn(n)&&n.Ia.length<10}function BE(n,e){n.Ia.push(e);let t=kt(n);t.N_()&&t.ea&&t.ta(e.mutations)}function Lp(n){return sn(n)&&!kt(n).O_()&&n.Ia.length>0}function Mp(n){kt(n).start()}function qE(n){return v(this,null,function*(){kt(n).ia()})}function $E(n){return v(this,null,function*(){let e=kt(n);for(let t of n.Ia)e.ta(t.mutations)})}function jE(n,e,t){return v(this,null,function*(){let r=n.Ia.shift(),i=fc.from(r,e,t);yield Vp(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Ms(n)})}function zE(n,e){return v(this,null,function*(){e&&kt(n).ea&&(yield function(r,i){return v(this,null,function*(){if(function(a){return sE(a)&&a!==P.ABORTED}(i.code)){let o=r.Ia.shift();kt(r).L_(),yield Vp(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i)),yield Ms(r)}})}(n,e)),Lp(n)&&Mp(n)})}function gf(n,e){return v(this,null,function*(){let t=B(n);t.asyncQueue.verifyOperationInProgress(),O(nn,"RemoteStore received new credentials");let r=sn(t);t.da.add(3),yield Gr(t),r&&t.Va.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.da.delete(3),yield Ls(t)})}function WE(n,e){return v(this,null,function*(){let t=B(n);e?(t.da.delete(2),yield Ls(t)):e||(t.da.add(2),yield Gr(t),t.Va.set("Unknown"))})}function jn(n){return n.fa||(n.fa=function(t,r,i){let o=B(t);return o.oa(),new Xc(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(n.datastore,n.asyncQueue,{e_:VE.bind(null,n),n_:LE.bind(null,n),i_:ME.bind(null,n),Y_:FE.bind(null,n)}),n.Aa.push(e=>v(null,null,function*(){e?(n.fa.L_(),qu(n)?Bu(n):n.Va.set("Unknown")):(yield n.fa.stop(),xp(n))}))),n.fa}function kt(n){return n.ga||(n.ga=function(t,r,i){let o=B(t);return o.oa(),new Zc(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(n.datastore,n.asyncQueue,{e_:()=>Promise.resolve(),n_:qE.bind(null,n),i_:zE.bind(null,n),na:$E.bind(null,n),ra:jE.bind(null,n)}),n.Aa.push(e=>v(null,null,function*(){e?(n.ga.L_(),yield Ms(n)):(yield n.ga.stop(),n.Ia.length>0&&(O(nn,`Stopping write stream with ${n.Ia.length} pending writes`),n.Ia=[]))}))),n.ga}var iu=class n{constructor(e,t,r,i,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new st,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,o){let a=Date.now()+r,u=new n(e,t,a,i,o);return u.start(r),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new V(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function $u(n,e){if(ot("AsyncQueue",`${e}: ${n}`),$n(n))return new V(P.UNAVAILABLE,`${e}: ${n}`);throw n}var vs=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||L.comparator(t.key,r.key):(t,r)=>L.comparator(t.key,r.key),this.keyedMap=Rr(),this.sortedSet=new ie(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Is=class{constructor(){this.pa=new ie(L.comparator)}track(e){let t=e.doc.key,r=this.pa.get(t);r?e.type!==0&&r.type===3?this.pa=this.pa.insert(t,e):e.type===3&&r.type!==1?this.pa=this.pa.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.pa=this.pa.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.pa=this.pa.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.pa=this.pa.remove(t):e.type===1&&r.type===2?this.pa=this.pa.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.pa=this.pa.insert(t,{type:2,doc:e.doc}):M(63341,{Vt:e,ya:r}):this.pa=this.pa.insert(t,e)}wa(){let e=[];return this.pa.inorderTraversal((t,r)=>{e.push(r)}),e}},Ln=class n{constructor(e,t,r,i,o,a,u,h,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,i,o){let a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new n(e,t,vs.emptySet(t),a,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Os(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var su=class{constructor(){this.ba=void 0,this.Sa=[]}Da(){return this.Sa.some(e=>e.va())}},ou=class{constructor(){this.queries=_f(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){let i=B(t),o=i.queries;i.queries=_f(),o.forEach((a,u)=>{for(let h of u.Sa)h.onError(r)})})(this,new V(P.ABORTED,"Firestore shutting down"))}};function _f(){return new ut(n=>up(n),Os)}function GE(n,e){return v(this,null,function*(){let t=B(n),r=3,i=e.query,o=t.queries.get(i);o?!o.Da()&&e.va()&&(r=2):(o=new su,r=e.va()?0:1);try{switch(r){case 0:o.ba=yield t.onListen(i,!0);break;case 1:o.ba=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){let u=$u(a,`Initialization of query '${vn(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,o),o.Sa.push(e),e.Fa(t.onlineState),o.ba&&e.Ma(o.ba)&&ju(t)})}function KE(n,e){return v(this,null,function*(){let t=B(n),r=e.query,i=3,o=t.queries.get(r);if(o){let a=o.Sa.indexOf(e);a>=0&&(o.Sa.splice(a,1),o.Sa.length===0?i=e.va()?0:1:!o.Da()&&e.va()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function HE(n,e){let t=B(n),r=!1;for(let i of e){let o=i.query,a=t.queries.get(o);if(a){for(let u of a.Sa)u.Ma(i)&&(r=!0);a.ba=i}}r&&ju(t)}function QE(n,e,t){let r=B(n),i=r.queries.get(e);if(i)for(let o of i.Sa)o.onError(t);r.queries.delete(e)}function ju(n){n.Ca.forEach(e=>{e.next()})}var au,yf;(yf=au||(au={})).xa="default",yf.Cache="cache";var cu=class{constructor(e,t,r){this.query=e,this.Oa=t,this.Na=!1,this.Ba=null,this.onlineState="Unknown",this.options=r||{}}Ma(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Ln(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Na?this.La(e)&&(this.Oa.next(e),t=!0):this.ka(e,this.onlineState)&&(this.qa(e),t=!0),this.Ba=e,t}onError(e){this.Oa.error(e)}Fa(e){this.onlineState=e;let t=!1;return this.Ba&&!this.Na&&this.ka(this.Ba,e)&&(this.qa(this.Ba),t=!0),t}ka(e,t){if(!e.fromCache||!this.va())return!0;let r=t!=="Offline";return(!this.options.Qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}La(e){if(e.docChanges.length>0)return!0;let t=this.Ba&&this.Ba.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}qa(e){e=Ln.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Na=!0,this.Oa.next(e)}va(){return this.options.source!==au.Cache}};var Es=class{constructor(e){this.key=e}},ws=class{constructor(e){this.key=e}},uu=class{constructor(e,t){this.query=e,this.Ha=t,this.Ja=null,this.hasCachedResults=!1,this.current=!1,this.Ya=G(),this.mutatedKeys=G(),this.Za=lp(e),this.Xa=new vs(this.Za)}get eu(){return this.Ha}tu(e,t){let r=t?t.nu:new Is,i=t?t.Xa:this.Xa,o=t?t.mutatedKeys:this.mutatedKeys,a=i,u=!1,h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((p,y)=>{let E=i.get(p),R=xs(this.query,y)?y:null,k=!!E&&this.mutatedKeys.has(E.key),x=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),D=!1;E&&R?E.data.isEqual(R.data)?k!==x&&(r.track({type:3,doc:R}),D=!0):this.ru(E,R)||(r.track({type:2,doc:R}),D=!0,(h&&this.Za(R,h)>0||d&&this.Za(R,d)<0)&&(u=!0)):!E&&R?(r.track({type:0,doc:R}),D=!0):E&&!R&&(r.track({type:1,doc:E}),D=!0,(h||d)&&(u=!0)),D&&(R?(a=a.add(R),o=x?o.add(p):o.delete(p)):(a=a.delete(p),o=o.delete(p)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{Xa:a,nu:r,Cs:u,mutatedKeys:o}}ru(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let o=this.Xa;this.Xa=e.Xa,this.mutatedKeys=e.mutatedKeys;let a=e.nu.wa();a.sort((p,y)=>function(R,k){let x=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return M(20277,{Vt:D})}};return x(R)-x(k)}(p.type,y.type)||this.Za(p.doc,y.doc)),this.iu(r),i=i!=null&&i;let u=t&&!i?this.su():[],h=this.Ya.size===0&&this.current&&!i?1:0,d=h!==this.Ja;return this.Ja=h,a.length!==0||d?{snapshot:new Ln(this.query,e.Xa,o,a,e.mutatedKeys,h===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),ou:u}:{ou:u}}Fa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Xa:this.Xa,nu:new Is,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{ou:[]}}_u(e){return!this.Ha.has(e)&&!!this.Xa.has(e)&&!this.Xa.get(e).hasLocalMutations}iu(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}su(){if(!this.current)return[];let e=this.Ya;this.Ya=G(),this.Xa.forEach(r=>{this._u(r.key)&&(this.Ya=this.Ya.add(r.key))});let t=[];return e.forEach(r=>{this.Ya.has(r)||t.push(new ws(r))}),this.Ya.forEach(r=>{e.has(r)||t.push(new Es(r))}),t}au(e){this.Ha=e.$s,this.Ya=G();let t=this.tu(e.documents);return this.applyChanges(t,!0)}uu(){return Ln.fromInitialDocuments(this.query,this.Xa,this.mutatedKeys,this.Ja===0,this.hasCachedResults)}},zu="SyncEngine",lu=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},hu=class{constructor(e){this.key=e,this.cu=!1}},du=class{constructor(e,t,r,i,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.lu={},this.hu=new ut(u=>up(u),Os),this.Pu=new Map,this.Tu=new Set,this.Iu=new ie(L.comparator),this.Eu=new Map,this.du=new Br,this.Au={},this.Ru=new Map,this.Vu=Ur.lr(),this.onlineState="Unknown",this.mu=void 0}get isPrimaryClient(){return this.mu===!0}};function YE(n,e,t=!0){return v(this,null,function*(){let r=jp(n),i,o=r.hu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.uu()):i=yield Fp(r,e,t,!0),i})}function JE(n,e){return v(this,null,function*(){let t=jp(n);yield Fp(t,e,!0,!1)})}function Fp(n,e,t,r){return v(this,null,function*(){let i=yield NE(n.localStore,Ge(e)),o=i.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t),u;return r&&(u=yield XE(n,e,o,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&Np(n.remoteStore,i),u})}function XE(n,e,t,r,i){return v(this,null,function*(){n.fu=(y,E,R)=>function(x,D,$,U){return v(this,null,function*(){let j=D.view.tu($);j.Cs&&(j=yield ff(x.localStore,D.query,!1).then(({documents:w})=>D.view.tu(w,j)));let J=U&&U.targetChanges.get(D.targetId),Ie=U&&U.targetMismatches.get(D.targetId)!=null,Y=D.view.applyChanges(j,x.isPrimaryClient,J,Ie);return If(x,D.targetId,Y.ou),Y.snapshot})}(n,y,E,R);let o=yield ff(n.localStore,e,!0),a=new uu(e,o.$s),u=a.tu(o.documents),h=Mr.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),d=a.applyChanges(u,n.isPrimaryClient,h);If(n,t,d.ou);let p=new lu(e,t,a);return n.hu.set(e,p),n.Pu.has(t)?n.Pu.get(t).push(e):n.Pu.set(t,[e]),d.snapshot})}function ZE(n,e,t){return v(this,null,function*(){let r=B(n),i=r.hu.get(e),o=r.Pu.get(i.targetId);if(o.length>1)return r.Pu.set(i.targetId,o.filter(a=>!Os(a,e))),void r.hu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Wc(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Fu(r.remoteStore,i.targetId),fu(r,i.targetId)}).catch(qn))):(fu(r,i.targetId),yield Wc(r.localStore,i.targetId,!0))})}function ew(n,e){return v(this,null,function*(){let t=B(n),r=t.hu.get(e),i=t.Pu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Fu(t.remoteStore,r.targetId))})}function tw(n,e,t){return v(this,null,function*(){let r=cw(n);try{let i=yield function(a,u){let h=B(a),d=de.now(),p=u.reduce((R,k)=>R.add(k.key),G()),y,E;return h.persistence.runTransaction("Locally write mutations","readwrite",R=>{let k=lt(),x=G();return h.Bs.getEntries(R,p).next(D=>{k=D,k.forEach(($,U)=>{U.isValidDocument()||(x=x.add($))})}).next(()=>h.localDocuments.getOverlayedDocuments(R,k)).next(D=>{y=D;let $=[];for(let U of u){let j=iE(U,y.get(U.key).overlayedDocument);j!=null&&$.push(new ht(U.key,j,np(j.value.mapValue),Qt.exists(!0)))}return h.mutationQueue.addMutationBatch(R,d,$,u)}).next(D=>{E=D;let $=D.applyToLocalDocumentSet(y,x);return h.documentOverlayCache.saveOverlays(R,D.batchId,$)})}).then(()=>({batchId:E.batchId,changes:dp(y)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(a,u,h){let d=a.Au[a.currentUser.toKey()];d||(d=new ie(z)),d=d.insert(u,h),a.Au[a.currentUser.toKey()]=d}(r,i.batchId,t),yield Kr(r,i.changes),yield Ms(r.remoteStore)}catch(i){let o=$u(i,"Failed to persist write");t.reject(o)}})}function Up(n,e){return v(this,null,function*(){let t=B(n);try{let r=yield CE(t.localStore,e);e.targetChanges.forEach((i,o)=>{let a=t.Eu.get(o);a&&(Q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.cu=!0:i.modifiedDocuments.size>0?Q(a.cu,14607):i.removedDocuments.size>0&&(Q(a.cu,42227),a.cu=!1))}),yield Kr(t,r,e)}catch(r){yield qn(r)}})}function vf(n,e,t){let r=B(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.hu.forEach((o,a)=>{let u=a.view.Fa(e);u.snapshot&&i.push(u.snapshot)}),function(a,u){let h=B(a);h.onlineState=u;let d=!1;h.queries.forEach((p,y)=>{for(let E of y.Sa)E.Fa(u)&&(d=!0)}),d&&ju(h)}(r.eventManager,e),i.length&&r.lu.Y_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function nw(n,e,t){return v(this,null,function*(){let r=B(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Eu.get(e),o=i&&i.key;if(o){let a=new ie(L.comparator);a=a.insert(o,Me.newNoDocument(o,q.min()));let u=G().add(o),h=new os(q.min(),new Map,new ie(z),a,u);yield Up(r,h),r.Iu=r.Iu.remove(o),r.Eu.delete(e),Wu(r)}else yield Wc(r.localStore,e,!1).then(()=>fu(r,e,t)).catch(qn)})}function rw(n,e){return v(this,null,function*(){let t=B(n),r=e.batch.batchId;try{let i=yield PE(t.localStore,e);qp(t,r,null),Bp(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Kr(t,i)}catch(i){yield qn(i)}})}function iw(n,e,t){return v(this,null,function*(){let r=B(n);try{let i=yield function(a,u){let h=B(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let p;return h.mutationQueue.lookupMutationBatch(d,u).next(y=>(Q(y!==null,37113),p=y.keys(),h.mutationQueue.removeMutationBatch(d,y))).next(()=>h.mutationQueue.performConsistencyCheck(d)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(d,p,u)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p)).next(()=>h.localDocuments.getDocuments(d,p))})}(r.localStore,e);qp(r,e,t),Bp(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Kr(r,i)}catch(i){yield qn(i)}})}function Bp(n,e){(n.Ru.get(e)||[]).forEach(t=>{t.resolve()}),n.Ru.delete(e)}function qp(n,e,t){let r=B(n),i=r.Au[r.currentUser.toKey()];if(i){let o=i.get(e);o&&(t?o.reject(t):o.resolve(),i=i.remove(e)),r.Au[r.currentUser.toKey()]=i}}function fu(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Pu.get(e))n.hu.delete(r),t&&n.lu.gu(r,t);n.Pu.delete(e),n.isPrimaryClient&&n.du.Hr(e).forEach(r=>{n.du.containsKey(r)||$p(n,r)})}function $p(n,e){n.Tu.delete(e.path.canonicalString());let t=n.Iu.get(e);t!==null&&(Fu(n.remoteStore,t),n.Iu=n.Iu.remove(e),n.Eu.delete(t),Wu(n))}function If(n,e,t){for(let r of t)r instanceof Es?(n.du.addReference(r.key,e),sw(n,r)):r instanceof ws?(O(zu,"Document no longer in limbo: "+r.key),n.du.removeReference(r.key,e),n.du.containsKey(r.key)||$p(n,r.key)):M(19791,{pu:r})}function sw(n,e){let t=e.key,r=t.path.canonicalString();n.Iu.get(t)||n.Tu.has(r)||(O(zu,"New document in limbo: "+t),n.Tu.add(r),Wu(n))}function Wu(n){for(;n.Tu.size>0&&n.Iu.size<n.maxConcurrentLimboResolutions;){let e=n.Tu.values().next().value;n.Tu.delete(e);let t=new L(te.fromString(e)),r=n.Vu.next();n.Eu.set(r,new hu(t)),n.Iu=n.Iu.insert(t,r),Np(n.remoteStore,new Fr(Ge(xu(t.path)),r,"TargetPurposeLimboResolution",Su.le))}}function Kr(n,e,t){return v(this,null,function*(){let r=B(n),i=[],o=[],a=[];r.hu.isEmpty()||(r.hu.forEach((u,h)=>{a.push(r.fu(h,e,t).then(d=>{var p;if((d||t)&&r.isPrimaryClient){let y=d?!d.fromCache:(p=t?.targetChanges.get(h.targetId))===null||p===void 0?void 0:p.current;r.sharedClientState.updateQueryState(h.targetId,y?"current":"not-current")}if(d){i.push(d);let y=qc.Rs(h.targetId,d);o.push(y)}}))}),yield Promise.all(a),r.lu.Y_(i),yield function(h,d){return v(this,null,function*(){let p=B(h);try{yield p.persistence.runTransaction("notifyLocalViewChanges","readwrite",y=>C.forEach(d,E=>C.forEach(E.ds,R=>p.persistence.referenceDelegate.addReference(y,E.targetId,R)).next(()=>C.forEach(E.As,R=>p.persistence.referenceDelegate.removeReference(y,E.targetId,R)))))}catch(y){if(!$n(y))throw y;O(Mu,"Failed to update sequence numbers: "+y)}for(let y of d){let E=y.targetId;if(!y.fromCache){let R=p.xs.get(E),k=R.snapshotVersion,x=R.withLastLimboFreeSnapshotVersion(k);p.xs=p.xs.insert(E,x)}}})}(r.localStore,o))})}function ow(n,e){return v(this,null,function*(){let t=B(n);if(!t.currentUser.isEqual(e)){O(zu,"User change. New user:",e.toKey());let r=yield kp(t.localStore,e);t.currentUser=e,function(o,a){o.Ru.forEach(u=>{u.forEach(h=>{h.reject(new V(P.CANCELLED,a))})}),o.Ru.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Kr(t,r.ks)}})}function aw(n,e){let t=B(n),r=t.Eu.get(e);if(r&&r.cu)return G().add(r.key);{let i=G(),o=t.Pu.get(e);if(!o)return i;for(let a of o){let u=t.hu.get(a);i=i.unionWith(u.view.eu)}return i}}function jp(n){let e=B(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Up.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=aw.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=nw.bind(null,e),e.lu.Y_=HE.bind(null,e.eventManager),e.lu.gu=QE.bind(null,e.eventManager),e}function cw(n){let e=B(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=rw.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=iw.bind(null,e),e}var zp=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return v(this,null,function*(){this.serializer=Vs(t.databaseInfo.databaseId),this.sharedClientState=this.bu(t),this.persistence=this.Su(t),yield this.persistence.start(),this.localStore=this.Du(t),this.gcScheduler=this.vu(t,this.localStore),this.indexBackfillerScheduler=this.Cu(t,this.localStore)})}vu(t,r){return null}Cu(t,r){return null}Du(t){return RE(this.persistence,new jc,t.initialUser,this.serializer)}Su(t){return new ds(Bc.fi,this.serializer)}bu(t){return new Gc}terminate(){return v(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),pu=class extends zp{constructor(e){super(),this.cacheSizeBytes=e}vu(e,t){Q(this.persistence.referenceDelegate instanceof fs,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new Rc(r,e.asyncQueue,t)}Su(e){let t=this.cacheSizeBytes!==void 0?De.withCacheSize(this.cacheSizeBytes):De.DEFAULT;return new ds(r=>fs.fi(r,t),this.serializer)}};var uw=(()=>{class n{initialize(t,r){return v(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>vf(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=ow.bind(null,this.syncEngine),yield WE(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new ou}()}createDatastore(t){let r=Vs(t.databaseInfo.databaseId),i=function(a){return new Jc(a)}(t.databaseInfo);return function(a,u,h,d){return new tu(a,u,h,d)}(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return function(i,o,a,u,h){return new ru(i,o,a,u,h)}(this.localStore,this.datastore,t.asyncQueue,r=>vf(this.syncEngine,r,0),function(){return ms.C()?new ms:new Kc}())}createSyncEngine(t,r){return function(o,a,u,h,d,p,y){let E=new du(o,a,u,h,d,p);return y&&(E.mu=!0),E}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return v(this,null,function*(){var t,r;yield function(o){return v(this,null,function*(){let a=B(o);O(nn,"RemoteStore shutting down."),a.da.add(5),yield Gr(a),a.Ra.shutdown(),a.Va.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();var mu=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Mu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Mu(this.observer.error,e):ot("Uncaught Error in snapshot listener:",e.toString()))}xu(){this.muted=!0}Mu(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var Dt="FirestoreClient",gu=class{constructor(e,t,r,i,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=ue.UNAUTHENTICATED,this.clientId=Xi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,a=>v(this,null,function*(){O(Dt,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,a=>(O(Dt,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new st;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>v(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=$u(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Ua(n,e){return v(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),O(Dt,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>v(null,null,function*(){r.isEqual(i)||(yield kp(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Ef(n,e){return v(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield lw(n);O(Dt,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>gf(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>gf(e.remoteStore,i)),n._onlineComponents=e})}function lw(n){return v(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){O(Dt,"Using user provided OfflineComponentProvider");try{yield Ua(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===P.FAILED_PRECONDITION||i.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;bn("Error using user provided cache. Falling back to memory cache: "+t),yield Ua(n,new zp)}}else O(Dt,"Using default OfflineComponentProvider"),yield Ua(n,new pu(void 0));return n._offlineComponents})}function Wp(n){return v(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(O(Dt,"Using user provided OnlineComponentProvider"),yield Ef(n,n._uninitializedComponentsProvider._online)):(O(Dt,"Using default OnlineComponentProvider"),yield Ef(n,new uw))),n._onlineComponents})}function hw(n){return Wp(n).then(e=>e.syncEngine)}function wf(n){return v(this,null,function*(){let e=yield Wp(n),t=e.eventManager;return t.onListen=YE.bind(null,e.syncEngine),t.onUnlisten=ZE.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=JE.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=ew.bind(null,e.syncEngine),t})}function Gp(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var Tf=new Map;function Kp(n,e,t){if(!t)throw new V(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function dw(n,e,t,r){if(e===!0&&r===!0)throw new V(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Af(n){if(!L.isDocumentKey(n))throw new V(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function bf(n){if(L.isDocumentKey(n))throw new V(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Fs(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":M(12329,{type:typeof n})}function Nr(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new V(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Fs(n);throw new V(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}var Hp="firestore.googleapis.com",Sf=!0,Ts=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new V(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Hp,this.ssl=Sf}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:Sf;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Cp;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<AE)throw new V(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}dw("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Gp((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new V(P.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new V(P.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new V(P.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Mn=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ts({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new V(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new V(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ts(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Ba;switch(r.type){case"firstParty":return new za(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new V(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return v(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=Tf.get(t);r&&(O("ComponentProvider","Removing Datastore"),Tf.delete(t),r.terminate())}(this),Promise.resolve()}};function Qp(n,e,t,r={}){var i;n=Nr(n,Mn);let o=yt(e),a=n._getSettings(),u=Object.assign(Object.assign({},a),{emulatorOptions:n._getEmulatorOptions()}),h=`${e}:${t}`;o&&(_i(`https://${h}`),yi("Firestore",!0)),a.host!==Hp&&a.host!==h&&bn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let d=Object.assign(Object.assign({},a),{host:h,ssl:o,emulatorOptions:r});if(!Be(d,u)&&(n._setSettings(d),r.mockUserToken)){let p,y;if(typeof r.mockUserToken=="string")p=r.mockUserToken,y=ue.MOCK_USER;else{p=hh(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let E=r.mockUserToken.sub||r.mockUserToken.user_id;if(!E)throw new V(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");y=new ue(E)}n._authCredentials=new qa(new Yi(p,y))}}var Fn=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Re=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Pt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Pt=class n extends Fn{constructor(e,t,r){super(e,t,xu(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Re(this.firestore,null,new L(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function Yp(n,e,...t){if(n=_e(n),Kp("collection","path",e),n instanceof Mn){let r=te.fromString(e,...t);return bf(r),new Pt(n,null,r)}{if(!(n instanceof Re||n instanceof Pt))throw new V(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(te.fromString(e,...t));return bf(r),new Pt(n.firestore,null,r)}}function Jp(n,e,...t){if(n=_e(n),arguments.length===1&&(e=Xi.newId()),Kp("doc","path",e),n instanceof Mn){let r=te.fromString(e,...t);return Af(r),new Re(n,null,new L(r))}{if(!(n instanceof Re||n instanceof Pt))throw new V(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(te.fromString(e,...t));return Af(r),new Re(n.firestore,n instanceof Pt?n.converter:null,new L(r))}}var Rf="AsyncQueue",As=class{constructor(e=Promise.resolve()){this.Ju=[],this.Yu=!1,this.Zu=[],this.Xu=null,this.ec=!1,this.tc=!1,this.nc=[],this.x_=new gs(this,"async_queue_retry"),this.rc=()=>{let r=Fa();r&&O(Rf,"Visibility state changed to "+r.visibilityState),this.x_.b_()},this.sc=e;let t=Fa();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.rc)}get isShuttingDown(){return this.Yu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.oc(),this._c(e)}enterRestrictedMode(e){if(!this.Yu){this.Yu=!0,this.tc=e||!1;let t=Fa();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.rc)}}enqueue(e){if(this.oc(),this.Yu)return new Promise(()=>{});let t=new st;return this._c(()=>this.Yu&&this.tc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ju.push(e),this.ac()))}ac(){return v(this,null,function*(){if(this.Ju.length!==0){try{yield this.Ju[0](),this.Ju.shift(),this.x_.reset()}catch(e){if(!$n(e))throw e;O(Rf,"Operation failed with retryable error: "+e)}this.Ju.length>0&&this.x_.y_(()=>this.ac())}})}_c(e){let t=this.sc.then(()=>(this.ec=!0,e().catch(r=>{throw this.Xu=r,this.ec=!1,ot("INTERNAL UNHANDLED ERROR: ",Pf(r)),r}).then(r=>(this.ec=!1,r))));return this.sc=t,t}enqueueAfterDelay(e,t,r){this.oc(),this.nc.indexOf(e)>-1&&(t=0);let i=iu.createAndSchedule(this,e,t,r,o=>this.uc(o));return this.Zu.push(i),i}oc(){this.Xu&&M(47125,{cc:Pf(this.Xu)})}verifyOperationInProgress(){}lc(){return v(this,null,function*(){let e;do e=this.sc,yield e;while(e!==this.sc)})}hc(e){for(let t of this.Zu)if(t.timerId===e)return!0;return!1}Pc(e){return this.lc().then(()=>{this.Zu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.Zu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.lc()})}Tc(e){this.nc.push(e)}uc(e){let t=this.Zu.indexOf(e);this.Zu.splice(t,1)}};function Pf(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function Cf(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let o of r)if(o in i&&typeof i[o]=="function")return!0;return!1}(n,["next","error","complete"])}var Un=class extends Mn{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new As,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return v(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new As(e),this._firestoreClient=void 0,yield e}})}};function Xp(n,e){let t=typeof n=="object"?n:Ut(),r=typeof n=="string"?n:e||ns,i=dn(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let o=lh("firestore");o&&Qp(i,...o)}return i}function Zp(n){if(n._terminated)throw new V(P.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||fw(n),n._firestoreClient}function fw(n){var e,t,r;let i=n._freezeSettings(),o=function(u,h,d,p){return new Qa(u,h,d,p.host,p.ssl,p.experimentalForceLongPolling,p.experimentalAutoDetectLongPolling,Gp(p.experimentalLongPollingOptions),p.useFetchStreams,p.isUsingEmulator)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new gu(n._authCredentials,n._appCheckCredentials,n._queue,o,n._componentsProvider&&function(u){let h=u?._online.build();return{_offline:u?._offline.build(h),_online:h}}(n._componentsProvider))}var qr=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(ve.fromBase64String(e))}catch(t){throw new V(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(ve.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var $r=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new V(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Se(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var bs=class{constructor(e){this._methodName=e}};var jr=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new V(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new V(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return z(this._lat,e._lat)||z(this._long,e._long)}};var zr=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0}(this._values,e._values)}};var pw=/^__.*__$/,_u=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new ht(e,this.data,this.fieldMask,t,this.fieldTransforms):new tn(e,this.data,t,this.fieldTransforms)}};function em(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw M(40011,{Ic:n})}}var yu=class n{constructor(e,t,r,i,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Ec(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ic(){return this.settings.Ic}dc(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ac(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.dc({path:r,Rc:!1});return i.Vc(e),i}mc(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.dc({path:r,Rc:!1});return i.Ec(),i}fc(e){return this.dc({path:void 0,Rc:!0})}gc(e){return Ss(e,this.settings.methodName,this.settings.yc||!1,this.path,this.settings.wc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ec(){if(this.path)for(let e=0;e<this.path.length;e++)this.Vc(this.path.get(e))}Vc(e){if(e.length===0)throw this.gc("Document fields must not be empty");if(em(this.Ic)&&pw.test(e))throw this.gc('Document fields cannot begin and end with "__"')}},vu=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Vs(e)}bc(e,t,r,i=!1){return new yu({Ic:e,methodName:t,wc:r,path:Se.emptyPath(),Rc:!1,yc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function tm(n){let e=n._freezeSettings(),t=Vs(n._databaseId);return new vu(n._databaseId,!!e.ignoreUndefinedProperties,t)}function mw(n,e,t,r,i,o={}){let a=n.bc(o.merge||o.mergeFields?2:0,e,t,i);im("Data must be an object, but it was:",a,r);let u=nm(r,a),h,d;if(o.merge)h=new ze(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){let p=[];for(let y of o.mergeFields){let E=_w(e,y,t);if(!a.contains(E))throw new V(P.INVALID_ARGUMENT,`Field '${E}' is specified in your field mask but missing from your input data.`);vw(p,E)||p.push(E)}h=new ze(p),d=a.fieldTransforms.filter(y=>h.covers(y.field))}else h=null,d=a.fieldTransforms;return new _u(new Le(u),h,d)}function gw(n,e,t,r=!1){return Gu(t,n.bc(r?4:3,e))}function Gu(n,e){if(rm(n=_e(n)))return im("Unsupported field value:",e,n),nm(n,e);if(n instanceof bs)return function(r,i){if(!em(i.Ic))throw i.gc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.gc(`${r._methodName}() is not currently supported inside arrays`);let o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Rc&&e.Ic!==4)throw e.gc("Nested arrays are not supported");return function(r,i){let o=[],a=0;for(let u of r){let h=Gu(u,i.fc(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}}(n,e)}return function(r,i){if((r=_e(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return ZI(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let o=de.fromDate(r);return{timestampValue:ls(i.serializer,o)}}if(r instanceof de){let o=new de(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:ls(i.serializer,o)}}if(r instanceof jr)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof qr)return{bytesValue:wp(i.serializer,r._byteString)};if(r instanceof Re){let o=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw i.gc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Lu(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof zr)return function(a,u){return{mapValue:{fields:{[Cu]:{stringValue:ku},[Rn]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw u.gc("VectorValues must only contain numeric values.");return Vu(u.serializer,d)})}}}}}}(r,i);throw i.gc(`Unsupported field value: ${Fs(r)}`)}(n,e)}function nm(n,e){let t={};return Hf(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):rn(n,(r,i)=>{let o=Gu(i,e.Ac(r));o!=null&&(t[r]=o)}),{mapValue:{fields:t}}}function rm(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof de||n instanceof jr||n instanceof qr||n instanceof Re||n instanceof bs||n instanceof zr)}function im(n,e,t){if(!rm(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=Fs(t);throw r==="an object"?e.gc(n+" a custom object"):e.gc(n+" "+r)}}function _w(n,e,t){if((e=_e(e))instanceof $r)return e._internalPath;if(typeof e=="string")return sm(n,e);throw Ss("Field path arguments must be of type string or ",n,!1,void 0,t)}var yw=new RegExp("[~\\*/\\[\\]]");function sm(n,e,t){if(e.search(yw)>=0)throw Ss(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new $r(...e.split("."))._internalPath}catch{throw Ss(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Ss(n,e,t,r,i){let o=r&&!r.isEmpty(),a=i!==void 0,u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${i}`),h+=")"),new V(P.INVALID_ARGUMENT,u+n+h)}function vw(n,e){return n.some(t=>t.isEqual(e))}var Rs=class{constructor(e,t,r,i,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Re(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Iu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Ku("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Iu=class extends Rs{data(){return super.data()}};function Ku(n,e){return typeof e=="string"?sm(n,e):e instanceof $r?e._internalPath:e._delegate._internalPath}function Iw(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new V(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Wr=class{},Eu=class extends Wr{};function om(n,e,...t){let r=[];e instanceof Wr&&r.push(e),r=r.concat(t),function(o){let a=o.filter(h=>h instanceof wu).length,u=o.filter(h=>h instanceof Ps).length;if(a>1||a>0&&u>0)throw new V(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var Ps=class n extends Eu{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return cm(e._query,t),new Fn(e.firestore,e.converter,cc(e._query,t))}_parse(e){let t=tm(e.firestore);return function(o,a,u,h,d,p,y){let E;if(d.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new V(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){Df(y,p);let k=[];for(let x of y)k.push(kf(h,o,x));E={arrayValue:{values:k}}}else E=kf(h,o,y)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||Df(y,p),E=gw(u,a,y,p==="in"||p==="not-in");return ae.create(d,p,E)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function am(n,e,t){let r=e,i=Ku("where",n);return Ps._create(i,r,t)}var wu=class n extends Wr{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Fe.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,o){let a=i,u=o.getFlattenedFilters();for(let h of u)cm(a,h),a=cc(a,h)}(e._query,t),new Fn(e.firestore,e.converter,cc(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};function kf(n,e,t){if(typeof(t=_e(t))=="string"){if(t==="")throw new V(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!cp(e)&&t.indexOf("/")!==-1)throw new V(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(te.fromString(t));if(!L.isDocumentKey(r))throw new V(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Kd(n,new L(r))}if(t instanceof Re)return Kd(n,t._key);throw new V(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Fs(t)}.`)}function Df(n,e){if(!Array.isArray(n)||n.length===0)throw new V(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function cm(n,e){let t=function(i,o){for(let a of i)for(let u of a.getFlattenedFilters())if(o.indexOf(u.op)>=0)return u.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new V(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new V(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Tu=class{convertValue(e,t="none"){switch(Ct(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ee(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ct(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw M(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return rn(e,(i,o)=>{r[i]=this.convertValue(o,t)}),r}convertVectorValue(e){var t,r,i;let o=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[Rn].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(a=>ee(a.doubleValue));return new zr(o)}convertGeoPoint(e){return new jr(ee(e.latitude),ee(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Ns(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Vr(e));default:return null}}convertTimestamp(e){let t=at(e);return new de(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=te.fromString(e);Q(Pp(r),9688,{name:e});let i=new rs(r.get(1),r.get(3)),o=new L(r.popFirst(5));return i.isEqual(t)||ot(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}};function Ew(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var Ht=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Cs=class extends Rs{constructor(e,t,r,i,o,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new An(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(Ku("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},An=class extends Cs{data(e={}){return super.data(e)}},Au=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Ht(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new An(this._firestore,this._userDataWriter,r.key,r,new Ht(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new V(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,o){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let h=new An(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Ht(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>o||u.type!==3).map(u=>{let h=new An(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Ht(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,p=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),p=a.indexOf(u.doc.key)),{type:ww(u.type),doc:h,oldIndex:d,newIndex:p}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function ww(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return M(61501,{type:n})}}var ks=class extends Tu{constructor(e){super(),this.firestore=e}convertBytes(e){return new qr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Re(this.firestore,null,t)}};function um(n,e){let t=Nr(n.firestore,Un),r=Jp(n),i=Ew(n.converter,e);return Tw(t,[mw(tm(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Qt.exists(!1))]).then(()=>r)}function Hu(n,...e){var t,r,i;n=_e(n);let o={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||Cf(e[a])||(o=e[a],a++);let u={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(Cf(e[a])){let y=e[a];e[a]=(t=y.next)===null||t===void 0?void 0:t.bind(y),e[a+1]=(r=y.error)===null||r===void 0?void 0:r.bind(y),e[a+2]=(i=y.complete)===null||i===void 0?void 0:i.bind(y)}let h,d,p;if(n instanceof Re)d=Nr(n.firestore,Un),p=xu(n._key.path),h={next:y=>{e[a]&&e[a](Aw(d,n,y))},error:e[a+1],complete:e[a+2]};else{let y=Nr(n,Fn);d=Nr(y.firestore,Un),p=y._query;let E=new ks(d);h={next:R=>{e[a]&&e[a](new Au(d,E,y,R))},error:e[a+1],complete:e[a+2]},Iw(n._query)}return function(E,R,k,x){let D=new mu(x),$=new cu(R,D,k);return E.asyncQueue.enqueueAndForget(()=>v(null,null,function*(){return GE(yield wf(E),$)})),()=>{D.xu(),E.asyncQueue.enqueueAndForget(()=>v(null,null,function*(){return KE(yield wf(E),$)}))}}(Zp(d),p,u,h)}function Tw(n,e){return function(r,i){let o=new st;return r.asyncQueue.enqueueAndForget(()=>v(null,null,function*(){return tw(yield hw(r),i,o)})),o.promise}(Zp(n),e)}function Aw(n,e,t){let r=t.docs.get(e._key),i=new ks(n);return new Cs(n,i,e._key,r,new Ht(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(i){Bn=i})(It),xe(new Te("firestore",(r,{instanceIdentifier:i,options:o})=>{let a=r.getProvider("app").getImmediate(),u=new Un(new $a(r.getProvider("auth-internal")),new Wa(a,r.getProvider("app-check-internal")),function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new V(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rs(d.options.projectId,p)}(a,i),a);return o=Object.assign({useFetchStreams:t},o),u._setSettings(o),u},"PUBLIC").setMultipleInstances(!0)),re(Md,Fd,e),re(Md,Fd,"esm2017")})();var Us=function(){return Us=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},Us.apply(this,arguments)};var Rw={includeMetadataChanges:!1};function lm(n,e){return e===void 0&&(e=Rw),new Lt(function(t){var r=Hu(n,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:r}})}function hm(n,e){var t;e===void 0&&(e={});var r=n.data(e);return!n.exists()||typeof r!="object"||r===null||!e.idField?r:Us(Us({},r),(t={},t[e.idField]=n.id,t))}function dm(n){return lm(n,{includeMetadataChanges:!0}).pipe(_o(function(e){return e.docs}))}function fm(n,e){return e===void 0&&(e={}),dm(n).pipe(_o(function(t){return t.map(function(r){return hm(r,e)})}))}var Hr=class{constructor(e){return e}},pm="firestore",Qu=class{constructor(){return pn(pm)}};var Yu=new ln("angularfire2.firestore-instances");function Pw(n,e){let t=mr(pm,n,e);return t&&new Hr(t)}function Cw(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Hr(r)}}var kw={provide:Qu,deps:[[new Pe,Yu]]},Dw={provide:Hr,useFactory:Pw,deps:[[new Pe,Yu],et]};function eS(n,...e){return re("angularfire",Et.full,"fst"),hn([Dw,kw,{provide:Yu,useFactory:Cw(n),multi:!0,deps:[Ue,_t,wt,qt,[new Pe,br],[new Pe,mn],...e]}])}var tS=ke(fm,!0);var nS=ke(um,!0,2);var rS=ke(Yp,!0,2);var iS=ke(Xp,!0);var sS=ke(om,!0,2);var oS=ke(am,!0,2);export{FT as a,UT as b,cb as c,ub as d,Hr as e,eS as f,tS as g,nS as h,rS as i,iS as j,sS as k,oS as l};
