import{$ as ln,Ib as eh,Jb as th,Mb as mo,T as Yl,W as un,Z as Xe,_ as Re,a as uo,b as lo,ba as Jl,c as gt,ca as hi,d as y,da as Xl,g as Lt,l as Hl,la as _t,m as Ql,o as ho,oa as di,p as fo,q as po,qa as Fe,w as li,ya as Zl}from"./chunk-SJU3657H.js";var nh=()=>{};var sh=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Fm=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let o=n[t++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){let o=n[t++],a=n[t++],u=n[t++],h=((i&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{let o=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|a&63)}}return e.join("")},fi={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let o=n[i],a=i+1<n.length,u=a?n[i+1]:0,h=i+2<n.length,d=h?n[i+2]:0,p=o>>2,v=(o&3)<<4|u>>4,E=(u&15)<<2|d>>6,R=d&63;h||(R=64,a||(E=64)),r.push(t[p],t[v],t[E],t[R])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(sh(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Fm(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let o=t[n.charAt(i++)],u=i<n.length?t[n.charAt(i)]:0;++i;let d=i<n.length?t[n.charAt(i)]:64;++i;let v=i<n.length?t[n.charAt(i)]:64;if(++i,o==null||u==null||d==null||v==null)throw new _o;let E=o<<2|u>>4;if(r.push(E),d!==64){let R=u<<4&240|d>>2;if(r.push(R),v!==64){let N=d<<6&192|v;r.push(N)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},_o=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Um=function(n){let e=sh(n);return fi.encodeByteArray(e,!0)},ur=function(n){return Um(n).replace(/\./g,"")},pi=function(n){try{return fi.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function vo(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Bm=()=>vo().__FIREBASE_DEFAULTS__,qm=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},$m=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&pi(n[1]);return e&&JSON.parse(e)},mi=()=>{try{return nh()||Bm()||qm()||$m()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Io=n=>{var e,t;return(t=(e=mi())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},oh=n=>{let e=Io(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Eo=()=>{var n;return(n=mi())===null||n===void 0?void 0:n.config},wo=n=>{var e;return(e=mi())===null||e===void 0?void 0:e[`_${n}`]};var Mt=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function yt(n){return n.endsWith(".cloudworkstations.dev")}function gi(n){return y(this,null,function*(){return(yield fetch(n,{credentials:"include"})).ok})}function ah(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[ur(JSON.stringify(t)),ur(JSON.stringify(a)),""].join(".")}var cr={};function jm(){let n={prod:[],emulator:[]};for(let e of Object.keys(cr))cr[e]?n.emulator.push(e):n.prod.push(e);return n}function zm(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}var rh=!1;function _i(n,e){if(typeof window>"u"||typeof document>"u"||!yt(window.location.host)||cr[n]===e||cr[n]||rh)return;cr[n]=e;function t(E){return`__firebase__banner__${E}`}let r="__firebase__banner",o=jm().prod.length>0;function a(){let E=document.getElementById(r);E&&E.remove()}function u(E){E.style.display="flex",E.style.background="#7faaf0",E.style.position="fixed",E.style.bottom="5px",E.style.left="5px",E.style.padding=".5em",E.style.borderRadius="5px",E.style.alignItems="center"}function h(E,R){E.setAttribute("width","24"),E.setAttribute("id",R),E.setAttribute("height","24"),E.setAttribute("viewBox","0 0 24 24"),E.setAttribute("fill","none"),E.style.marginLeft="-6px"}function d(){let E=document.createElement("span");return E.style.cursor="pointer",E.style.marginLeft="16px",E.style.fontSize="24px",E.innerHTML=" &times;",E.onclick=()=>{rh=!0,a()},E}function p(E,R){E.setAttribute("id",R),E.innerText="Learn more",E.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",E.setAttribute("target","__blank"),E.style.paddingLeft="5px",E.style.textDecoration="underline"}function v(){let E=zm(r),R=t("text"),N=document.getElementById(R)||document.createElement("span"),x=t("learnmore"),k=document.getElementById(x)||document.createElement("a"),$=t("preprendIcon"),U=document.getElementById($)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(E.created){let j=E.element;u(j),p(k,x);let J=d();h(U,$),j.append(U,N,k,J),document.body.appendChild(j)}o?(N.innerText="Preview backend disconnected.",U.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(U.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,N.innerText="Preview backend running in this workspace."),N.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",v):v()}function ce(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function ch(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ce())}function Wm(){var n;let e=(n=mi())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function uh(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function lh(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function hh(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function dh(){let n=ce();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function fh(){return!Wm()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function lr(){try{return typeof indexedDB=="object"}catch{return!1}}function ph(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var o;e(((o=i.error)===null||o===void 0?void 0:o.message)||"")}}catch(t){e(t)}})}var Gm="FirebaseError",be=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Gm,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Oe.prototype.create)}},Oe=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,o=this.errors[e],a=o?Km(o,r):"Error",u=`${this.serviceName}: ${a} (${i}).`;return new be(i,u,r)}};function Km(n,e){return n.replace(Hm,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var Hm=/\{\$([^}]+)}/g;function mh(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ue(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let o=n[i],a=e[i];if(ih(o)&&ih(a)){if(!Ue(o,a))return!1}else if(o!==a)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function ih(n){return n!==null&&typeof n=="object"}function hr(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function gh(n,e){let t=new yo(n,e);return t.subscribe.bind(t)}var yo=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Qm(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=go),i.error===void 0&&(i.error=go),i.complete===void 0&&(i.complete=go);let o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function Qm(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function go(){}var Aw=4*60*60*1e3;function we(n){return n&&n._delegate?n._delegate:n}var Te=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var Ft="[DEFAULT]";var To=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new Mt;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(o){if(i)return null;throw o}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Jm(e))try{this.getOrInitializeService({instanceIdentifier:Ft})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=Ft){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return y(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=Ft){return this.instances.has(e)}getOptions(e=Ft){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[o,a]of this.instancesDeferred.entries()){let u=this.normalizeInstanceIdentifier(o);r===u&&a.resolve(i)}return i}onInit(e,t){var r;let i=this.normalizeInstanceIdentifier(t),o=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;o.add(e),this.onInitCallbacks.set(i,o);let a=this.instances.get(i);return a&&e(a,i),()=>{o.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Ym(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Ft){return this.component?this.component.multipleInstances?e:Ft:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Ym(n){return n===Ft?void 0:n}function Jm(n){return n.instantiationMode==="EAGER"}var yi=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new To(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var Xm=[],W=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(W||{}),Zm={debug:W.DEBUG,verbose:W.VERBOSE,info:W.INFO,warn:W.WARN,error:W.ERROR,silent:W.SILENT},eg=W.INFO,tg={[W.DEBUG]:"log",[W.VERBOSE]:"log",[W.INFO]:"info",[W.WARN]:"warn",[W.ERROR]:"error"},ng=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=tg[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},Be=class{constructor(e){this.name=e,this._logLevel=eg,this._logHandler=ng,this._userLogHandler=null,Xm.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in W))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Zm[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,W.DEBUG,...e),this._logHandler(this,W.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,W.VERBOSE,...e),this._logHandler(this,W.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,W.INFO,...e),this._logHandler(this,W.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,W.WARN,...e),this._logHandler(this,W.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,W.ERROR,...e),this._logHandler(this,W.ERROR,...e)}};var rg=(n,e)=>e.some(t=>n instanceof t),_h,yh;function ig(){return _h||(_h=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function sg(){return yh||(yh=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var vh=new WeakMap,bo=new WeakMap,Ih=new WeakMap,Ao=new WeakMap,Ro=new WeakMap;function og(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(qe(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&vh.set(t,n)}).catch(()=>{}),Ro.set(e,n),e}function ag(n){if(bo.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});bo.set(n,e)}var So={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return bo.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Ih.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return qe(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Eh(n){So=n(So)}function cg(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(vi(this),e,...t);return Ih.set(r,e.sort?e.sort():[e]),qe(r)}:sg().includes(n)?function(...e){return n.apply(vi(this),e),qe(vh.get(this))}:function(...e){return qe(n.apply(vi(this),e))}}function ug(n){return typeof n=="function"?cg(n):(n instanceof IDBTransaction&&ag(n),rg(n,ig())?new Proxy(n,So):n)}function qe(n){if(n instanceof IDBRequest)return og(n);if(Ao.has(n))return Ao.get(n);let e=ug(n);return e!==n&&(Ao.set(n,e),Ro.set(e,n)),e}var vi=n=>Ro.get(n);function Th(n,e,{blocked:t,upgrade:r,blocking:i,terminated:o}={}){let a=indexedDB.open(n,e),u=qe(a);return r&&a.addEventListener("upgradeneeded",h=>{r(qe(a.result),h.oldVersion,h.newVersion,qe(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}var lg=["get","getKey","getAll","getAllKeys","count"],hg=["put","add","delete","clear"],Po=new Map;function wh(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Po.get(e))return Po.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=hg.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||lg.includes(t)))return;let o=function(a,...u){return y(this,null,function*(){let h=this.transaction(a,i?"readwrite":"readonly"),d=h.store;return r&&(d=d.index(u.shift())),(yield Promise.all([d[t](...u),i&&h.done]))[0]})};return Po.set(e,o),o}Eh(n=>lo(uo({},n),{get:(e,t,r)=>wh(e,t)||n.get(e,t,r),has:(e,t)=>!!wh(e,t)||n.has(e,t)}));var ko=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(dg(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function dg(n){let e=n.getComponent();return e?.type==="VERSION"}var Do="@firebase/app",Ah="0.13.1";var Ze=new Be("@firebase/app"),fg="@firebase/app-compat",pg="@firebase/analytics-compat",mg="@firebase/analytics",gg="@firebase/app-check-compat",_g="@firebase/app-check",yg="@firebase/auth",vg="@firebase/auth-compat",Ig="@firebase/database",Eg="@firebase/data-connect",wg="@firebase/database-compat",Tg="@firebase/functions",Ag="@firebase/functions-compat",bg="@firebase/installations",Sg="@firebase/installations-compat",Rg="@firebase/messaging",Pg="@firebase/messaging-compat",Cg="@firebase/performance",kg="@firebase/performance-compat",Dg="@firebase/remote-config",Ng="@firebase/remote-config-compat",Og="@firebase/storage",xg="@firebase/storage-compat",Vg="@firebase/firestore",Lg="@firebase/ai",Mg="@firebase/firestore-compat",Fg="firebase",Ug="11.9.0";var No="[DEFAULT]",Bg={[Do]:"fire-core",[fg]:"fire-core-compat",[mg]:"fire-analytics",[pg]:"fire-analytics-compat",[_g]:"fire-app-check",[gg]:"fire-app-check-compat",[yg]:"fire-auth",[vg]:"fire-auth-compat",[Ig]:"fire-rtdb",[Eg]:"fire-data-connect",[wg]:"fire-rtdb-compat",[Tg]:"fire-fn",[Ag]:"fire-fn-compat",[bg]:"fire-iid",[Sg]:"fire-iid-compat",[Rg]:"fire-fcm",[Pg]:"fire-fcm-compat",[Cg]:"fire-perf",[kg]:"fire-perf-compat",[Dg]:"fire-rc",[Ng]:"fire-rc-compat",[Og]:"fire-gcs",[xg]:"fire-gcs-compat",[Vg]:"fire-fst",[Mg]:"fire-fst-compat",[Lg]:"fire-vertex","fire-js":"fire-js",[Fg]:"fire-js-all"};var dr=new Map,qg=new Map,Oo=new Map;function bh(n,e){try{n.container.addComponent(e)}catch(t){Ze.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function xe(n){let e=n.name;if(Oo.has(e))return Ze.debug(`There were multiple attempts to register component ${e}.`),!1;Oo.set(e,n);for(let t of dr.values())bh(t,n);for(let t of qg.values())bh(t,n);return!0}function hn(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Pe(n){return n==null?!1:n.settings!==void 0}var $g={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},vt=new Oe("app","Firebase",$g);var xo=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Te("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw vt.create("app-deleted",{appName:this._name})}};var It=Ug;function Mo(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=Object.assign({name:No,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw vt.create("bad-app-name",{appName:String(i)});if(t||(t=Eo()),!t)throw vt.create("no-options");let o=dr.get(i);if(o){if(Ue(t,o.options)&&Ue(r,o.config))return o;throw vt.create("duplicate-app",{appName:i})}let a=new yi(i);for(let h of Oo.values())a.addComponent(h);let u=new xo(t,r,a);return dr.set(i,u),u}function Ut(n=No){let e=dr.get(n);if(!e&&n===No&&Eo())return Mo();if(!e)throw vt.create("no-app",{appName:n});return e}function Ii(){return Array.from(dr.values())}function ne(n,e,t){var r;let i=(r=Bg[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);let o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){let u=[`Unable to register library "${i}" with version "${e}":`];o&&u.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&a&&u.push("and"),a&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ze.warn(u.join(" "));return}xe(new Te(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}var jg="firebase-heartbeat-database",zg=1,fr="firebase-heartbeat-store",Co=null;function Ch(){return Co||(Co=Th(jg,zg,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(fr)}catch(t){console.warn(t)}}}}).catch(n=>{throw vt.create("idb-open",{originalErrorMessage:n.message})})),Co}function Wg(n){return y(this,null,function*(){try{let t=(yield Ch()).transaction(fr),r=yield t.objectStore(fr).get(kh(n));return yield t.done,r}catch(e){if(e instanceof be)Ze.warn(e.message);else{let t=vt.create("idb-get",{originalErrorMessage:e?.message});Ze.warn(t.message)}}})}function Sh(n,e){return y(this,null,function*(){try{let r=(yield Ch()).transaction(fr,"readwrite");yield r.objectStore(fr).put(e,kh(n)),yield r.done}catch(t){if(t instanceof be)Ze.warn(t.message);else{let r=vt.create("idb-set",{originalErrorMessage:t?.message});Ze.warn(r.message)}}})}function kh(n){return`${n.name}!${n.options.appId}`}var Gg=1024,Kg=30,Vo=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Lo(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return y(this,null,function*(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=Rh();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(a=>a.date===o))return;if(this._heartbeatsCache.heartbeats.push({date:o,agent:i}),this._heartbeatsCache.heartbeats.length>Kg){let a=Qg(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Ze.warn(r)}})}getHeartbeatsHeader(){return y(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=Rh(),{heartbeatsToSend:r,unsentEntries:i}=Hg(this._heartbeatsCache.heartbeats),o=ur(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(t){return Ze.warn(t),""}})}};function Rh(){return new Date().toISOString().substring(0,10)}function Hg(n,e=Gg){let t=[],r=n.slice();for(let i of n){let o=t.find(a=>a.agent===i.agent);if(o){if(o.dates.push(i.date),Ph(t)>e){o.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Ph(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var Lo=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return y(this,null,function*(){return lr()?ph().then(()=>!0).catch(()=>!1):!1})}read(){return y(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield Wg(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return y(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Sh(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return y(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Sh(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};function Ph(n){return ur(JSON.stringify({version:2,heartbeats:n})).length}function Qg(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function Yg(n){xe(new Te("platform-logger",e=>new ko(e),"PRIVATE")),xe(new Te("heartbeat",e=>new Vo(e),"PRIVATE")),ne(Do,Ah,n),ne(Do,Ah,"esm2017"),ne("fire-js","")}Yg("");var Jg="firebase",Xg="11.9.1";ne(Jg,Xg,"app");function Fo(n){n===void 0&&(Xl(Fo),n=Xe(_t));let e=n.get(di);return t=>new Lt(r=>{let i=e.add(),o=!1;function a(){o||(i(),o=!0)}let u=t.subscribe({next:h=>{r.next(h),a()},complete:()=>{r.complete(),a()},error:h=>{r.error(h),a()}});return u.add(()=>{r.unsubscribe(),a()}),u})}var Et=new eh("ANGULARFIRE2_VERSION");function pr(n,e,t){if(e){if(e.length===1)return e[0];let o=e.filter(a=>a.app===t);if(o.length===1)return o[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var fn=(n,e)=>{let t=e?[e]:Ii(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(a=>{r.includes(a)||r.push(a)})}),r},dn=function(n){return n[n.SILENT=0]="SILENT",n[n.WARN=1]="WARN",n[n.VERBOSE=2]="VERBOSE",n}(dn||{}),Dh=mo()&&typeof Zone<"u"?dn.WARN:dn.SILENT;var Ei=class{zone;delegate;constructor(e,t=Ql){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,o=function(a){i?i.runGuarded(()=>{e.apply(this,[a])}):e.apply(this,[a])};return this.delegate.schedule(o,t,r)}},wt=(()=>{class n{outsideAngular;insideAngular;constructor(){let t=Xe(Fe);this.outsideAngular=t.runOutsideAngular(()=>new Ei(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=t.run(()=>new Ei(typeof Zone>"u"?void 0:Zone.current,Hl))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Yl({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Nh=!1;function Zg(n,e){!Nh&&(Dh>dn.SILENT||mo())&&(Nh=!0,console.warn("Calling Firebase APIs outside of an Injection context may destabilize your application leading to subtle change-detection and hydration bugs. Find more at https://github.com/angular/angularfire/blob/main/docs/zones.md")),Dh>=e&&console.warn(`Firebase API called outside injection context: ${n.name}`)}function e_(n){let e=Xe(Fe,{optional:!0});return e?e.runOutsideAngular(()=>n()):n()}function Bt(n){let e=Xe(Fe,{optional:!0});return e?e.run(()=>n()):n()}var t_=(n,e,t)=>(...r)=>(e&&setTimeout(e,0),hi(t,()=>Bt(()=>n.apply(void 0,r)))),Ce=(n,e,t)=>(t||=e?dn.WARN:dn.VERBOSE,function(){let r,i=arguments,o,a,u;try{o=Xe(wt),a=Xe(di),u=Xe(Jl)}catch{return Zg(n,t),n.apply(this,i)}for(let d=0;d<arguments.length;d++)typeof i[d]=="function"&&(e&&(r||=Bt(()=>a.add())),i[d]=t_(i[d],r,u));let h=e_(()=>n.apply(this,i));return e?h instanceof Lt?h.pipe(po(o.outsideAngular),fo(o.insideAngular),Fo(u)):h instanceof Promise?Bt(()=>new Promise((d,p)=>{a.run(()=>h).then(v=>hi(u,()=>Bt(()=>d(v))),v=>hi(u,()=>Bt(()=>p(v))))})):typeof h=="function"&&r?function(){return setTimeout(r,0),h.apply(this,arguments)}:Bt(()=>h):h instanceof Lt?h.pipe(po(o.outsideAngular),fo(o.insideAngular)):Bt(()=>h)});var et=class{constructor(e){return e}},qt=class{constructor(){return Ii()}};function n_(n){return n&&n.length===1?n[0]:new et(Ut())}var Uo=new un("angularfire2._apps"),r_={provide:et,useFactory:n_,deps:[[new Re,Uo]]},i_={provide:qt,deps:[[new Re,Uo]]};function s_(n){return(e,t)=>{let r=t.get(Zl);ne("angularfire",Et.full,"core"),ne("angularfire",Et.full,"app"),ne("angular",th.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new et(i)}}function PT(n,...e){return ln([r_,i_,{provide:Uo,useFactory:s_(n),multi:!0,deps:[Fe,_t,wt,...e]}])}var CT=Ce(Mo,!0);var o_=new Map,a_={activated:!1,tokenObservers:[]},c_={initialized:!1,enabled:!1};function Ve(n){return o_.get(n)||Object.assign({},a_)}function Lh(){return c_}var u_="https://content-firebaseappcheck.googleapis.com/v1";var l_="exchangeDebugToken",Oh={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},FT=24*60*60*1e3;var $o=class{constructor(e,t,r,i,o){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=o,this.pending=null,this.nextErrorWaitInterval=i,i>o)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return y(this,null,function*(){this.stop();try{this.pending=new Mt,this.pending.promise.catch(t=>{}),yield h_(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Mt,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function h_(n){return new Promise(e=>{setTimeout(e,n)})}var d_={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},Tt=new Oe("appCheck","AppCheck",d_);function Mh(n){if(!Ve(n).activated)throw Tt.create("use-before-activation",{appName:n.name})}function Fh(r,i){return y(this,arguments,function*({url:n,body:e},t){let o={"Content-Type":"application/json"},a=t.getImmediate({optional:!0});if(a){let R=yield a.getHeartbeatsHeader();R&&(o["X-Firebase-Client"]=R)}let u={method:"POST",body:JSON.stringify(e),headers:o},h;try{h=yield fetch(n,u)}catch(R){throw Tt.create("fetch-network-error",{originalErrorMessage:R?.message})}if(h.status!==200)throw Tt.create("fetch-status-error",{httpStatus:h.status});let d;try{d=yield h.json()}catch(R){throw Tt.create("fetch-parse-error",{originalErrorMessage:R?.message})}let p=d.ttl.match(/^([\d.]+)(s)$/);if(!p||!p[2]||isNaN(Number(p[1])))throw Tt.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${d.ttl}`});let v=Number(p[1])*1e3,E=Date.now();return{token:d.token,expireTimeMillis:E+v,issuedAtTimeMillis:E}})}function Uh(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${u_}/projects/${t}/apps/${r}:${l_}?key=${i}`,body:{debug_token:e}}}var f_="firebase-app-check-database",p_=1,jo="firebase-app-check-store";var wi=null;function m_(){return wi||(wi=new Promise((n,e)=>{try{let t=indexedDB.open(f_,p_);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Tt.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(jo,{keyPath:"compositeKey"})}}}catch(t){e(Tt.create("storage-open",{originalErrorMessage:t?.message}))}}),wi)}function g_(n,e){return __(y_(n),e)}function __(n,e){return y(this,null,function*(){let r=(yield m_()).transaction(jo,"readwrite"),o=r.objectStore(jo).put({compositeKey:n,value:e});return new Promise((a,u)=>{o.onsuccess=h=>{a()},r.onerror=h=>{var d;u(Tt.create("storage-set",{originalErrorMessage:(d=h.target.error)===null||d===void 0?void 0:d.message}))}})})}function y_(n){return`${n.options.appId}-${n.name}`}var mr=new Be("@firebase/app-check");function Bo(n,e){return lr()?g_(n,e).catch(t=>{mr.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Bh(){return Lh().enabled}function qh(){return y(this,null,function*(){let n=Lh();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var v_={error:"UNKNOWN_ERROR"};function I_(n){return fi.encodeString(JSON.stringify(n),!1)}function zo(n,e=!1,t=!1){return y(this,null,function*(){let r=n.app;Mh(r);let i=Ve(r),o=i.token,a;if(o&&!gr(o)&&(i.token=void 0,o=void 0),!o){let d=yield i.cachedTokenPromise;d&&(gr(d)?o=d:yield Bo(r,void 0))}if(!e&&o&&gr(o))return{token:o.token};let u=!1;if(Bh())try{i.exchangeTokenPromise||(i.exchangeTokenPromise=Fh(Uh(r,yield qh()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),u=!0);let d=yield i.exchangeTokenPromise;return yield Bo(r,d),i.token=d,{token:d.token}}catch(d){return d.code==="appCheck/throttled"||d.code==="appCheck/initial-throttle"?mr.warn(d.message):t&&mr.error(d),qo(d)}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),u=!0),o=yield Ve(r).exchangeTokenPromise}catch(d){d.code==="appCheck/throttled"||d.code==="appCheck/initial-throttle"?mr.warn(d.message):t&&mr.error(d),a=d}let h;return o?a?gr(o)?h={token:o.token,internalError:a}:h=qo(a):(h={token:o.token},i.token=o,yield Bo(r,o)):h=qo(a),u&&A_(r,h),h})}function E_(n){return y(this,null,function*(){let e=n.app;Mh(e);let{provider:t}=Ve(e);if(Bh()){let r=yield qh(),{token:i}=yield Fh(Uh(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function w_(n,e,t,r){let{app:i}=n,o=Ve(i),a={next:t,error:r,type:e};if(o.tokenObservers=[...o.tokenObservers,a],o.token&&gr(o.token)){let u=o.token;Promise.resolve().then(()=>{t({token:u.token}),xh(n)}).catch(()=>{})}o.cachedTokenPromise.then(()=>xh(n))}function $h(n,e){let t=Ve(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function xh(n){let{app:e}=n,t=Ve(e),r=t.tokenRefresher;r||(r=T_(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function T_(n){let{app:e}=n;return new $o(()=>y(null,null,function*(){let t=Ve(e),r;if(t.token?r=yield zo(n,!0):r=yield zo(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=Ve(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},Oh.RETRIAL_MIN_WAIT,Oh.RETRIAL_MAX_WAIT)}function A_(n,e){let t=Ve(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function gr(n){return n.expireTimeMillis-Date.now()>0}function qo(n){return{token:I_(v_),error:n}}var Wo=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Ve(this.app);for(let t of e)$h(this.app,t.next);return Promise.resolve()}};function b_(n,e){return new Wo(n,e)}function S_(n){return{getToken:e=>zo(n,e),getLimitedUseToken:()=>E_(n),addTokenListener:e=>w_(n,"INTERNAL",e),removeTokenListener:e=>$h(n.app,e)}}var R_="@firebase/app-check",P_="0.10.0";var C_="app-check",Vh="app-check-internal";function k_(){xe(new Te(C_,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return b_(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Vh).initialize()})),xe(new Te(Vh,n=>{let e=n.getProvider("app-check").getImmediate();return S_(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),ne(R_,P_)}k_();var D_="app-check";var pn=class{constructor(){return fn(D_)}};var N_=["localhost","0.0.0.0","127.0.0.1"],JT=typeof window<"u"&&N_.includes(window.location.hostname);function rd(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var id=rd,sd=new Oe("auth","Firebase",rd());var Pi=new Be("@firebase/auth");function O_(n,...e){Pi.logLevel<=W.WARN&&Pi.warn(`Auth (${It}): ${n}`,...e)}function Ai(n,...e){Pi.logLevel<=W.ERROR&&Pi.error(`Auth (${It}): ${n}`,...e)}function St(n,...e){throw ha(n,...e)}function jt(n,...e){return ha(n,...e)}function od(n,e,t){let r=Object.assign(Object.assign({},id()),{[e]:t});return new Oe("auth","Firebase",r).create(e,{appName:n.name})}function $t(n){return od(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ha(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return sd.create(n,...e)}function F(n,e,...t){if(!n)throw ha(e,...t)}function tt(n){let e="INTERNAL ASSERTION FAILED: "+n;throw Ai(e),new Error(e)}function Rt(n,e){n||tt(e)}function Qo(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function x_(){return jh()==="http:"||jh()==="https:"}function jh(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function V_(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(x_()||lh()||"connection"in navigator)?navigator.onLine:!0}function L_(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var zt=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,Rt(t>e,"Short delay should be less than long delay!"),this.isMobile=ch()||hh()}get(){return V_()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function da(n,e){Rt(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var Ci=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;tt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;tt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;tt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var M_={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var F_=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],U_=new zt(3e4,6e4);function fa(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function mn(o,a,u,h){return y(this,arguments,function*(n,e,t,r,i={}){return ad(n,i,()=>y(null,null,function*(){let d={},p={};r&&(e==="GET"?p=r:d={body:JSON.stringify(r)});let v=hr(Object.assign({key:n.config.apiKey},p)).slice(1),E=yield n._getAdditionalHeaders();E["Content-Type"]="application/json",n.languageCode&&(E["X-Firebase-Locale"]=n.languageCode);let R=Object.assign({method:e,headers:E},d);return uh()||(R.referrerPolicy="no-referrer"),n.emulatorConfig&&yt(n.emulatorConfig.host)&&(R.credentials="include"),Ci.fetch()(yield cd(n,n.config.apiHost,t,v),R)}))})}function ad(n,e,t){return y(this,null,function*(){n._canInitEmulator=!1;let r=Object.assign(Object.assign({},M_),e);try{let i=new Yo(n),o=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let a=yield o.json();if("needConfirmation"in a)throw Ti(n,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{let u=o.ok?a.errorMessage:a.error.message,[h,d]=u.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ti(n,"credential-already-in-use",a);if(h==="EMAIL_EXISTS")throw Ti(n,"email-already-in-use",a);if(h==="USER_DISABLED")throw Ti(n,"user-disabled",a);let p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw od(n,p,d);St(n,p)}}catch(i){if(i instanceof be)throw i;St(n,"network-request-failed",{message:String(i)})}})}function B_(o,a,u,h){return y(this,arguments,function*(n,e,t,r,i={}){let d=yield mn(n,e,t,r,i);return"mfaPendingCredential"in d&&St(n,"multi-factor-auth-required",{_serverResponse:d}),d})}function cd(n,e,t,r){return y(this,null,function*(){let i=`${e}${t}?${r}`,o=n,a=o.config.emulator?da(n.config,i):`${n.config.apiScheme}://${i}`;return F_.includes(t)&&(yield o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(a).toString():a})}var Yo=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(jt(this.auth,"network-request-failed")),U_.get())})}};function Ti(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=jt(n,e,r);return i.customData._tokenResponse=t,i}function q_(n,e){return y(this,null,function*(){return mn(n,"POST","/v1/accounts:delete",e)})}function ki(n,e){return y(this,null,function*(){return mn(n,"POST","/v1/accounts:lookup",e)})}function _r(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function pa(n,e=!1){return y(this,null,function*(){let t=we(n),r=yield t.getIdToken(e),i=ma(r);F(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let o=typeof i.firebase=="object"?i.firebase:void 0,a=o?.sign_in_provider;return{claims:i,token:r,authTime:_r(Go(i.auth_time)),issuedAtTime:_r(Go(i.iat)),expirationTime:_r(Go(i.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}})}function Go(n){return Number(n)*1e3}function ma(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Ai("JWT malformed, contained fewer than 3 sections"),null;try{let i=pi(t);return i?JSON.parse(i):(Ai("Failed to decode base64 JWT payload"),null)}catch(i){return Ai("Caught error parsing JWT payload as JSON",i?.toString()),null}}function zh(n){let e=ma(n);return F(e,"internal-error"),F(typeof e.exp<"u","internal-error"),F(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function vr(n,e,t=!1){return y(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof be&&$_(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function $_({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var Jo=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>y(this,null,function*(){yield this.iteration()}),t)}iteration(){return y(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var Ir=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=_r(this.lastLoginAt),this.creationTime=_r(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function Di(n){return y(this,null,function*(){var e;let t=n.auth,r=yield n.getIdToken(),i=yield vr(n,ki(t,{idToken:r}));F(i?.users.length,t,"internal-error");let o=i.users[0];n._notifyReloadListener(o);let a=!((e=o.providerUserInfo)===null||e===void 0)&&e.length?ud(o.providerUserInfo):[],u=j_(n.providerData,a),h=n.isAnonymous,d=!(n.email&&o.passwordHash)&&!u?.length,p=h?d:!1,v={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:u,metadata:new Ir(o.createdAt,o.lastLoginAt),isAnonymous:p};Object.assign(n,v)})}function ga(n){return y(this,null,function*(){let e=we(n);yield Di(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function j_(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function ud(n){return n.map(e=>{var{providerId:t}=e,r=ho(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function z_(n,e){return y(this,null,function*(){let t=yield ad(n,{},()=>y(null,null,function*(){let r=hr({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=n.config,a=yield cd(n,i,"/v1/token",`key=${o}`),u=yield n._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";let h={method:"POST",headers:u,body:r};return n.emulatorConfig&&yt(n.emulatorConfig.host)&&(h.credentials="include"),Ci.fetch()(a,h)}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function W_(n,e){return y(this,null,function*(){return mn(n,"POST","/v2/accounts:revokeToken",fa(n,e))})}var yr=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){F(e.idToken,"internal-error"),F(typeof e.idToken<"u","internal-error"),F(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):zh(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){F(e.length!==0,"internal-error");let t=zh(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return y(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(F(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return y(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:o}=yield z_(e,t);this.updateTokensAndExpiration(r,i,Number(o))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:o}=t,a=new n;return r&&(F(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(F(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),o&&(F(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return tt("not implemented")}};function At(n,e){F(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var bt=class n{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,o=ho(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Jo(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=o.displayName||null,this.email=o.email||null,this.emailVerified=o.emailVerified||!1,this.phoneNumber=o.phoneNumber||null,this.photoURL=o.photoURL||null,this.isAnonymous=o.isAnonymous||!1,this.tenantId=o.tenantId||null,this.providerData=o.providerData?[...o.providerData]:[],this.metadata=new Ir(o.createdAt||void 0,o.lastLoginAt||void 0)}getIdToken(e){return y(this,null,function*(){let t=yield vr(this,this.stsTokenManager.getToken(this.auth,e));return F(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return pa(this,e)}reload(){return ga(this)}_assign(e){this!==e&&(F(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){F(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return y(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield Di(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return y(this,null,function*(){if(Pe(this.auth.app))return Promise.reject($t(this.auth));let e=yield this.getIdToken();return yield vr(this,q_(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,o,a,u,h,d,p;let v=(r=t.displayName)!==null&&r!==void 0?r:void 0,E=(i=t.email)!==null&&i!==void 0?i:void 0,R=(o=t.phoneNumber)!==null&&o!==void 0?o:void 0,N=(a=t.photoURL)!==null&&a!==void 0?a:void 0,x=(u=t.tenantId)!==null&&u!==void 0?u:void 0,k=(h=t._redirectEventId)!==null&&h!==void 0?h:void 0,$=(d=t.createdAt)!==null&&d!==void 0?d:void 0,U=(p=t.lastLoginAt)!==null&&p!==void 0?p:void 0,{uid:j,emailVerified:J,isAnonymous:ve,providerData:Y,stsTokenManager:w}=t;F(j&&w,e,"internal-error");let m=yr.fromJSON(this.name,w);F(typeof j=="string",e,"internal-error"),At(v,e.name),At(E,e.name),F(typeof J=="boolean",e,"internal-error"),F(typeof ve=="boolean",e,"internal-error"),At(R,e.name),At(N,e.name),At(x,e.name),At(k,e.name),At($,e.name),At(U,e.name);let _=new n({uid:j,auth:e,email:E,emailVerified:J,displayName:v,isAnonymous:ve,photoURL:N,phoneNumber:R,tenantId:x,stsTokenManager:m,createdAt:$,lastLoginAt:U});return Y&&Array.isArray(Y)&&(_.providerData=Y.map(I=>Object.assign({},I))),k&&(_._redirectEventId=k),_}static _fromIdTokenResponse(e,t,r=!1){return y(this,null,function*(){let i=new yr;i.updateFromServerResponse(t);let o=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield Di(o),o})}static _fromGetAccountInfoResponse(e,t,r){return y(this,null,function*(){let i=t.users[0];F(i.localId!==void 0,"internal-error");let o=i.providerUserInfo!==void 0?ud(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!o?.length,u=new yr;u.updateFromIdToken(r);let h=new n({uid:i.localId,auth:e,stsTokenManager:u,isAnonymous:a}),d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new Ir(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!o?.length};return Object.assign(h,d),h})}};var Wh=new Map;function nt(n){Rt(n instanceof Function,"Expected a class definition");let e=Wh.get(n);return e?(Rt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Wh.set(n,e),e)}var G_=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return y(this,null,function*(){return!0})}_set(t,r){return y(this,null,function*(){this.storage[t]=r})}_get(t){return y(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return y(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),Xo=G_;function bi(n,e,t){return`firebase:${n}:${e}:${t}`}var Ni=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:o}=this.auth;this.fullUserKey=bi(this.userKey,i.apiKey,o),this.fullPersistenceKey=bi("persistence",i.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return y(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=yield ki(this.auth,{idToken:e}).catch(()=>{});return t?bt._fromGetAccountInfoResponse(this.auth,t,e):null}return bt._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return y(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return y(this,null,function*(){if(!t.length)return new n(nt(Xo),e,r);let i=(yield Promise.all(t.map(d=>y(null,null,function*(){if(yield d._isAvailable())return d})))).filter(d=>d),o=i[0]||nt(Xo),a=bi(r,e.config.apiKey,e.name),u=null;for(let d of t)try{let p=yield d._get(a);if(p){let v;if(typeof p=="string"){let E=yield ki(e,{idToken:p}).catch(()=>{});if(!E)break;v=yield bt._fromGetAccountInfoResponse(e,E,p)}else v=bt._fromJSON(e,p);d!==o&&(u=v),o=d;break}}catch{}let h=i.filter(d=>d._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new n(o,e,r):(o=h[0],u&&(yield o._set(a,u.toJSON())),yield Promise.all(t.map(d=>y(null,null,function*(){if(d!==o)try{yield d._remove(a)}catch{}}))),new n(o,e,r))})}};function Gh(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(fd(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(ld(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(md(e))return"Blackberry";if(gd(e))return"Webos";if(hd(e))return"Safari";if((e.includes("chrome/")||dd(e))&&!e.includes("edge/"))return"Chrome";if(pd(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function ld(n=ce()){return/firefox\//i.test(n)}function hd(n=ce()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function dd(n=ce()){return/crios\//i.test(n)}function fd(n=ce()){return/iemobile/i.test(n)}function pd(n=ce()){return/android/i.test(n)}function md(n=ce()){return/blackberry/i.test(n)}function gd(n=ce()){return/webos/i.test(n)}function _a(n=ce()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function K_(n=ce()){var e;return _a(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function H_(){return dh()&&document.documentMode===10}function _d(n=ce()){return _a(n)||pd(n)||gd(n)||md(n)||/windows phone/i.test(n)||fd(n)}function yd(n,e=[]){let t;switch(n){case"Browser":t=Gh(ce());break;case"Worker":t=`${Gh(ce())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${It}/${r}`}var Zo=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=o=>new Promise((a,u)=>{try{let h=e(o);a(h)}catch(h){u(h)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return y(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function Q_(t){return y(this,arguments,function*(n,e={}){return mn(n,"GET","/v2/passwordPolicy",fa(n,e))})}var Y_=6,ea=class{constructor(e){var t,r,i,o;let a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:Y_,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(o=e.forceUpgradeOnSignin)!==null&&o!==void 0?o:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,o,a,u;let h={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,h),this.validatePasswordCharacterOptions(e,h),h.isValid&&(h.isValid=(t=h.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),h.isValid&&(h.isValid=(r=h.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),h.isValid&&(h.isValid=(i=h.containsLowercaseLetter)!==null&&i!==void 0?i:!0),h.isValid&&(h.isValid=(o=h.containsUppercaseLetter)!==null&&o!==void 0?o:!0),h.isValid&&(h.isValid=(a=h.containsNumericCharacter)!==null&&a!==void 0?a:!0),h.isValid&&(h.isValid=(u=h.containsNonAlphanumericCharacter)!==null&&u!==void 0?u:!0),h}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}};var ta=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Oi(this),this.idTokenSubscription=new Oi(this),this.beforeStateQueue=new Zo(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=sd,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=nt(t)),this._initializationPromise=this.queue(()=>y(this,null,function*(){var r,i,o;if(!this._deleted&&(this.persistenceManager=yield Ni.create(this,e),(r=this._resolvePersistenceManagerAvailable)===null||r===void 0||r.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((o=this.currentUser)===null||o===void 0?void 0:o.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return y(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return y(this,null,function*(){try{let t=yield ki(this,{idToken:e}),r=yield bt._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return y(this,null,function*(){var t;if(Pe(this.app)){let a=this.app.settings.authIdToken;return a?new Promise(u=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(u,u))}):this.directlySetCurrentUser(null)}let r=yield this.assertedPersistence.getCurrentUser(),i=r,o=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,u=i?._redirectEventId,h=yield this.tryRedirectSignIn(e);(!a||a===u)&&h?.user&&(i=h.user,o=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(o)try{yield this.beforeStateQueue.runMiddleware(i)}catch(a){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return F(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return y(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return y(this,null,function*(){try{yield Di(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=L_()}_delete(){return y(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return y(this,null,function*(){if(Pe(this.app))return Promise.reject($t(this));let t=e?we(e):null;return t&&F(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return y(this,null,function*(){if(!this._deleted)return e&&F(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>y(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return y(this,null,function*(){return Pe(this.app)?Promise.reject($t(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return Pe(this.app)?Promise.reject($t(this)):this.queue(()=>y(this,null,function*(){yield this.assertedPersistence.setPersistence(nt(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return y(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return y(this,null,function*(){let e=yield Q_(this),t=new ea(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Oe("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return y(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield W_(this,r)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return y(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return y(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&nt(e)||this._popupRedirectResolver;F(t,this,"argument-error"),this.redirectPersistenceManager=yield Ni.create(this,[nt(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return y(this,null,function*(){var t,r;return this._isInitialized&&(yield this.queue(()=>y(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return y(this,null,function*(){if(e===this.currentUser)return this.queue(()=>y(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let o=typeof t=="function"?t:t.next.bind(t),a=!1,u=this._isInitialized?Promise.resolve():this._initializationPromise;if(F(u,this,"internal-error"),u.then(()=>{a||o(this.currentUser)}),typeof t=="function"){let h=e.addObserver(t,r,i);return()=>{a=!0,h()}}else{let h=e.addObserver(t);return()=>{a=!0,h()}}}directlySetCurrentUser(e){return y(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return F(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=yd(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return y(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();r&&(t["X-Firebase-Client"]=r);let i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return y(this,null,function*(){var e;if(Pe(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&O_(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function ya(n){return we(n)}var Oi=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=gh(t=>this.observer=t)}get next(){return F(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var va={loadJS(){return y(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function J_(n){va=n}function X_(n){return va.loadJS(n)}function Z_(){return va.gapiScript}function vd(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function Ia(n,e){let t=hn(n,"auth");if(t.isInitialized()){let i=t.getImmediate(),o=t.getOptions();if(Ue(o,e??{}))return i;St(i,"already-initialized")}return t.initialize({options:e})}function ey(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(nt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function Ea(n,e,t){let r=ya(n);F(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!t?.disableWarnings,o=Id(e),{host:a,port:u}=ty(e),h=u===null?"":`:${u}`,d={url:`${o}//${a}${h}/`},p=Object.freeze({host:a,port:u,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){F(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),F(Ue(d,r.config.emulator)&&Ue(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,yt(a)?(gi(`${o}//${a}${h}`),_i("Auth",!0)):i||ny()}function Id(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function ty(n){let e=Id(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let o=i[1];return{host:o,port:Kh(r.substr(o.length+1))}}else{let[o,a]=r.split(":");return{host:o,port:Kh(a)}}}function Kh(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function ny(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var xi=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return tt("not implemented")}_getIdTokenResponse(e){return tt("not implemented")}_linkToIdToken(e,t){return tt("not implemented")}_getReauthenticationResolver(e){return tt("not implemented")}};function Ko(n,e){return y(this,null,function*(){return B_(n,"POST","/v1/accounts:signInWithIdp",fa(n,e))})}var Vi=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var na=class extends Vi{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};var Er=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,r,i=!1){return y(this,null,function*(){let o=yield bt._fromIdTokenResponse(e,r,i),a=Hh(r);return new n({user:o,providerId:a,_tokenResponse:r,operationType:t})})}static _forOperation(e,t,r){return y(this,null,function*(){yield e._updateTokensIfNecessary(r,!0);let i=Hh(r);return new n({user:e,providerId:i,_tokenResponse:r,operationType:t})})}};function Hh(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var ra=class n extends be{constructor(e,t,r,i){var o;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:(o=e.tenantId)!==null&&o!==void 0?o:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new n(e,t,r,i)}};function Ed(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?ra._fromErrorAndOperation(n,o,e,r):o})}function ry(n,e,t=!1){return y(this,null,function*(){let r=yield vr(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return Er._forOperation(n,"link",r)})}function iy(n,e,t=!1){return y(this,null,function*(){let{auth:r}=n;if(Pe(r.app))return Promise.reject($t(r));let i="reauthenticate";try{let o=yield vr(n,Ed(r,i,e,n),t);F(o.idToken,r,"internal-error");let a=ma(o.idToken);F(a,r,"internal-error");let{sub:u}=a;return F(n.uid===u,r,"user-mismatch"),Er._forOperation(n,i,o)}catch(o){throw o?.code==="auth/user-not-found"&&St(r,"user-mismatch"),o}})}function sy(n,e,t=!1){return y(this,null,function*(){if(Pe(n.app))return Promise.reject($t(n));let r="signIn",i=yield Ed(n,r,e),o=yield Er._fromIdTokenResponse(n,r,i);return t||(yield n._updateCurrentUser(o.user)),o})}function wa(n,e,t,r){return we(n).onIdTokenChanged(e,t,r)}function Ta(n,e,t){return we(n).beforeAuthStateChanged(e,t)}var Li="__sak";var Mi=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Li,"1"),this.storage.removeItem(Li),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var oy=1e3,ay=10,cy=(()=>{class n extends Mi{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=_d(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let r of Object.keys(this.listeners)){let i=this.storage.getItem(r),o=this.localCache[r];i!==o&&t(r,o,i)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((u,h,d)=>{this.notifyListeners(u,d)});return}let i=t.key;r?this.detachListener():this.stopPolling();let o=()=>{let u=this.storage.getItem(i);!r&&this.localCache[i]===u||this.notifyListeners(i,u)},a=this.storage.getItem(i);H_()&&a!==t.newValue&&t.newValue!==t.oldValue?setTimeout(o,ay):o()}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let o of Array.from(i))o(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:i}),!0)})},oy)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,r){return y(this,null,function*(){yield gt(n.prototype,this,"_set").call(this,t,r),this.localCache[t]=JSON.stringify(r)})}_get(t){return y(this,null,function*(){let r=yield gt(n.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(r),r})}_remove(t){return y(this,null,function*(){yield gt(n.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return n.type="LOCAL",n})(),wd=cy;var uy=(()=>{class n extends Mi{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}return n.type="SESSION",n})(),Aa=uy;function ly(n){return Promise.all(n.map(e=>y(null,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}var hy=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let r=this.receivers.find(o=>o.isListeningto(t));if(r)return r;let i=new n(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}handleEvent(t){return y(this,null,function*(){let r=t,{eventId:i,eventType:o,data:a}=r.data,u=this.handlersMap[o];if(!u?.size)return;r.ports[0].postMessage({status:"ack",eventId:i,eventType:o});let h=Array.from(u).map(p=>y(this,null,function*(){return p(r.origin,a)})),d=yield ly(h);r.ports[0].postMessage({status:"done",eventId:i,eventType:o,response:d})})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function Td(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}var ia=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,r=50){return y(this,null,function*(){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let o,a;return new Promise((u,h)=>{let d=Td("",20);i.port1.start();let p=setTimeout(()=>{h(new Error("unsupported_event"))},r);a={messageChannel:i,onMessage(v){let E=v;if(E.data.eventId===d)switch(E.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),u(E.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})})}};function $e(){return window}function dy(n){$e().location.href=n}function Ad(){return typeof $e().WorkerGlobalScope<"u"&&typeof $e().importScripts=="function"}function fy(){return y(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function py(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function my(){return Ad()?self:null}var bd="firebaseLocalStorageDb",gy=1,Fi="firebaseLocalStorage",Sd="fbase_key",Wt=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function Bi(n,e){return n.transaction([Fi],e?"readwrite":"readonly").objectStore(Fi)}function _y(){let n=indexedDB.deleteDatabase(bd);return new Wt(n).toPromise()}function sa(){let n=indexedDB.open(bd,gy);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let r=n.result;try{r.createObjectStore(Fi,{keyPath:Sd})}catch(i){t(i)}}),n.addEventListener("success",()=>y(null,null,function*(){let r=n.result;r.objectStoreNames.contains(Fi)?e(r):(r.close(),yield _y(),e(yield sa()))}))})}function Qh(n,e,t){return y(this,null,function*(){let r=Bi(n,!0).put({[Sd]:e,value:t});return new Wt(r).toPromise()})}function yy(n,e){return y(this,null,function*(){let t=Bi(n,!1).get(e),r=yield new Wt(t).toPromise();return r===void 0?null:r.value})}function Yh(n,e){let t=Bi(n,!0).delete(e);return new Wt(t).toPromise()}var vy=800,Iy=3,Ey=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return y(this,null,function*(){return this.db?this.db:(this.db=yield sa(),this.db)})}_withRetries(t){return y(this,null,function*(){let r=0;for(;;)try{let i=yield this._openDb();return yield t(i)}catch(i){if(r++>Iy)throw i;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return y(this,null,function*(){return Ad()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return y(this,null,function*(){this.receiver=hy._getInstance(my()),this.receiver._subscribe("keyChanged",(t,r)=>y(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(r.key)}})),this.receiver._subscribe("ping",(t,r)=>y(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return y(this,null,function*(){var t,r;if(this.activeServiceWorker=yield fy(),!this.activeServiceWorker)return;this.sender=new ia(this.activeServiceWorker);let i=yield this.sender._send("ping",{},800);i&&!((t=i[0])===null||t===void 0)&&t.fulfilled&&!((r=i[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return y(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||py()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return y(this,null,function*(){try{if(!indexedDB)return!1;let t=yield sa();return yield Qh(t,Li,"1"),yield Yh(t,Li),!0}catch{}return!1})}_withPendingWrite(t){return y(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,r){return y(this,null,function*(){return this._withPendingWrite(()=>y(this,null,function*(){return yield this._withRetries(i=>Qh(i,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)}))})}_get(t){return y(this,null,function*(){let r=yield this._withRetries(i=>yy(i,t));return this.localCache[t]=r,r})}_remove(t){return y(this,null,function*(){return this._withPendingWrite(()=>y(this,null,function*(){return yield this._withRetries(r=>Yh(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return y(this,null,function*(){let t=yield this._withRetries(o=>{let a=Bi(o,!1).getAll();return new Wt(a).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let r=[],i=new Set;if(t.length!==0)for(let{fbase_key:o,value:a}of t)i.add(o),JSON.stringify(this.localCache[o])!==JSON.stringify(a)&&(this.notifyListeners(o,a),r.push(o));for(let o of Object.keys(this.localCache))this.localCache[o]&&!i.has(o)&&(this.notifyListeners(o,null),r.push(o));return r})}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let o of Array.from(i))o(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>y(this,null,function*(){return this._poll()}),vy)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),Rd=Ey;var aA=vd("rcb"),cA=new zt(3e4,6e4);function wy(n,e){return e?nt(e):(F(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var wr=class extends xi{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ko(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ko(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ko(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function Ty(n){return sy(n.auth,new wr(n),n.bypassAuthState)}function Ay(n){let{auth:e,user:t}=n;return F(t,e,"internal-error"),iy(t,new wr(n),n.bypassAuthState)}function by(n){return y(this,null,function*(){let{auth:e,user:t}=n;return F(t,e,"internal-error"),ry(t,new wr(n),n.bypassAuthState)})}var oa=class{constructor(e,t,r,i,o=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>y(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}}))}onAuthEvent(e){return y(this,null,function*(){let{urlResponse:t,sessionId:r,postBody:i,tenantId:o,error:a,type:u}=e;if(a){this.reject(a);return}let h={auth:this.auth,requestUri:t,sessionId:r,tenantId:o||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(u)(h))}catch(d){this.reject(d)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Ty;case"linkViaPopup":case"linkViaRedirect":return by;case"reauthViaPopup":case"reauthViaRedirect":return Ay;default:St(this.auth,"internal-error")}}resolve(e){Rt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Rt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var uA=new zt(2e3,1e4);var Sy="pendingRedirect",Si=new Map,aa=class n extends oa{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}execute(){return y(this,null,function*(){let e=Si.get(this.auth._key());if(!e){try{let r=(yield Ry(this.resolver,this.auth))?yield gt(n.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Si.set(this.auth._key(),e)}return this.bypassAuthState||Si.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return y(this,null,function*(){if(e.type==="signInViaRedirect")return gt(n.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,gt(n.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return y(this,null,function*(){})}cleanUp(){}};function Ry(n,e){return y(this,null,function*(){let t=ky(e),r=Cy(n);if(!(yield r._isAvailable()))return!1;let i=(yield r._get(t))==="true";return yield r._remove(t),i})}function Py(n,e){Si.set(n._key(),e)}function Cy(n){return nt(n._redirectPersistence)}function ky(n){return bi(Sy,n.config.apiKey,n.name)}function Dy(n,e,t=!1){return y(this,null,function*(){if(Pe(n.app))return Promise.reject($t(n));let r=ya(n),i=wy(r,e),a=yield new aa(r,i,t).execute();return a&&!t&&(delete a.user._redirectEventId,yield r._persistUserIfCurrent(a.user),yield r._setRedirectUser(null,e)),a})}var Ny=10*60*1e3,ca=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Oy(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!Pd(e)){let i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(jt(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Ny&&this.cachedEventUids.clear(),this.cachedEventUids.has(Jh(e))}saveEventToCache(e){this.cachedEventUids.add(Jh(e)),this.lastProcessedEventTime=Date.now()}};function Jh(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Pd({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function Oy(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Pd(n);default:return!1}}function xy(t){return y(this,arguments,function*(n,e={}){return mn(n,"GET","/v1/projects",e)})}var Vy=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Ly=/^https?/;function My(n){return y(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:e}=yield xy(n);for(let t of e)try{if(Fy(t))return}catch{}St(n,"unauthorized-domain")})}function Fy(n){let e=Qo(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){let a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!Ly.test(t))return!1;if(Vy.test(n))return r===n;let i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}var Uy=new zt(3e4,6e4);function Xh(){let n=$e().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function By(n){return new Promise((e,t)=>{var r,i,o;function a(){Xh(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Xh(),t(jt(n,"network-request-failed"))},timeout:Uy.get()})}if(!((i=(r=$e().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((o=$e().gapi)===null||o===void 0)&&o.load)a();else{let u=vd("iframefcb");return $e()[u]=()=>{gapi.load?a():t(jt(n,"network-request-failed"))},X_(`${Z_()}?onload=${u}`).catch(h=>t(h))}}).catch(e=>{throw Ri=null,e})}var Ri=null;function qy(n){return Ri=Ri||By(n),Ri}var $y=new zt(5e3,15e3),jy="__/auth/iframe",zy="emulator/auth/iframe",Wy={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Gy=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Ky(n){let e=n.config;F(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?da(e,zy):`https://${n.config.authDomain}/${jy}`,r={apiKey:e.apiKey,appName:n.name,v:It},i=Gy.get(n.config.apiHost);i&&(r.eid=i);let o=n._getFrameworks();return o.length&&(r.fw=o.join(",")),`${t}?${hr(r).slice(1)}`}function Hy(n){return y(this,null,function*(){let e=yield qy(n),t=$e().gapi;return F(t,n,"internal-error"),e.open({where:document.body,url:Ky(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Wy,dontclear:!0},r=>new Promise((i,o)=>y(null,null,function*(){yield r.restyle({setHideOnLeave:!1});let a=jt(n,"network-request-failed"),u=$e().setTimeout(()=>{o(a)},$y.get());function h(){$e().clearTimeout(u),i(r)}r.ping(h).then(h,()=>{o(a)})})))})}var Qy={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Yy=500,Jy=600,Xy="_blank",Zy="http://localhost",Ui=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function ev(n,e,t,r=Yy,i=Jy){let o=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString(),u="",h=Object.assign(Object.assign({},Qy),{width:r.toString(),height:i.toString(),top:o,left:a}),d=ce().toLowerCase();t&&(u=dd(d)?Xy:t),ld(d)&&(e=e||Zy,h.scrollbars="yes");let p=Object.entries(h).reduce((E,[R,N])=>`${E}${R}=${N},`,"");if(K_(d)&&u!=="_self")return tv(e||"",u),new Ui(null);let v=window.open(e||"",u,p);F(v,n,"popup-blocked");try{v.focus()}catch{}return new Ui(v)}function tv(n,e){let t=document.createElement("a");t.href=n,t.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}var nv="__/auth/handler",rv="emulator/auth/handler",iv=encodeURIComponent("fac");function Zh(n,e,t,r,i,o){return y(this,null,function*(){F(n.config.authDomain,n,"auth-domain-config-required"),F(n.config.apiKey,n,"invalid-api-key");let a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:It,eventId:i};if(e instanceof Vi){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",mh(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(let[p,v]of Object.entries(o||{}))a[p]=v}if(e instanceof na){let p=e.getScopes().filter(v=>v!=="");p.length>0&&(a.scopes=p.join(","))}n.tenantId&&(a.tid=n.tenantId);let u=a;for(let p of Object.keys(u))u[p]===void 0&&delete u[p];let h=yield n._getAppCheckToken(),d=h?`#${iv}=${encodeURIComponent(h)}`:"";return`${sv(n)}?${hr(u).slice(1)}${d}`})}function sv({config:n}){return n.emulator?da(n,rv):`https://${n.authDomain}/${nv}`}var Ho="webStorageSupport",ua=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Aa,this._completeRedirectFn=Dy,this._overrideRedirectResult=Py}_openPopup(e,t,r,i){return y(this,null,function*(){var o;Rt((o=this.eventManagers[e._key()])===null||o===void 0?void 0:o.manager,"_initialize() not called before _openPopup()");let a=yield Zh(e,t,r,Qo(),i);return ev(e,a,Td())})}_openRedirect(e,t,r,i){return y(this,null,function*(){yield this._originValidation(e);let o=yield Zh(e,t,r,Qo(),i);return dy(o),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:o}=this.eventManagers[t];return i?Promise.resolve(i):(Rt(o,"If manager is not set, promise should be"),o)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}initAndGetManager(e){return y(this,null,function*(){let t=yield Hy(e),r=new ca(e);return t.register("authEvent",i=>(F(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Ho,{type:Ho},i=>{var o;let a=(o=i?.[0])===null||o===void 0?void 0:o[Ho];a!==void 0&&t(!!a),St(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=My(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return _d()||hd()||_a()}},Cd=ua;var ed="@firebase/auth",td="1.10.7";var la=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return y(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){F(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function ov(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function av(n){xe(new Te("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:u}=r.options;F(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let h={apiKey:a,authDomain:u,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:yd(n)},d=new ta(r,i,o,h);return ey(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),xe(new Te("auth-internal",e=>{let t=ya(e.getProvider("auth").getImmediate());return(r=>new la(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ne(ed,td,ov(n)),ne(ed,td,"esm2017")}var cv=5*60,uv=wo("authIdTokenMaxAge")||cv,nd=null,lv=n=>e=>y(null,null,function*(){let t=e&&(yield e.getIdTokenResult()),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>uv)return;let i=t?.token;nd!==i&&(nd=i,yield fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});function ba(n=Ut()){let e=hn(n,"auth");if(e.isInitialized())return e.getImmediate();let t=Ia(n,{popupRedirectResolver:Cd,persistence:[Rd,wd,Aa]}),r=wo("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let o=new URL(r,location.origin);if(location.origin===o.origin){let a=lv(o.toString());Ta(t,a,()=>a(t.currentUser)),wa(t,u=>a(u))}}let i=Io("auth");return i&&Ea(t,`http://${i}`),t}function hv(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}J_({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let o=jt("internal-error");o.customData=i,t(o)},r.type="text/javascript",r.charset="UTF-8",hv().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});av("Browser");var kd="auth",Tr=class{constructor(e){return e}},Ar=class{constructor(){return fn(kd)}};var Sa=new un("angularfire2.auth-instances");function iI(n,e){let t=pr(kd,n,e);return t&&new Tr(t)}function sI(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Tr(r)}}var oI={provide:Ar,deps:[[new Re,Sa]]},aI={provide:Tr,useFactory:iI,deps:[[new Re,Sa],et]};function XA(n,...e){return ne("angularfire",Et.full,"auth"),ln([aI,oI,{provide:Sa,useFactory:sI(n),multi:!0,deps:[Fe,_t,wt,qt,[new Re,pn],...e]}])}var ZA=Ce(ba,!0);var Dd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Nd={};var rt,Ra;(function(){var n;function e(w,m){function _(){}_.prototype=m.prototype,w.D=m.prototype,w.prototype=new _,w.prototype.constructor=w,w.C=function(I,T,b){for(var g=Array(arguments.length-2),Qe=2;Qe<arguments.length;Qe++)g[Qe-2]=arguments[Qe];return m.prototype[T].apply(I,g)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(w,m,_){_||(_=0);var I=Array(16);if(typeof m=="string")for(var T=0;16>T;++T)I[T]=m.charCodeAt(_++)|m.charCodeAt(_++)<<8|m.charCodeAt(_++)<<16|m.charCodeAt(_++)<<24;else for(T=0;16>T;++T)I[T]=m[_++]|m[_++]<<8|m[_++]<<16|m[_++]<<24;m=w.g[0],_=w.g[1],T=w.g[2];var b=w.g[3],g=m+(b^_&(T^b))+I[0]+3614090360&4294967295;m=_+(g<<7&4294967295|g>>>25),g=b+(T^m&(_^T))+I[1]+3905402710&4294967295,b=m+(g<<12&4294967295|g>>>20),g=T+(_^b&(m^_))+I[2]+606105819&4294967295,T=b+(g<<17&4294967295|g>>>15),g=_+(m^T&(b^m))+I[3]+3250441966&4294967295,_=T+(g<<22&4294967295|g>>>10),g=m+(b^_&(T^b))+I[4]+4118548399&4294967295,m=_+(g<<7&4294967295|g>>>25),g=b+(T^m&(_^T))+I[5]+1200080426&4294967295,b=m+(g<<12&4294967295|g>>>20),g=T+(_^b&(m^_))+I[6]+2821735955&4294967295,T=b+(g<<17&4294967295|g>>>15),g=_+(m^T&(b^m))+I[7]+4249261313&4294967295,_=T+(g<<22&4294967295|g>>>10),g=m+(b^_&(T^b))+I[8]+1770035416&4294967295,m=_+(g<<7&4294967295|g>>>25),g=b+(T^m&(_^T))+I[9]+2336552879&4294967295,b=m+(g<<12&4294967295|g>>>20),g=T+(_^b&(m^_))+I[10]+4294925233&4294967295,T=b+(g<<17&4294967295|g>>>15),g=_+(m^T&(b^m))+I[11]+2304563134&4294967295,_=T+(g<<22&4294967295|g>>>10),g=m+(b^_&(T^b))+I[12]+1804603682&4294967295,m=_+(g<<7&4294967295|g>>>25),g=b+(T^m&(_^T))+I[13]+4254626195&4294967295,b=m+(g<<12&4294967295|g>>>20),g=T+(_^b&(m^_))+I[14]+2792965006&4294967295,T=b+(g<<17&4294967295|g>>>15),g=_+(m^T&(b^m))+I[15]+1236535329&4294967295,_=T+(g<<22&4294967295|g>>>10),g=m+(T^b&(_^T))+I[1]+4129170786&4294967295,m=_+(g<<5&4294967295|g>>>27),g=b+(_^T&(m^_))+I[6]+3225465664&4294967295,b=m+(g<<9&4294967295|g>>>23),g=T+(m^_&(b^m))+I[11]+643717713&4294967295,T=b+(g<<14&4294967295|g>>>18),g=_+(b^m&(T^b))+I[0]+3921069994&4294967295,_=T+(g<<20&4294967295|g>>>12),g=m+(T^b&(_^T))+I[5]+3593408605&4294967295,m=_+(g<<5&4294967295|g>>>27),g=b+(_^T&(m^_))+I[10]+38016083&4294967295,b=m+(g<<9&4294967295|g>>>23),g=T+(m^_&(b^m))+I[15]+3634488961&4294967295,T=b+(g<<14&4294967295|g>>>18),g=_+(b^m&(T^b))+I[4]+3889429448&4294967295,_=T+(g<<20&4294967295|g>>>12),g=m+(T^b&(_^T))+I[9]+568446438&4294967295,m=_+(g<<5&4294967295|g>>>27),g=b+(_^T&(m^_))+I[14]+3275163606&4294967295,b=m+(g<<9&4294967295|g>>>23),g=T+(m^_&(b^m))+I[3]+4107603335&4294967295,T=b+(g<<14&4294967295|g>>>18),g=_+(b^m&(T^b))+I[8]+1163531501&4294967295,_=T+(g<<20&4294967295|g>>>12),g=m+(T^b&(_^T))+I[13]+2850285829&4294967295,m=_+(g<<5&4294967295|g>>>27),g=b+(_^T&(m^_))+I[2]+4243563512&4294967295,b=m+(g<<9&4294967295|g>>>23),g=T+(m^_&(b^m))+I[7]+1735328473&4294967295,T=b+(g<<14&4294967295|g>>>18),g=_+(b^m&(T^b))+I[12]+2368359562&4294967295,_=T+(g<<20&4294967295|g>>>12),g=m+(_^T^b)+I[5]+4294588738&4294967295,m=_+(g<<4&4294967295|g>>>28),g=b+(m^_^T)+I[8]+2272392833&4294967295,b=m+(g<<11&4294967295|g>>>21),g=T+(b^m^_)+I[11]+1839030562&4294967295,T=b+(g<<16&4294967295|g>>>16),g=_+(T^b^m)+I[14]+4259657740&4294967295,_=T+(g<<23&4294967295|g>>>9),g=m+(_^T^b)+I[1]+2763975236&4294967295,m=_+(g<<4&4294967295|g>>>28),g=b+(m^_^T)+I[4]+1272893353&4294967295,b=m+(g<<11&4294967295|g>>>21),g=T+(b^m^_)+I[7]+4139469664&4294967295,T=b+(g<<16&4294967295|g>>>16),g=_+(T^b^m)+I[10]+3200236656&4294967295,_=T+(g<<23&4294967295|g>>>9),g=m+(_^T^b)+I[13]+681279174&4294967295,m=_+(g<<4&4294967295|g>>>28),g=b+(m^_^T)+I[0]+3936430074&4294967295,b=m+(g<<11&4294967295|g>>>21),g=T+(b^m^_)+I[3]+3572445317&4294967295,T=b+(g<<16&4294967295|g>>>16),g=_+(T^b^m)+I[6]+76029189&4294967295,_=T+(g<<23&4294967295|g>>>9),g=m+(_^T^b)+I[9]+3654602809&4294967295,m=_+(g<<4&4294967295|g>>>28),g=b+(m^_^T)+I[12]+3873151461&4294967295,b=m+(g<<11&4294967295|g>>>21),g=T+(b^m^_)+I[15]+530742520&4294967295,T=b+(g<<16&4294967295|g>>>16),g=_+(T^b^m)+I[2]+3299628645&4294967295,_=T+(g<<23&4294967295|g>>>9),g=m+(T^(_|~b))+I[0]+4096336452&4294967295,m=_+(g<<6&4294967295|g>>>26),g=b+(_^(m|~T))+I[7]+1126891415&4294967295,b=m+(g<<10&4294967295|g>>>22),g=T+(m^(b|~_))+I[14]+2878612391&4294967295,T=b+(g<<15&4294967295|g>>>17),g=_+(b^(T|~m))+I[5]+4237533241&4294967295,_=T+(g<<21&4294967295|g>>>11),g=m+(T^(_|~b))+I[12]+1700485571&4294967295,m=_+(g<<6&4294967295|g>>>26),g=b+(_^(m|~T))+I[3]+2399980690&4294967295,b=m+(g<<10&4294967295|g>>>22),g=T+(m^(b|~_))+I[10]+4293915773&4294967295,T=b+(g<<15&4294967295|g>>>17),g=_+(b^(T|~m))+I[1]+2240044497&4294967295,_=T+(g<<21&4294967295|g>>>11),g=m+(T^(_|~b))+I[8]+1873313359&4294967295,m=_+(g<<6&4294967295|g>>>26),g=b+(_^(m|~T))+I[15]+4264355552&4294967295,b=m+(g<<10&4294967295|g>>>22),g=T+(m^(b|~_))+I[6]+2734768916&4294967295,T=b+(g<<15&4294967295|g>>>17),g=_+(b^(T|~m))+I[13]+1309151649&4294967295,_=T+(g<<21&4294967295|g>>>11),g=m+(T^(_|~b))+I[4]+4149444226&4294967295,m=_+(g<<6&4294967295|g>>>26),g=b+(_^(m|~T))+I[11]+3174756917&4294967295,b=m+(g<<10&4294967295|g>>>22),g=T+(m^(b|~_))+I[2]+718787259&4294967295,T=b+(g<<15&4294967295|g>>>17),g=_+(b^(T|~m))+I[9]+3951481745&4294967295,w.g[0]=w.g[0]+m&4294967295,w.g[1]=w.g[1]+(T+(g<<21&4294967295|g>>>11))&4294967295,w.g[2]=w.g[2]+T&4294967295,w.g[3]=w.g[3]+b&4294967295}r.prototype.u=function(w,m){m===void 0&&(m=w.length);for(var _=m-this.blockSize,I=this.B,T=this.h,b=0;b<m;){if(T==0)for(;b<=_;)i(this,w,b),b+=this.blockSize;if(typeof w=="string"){for(;b<m;)if(I[T++]=w.charCodeAt(b++),T==this.blockSize){i(this,I),T=0;break}}else for(;b<m;)if(I[T++]=w[b++],T==this.blockSize){i(this,I),T=0;break}}this.h=T,this.o+=m},r.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var m=1;m<w.length-8;++m)w[m]=0;var _=8*this.o;for(m=w.length-8;m<w.length;++m)w[m]=_&255,_/=256;for(this.u(w),w=Array(16),m=_=0;4>m;++m)for(var I=0;32>I;I+=8)w[_++]=this.g[m]>>>I&255;return w};function o(w,m){var _=u;return Object.prototype.hasOwnProperty.call(_,w)?_[w]:_[w]=m(w)}function a(w,m){this.h=m;for(var _=[],I=!0,T=w.length-1;0<=T;T--){var b=w[T]|0;I&&b==m||(_[T]=b,I=!1)}this.g=_}var u={};function h(w){return-128<=w&&128>w?o(w,function(m){return new a([m|0],0>m?-1:0)}):new a([w|0],0>w?-1:0)}function d(w){if(isNaN(w)||!isFinite(w))return v;if(0>w)return k(d(-w));for(var m=[],_=1,I=0;w>=_;I++)m[I]=w/_|0,_*=4294967296;return new a(m,0)}function p(w,m){if(w.length==0)throw Error("number format error: empty string");if(m=m||10,2>m||36<m)throw Error("radix out of range: "+m);if(w.charAt(0)=="-")return k(p(w.substring(1),m));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var _=d(Math.pow(m,8)),I=v,T=0;T<w.length;T+=8){var b=Math.min(8,w.length-T),g=parseInt(w.substring(T,T+b),m);8>b?(b=d(Math.pow(m,b)),I=I.j(b).add(d(g))):(I=I.j(_),I=I.add(d(g)))}return I}var v=h(0),E=h(1),R=h(16777216);n=a.prototype,n.m=function(){if(x(this))return-k(this).m();for(var w=0,m=1,_=0;_<this.g.length;_++){var I=this.i(_);w+=(0<=I?I:4294967296+I)*m,m*=4294967296}return w},n.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(N(this))return"0";if(x(this))return"-"+k(this).toString(w);for(var m=d(Math.pow(w,6)),_=this,I="";;){var T=J(_,m).g;_=$(_,T.j(m));var b=((0<_.g.length?_.g[0]:_.h)>>>0).toString(w);if(_=T,N(_))return b+I;for(;6>b.length;)b="0"+b;I=b+I}},n.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function N(w){if(w.h!=0)return!1;for(var m=0;m<w.g.length;m++)if(w.g[m]!=0)return!1;return!0}function x(w){return w.h==-1}n.l=function(w){return w=$(this,w),x(w)?-1:N(w)?0:1};function k(w){for(var m=w.g.length,_=[],I=0;I<m;I++)_[I]=~w.g[I];return new a(_,~w.h).add(E)}n.abs=function(){return x(this)?k(this):this},n.add=function(w){for(var m=Math.max(this.g.length,w.g.length),_=[],I=0,T=0;T<=m;T++){var b=I+(this.i(T)&65535)+(w.i(T)&65535),g=(b>>>16)+(this.i(T)>>>16)+(w.i(T)>>>16);I=g>>>16,b&=65535,g&=65535,_[T]=g<<16|b}return new a(_,_[_.length-1]&-2147483648?-1:0)};function $(w,m){return w.add(k(m))}n.j=function(w){if(N(this)||N(w))return v;if(x(this))return x(w)?k(this).j(k(w)):k(k(this).j(w));if(x(w))return k(this.j(k(w)));if(0>this.l(R)&&0>w.l(R))return d(this.m()*w.m());for(var m=this.g.length+w.g.length,_=[],I=0;I<2*m;I++)_[I]=0;for(I=0;I<this.g.length;I++)for(var T=0;T<w.g.length;T++){var b=this.i(I)>>>16,g=this.i(I)&65535,Qe=w.i(T)>>>16,jn=w.i(T)&65535;_[2*I+2*T]+=g*jn,U(_,2*I+2*T),_[2*I+2*T+1]+=b*jn,U(_,2*I+2*T+1),_[2*I+2*T+1]+=g*Qe,U(_,2*I+2*T+1),_[2*I+2*T+2]+=b*Qe,U(_,2*I+2*T+2)}for(I=0;I<m;I++)_[I]=_[2*I+1]<<16|_[2*I];for(I=m;I<2*m;I++)_[I]=0;return new a(_,0)};function U(w,m){for(;(w[m]&65535)!=w[m];)w[m+1]+=w[m]>>>16,w[m]&=65535,m++}function j(w,m){this.g=w,this.h=m}function J(w,m){if(N(m))throw Error("division by zero");if(N(w))return new j(v,v);if(x(w))return m=J(k(w),m),new j(k(m.g),k(m.h));if(x(m))return m=J(w,k(m)),new j(k(m.g),m.h);if(30<w.g.length){if(x(w)||x(m))throw Error("slowDivide_ only works with positive integers.");for(var _=E,I=m;0>=I.l(w);)_=ve(_),I=ve(I);var T=Y(_,1),b=Y(I,1);for(I=Y(I,2),_=Y(_,2);!N(I);){var g=b.add(I);0>=g.l(w)&&(T=T.add(_),b=g),I=Y(I,1),_=Y(_,1)}return m=$(w,T.j(m)),new j(T,m)}for(T=v;0<=w.l(m);){for(_=Math.max(1,Math.floor(w.m()/m.m())),I=Math.ceil(Math.log(_)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),b=d(_),g=b.j(m);x(g)||0<g.l(w);)_-=I,b=d(_),g=b.j(m);N(b)&&(b=E),T=T.add(b),w=$(w,g)}return new j(T,w)}n.A=function(w){return J(this,w).h},n.and=function(w){for(var m=Math.max(this.g.length,w.g.length),_=[],I=0;I<m;I++)_[I]=this.i(I)&w.i(I);return new a(_,this.h&w.h)},n.or=function(w){for(var m=Math.max(this.g.length,w.g.length),_=[],I=0;I<m;I++)_[I]=this.i(I)|w.i(I);return new a(_,this.h|w.h)},n.xor=function(w){for(var m=Math.max(this.g.length,w.g.length),_=[],I=0;I<m;I++)_[I]=this.i(I)^w.i(I);return new a(_,this.h^w.h)};function ve(w){for(var m=w.g.length+1,_=[],I=0;I<m;I++)_[I]=w.i(I)<<1|w.i(I-1)>>>31;return new a(_,w.h)}function Y(w,m){var _=m>>5;m%=32;for(var I=w.g.length-_,T=[],b=0;b<I;b++)T[b]=0<m?w.i(b+_)>>>m|w.i(b+_+1)<<32-m:w.i(b+_);return new a(T,w.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Ra=Nd.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,rt=Nd.Integer=a}).apply(typeof Dd<"u"?Dd:typeof self<"u"?self:typeof window<"u"?window:{});var qi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},it={};var Pa,cI,gn,Ca,br,$i,ka,Da,Na;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(s,c,l){return s==Array.prototype||s==Object.prototype||(s[c]=l.value),s};function t(s){s=[typeof globalThis=="object"&&globalThis,s,typeof window=="object"&&window,typeof self=="object"&&self,typeof qi=="object"&&qi];for(var c=0;c<s.length;++c){var l=s[c];if(l&&l.Math==Math)return l}throw Error("Cannot find global object")}var r=t(this);function i(s,c){if(c)e:{var l=r;s=s.split(".");for(var f=0;f<s.length-1;f++){var A=s[f];if(!(A in l))break e;l=l[A]}s=s[s.length-1],f=l[s],c=c(f),c!=f&&c!=null&&e(l,s,{configurable:!0,writable:!0,value:c})}}function o(s,c){s instanceof String&&(s+="");var l=0,f=!1,A={next:function(){if(!f&&l<s.length){var S=l++;return{value:c(S,s[S]),done:!1}}return f=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}i("Array.prototype.values",function(s){return s||function(){return o(this,function(c,l){return l})}});var a=a||{},u=this||self;function h(s){var c=typeof s;return c=c!="object"?c:s?Array.isArray(s)?"array":c:"null",c=="array"||c=="object"&&typeof s.length=="number"}function d(s){var c=typeof s;return c=="object"&&s!=null||c=="function"}function p(s,c,l){return s.call.apply(s.bind,arguments)}function v(s,c,l){if(!s)throw Error();if(2<arguments.length){var f=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,f),s.apply(c,A)}}return function(){return s.apply(c,arguments)}}function E(s,c,l){return E=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?p:v,E.apply(null,arguments)}function R(s,c){var l=Array.prototype.slice.call(arguments,1);return function(){var f=l.slice();return f.push.apply(f,arguments),s.apply(this,f)}}function N(s,c){function l(){}l.prototype=c.prototype,s.aa=c.prototype,s.prototype=new l,s.prototype.constructor=s,s.Qb=function(f,A,S){for(var D=Array(arguments.length-2),X=2;X<arguments.length;X++)D[X-2]=arguments[X];return c.prototype[A].apply(f,D)}}function x(s){let c=s.length;if(0<c){let l=Array(c);for(let f=0;f<c;f++)l[f]=s[f];return l}return[]}function k(s,c){for(let l=1;l<arguments.length;l++){let f=arguments[l];if(h(f)){let A=s.length||0,S=f.length||0;s.length=A+S;for(let D=0;D<S;D++)s[A+D]=f[D]}else s.push(f)}}class ${constructor(c,l){this.i=c,this.j=l,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function U(s){return/^[\s\xa0]*$/.test(s)}function j(){var s=u.navigator;return s&&(s=s.userAgent)?s:""}function J(s){return J[" "](s),s}J[" "]=function(){};var ve=j().indexOf("Gecko")!=-1&&!(j().toLowerCase().indexOf("webkit")!=-1&&j().indexOf("Edge")==-1)&&!(j().indexOf("Trident")!=-1||j().indexOf("MSIE")!=-1)&&j().indexOf("Edge")==-1;function Y(s,c,l){for(let f in s)c.call(l,s[f],f,s)}function w(s,c){for(let l in s)c.call(void 0,s[l],l,s)}function m(s){let c={};for(let l in s)c[l]=s[l];return c}let _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(s,c){let l,f;for(let A=1;A<arguments.length;A++){f=arguments[A];for(l in f)s[l]=f[l];for(let S=0;S<_.length;S++)l=_[S],Object.prototype.hasOwnProperty.call(f,l)&&(s[l]=f[l])}}function T(s){var c=1;s=s.split(":");let l=[];for(;0<c&&s.length;)l.push(s.shift()),c--;return s.length&&l.push(s.join(":")),l}function b(s){u.setTimeout(()=>{throw s},0)}function g(){var s=Fs;let c=null;return s.g&&(c=s.g,s.g=s.g.next,s.g||(s.h=null),c.next=null),c}class Qe{constructor(){this.h=this.g=null}add(c,l){let f=jn.get();f.set(c,l),this.h?this.h.next=f:this.g=f,this.h=f}}var jn=new $(()=>new im,s=>s.reset());class im{constructor(){this.next=this.g=this.h=null}set(c,l){this.h=c,this.g=l,this.next=null}reset(){this.next=this.g=this.h=null}}let zn,Wn=!1,Fs=new Qe,Ku=()=>{let s=u.Promise.resolve(void 0);zn=()=>{s.then(sm)}};var sm=()=>{for(var s;s=g();){try{s.h.call(s.g)}catch(l){b(l)}var c=jn;c.j(s),100>c.h&&(c.h++,s.next=c.g,c.g=s)}Wn=!1};function dt(){this.s=this.s,this.C=this.C}dt.prototype.s=!1,dt.prototype.ma=function(){this.s||(this.s=!0,this.N())},dt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function fe(s,c){this.type=s,this.g=this.target=c,this.defaultPrevented=!1}fe.prototype.h=function(){this.defaultPrevented=!0};var om=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var s=!1,c=Object.defineProperty({},"passive",{get:function(){s=!0}});try{let l=()=>{};u.addEventListener("test",l,c),u.removeEventListener("test",l,c)}catch{}return s}();function Gn(s,c){if(fe.call(this,s?s.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,s){var l=this.type=s.type,f=s.changedTouches&&s.changedTouches.length?s.changedTouches[0]:null;if(this.target=s.target||s.srcElement,this.g=c,c=s.relatedTarget){if(ve){e:{try{J(c.nodeName);var A=!0;break e}catch{}A=!1}A||(c=null)}}else l=="mouseover"?c=s.fromElement:l=="mouseout"&&(c=s.toElement);this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0),this.button=s.button,this.key=s.key||"",this.ctrlKey=s.ctrlKey,this.altKey=s.altKey,this.shiftKey=s.shiftKey,this.metaKey=s.metaKey,this.pointerId=s.pointerId||0,this.pointerType=typeof s.pointerType=="string"?s.pointerType:am[s.pointerType]||"",this.state=s.state,this.i=s,s.defaultPrevented&&Gn.aa.h.call(this)}}N(Gn,fe);var am={2:"touch",3:"pen",4:"mouse"};Gn.prototype.h=function(){Gn.aa.h.call(this);var s=this.i;s.preventDefault?s.preventDefault():s.returnValue=!1};var Kn="closure_listenable_"+(1e6*Math.random()|0),cm=0;function um(s,c,l,f,A){this.listener=s,this.proxy=null,this.src=c,this.type=l,this.capture=!!f,this.ha=A,this.key=++cm,this.da=this.fa=!1}function Kr(s){s.da=!0,s.listener=null,s.proxy=null,s.src=null,s.ha=null}function Hr(s){this.src=s,this.g={},this.h=0}Hr.prototype.add=function(s,c,l,f,A){var S=s.toString();s=this.g[S],s||(s=this.g[S]=[],this.h++);var D=Bs(s,c,f,A);return-1<D?(c=s[D],l||(c.fa=!1)):(c=new um(c,this.src,S,!!f,A),c.fa=l,s.push(c)),c};function Us(s,c){var l=c.type;if(l in s.g){var f=s.g[l],A=Array.prototype.indexOf.call(f,c,void 0),S;(S=0<=A)&&Array.prototype.splice.call(f,A,1),S&&(Kr(c),s.g[l].length==0&&(delete s.g[l],s.h--))}}function Bs(s,c,l,f){for(var A=0;A<s.length;++A){var S=s[A];if(!S.da&&S.listener==c&&S.capture==!!l&&S.ha==f)return A}return-1}var qs="closure_lm_"+(1e6*Math.random()|0),$s={};function Hu(s,c,l,f,A){if(f&&f.once)return Yu(s,c,l,f,A);if(Array.isArray(c)){for(var S=0;S<c.length;S++)Hu(s,c[S],l,f,A);return null}return l=Gs(l),s&&s[Kn]?s.K(c,l,d(f)?!!f.capture:!!f,A):Qu(s,c,l,!1,f,A)}function Qu(s,c,l,f,A,S){if(!c)throw Error("Invalid event type");var D=d(A)?!!A.capture:!!A,X=zs(s);if(X||(s[qs]=X=new Hr(s)),l=X.add(c,l,f,D,S),l.proxy)return l;if(f=lm(),l.proxy=f,f.src=s,f.listener=l,s.addEventListener)om||(A=D),A===void 0&&(A=!1),s.addEventListener(c.toString(),f,A);else if(s.attachEvent)s.attachEvent(Xu(c.toString()),f);else if(s.addListener&&s.removeListener)s.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return l}function lm(){function s(l){return c.call(s.src,s.listener,l)}let c=hm;return s}function Yu(s,c,l,f,A){if(Array.isArray(c)){for(var S=0;S<c.length;S++)Yu(s,c[S],l,f,A);return null}return l=Gs(l),s&&s[Kn]?s.L(c,l,d(f)?!!f.capture:!!f,A):Qu(s,c,l,!0,f,A)}function Ju(s,c,l,f,A){if(Array.isArray(c))for(var S=0;S<c.length;S++)Ju(s,c[S],l,f,A);else f=d(f)?!!f.capture:!!f,l=Gs(l),s&&s[Kn]?(s=s.i,c=String(c).toString(),c in s.g&&(S=s.g[c],l=Bs(S,l,f,A),-1<l&&(Kr(S[l]),Array.prototype.splice.call(S,l,1),S.length==0&&(delete s.g[c],s.h--)))):s&&(s=zs(s))&&(c=s.g[c.toString()],s=-1,c&&(s=Bs(c,l,f,A)),(l=-1<s?c[s]:null)&&js(l))}function js(s){if(typeof s!="number"&&s&&!s.da){var c=s.src;if(c&&c[Kn])Us(c.i,s);else{var l=s.type,f=s.proxy;c.removeEventListener?c.removeEventListener(l,f,s.capture):c.detachEvent?c.detachEvent(Xu(l),f):c.addListener&&c.removeListener&&c.removeListener(f),(l=zs(c))?(Us(l,s),l.h==0&&(l.src=null,c[qs]=null)):Kr(s)}}}function Xu(s){return s in $s?$s[s]:$s[s]="on"+s}function hm(s,c){if(s.da)s=!0;else{c=new Gn(c,this);var l=s.listener,f=s.ha||s.src;s.fa&&js(s),s=l.call(f,c)}return s}function zs(s){return s=s[qs],s instanceof Hr?s:null}var Ws="__closure_events_fn_"+(1e9*Math.random()>>>0);function Gs(s){return typeof s=="function"?s:(s[Ws]||(s[Ws]=function(c){return s.handleEvent(c)}),s[Ws])}function pe(){dt.call(this),this.i=new Hr(this),this.M=this,this.F=null}N(pe,dt),pe.prototype[Kn]=!0,pe.prototype.removeEventListener=function(s,c,l,f){Ju(this,s,c,l,f)};function Ie(s,c){var l,f=s.F;if(f)for(l=[];f;f=f.F)l.push(f);if(s=s.M,f=c.type||c,typeof c=="string")c=new fe(c,s);else if(c instanceof fe)c.target=c.target||s;else{var A=c;c=new fe(f,s),I(c,A)}if(A=!0,l)for(var S=l.length-1;0<=S;S--){var D=c.g=l[S];A=Qr(D,f,!0,c)&&A}if(D=c.g=s,A=Qr(D,f,!0,c)&&A,A=Qr(D,f,!1,c)&&A,l)for(S=0;S<l.length;S++)D=c.g=l[S],A=Qr(D,f,!1,c)&&A}pe.prototype.N=function(){if(pe.aa.N.call(this),this.i){var s=this.i,c;for(c in s.g){for(var l=s.g[c],f=0;f<l.length;f++)Kr(l[f]);delete s.g[c],s.h--}}this.F=null},pe.prototype.K=function(s,c,l,f){return this.i.add(String(s),c,!1,l,f)},pe.prototype.L=function(s,c,l,f){return this.i.add(String(s),c,!0,l,f)};function Qr(s,c,l,f){if(c=s.i.g[String(c)],!c)return!0;c=c.concat();for(var A=!0,S=0;S<c.length;++S){var D=c[S];if(D&&!D.da&&D.capture==l){var X=D.listener,he=D.ha||D.src;D.fa&&Us(s.i,D),A=X.call(he,f)!==!1&&A}}return A&&!f.defaultPrevented}function Zu(s,c,l){if(typeof s=="function")l&&(s=E(s,l));else if(s&&typeof s.handleEvent=="function")s=E(s.handleEvent,s);else throw Error("Invalid listener argument");return 2147483647<Number(c)?-1:u.setTimeout(s,c||0)}function el(s){s.g=Zu(()=>{s.g=null,s.i&&(s.i=!1,el(s))},s.l);let c=s.h;s.h=null,s.m.apply(null,c)}class dm extends dt{constructor(c,l){super(),this.m=c,this.l=l,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:el(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Hn(s){dt.call(this),this.h=s,this.g={}}N(Hn,dt);var tl=[];function nl(s){Y(s.g,function(c,l){this.g.hasOwnProperty(l)&&js(c)},s),s.g={}}Hn.prototype.N=function(){Hn.aa.N.call(this),nl(this)},Hn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ks=u.JSON.stringify,fm=u.JSON.parse,pm=class{stringify(s){return u.JSON.stringify(s,void 0)}parse(s){return u.JSON.parse(s,void 0)}};function Hs(){}Hs.prototype.h=null;function rl(s){return s.h||(s.h=s.i())}function il(){}var Qn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Qs(){fe.call(this,"d")}N(Qs,fe);function Ys(){fe.call(this,"c")}N(Ys,fe);var Nt={},sl=null;function Yr(){return sl=sl||new pe}Nt.La="serverreachability";function ol(s){fe.call(this,Nt.La,s)}N(ol,fe);function Yn(s){let c=Yr();Ie(c,new ol(c))}Nt.STAT_EVENT="statevent";function al(s,c){fe.call(this,Nt.STAT_EVENT,s),this.stat=c}N(al,fe);function Ee(s){let c=Yr();Ie(c,new al(c,s))}Nt.Ma="timingevent";function cl(s,c){fe.call(this,Nt.Ma,s),this.size=c}N(cl,fe);function Jn(s,c){if(typeof s!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){s()},c)}function Xn(){this.g=!0}Xn.prototype.xa=function(){this.g=!1};function mm(s,c,l,f,A,S){s.info(function(){if(s.g)if(S)for(var D="",X=S.split("&"),he=0;he<X.length;he++){var H=X[he].split("=");if(1<H.length){var me=H[0];H=H[1];var ge=me.split("_");D=2<=ge.length&&ge[1]=="type"?D+(me+"="+H+"&"):D+(me+"=redacted&")}}else D=null;else D=S;return"XMLHTTP REQ ("+f+") [attempt "+A+"]: "+c+`
`+l+`
`+D})}function gm(s,c,l,f,A,S,D){s.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+A+"]: "+c+`
`+l+`
`+S+" "+D})}function sn(s,c,l,f){s.info(function(){return"XMLHTTP TEXT ("+c+"): "+ym(s,l)+(f?" "+f:"")})}function _m(s,c){s.info(function(){return"TIMEOUT: "+c})}Xn.prototype.info=function(){};function ym(s,c){if(!s.g)return c;if(!c)return null;try{var l=JSON.parse(c);if(l){for(s=0;s<l.length;s++)if(Array.isArray(l[s])){var f=l[s];if(!(2>f.length)){var A=f[1];if(Array.isArray(A)&&!(1>A.length)){var S=A[0];if(S!="noop"&&S!="stop"&&S!="close")for(var D=1;D<A.length;D++)A[D]=""}}}}return Ks(l)}catch{return c}}var Jr={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ul={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Js;function Xr(){}N(Xr,Hs),Xr.prototype.g=function(){return new XMLHttpRequest},Xr.prototype.i=function(){return{}},Js=new Xr;function ft(s,c,l,f){this.j=s,this.i=c,this.l=l,this.R=f||1,this.U=new Hn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ll}function ll(){this.i=null,this.g="",this.h=!1}var hl={},Xs={};function Zs(s,c,l){s.L=1,s.v=ni(Ye(c)),s.m=l,s.P=!0,dl(s,null)}function dl(s,c){s.F=Date.now(),Zr(s),s.A=Ye(s.v);var l=s.A,f=s.R;Array.isArray(f)||(f=[String(f)]),Sl(l.i,"t",f),s.C=0,l=s.j.J,s.h=new ll,s.g=zl(s.j,l?c:null,!s.m),0<s.O&&(s.M=new dm(E(s.Y,s,s.g),s.O)),c=s.U,l=s.g,f=s.ca;var A="readystatechange";Array.isArray(A)||(A&&(tl[0]=A.toString()),A=tl);for(var S=0;S<A.length;S++){var D=Hu(l,A[S],f||c.handleEvent,!1,c.h||c);if(!D)break;c.g[D.key]=D}c=s.H?m(s.H):{},s.m?(s.u||(s.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",s.g.ea(s.A,s.u,s.m,c)):(s.u="GET",s.g.ea(s.A,s.u,null,c)),Yn(),mm(s.i,s.u,s.A,s.l,s.R,s.m)}ft.prototype.ca=function(s){s=s.target;let c=this.M;c&&Je(s)==3?c.j():this.Y(s)},ft.prototype.Y=function(s){try{if(s==this.g)e:{let ge=Je(this.g);var c=this.g.Ba();let cn=this.g.Z();if(!(3>ge)&&(ge!=3||this.g&&(this.h.h||this.g.oa()||Ol(this.g)))){this.J||ge!=4||c==7||(c==8||0>=cn?Yn(3):Yn(2)),eo(this);var l=this.g.Z();this.X=l;t:if(fl(this)){var f=Ol(this.g);s="";var A=f.length,S=Je(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ot(this),Zn(this);var D="";break t}this.h.i=new u.TextDecoder}for(c=0;c<A;c++)this.h.h=!0,s+=this.h.i.decode(f[c],{stream:!(S&&c==A-1)});f.length=0,this.h.g+=s,this.C=0,D=this.h.g}else D=this.g.oa();if(this.o=l==200,gm(this.i,this.u,this.A,this.l,this.R,ge,l),this.o){if(this.T&&!this.K){t:{if(this.g){var X,he=this.g;if((X=he.g?he.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!U(X)){var H=X;break t}}H=null}if(l=H)sn(this.i,this.l,l,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,to(this,l);else{this.o=!1,this.s=3,Ee(12),Ot(this),Zn(this);break e}}if(this.P){l=!0;let Ne;for(;!this.J&&this.C<D.length;)if(Ne=vm(this,D),Ne==Xs){ge==4&&(this.s=4,Ee(14),l=!1),sn(this.i,this.l,null,"[Incomplete Response]");break}else if(Ne==hl){this.s=4,Ee(15),sn(this.i,this.l,D,"[Invalid Chunk]"),l=!1;break}else sn(this.i,this.l,Ne,null),to(this,Ne);if(fl(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ge!=4||D.length!=0||this.h.h||(this.s=1,Ee(16),l=!1),this.o=this.o&&l,!l)sn(this.i,this.l,D,"[Invalid Chunked Response]"),Ot(this),Zn(this);else if(0<D.length&&!this.W){this.W=!0;var me=this.j;me.g==this&&me.ba&&!me.M&&(me.j.info("Great, no buffering proxy detected. Bytes received: "+D.length),ao(me),me.M=!0,Ee(11))}}else sn(this.i,this.l,D,null),to(this,D);ge==4&&Ot(this),this.o&&!this.J&&(ge==4?Bl(this.j,this):(this.o=!1,Zr(this)))}else Lm(this.g),l==400&&0<D.indexOf("Unknown SID")?(this.s=3,Ee(12)):(this.s=0,Ee(13)),Ot(this),Zn(this)}}}catch{}finally{}};function fl(s){return s.g?s.u=="GET"&&s.L!=2&&s.j.Ca:!1}function vm(s,c){var l=s.C,f=c.indexOf(`
`,l);return f==-1?Xs:(l=Number(c.substring(l,f)),isNaN(l)?hl:(f+=1,f+l>c.length?Xs:(c=c.slice(f,f+l),s.C=f+l,c)))}ft.prototype.cancel=function(){this.J=!0,Ot(this)};function Zr(s){s.S=Date.now()+s.I,pl(s,s.I)}function pl(s,c){if(s.B!=null)throw Error("WatchDog timer not null");s.B=Jn(E(s.ba,s),c)}function eo(s){s.B&&(u.clearTimeout(s.B),s.B=null)}ft.prototype.ba=function(){this.B=null;let s=Date.now();0<=s-this.S?(_m(this.i,this.A),this.L!=2&&(Yn(),Ee(17)),Ot(this),this.s=2,Zn(this)):pl(this,this.S-s)};function Zn(s){s.j.G==0||s.J||Bl(s.j,s)}function Ot(s){eo(s);var c=s.M;c&&typeof c.ma=="function"&&c.ma(),s.M=null,nl(s.U),s.g&&(c=s.g,s.g=null,c.abort(),c.ma())}function to(s,c){try{var l=s.j;if(l.G!=0&&(l.g==s||no(l.h,s))){if(!s.K&&no(l.h,s)&&l.G==3){try{var f=l.Da.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var A=f;if(A[0]==0){e:if(!l.u){if(l.g)if(l.g.F+3e3<s.F)ai(l),si(l);else break e;oo(l),Ee(18)}}else l.za=A[1],0<l.za-l.T&&37500>A[2]&&l.F&&l.v==0&&!l.C&&(l.C=Jn(E(l.Za,l),6e3));if(1>=_l(l.h)&&l.ca){try{l.ca()}catch{}l.ca=void 0}}else Vt(l,11)}else if((s.K||l.g==s)&&ai(l),!U(c))for(A=l.Da.g.parse(c),c=0;c<A.length;c++){let H=A[c];if(l.T=H[0],H=H[1],l.G==2)if(H[0]=="c"){l.K=H[1],l.ia=H[2];let me=H[3];me!=null&&(l.la=me,l.j.info("VER="+l.la));let ge=H[4];ge!=null&&(l.Aa=ge,l.j.info("SVER="+l.Aa));let cn=H[5];cn!=null&&typeof cn=="number"&&0<cn&&(f=1.5*cn,l.L=f,l.j.info("backChannelRequestTimeoutMs_="+f)),f=l;let Ne=s.g;if(Ne){let ui=Ne.g?Ne.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ui){var S=f.h;S.g||ui.indexOf("spdy")==-1&&ui.indexOf("quic")==-1&&ui.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(ro(S,S.h),S.h=null))}if(f.D){let co=Ne.g?Ne.g.getResponseHeader("X-HTTP-Session-Id"):null;co&&(f.ya=co,Z(f.I,f.D,co))}}l.G=3,l.l&&l.l.ua(),l.ba&&(l.R=Date.now()-s.F,l.j.info("Handshake RTT: "+l.R+"ms")),f=l;var D=s;if(f.qa=jl(f,f.J?f.ia:null,f.W),D.K){yl(f.h,D);var X=D,he=f.L;he&&(X.I=he),X.B&&(eo(X),Zr(X)),f.g=D}else Fl(f);0<l.i.length&&oi(l)}else H[0]!="stop"&&H[0]!="close"||Vt(l,7);else l.G==3&&(H[0]=="stop"||H[0]=="close"?H[0]=="stop"?Vt(l,7):so(l):H[0]!="noop"&&l.l&&l.l.ta(H),l.v=0)}}Yn(4)}catch{}}var Im=class{constructor(s,c){this.g=s,this.map=c}};function ml(s){this.l=s||10,u.PerformanceNavigationTiming?(s=u.performance.getEntriesByType("navigation"),s=0<s.length&&(s[0].nextHopProtocol=="hq"||s[0].nextHopProtocol=="h2")):s=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=s?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function gl(s){return s.h?!0:s.g?s.g.size>=s.j:!1}function _l(s){return s.h?1:s.g?s.g.size:0}function no(s,c){return s.h?s.h==c:s.g?s.g.has(c):!1}function ro(s,c){s.g?s.g.add(c):s.h=c}function yl(s,c){s.h&&s.h==c?s.h=null:s.g&&s.g.has(c)&&s.g.delete(c)}ml.prototype.cancel=function(){if(this.i=vl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let s of this.g.values())s.cancel();this.g.clear()}};function vl(s){if(s.h!=null)return s.i.concat(s.h.D);if(s.g!=null&&s.g.size!==0){let c=s.i;for(let l of s.g.values())c=c.concat(l.D);return c}return x(s.i)}function Em(s){if(s.V&&typeof s.V=="function")return s.V();if(typeof Map<"u"&&s instanceof Map||typeof Set<"u"&&s instanceof Set)return Array.from(s.values());if(typeof s=="string")return s.split("");if(h(s)){for(var c=[],l=s.length,f=0;f<l;f++)c.push(s[f]);return c}c=[],l=0;for(f in s)c[l++]=s[f];return c}function wm(s){if(s.na&&typeof s.na=="function")return s.na();if(!s.V||typeof s.V!="function"){if(typeof Map<"u"&&s instanceof Map)return Array.from(s.keys());if(!(typeof Set<"u"&&s instanceof Set)){if(h(s)||typeof s=="string"){var c=[];s=s.length;for(var l=0;l<s;l++)c.push(l);return c}c=[],l=0;for(let f in s)c[l++]=f;return c}}}function Il(s,c){if(s.forEach&&typeof s.forEach=="function")s.forEach(c,void 0);else if(h(s)||typeof s=="string")Array.prototype.forEach.call(s,c,void 0);else for(var l=wm(s),f=Em(s),A=f.length,S=0;S<A;S++)c.call(void 0,f[S],l&&l[S],s)}var El=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Tm(s,c){if(s){s=s.split("&");for(var l=0;l<s.length;l++){var f=s[l].indexOf("="),A=null;if(0<=f){var S=s[l].substring(0,f);A=s[l].substring(f+1)}else S=s[l];c(S,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function xt(s){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,s instanceof xt){this.h=s.h,ei(this,s.j),this.o=s.o,this.g=s.g,ti(this,s.s),this.l=s.l;var c=s.i,l=new nr;l.i=c.i,c.g&&(l.g=new Map(c.g),l.h=c.h),wl(this,l),this.m=s.m}else s&&(c=String(s).match(El))?(this.h=!1,ei(this,c[1]||"",!0),this.o=er(c[2]||""),this.g=er(c[3]||"",!0),ti(this,c[4]),this.l=er(c[5]||"",!0),wl(this,c[6]||"",!0),this.m=er(c[7]||"")):(this.h=!1,this.i=new nr(null,this.h))}xt.prototype.toString=function(){var s=[],c=this.j;c&&s.push(tr(c,Tl,!0),":");var l=this.g;return(l||c=="file")&&(s.push("//"),(c=this.o)&&s.push(tr(c,Tl,!0),"@"),s.push(encodeURIComponent(String(l)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l=this.s,l!=null&&s.push(":",String(l))),(l=this.l)&&(this.g&&l.charAt(0)!="/"&&s.push("/"),s.push(tr(l,l.charAt(0)=="/"?Sm:bm,!0))),(l=this.i.toString())&&s.push("?",l),(l=this.m)&&s.push("#",tr(l,Pm)),s.join("")};function Ye(s){return new xt(s)}function ei(s,c,l){s.j=l?er(c,!0):c,s.j&&(s.j=s.j.replace(/:$/,""))}function ti(s,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);s.s=c}else s.s=null}function wl(s,c,l){c instanceof nr?(s.i=c,Cm(s.i,s.h)):(l||(c=tr(c,Rm)),s.i=new nr(c,s.h))}function Z(s,c,l){s.i.set(c,l)}function ni(s){return Z(s,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),s}function er(s,c){return s?c?decodeURI(s.replace(/%25/g,"%2525")):decodeURIComponent(s):""}function tr(s,c,l){return typeof s=="string"?(s=encodeURI(s).replace(c,Am),l&&(s=s.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),s):null}function Am(s){return s=s.charCodeAt(0),"%"+(s>>4&15).toString(16)+(s&15).toString(16)}var Tl=/[#\/\?@]/g,bm=/[#\?:]/g,Sm=/[#\?]/g,Rm=/[#\?@]/g,Pm=/#/g;function nr(s,c){this.h=this.g=null,this.i=s||null,this.j=!!c}function pt(s){s.g||(s.g=new Map,s.h=0,s.i&&Tm(s.i,function(c,l){s.add(decodeURIComponent(c.replace(/\+/g," ")),l)}))}n=nr.prototype,n.add=function(s,c){pt(this),this.i=null,s=on(this,s);var l=this.g.get(s);return l||this.g.set(s,l=[]),l.push(c),this.h+=1,this};function Al(s,c){pt(s),c=on(s,c),s.g.has(c)&&(s.i=null,s.h-=s.g.get(c).length,s.g.delete(c))}function bl(s,c){return pt(s),c=on(s,c),s.g.has(c)}n.forEach=function(s,c){pt(this),this.g.forEach(function(l,f){l.forEach(function(A){s.call(c,A,f,this)},this)},this)},n.na=function(){pt(this);let s=Array.from(this.g.values()),c=Array.from(this.g.keys()),l=[];for(let f=0;f<c.length;f++){let A=s[f];for(let S=0;S<A.length;S++)l.push(c[f])}return l},n.V=function(s){pt(this);let c=[];if(typeof s=="string")bl(this,s)&&(c=c.concat(this.g.get(on(this,s))));else{s=Array.from(this.g.values());for(let l=0;l<s.length;l++)c=c.concat(s[l])}return c},n.set=function(s,c){return pt(this),this.i=null,s=on(this,s),bl(this,s)&&(this.h-=this.g.get(s).length),this.g.set(s,[c]),this.h+=1,this},n.get=function(s,c){return s?(s=this.V(s),0<s.length?String(s[0]):c):c};function Sl(s,c,l){Al(s,c),0<l.length&&(s.i=null,s.g.set(on(s,c),x(l)),s.h+=l.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let s=[],c=Array.from(this.g.keys());for(var l=0;l<c.length;l++){var f=c[l];let S=encodeURIComponent(String(f)),D=this.V(f);for(f=0;f<D.length;f++){var A=S;D[f]!==""&&(A+="="+encodeURIComponent(String(D[f]))),s.push(A)}}return this.i=s.join("&")};function on(s,c){return c=String(c),s.j&&(c=c.toLowerCase()),c}function Cm(s,c){c&&!s.j&&(pt(s),s.i=null,s.g.forEach(function(l,f){var A=f.toLowerCase();f!=A&&(Al(this,f),Sl(this,A,l))},s)),s.j=c}function km(s,c){let l=new Xn;if(u.Image){let f=new Image;f.onload=R(mt,l,"TestLoadImage: loaded",!0,c,f),f.onerror=R(mt,l,"TestLoadImage: error",!1,c,f),f.onabort=R(mt,l,"TestLoadImage: abort",!1,c,f),f.ontimeout=R(mt,l,"TestLoadImage: timeout",!1,c,f),u.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=s}else c(!1)}function Dm(s,c){let l=new Xn,f=new AbortController,A=setTimeout(()=>{f.abort(),mt(l,"TestPingServer: timeout",!1,c)},1e4);fetch(s,{signal:f.signal}).then(S=>{clearTimeout(A),S.ok?mt(l,"TestPingServer: ok",!0,c):mt(l,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(A),mt(l,"TestPingServer: error",!1,c)})}function mt(s,c,l,f,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),f(l)}catch{}}function Nm(){this.g=new pm}function Om(s,c,l){let f=l||"";try{Il(s,function(A,S){let D=A;d(A)&&(D=Ks(A)),c.push(f+S+"="+encodeURIComponent(D))})}catch(A){throw c.push(f+"type="+encodeURIComponent("_badmap")),A}}function rr(s){this.l=s.Ub||null,this.j=s.eb||!1}N(rr,Hs),rr.prototype.g=function(){return new ri(this.l,this.j)},rr.prototype.i=function(s){return function(){return s}}({});function ri(s,c){pe.call(this),this.D=s,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}N(ri,pe),n=ri.prototype,n.open=function(s,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=s,this.A=c,this.readyState=1,sr(this)},n.send=function(s){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};s&&(c.body=s),(this.D||u).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ir(this)),this.readyState=0},n.Sa=function(s){if(this.g&&(this.l=s,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=s.headers,this.readyState=2,sr(this)),this.g&&(this.readyState=3,sr(this),this.g)))if(this.responseType==="arraybuffer")s.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in s){if(this.j=s.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Rl(this)}else s.text().then(this.Ra.bind(this),this.ga.bind(this))};function Rl(s){s.j.read().then(s.Pa.bind(s)).catch(s.ga.bind(s))}n.Pa=function(s){if(this.g){if(this.o&&s.value)this.response.push(s.value);else if(!this.o){var c=s.value?s.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!s.done}))&&(this.response=this.responseText+=c)}s.done?ir(this):sr(this),this.readyState==3&&Rl(this)}},n.Ra=function(s){this.g&&(this.response=this.responseText=s,ir(this))},n.Qa=function(s){this.g&&(this.response=s,ir(this))},n.ga=function(){this.g&&ir(this)};function ir(s){s.readyState=4,s.l=null,s.j=null,s.v=null,sr(s)}n.setRequestHeader=function(s,c){this.u.append(s,c)},n.getResponseHeader=function(s){return this.h&&this.h.get(s.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let s=[],c=this.h.entries();for(var l=c.next();!l.done;)l=l.value,s.push(l[0]+": "+l[1]),l=c.next();return s.join(`\r
`)};function sr(s){s.onreadystatechange&&s.onreadystatechange.call(s)}Object.defineProperty(ri.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(s){this.m=s?"include":"same-origin"}});function Pl(s){let c="";return Y(s,function(l,f){c+=f,c+=":",c+=l,c+=`\r
`}),c}function io(s,c,l){e:{for(f in l){var f=!1;break e}f=!0}f||(l=Pl(l),typeof s=="string"?l!=null&&encodeURIComponent(String(l)):Z(s,c,l))}function te(s){pe.call(this),this.headers=new Map,this.o=s||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}N(te,pe);var xm=/^https?$/i,Vm=["POST","PUT"];n=te.prototype,n.Ha=function(s){this.J=s},n.ea=function(s,c,l,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+s);c=c?c.toUpperCase():"GET",this.D=s,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Js.g(),this.v=this.o?rl(this.o):rl(Js),this.g.onreadystatechange=E(this.Ea,this);try{this.B=!0,this.g.open(c,String(s),!0),this.B=!1}catch(S){Cl(this,S);return}if(s=l||"",l=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var A in f)l.set(A,f[A]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(let S of f.keys())l.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(l.keys()).find(S=>S.toLowerCase()=="content-type"),A=u.FormData&&s instanceof u.FormData,!(0<=Array.prototype.indexOf.call(Vm,c,void 0))||f||A||l.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[S,D]of l)this.g.setRequestHeader(S,D);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Nl(this),this.u=!0,this.g.send(s),this.u=!1}catch(S){Cl(this,S)}};function Cl(s,c){s.h=!1,s.g&&(s.j=!0,s.g.abort(),s.j=!1),s.l=c,s.m=5,kl(s),ii(s)}function kl(s){s.A||(s.A=!0,Ie(s,"complete"),Ie(s,"error"))}n.abort=function(s){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=s||7,Ie(this,"complete"),Ie(this,"abort"),ii(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ii(this,!0)),te.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Dl(this):this.bb())},n.bb=function(){Dl(this)};function Dl(s){if(s.h&&typeof a<"u"&&(!s.v[1]||Je(s)!=4||s.Z()!=2)){if(s.u&&Je(s)==4)Zu(s.Ea,0,s);else if(Ie(s,"readystatechange"),Je(s)==4){s.h=!1;try{let D=s.Z();e:switch(D){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var l;if(!(l=c)){var f;if(f=D===0){var A=String(s.D).match(El)[1]||null;!A&&u.self&&u.self.location&&(A=u.self.location.protocol.slice(0,-1)),f=!xm.test(A?A.toLowerCase():"")}l=f}if(l)Ie(s,"complete"),Ie(s,"success");else{s.m=6;try{var S=2<Je(s)?s.g.statusText:""}catch{S=""}s.l=S+" ["+s.Z()+"]",kl(s)}}finally{ii(s)}}}}function ii(s,c){if(s.g){Nl(s);let l=s.g,f=s.v[0]?()=>{}:null;s.g=null,s.v=null,c||Ie(s,"ready");try{l.onreadystatechange=f}catch{}}}function Nl(s){s.I&&(u.clearTimeout(s.I),s.I=null)}n.isActive=function(){return!!this.g};function Je(s){return s.g?s.g.readyState:0}n.Z=function(){try{return 2<Je(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(s){if(this.g){var c=this.g.responseText;return s&&c.indexOf(s)==0&&(c=c.substring(s.length)),fm(c)}};function Ol(s){try{if(!s.g)return null;if("response"in s.g)return s.g.response;switch(s.H){case"":case"text":return s.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in s.g)return s.g.mozResponseArrayBuffer}return null}catch{return null}}function Lm(s){let c={};s=(s.g&&2<=Je(s)&&s.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<s.length;f++){if(U(s[f]))continue;var l=T(s[f]);let A=l[0];if(l=l[1],typeof l!="string")continue;l=l.trim();let S=c[A]||[];c[A]=S,S.push(l)}w(c,function(f){return f.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function or(s,c,l){return l&&l.internalChannelParams&&l.internalChannelParams[s]||c}function xl(s){this.Aa=0,this.i=[],this.j=new Xn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=or("failFast",!1,s),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=or("baseRetryDelayMs",5e3,s),this.cb=or("retryDelaySeedMs",1e4,s),this.Wa=or("forwardChannelMaxRetries",2,s),this.wa=or("forwardChannelRequestTimeoutMs",2e4,s),this.pa=s&&s.xmlHttpFactory||void 0,this.Xa=s&&s.Tb||void 0,this.Ca=s&&s.useFetchStreams||!1,this.L=void 0,this.J=s&&s.supportsCrossDomainXhr||!1,this.K="",this.h=new ml(s&&s.concurrentRequestLimit),this.Da=new Nm,this.P=s&&s.fastHandshake||!1,this.O=s&&s.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=s&&s.Rb||!1,s&&s.xa&&this.j.xa(),s&&s.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&s&&s.detectBufferingProxy||!1,this.ja=void 0,s&&s.longPollingTimeout&&0<s.longPollingTimeout&&(this.ja=s.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=xl.prototype,n.la=8,n.G=1,n.connect=function(s,c,l,f){Ee(0),this.W=s,this.H=c||{},l&&f!==void 0&&(this.H.OSID=l,this.H.OAID=f),this.F=this.X,this.I=jl(this,null,this.W),oi(this)};function so(s){if(Vl(s),s.G==3){var c=s.U++,l=Ye(s.I);if(Z(l,"SID",s.K),Z(l,"RID",c),Z(l,"TYPE","terminate"),ar(s,l),c=new ft(s,s.j,c),c.L=2,c.v=ni(Ye(l)),l=!1,u.navigator&&u.navigator.sendBeacon)try{l=u.navigator.sendBeacon(c.v.toString(),"")}catch{}!l&&u.Image&&(new Image().src=c.v,l=!0),l||(c.g=zl(c.j,null),c.g.ea(c.v)),c.F=Date.now(),Zr(c)}$l(s)}function si(s){s.g&&(ao(s),s.g.cancel(),s.g=null)}function Vl(s){si(s),s.u&&(u.clearTimeout(s.u),s.u=null),ai(s),s.h.cancel(),s.s&&(typeof s.s=="number"&&u.clearTimeout(s.s),s.s=null)}function oi(s){if(!gl(s.h)&&!s.s){s.s=!0;var c=s.Ga;zn||Ku(),Wn||(zn(),Wn=!0),Fs.add(c,s),s.B=0}}function Mm(s,c){return _l(s.h)>=s.h.j-(s.s?1:0)?!1:s.s?(s.i=c.D.concat(s.i),!0):s.G==1||s.G==2||s.B>=(s.Va?0:s.Wa)?!1:(s.s=Jn(E(s.Ga,s,c),ql(s,s.B)),s.B++,!0)}n.Ga=function(s){if(this.s)if(this.s=null,this.G==1){if(!s){this.U=Math.floor(1e5*Math.random()),s=this.U++;let A=new ft(this,this.j,s),S=this.o;if(this.S&&(S?(S=m(S),I(S,this.S)):S=this.S),this.m!==null||this.O||(A.H=S,S=null),this.P)e:{for(var c=0,l=0;l<this.i.length;l++){t:{var f=this.i[l];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(c+=f,4096<c){c=l;break e}if(c===4096||l===this.i.length-1){c=l+1;break e}}c=1e3}else c=1e3;c=Ml(this,A,c),l=Ye(this.I),Z(l,"RID",s),Z(l,"CVER",22),this.D&&Z(l,"X-HTTP-Session-Id",this.D),ar(this,l),S&&(this.O?c="headers="+encodeURIComponent(String(Pl(S)))+"&"+c:this.m&&io(l,this.m,S)),ro(this.h,A),this.Ua&&Z(l,"TYPE","init"),this.P?(Z(l,"$req",c),Z(l,"SID","null"),A.T=!0,Zs(A,l,null)):Zs(A,l,c),this.G=2}}else this.G==3&&(s?Ll(this,s):this.i.length==0||gl(this.h)||Ll(this))};function Ll(s,c){var l;c?l=c.l:l=s.U++;let f=Ye(s.I);Z(f,"SID",s.K),Z(f,"RID",l),Z(f,"AID",s.T),ar(s,f),s.m&&s.o&&io(f,s.m,s.o),l=new ft(s,s.j,l,s.B+1),s.m===null&&(l.H=s.o),c&&(s.i=c.D.concat(s.i)),c=Ml(s,l,1e3),l.I=Math.round(.5*s.wa)+Math.round(.5*s.wa*Math.random()),ro(s.h,l),Zs(l,f,c)}function ar(s,c){s.H&&Y(s.H,function(l,f){Z(c,f,l)}),s.l&&Il({},function(l,f){Z(c,f,l)})}function Ml(s,c,l){l=Math.min(s.i.length,l);var f=s.l?E(s.l.Na,s.l,s):null;e:{var A=s.i;let S=-1;for(;;){let D=["count="+l];S==-1?0<l?(S=A[0].g,D.push("ofs="+S)):S=0:D.push("ofs="+S);let X=!0;for(let he=0;he<l;he++){let H=A[he].g,me=A[he].map;if(H-=S,0>H)S=Math.max(0,A[he].g-100),X=!1;else try{Om(me,D,"req"+H+"_")}catch{f&&f(me)}}if(X){f=D.join("&");break e}}}return s=s.i.splice(0,l),c.D=s,f}function Fl(s){if(!s.g&&!s.u){s.Y=1;var c=s.Fa;zn||Ku(),Wn||(zn(),Wn=!0),Fs.add(c,s),s.v=0}}function oo(s){return s.g||s.u||3<=s.v?!1:(s.Y++,s.u=Jn(E(s.Fa,s),ql(s,s.v)),s.v++,!0)}n.Fa=function(){if(this.u=null,Ul(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var s=2*this.R;this.j.info("BP detection timer enabled: "+s),this.A=Jn(E(this.ab,this),s)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ee(10),si(this),Ul(this))};function ao(s){s.A!=null&&(u.clearTimeout(s.A),s.A=null)}function Ul(s){s.g=new ft(s,s.j,"rpc",s.Y),s.m===null&&(s.g.H=s.o),s.g.O=0;var c=Ye(s.qa);Z(c,"RID","rpc"),Z(c,"SID",s.K),Z(c,"AID",s.T),Z(c,"CI",s.F?"0":"1"),!s.F&&s.ja&&Z(c,"TO",s.ja),Z(c,"TYPE","xmlhttp"),ar(s,c),s.m&&s.o&&io(c,s.m,s.o),s.L&&(s.g.I=s.L);var l=s.g;s=s.ia,l.L=1,l.v=ni(Ye(c)),l.m=null,l.P=!0,dl(l,s)}n.Za=function(){this.C!=null&&(this.C=null,si(this),oo(this),Ee(19))};function ai(s){s.C!=null&&(u.clearTimeout(s.C),s.C=null)}function Bl(s,c){var l=null;if(s.g==c){ai(s),ao(s),s.g=null;var f=2}else if(no(s.h,c))l=c.D,yl(s.h,c),f=1;else return;if(s.G!=0){if(c.o)if(f==1){l=c.m?c.m.length:0,c=Date.now()-c.F;var A=s.B;f=Yr(),Ie(f,new cl(f,l)),oi(s)}else Fl(s);else if(A=c.s,A==3||A==0&&0<c.X||!(f==1&&Mm(s,c)||f==2&&oo(s)))switch(l&&0<l.length&&(c=s.h,c.i=c.i.concat(l)),A){case 1:Vt(s,5);break;case 4:Vt(s,10);break;case 3:Vt(s,6);break;default:Vt(s,2)}}}function ql(s,c){let l=s.Ta+Math.floor(Math.random()*s.cb);return s.isActive()||(l*=2),l*c}function Vt(s,c){if(s.j.info("Error code "+c),c==2){var l=E(s.fb,s),f=s.Xa;let A=!f;f=new xt(f||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||ei(f,"https"),ni(f),A?km(f.toString(),l):Dm(f.toString(),l)}else Ee(2);s.G=0,s.l&&s.l.sa(c),$l(s),Vl(s)}n.fb=function(s){s?(this.j.info("Successfully pinged google.com"),Ee(2)):(this.j.info("Failed to ping google.com"),Ee(1))};function $l(s){if(s.G=0,s.ka=[],s.l){let c=vl(s.h);(c.length!=0||s.i.length!=0)&&(k(s.ka,c),k(s.ka,s.i),s.h.i.length=0,x(s.i),s.i.length=0),s.l.ra()}}function jl(s,c,l){var f=l instanceof xt?Ye(l):new xt(l);if(f.g!="")c&&(f.g=c+"."+f.g),ti(f,f.s);else{var A=u.location;f=A.protocol,c=c?c+"."+A.hostname:A.hostname,A=+A.port;var S=new xt(null);f&&ei(S,f),c&&(S.g=c),A&&ti(S,A),l&&(S.l=l),f=S}return l=s.D,c=s.ya,l&&c&&Z(f,l,c),Z(f,"VER",s.la),ar(s,f),f}function zl(s,c,l){if(c&&!s.J)throw Error("Can't create secondary domain capable XhrIo object.");return c=s.Ca&&!s.pa?new te(new rr({eb:l})):new te(s.pa),c.Ha(s.J),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Wl(){}n=Wl.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function ci(){}ci.prototype.g=function(s,c){return new Ae(s,c)};function Ae(s,c){pe.call(this),this.g=new xl(c),this.l=s,this.h=c&&c.messageUrlParams||null,s=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(s?s["X-Client-Protocol"]="webchannel":s={"X-Client-Protocol":"webchannel"}),this.g.o=s,s=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(s?s["X-WebChannel-Content-Type"]=c.messageContentType:s={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(s?s["X-WebChannel-Client-Profile"]=c.va:s={"X-WebChannel-Client-Profile":c.va}),this.g.S=s,(s=c&&c.Sb)&&!U(s)&&(this.g.m=s),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!U(c)&&(this.g.D=c,s=this.h,s!==null&&c in s&&(s=this.h,c in s&&delete s[c])),this.j=new an(this)}N(Ae,pe),Ae.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ae.prototype.close=function(){so(this.g)},Ae.prototype.o=function(s){var c=this.g;if(typeof s=="string"){var l={};l.__data__=s,s=l}else this.u&&(l={},l.__data__=Ks(s),s=l);c.i.push(new Im(c.Ya++,s)),c.G==3&&oi(c)},Ae.prototype.N=function(){this.g.l=null,delete this.j,so(this.g),delete this.g,Ae.aa.N.call(this)};function Gl(s){Qs.call(this),s.__headers__&&(this.headers=s.__headers__,this.statusCode=s.__status__,delete s.__headers__,delete s.__status__);var c=s.__sm__;if(c){e:{for(let l in c){s=l;break e}s=void 0}(this.i=s)&&(s=this.i,c=c!==null&&s in c?c[s]:void 0),this.data=c}else this.data=s}N(Gl,Qs);function Kl(){Ys.call(this),this.status=1}N(Kl,Ys);function an(s){this.g=s}N(an,Wl),an.prototype.ua=function(){Ie(this.g,"a")},an.prototype.ta=function(s){Ie(this.g,new Gl(s))},an.prototype.sa=function(s){Ie(this.g,new Kl)},an.prototype.ra=function(){Ie(this.g,"b")},ci.prototype.createWebChannel=ci.prototype.g,Ae.prototype.send=Ae.prototype.o,Ae.prototype.open=Ae.prototype.m,Ae.prototype.close=Ae.prototype.close,Na=it.createWebChannelTransport=function(){return new ci},Da=it.getStatEventTarget=function(){return Yr()},ka=it.Event=Nt,$i=it.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Jr.NO_ERROR=0,Jr.TIMEOUT=8,Jr.HTTP_ERROR=6,br=it.ErrorCode=Jr,ul.COMPLETE="complete",Ca=it.EventType=ul,il.EventType=Qn,Qn.OPEN="a",Qn.CLOSE="b",Qn.ERROR="c",Qn.MESSAGE="d",pe.prototype.listen=pe.prototype.K,gn=it.WebChannel=il,cI=it.FetchXmlHttpFactory=rr,te.prototype.listenOnce=te.prototype.L,te.prototype.getLastError=te.prototype.Ka,te.prototype.getLastErrorCode=te.prototype.Ba,te.prototype.getStatus=te.prototype.Z,te.prototype.getResponseJson=te.prototype.Oa,te.prototype.getResponseText=te.prototype.oa,te.prototype.send=te.prototype.ea,te.prototype.setWithCredentials=te.prototype.Ha,Pa=it.XhrIo=te}).apply(typeof qi<"u"?qi:typeof self<"u"?self:typeof window<"u"?window:{});var Od="@firebase/firestore",xd="4.7.17";var ue=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};ue.UNAUTHENTICATED=new ue(null),ue.GOOGLE_CREDENTIALS=new ue("google-credentials-uid"),ue.FIRST_PARTY=new ue("first-party-uid"),ue.MOCK_USER=new ue("mock-user");var Un="11.9.0";var Yt=new Be("@firebase/firestore");function _n(){return Yt.logLevel}function O(n,...e){if(Yt.logLevel<=W.DEBUG){let t=e.map(vu);Yt.debug(`Firestore (${Un}): ${n}`,...t)}}function ot(n,...e){if(Yt.logLevel<=W.ERROR){let t=e.map(vu);Yt.error(`Firestore (${Un}): ${n}`,...t)}}function An(n,...e){if(Yt.logLevel<=W.WARN){let t=e.map(vu);Yt.warn(`Firestore (${Un}): ${n}`,...t)}}function vu(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function L(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,bf(n,r,t)}function bf(n,e,t){let r=`FIRESTORE (${Un}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw ot(r),new Error(r)}function Q(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||bf(e,i,r)}function B(n,e){return n}var C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},V=class extends be{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var st=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Qi=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Ma=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ue.UNAUTHENTICATED))}shutdown(){}},Fa=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Ua=class{constructor(e){this.t=e,this.currentUser=ue.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Q(this.o===void 0,42304);let r=this.i,i=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve(),o=new st;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new st,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let h=o;e.enqueueRetryable(()=>y(this,null,function*(){yield h.promise,yield i(this.currentUser)}))},u=h=>{O("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(h=>u(h)),setTimeout(()=>{if(!this.auth){let h=this.t.getImmediate({optional:!0});h?u(h):(O("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new st)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(O("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Q(typeof r.accessToken=="string",31837,{l:r}),new Qi(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return Q(e===null||typeof e=="string",2055,{h:e}),new ue(e)}},Ba=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=ue.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},qa=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Ba(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(ue.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Yi=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},$a=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Pe(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Q(this.o===void 0,3512);let r=o=>{o.error!=null&&O("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);let a=o.token!==this.m;return this.m=o.token,O("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>r(o))};let i=o=>{O("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){let o=this.V.getImmediate({optional:!0});o?i(o):O("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Yi(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Q(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Yi(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function uI(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}function Sf(){return new TextEncoder}var Ji=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=uI(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<t&&(r+=e.charAt(i[o]%62))}return r}};function z(n,e){return n<e?-1:n>e?1:0}function ja(n,e){let t=0;for(;t<n.length&&t<e.length;){let r=n.codePointAt(t),i=e.codePointAt(t);if(r!==i){if(r<128&&i<128)return z(r,i);{let o=Sf(),a=lI(o.encode(Vd(n,t)),o.encode(Vd(e,t)));return a!==0?a:z(r,i)}}t+=r>65535?2:1}return z(n.length,e.length)}function Vd(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function lI(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return z(n[t],e[t]);return z(n.length,e.length)}function bn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var Ld=-62135596800,Md=1e6,de=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*Md);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new V(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new V(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Ld)throw new V(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new V(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Md}_compareTo(e){return this.seconds===e.seconds?z(this.nanoseconds,e.nanoseconds):z(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-Ld;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var q=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new de(0,0))}static max(){return new n(new de(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Fd="__name__",Xi=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&L(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&L(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let o=n.compareSegments(e.get(i),t.get(i));if(o!==0)return o}return z(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):ja(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return rt.fromString(e.substring(4,e.length-2))}},re=class n extends Xi{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new V(C.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},hI=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Se=class n extends Xi{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return hI.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Fd}static keyField(){return new n([Fd])}static fromServerFormat(e){let t=[],r="",i=0,o=()=>{if(r.length===0)throw new V(C.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},a=!1;for(;i<e.length;){let u=e[i];if(u==="\\"){if(i+1===e.length)throw new V(C.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new V(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(r+=u,i++):(o(),i++)}if(o(),a)throw new V(C.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var M=class n{constructor(e){this.path=e}static fromPath(e){return new n(re.fromString(e))}static fromName(e){return new n(re.fromString(e).popFirst(5))}static empty(){return new n(re.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&re.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return re.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new re(e.slice()))}};var Nr=-1,za=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};za.UNKNOWN_ID=-1;function dI(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=q.fromTimestamp(r===1e9?new de(t+1,0):new de(t,r));return new Jt(i,M.empty(),e)}function fI(n){return new Jt(n.readTime,n.key,Nr)}var Jt=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(q.min(),M.empty(),Nr)}static max(){return new n(q.max(),M.empty(),Nr)}};function pI(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=M.comparator(n.documentKey,e.documentKey),t!==0?t:z(n.largestBatchId,e.largestBatchId))}var mI="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Wa=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Bn(n){return y(this,null,function*(){if(n.code!==C.FAILED_PRECONDITION||n.message!==mI)throw n;O("LocalStore","Unexpectedly lost primary lease")})}var P=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&L(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,o=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++o,a&&o===i&&t()},h=>r(h))}),a=!0,o===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,o)=>{r.push(t.call(this,i,o))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let o=e.length,a=new Array(o),u=0;for(let h=0;h<o;h++){let d=h;t(e[d]).next(p=>{a[d]=p,++u,u===o&&r(a)},p=>i(p))}})}static doWhile(e,t){return new n((r,i)=>{let o=()=>{e()===!0?t().next(()=>{o()},i):r()};o()})}};function gI(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function qn(n){return n.name==="IndexedDbTransactionError"}var Iu=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ue(i),this.ce=i=>r.writeSequenceNumber(i))}ue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ce&&this.ce(t),t}}n.le=-1;return n})(),Eu=-1;function ks(n){return n==null}function Or(n){return n===0&&1/n==-1/0}function _I(n){return typeof n=="number"&&Number.isInteger(n)&&!Or(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var Rf="";function yI(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Ud(e)),e=vI(n.get(t),e);return Ud(e)}function vI(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let o=n.charAt(i);switch(o){case"\0":t+="";break;case Rf:t+="";break;default:t+=o}}return t}function Ud(n){return n+Rf+""}var II="remoteDocuments",Pf="owner";var Cf="mutationQueues";var kf="mutations";var Df="documentMutations",EI="remoteDocumentsV14";var Nf="remoteDocumentGlobal";var Of="targets";var xf="targetDocuments";var Vf="targetGlobal",Lf="collectionParents";var Mf="clientMetadata";var Ff="bundles";var Uf="namedQueries";var wI="indexConfiguration";var TI="indexState";var AI="indexEntries";var Bf="documentOverlays";var bI="globals";var SI=[Cf,kf,Df,II,Of,Pf,Vf,xf,Mf,Nf,Lf,Ff,Uf],pb=[...SI,Bf],RI=[Cf,kf,Df,EI,Of,Pf,Vf,xf,Mf,Nf,Lf,Ff,Uf,Bf],PI=RI,CI=[...PI,wI,TI,AI];var mb=[...CI,bI];function Bd(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function nn(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function qf(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ie=class n{constructor(e,t){this.comparator=e,this.root=t||ze.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ze.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ze.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new En(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new En(this.root,e,this.comparator,!1)}getReverseIterator(){return new En(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new En(this.root,e,this.comparator,!0)}},En=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},ze=class n{constructor(e,t,r,i,o){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,o){return new n(e??this.key,t??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,t,r),null):o===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw L(43730,{key:this.key,value:this.value});if(this.right.isRed())throw L(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw L(27949);return e+(this.isRed()?0:1)}};ze.EMPTY=null,ze.RED=!0,ze.BLACK=!1;ze.EMPTY=new class{constructor(){this.size=0}get key(){throw L(57766)}get value(){throw L(16141)}get color(){throw L(16727)}get left(){throw L(29726)}get right(){throw L(36894)}copy(e,t,r,i,o){return this}insert(e,t,r){return new ze(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var le=class n{constructor(e){this.comparator=e,this.data=new ie(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Zi(this.data.getIterator())}getIteratorFrom(e){return new Zi(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Zi=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var je=class n{constructor(e){this.fields=e,e.sort(Se.comparator)}static empty(){return new n([])}unionWith(e){let t=new le(Se.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return bn(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var es=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var ye=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new es("Invalid base64 string: "+o):o}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let o="";for(let a=0;a<i.length;++a)o+=String.fromCharCode(i[a]);return o}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return z(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};ye.EMPTY_BYTE_STRING=new ye("");var kI=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function at(n){if(Q(!!n,39018),typeof n=="string"){let e=0,t=kI.exec(n);if(Q(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ee(n.seconds),nanos:ee(n.nanos)}}function ee(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ct(n){return typeof n=="string"?ye.fromBase64String(n):ye.fromUint8Array(n)}var $f="server_timestamp",jf="__type__",zf="__previous_value__",Wf="__local_write_time__";function wu(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[jf])===null||t===void 0?void 0:t.stringValue)===$f}function Ds(n){let e=n.mapValue.fields[zf];return wu(e)?Ds(e):e}function xr(n){let e=at(n.mapValue.fields[Wf].timestampValue);return new de(e.seconds,e.nanos)}var Ga=class{constructor(e,t,r,i,o,a,u,h,d,p){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=d,this.isUsingEmulator=p}},ts="(default)",ns=class n{constructor(e,t){this.projectId=e,this.database=t||ts}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===ts}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Tu="__type__",Gf="__max__",ji={mapValue:{fields:{__type__:{stringValue:Gf}}}},Au="__vector__",Sn="value";function Ct(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?wu(n)?4:Hf(n)?9007199254740991:Kf(n)?10:11:L(28295,{value:n})}function Ke(n,e){if(n===e)return!0;let t=Ct(n);if(t!==Ct(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return xr(n).isEqual(xr(e));case 3:return function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;let a=at(i.timestampValue),u=at(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,o){return ct(i.bytesValue).isEqual(ct(o.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,o){return ee(i.geoPointValue.latitude)===ee(o.geoPointValue.latitude)&&ee(i.geoPointValue.longitude)===ee(o.geoPointValue.longitude)}(n,e);case 2:return function(i,o){if("integerValue"in i&&"integerValue"in o)return ee(i.integerValue)===ee(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){let a=ee(i.doubleValue),u=ee(o.doubleValue);return a===u?Or(a)===Or(u):isNaN(a)&&isNaN(u)}return!1}(n,e);case 9:return bn(n.arrayValue.values||[],e.arrayValue.values||[],Ke);case 10:case 11:return function(i,o){let a=i.mapValue.fields||{},u=o.mapValue.fields||{};if(Bd(a)!==Bd(u))return!1;for(let h in a)if(a.hasOwnProperty(h)&&(u[h]===void 0||!Ke(a[h],u[h])))return!1;return!0}(n,e);default:return L(52216,{left:n})}}function Vr(n,e){return(n.values||[]).find(t=>Ke(t,e))!==void 0}function Rn(n,e){if(n===e)return 0;let t=Ct(n),r=Ct(e);if(t!==r)return z(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return z(n.booleanValue,e.booleanValue);case 2:return function(o,a){let u=ee(o.integerValue||o.doubleValue),h=ee(a.integerValue||a.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1}(n,e);case 3:return qd(n.timestampValue,e.timestampValue);case 4:return qd(xr(n),xr(e));case 5:return ja(n.stringValue,e.stringValue);case 6:return function(o,a){let u=ct(o),h=ct(a);return u.compareTo(h)}(n.bytesValue,e.bytesValue);case 7:return function(o,a){let u=o.split("/"),h=a.split("/");for(let d=0;d<u.length&&d<h.length;d++){let p=z(u[d],h[d]);if(p!==0)return p}return z(u.length,h.length)}(n.referenceValue,e.referenceValue);case 8:return function(o,a){let u=z(ee(o.latitude),ee(a.latitude));return u!==0?u:z(ee(o.longitude),ee(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return $d(n.arrayValue,e.arrayValue);case 10:return function(o,a){var u,h,d,p;let v=o.fields||{},E=a.fields||{},R=(u=v[Sn])===null||u===void 0?void 0:u.arrayValue,N=(h=E[Sn])===null||h===void 0?void 0:h.arrayValue,x=z(((d=R?.values)===null||d===void 0?void 0:d.length)||0,((p=N?.values)===null||p===void 0?void 0:p.length)||0);return x!==0?x:$d(R,N)}(n.mapValue,e.mapValue);case 11:return function(o,a){if(o===ji.mapValue&&a===ji.mapValue)return 0;if(o===ji.mapValue)return 1;if(a===ji.mapValue)return-1;let u=o.fields||{},h=Object.keys(u),d=a.fields||{},p=Object.keys(d);h.sort(),p.sort();for(let v=0;v<h.length&&v<p.length;++v){let E=ja(h[v],p[v]);if(E!==0)return E;let R=Rn(u[h[v]],d[p[v]]);if(R!==0)return R}return z(h.length,p.length)}(n.mapValue,e.mapValue);default:throw L(23264,{Pe:t})}}function qd(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return z(n,e);let t=at(n),r=at(e),i=z(t.seconds,r.seconds);return i!==0?i:z(t.nanos,r.nanos)}function $d(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let o=Rn(t[i],r[i]);if(o)return o}return z(t.length,r.length)}function Pn(n){return Ka(n)}function Ka(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=at(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return ct(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return M.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let o of t.values||[])i?i=!1:r+=",",r+=Ka(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",o=!0;for(let a of r)o?o=!1:i+=",",i+=`${a}:${Ka(t.fields[a])}`;return i+"}"}(n.mapValue):L(61005,{value:n})}function Gi(n){switch(Ct(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=Ds(n);return e?16+Gi(e):16;case 5:return 2*n.stringValue.length;case 6:return ct(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,o)=>i+Gi(o),0)}(n.arrayValue);case 10:case 11:return function(r){let i=0;return nn(r.fields,(o,a)=>{i+=o.length+Gi(a)}),i}(n.mapValue);default:throw L(13486,{value:n})}}function Ha(n){return!!n&&"integerValue"in n}function bu(n){return!!n&&"arrayValue"in n}function jd(n){return!!n&&"nullValue"in n}function zd(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ki(n){return!!n&&"mapValue"in n}function Kf(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Tu])===null||t===void 0?void 0:t.stringValue)===Au}function Rr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return nn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Rr(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Rr(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Hf(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Gf}var _b={mapValue:{fields:{[Tu]:{stringValue:Au},[Sn]:{arrayValue:{}}}}};var Le=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ki(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Rr(t)}setAll(e){let t=Se.emptyPath(),r={},i=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){let h=this.getFieldsMap(t);this.applyChanges(h,r,i),r={},i=[],t=u.popLast()}a?r[u.lastSegment()]=Rr(a):i.push(u.lastSegment())});let o=this.getFieldsMap(t);this.applyChanges(o,r,i)}delete(e){let t=this.field(e.popLast());Ki(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ke(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Ki(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){nn(t,(i,o)=>e[i]=o);for(let i of r)delete e[i]}clone(){return new n(Rr(this.value))}};function Qf(n){let e=[];return nn(n.fields,(t,r)=>{let i=new Se([t]);if(Ki(r)){let o=Qf(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new je(e)}var Me=class n{constructor(e,t,r,i,o,a,u){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(e){return new n(e,0,q.min(),q.min(),q.min(),Le.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,q.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,q.min(),q.min(),Le.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,q.min(),q.min(),Le.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(q.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Le.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Le.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=q.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Cn=class{constructor(e,t){this.position=e,this.inclusive=t}};function Wd(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let o=e[i],a=n.position[i];if(o.field.isKeyField()?r=M.comparator(M.fromName(a.referenceValue),t.key):r=Rn(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Gd(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ke(n.position[t],e.position[t]))return!1;return!0}var kn=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function DI(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var rs=class{},ae=class n extends rs{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Ya(e,t,r):t==="array-contains"?new Za(e,r):t==="in"?new ec(e,r):t==="not-in"?new tc(e,r):t==="array-contains-any"?new nc(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Ja(e,r):new Xa(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Rn(t,this.value)):t!==null&&Ct(this.value)===Ct(t)&&this.matchesComparison(Rn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return L(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},He=class n extends rs{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new n(e,t)}matches(e){return Yf(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Te!==null||(this.Te=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}};function Yf(n){return n.op==="and"}function Jf(n){return NI(n)&&Yf(n)}function NI(n){for(let e of n.filters)if(e instanceof He)return!1;return!0}function Qa(n){if(n instanceof ae)return n.field.canonicalString()+n.op.toString()+Pn(n.value);if(Jf(n))return n.filters.map(e=>Qa(e)).join(",");{let e=n.filters.map(t=>Qa(t)).join(",");return`${n.op}(${e})`}}function Xf(n,e){return n instanceof ae?function(r,i){return i instanceof ae&&r.op===i.op&&r.field.isEqual(i.field)&&Ke(r.value,i.value)}(n,e):n instanceof He?function(r,i){return i instanceof He&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((o,a,u)=>o&&Xf(a,i.filters[u]),!0):!1}(n,e):void L(19439)}function Zf(n){return n instanceof ae?function(t){return`${t.field.canonicalString()} ${t.op} ${Pn(t.value)}`}(n):n instanceof He?function(t){return t.op.toString()+" {"+t.getFilters().map(Zf).join(" ,")+"}"}(n):"Filter"}var Ya=class extends ae{constructor(e,t,r){super(e,t,r),this.key=M.fromName(r.referenceValue)}matches(e){let t=M.comparator(e.key,this.key);return this.matchesComparison(t)}},Ja=class extends ae{constructor(e,t){super(e,"in",t),this.keys=ep("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Xa=class extends ae{constructor(e,t){super(e,"not-in",t),this.keys=ep("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function ep(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>M.fromName(r.referenceValue))}var Za=class extends ae{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return bu(t)&&Vr(t.arrayValue,this.value)}},ec=class extends ae{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Vr(this.value.arrayValue,t)}},tc=class extends ae{constructor(e,t){super(e,"not-in",t)}matches(e){if(Vr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Vr(this.value.arrayValue,t)}},nc=class extends ae{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!bu(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Vr(this.value.arrayValue,r))}};var rc=class{constructor(e,t=null,r=[],i=[],o=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=a,this.endAt=u,this.Ie=null}};function Kd(n,e=null,t=[],r=[],i=null,o=null,a=null){return new rc(n,e,t,r,i,o,a)}function Su(n){let e=B(n);if(e.Ie===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Qa(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(o){return o.field.canonicalString()+o.dir}(r)).join(","),ks(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Pn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Pn(r)).join(",")),e.Ie=t}return e.Ie}function Ru(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!DI(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Xf(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Gd(n.startAt,e.startAt)&&Gd(n.endAt,e.endAt)}function ic(n){return M.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var Dn=class{constructor(e,t=null,r=[],i=[],o=null,a="F",u=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=h,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}};function OI(n,e,t,r,i,o,a,u){return new Dn(n,e,t,r,i,o,a,u)}function Pu(n){return new Dn(n)}function Hd(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function xI(n){return n.collectionGroup!==null}function Pr(n){let e=B(n);if(e.Ee===null){e.Ee=[];let t=new Set;for(let o of e.explicitOrderBy)e.Ee.push(o),t.add(o.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new le(Se.comparator);return a.filters.forEach(h=>{h.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ee.push(new kn(o,r))}),t.has(Se.keyField().canonicalString())||e.Ee.push(new kn(Se.keyField(),r))}return e.Ee}function We(n){let e=B(n);return e.de||(e.de=VI(e,Pr(n))),e.de}function VI(n,e){if(n.limitType==="F")return Kd(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let o=i.dir==="desc"?"asc":"desc";return new kn(i.field,o)});let t=n.endAt?new Cn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Cn(n.startAt.position,n.startAt.inclusive):null;return Kd(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function sc(n,e,t){return new Dn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ns(n,e){return Ru(We(n),We(e))&&n.limitType===e.limitType}function tp(n){return`${Su(We(n))}|lt:${n.limitType}`}function yn(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Zf(i)).join(", ")}]`),ks(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Pn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Pn(i)).join(",")),`Target(${r})`}(We(n))}; limitType=${n.limitType})`}function Os(n,e){return e.isFoundDocument()&&function(r,i){let o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):M.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(n,e)&&function(r,i){for(let o of Pr(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let o of r.filters)if(!o.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(a,u,h){let d=Wd(a,u,h);return a.inclusive?d<=0:d<0}(r.startAt,Pr(r),i)||r.endAt&&!function(a,u,h){let d=Wd(a,u,h);return a.inclusive?d>=0:d>0}(r.endAt,Pr(r),i))}(n,e)}function LI(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function np(n){return(e,t)=>{let r=!1;for(let i of Pr(n)){let o=MI(i,e,t);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function MI(n,e,t){let r=n.field.isKeyField()?M.comparator(e.key,t.key):function(o,a,u){let h=a.data.field(o),d=u.data.field(o);return h!==null&&d!==null?Rn(h,d):L(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return L(19790,{direction:n.dir})}}var ut=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){nn(this.inner,(t,r)=>{for(let[i,o]of r)e(i,o)})}isEmpty(){return qf(this.inner)}size(){return this.innerSize}};var FI=new ie(M.comparator);function lt(){return FI}var rp=new ie(M.comparator);function Sr(...n){let e=rp;for(let t of n)e=e.insert(t.key,t);return e}function ip(n){let e=rp;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Gt(){return Cr()}function sp(){return Cr()}function Cr(){return new ut(n=>n.toString(),(n,e)=>n.isEqual(e))}var UI=new ie(M.comparator),BI=new le(M.comparator);function G(...n){let e=BI;for(let t of n)e=e.add(t);return e}var qI=new le(z);function $I(){return qI}function Cu(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Or(e)?"-0":e}}function op(n){return{integerValue:""+n}}function jI(n,e){return _I(e)?op(e):Cu(n,e)}var Nn=class{constructor(){this._=void 0}};function zI(n,e,t){return n instanceof On?function(i,o){let a={fields:{[jf]:{stringValue:$f},[Wf]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&wu(o)&&(o=Ds(o)),o&&(a.fields[zf]=o),{mapValue:a}}(t,e):n instanceof Xt?cp(n,e):n instanceof Zt?up(n,e):function(i,o){let a=ap(i,o),u=Qd(a)+Qd(i.Re);return Ha(a)&&Ha(i.Re)?op(u):Cu(i.serializer,u)}(n,e)}function WI(n,e,t){return n instanceof Xt?cp(n,e):n instanceof Zt?up(n,e):t}function ap(n,e){return n instanceof xn?function(r){return Ha(r)||function(o){return!!o&&"doubleValue"in o}(r)}(e)?e:{integerValue:0}:null}var On=class extends Nn{},Xt=class extends Nn{constructor(e){super(),this.elements=e}};function cp(n,e){let t=lp(e);for(let r of n.elements)t.some(i=>Ke(i,r))||t.push(r);return{arrayValue:{values:t}}}var Zt=class extends Nn{constructor(e){super(),this.elements=e}};function up(n,e){let t=lp(e);for(let r of n.elements)t=t.filter(i=>!Ke(i,r));return{arrayValue:{values:t}}}var xn=class extends Nn{constructor(e,t){super(),this.serializer=e,this.Re=t}};function Qd(n){return ee(n.integerValue||n.doubleValue)}function lp(n){return bu(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function GI(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof Xt&&i instanceof Xt||r instanceof Zt&&i instanceof Zt?bn(r.elements,i.elements,Ke):r instanceof xn&&i instanceof xn?Ke(r.Re,i.Re):r instanceof On&&i instanceof On}(n.transform,e.transform)}var oc=class{constructor(e,t){this.version=e,this.transformResults=t}},Qt=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Hi(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Vn=class{};function hp(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new is(n.key,Qt.none()):new en(n.key,n.data,Qt.none());{let t=n.data,r=Le.empty(),i=new le(Se.comparator);for(let o of e.fields)if(!i.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),i=i.add(o)}return new ht(n.key,r,new je(i.toArray()),Qt.none())}}function KI(n,e,t){n instanceof en?function(i,o,a){let u=i.value.clone(),h=Jd(i.fieldTransforms,o,a.transformResults);u.setAll(h),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(n,e,t):n instanceof ht?function(i,o,a){if(!Hi(i.precondition,o))return void o.convertToUnknownDocument(a.version);let u=Jd(i.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(dp(i)),h.setAll(u),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()}(n,e,t):function(i,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function kr(n,e,t,r){return n instanceof en?function(o,a,u,h){if(!Hi(o.precondition,a))return u;let d=o.value.clone(),p=Xd(o.fieldTransforms,h,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(n,e,t,r):n instanceof ht?function(o,a,u,h){if(!Hi(o.precondition,a))return u;let d=Xd(o.fieldTransforms,h,a),p=a.data;return p.setAll(dp(o)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(v=>v.field))}(n,e,t,r):function(o,a,u){return Hi(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(n,e,t)}function HI(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),o=ap(r.transform,i||null);o!=null&&(t===null&&(t=Le.empty()),t.set(r.field,o))}return t||null}function Yd(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&bn(r,i,(o,a)=>GI(o,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var en=class extends Vn{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},ht=class extends Vn{constructor(e,t,r,i,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}};function dp(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function Jd(n,e,t){let r=new Map;Q(n.length===t.length,32656,{Ve:t.length,me:n.length});for(let i=0;i<t.length;i++){let o=n[i],a=o.transform,u=e.data.field(o.field);r.set(o.field,WI(a,u,t[i]))}return r}function Xd(n,e,t){let r=new Map;for(let i of n){let o=i.transform,a=t.data.field(i.field);r.set(i.field,zI(o,a,e))}return r}var is=class extends Vn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},ac=class extends Vn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var cc=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let o=this.mutations[i];o.key.isEqual(e.key)&&KI(o,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=kr(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=kr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=sp();return this.mutations.forEach(i=>{let o=e.get(i.key),a=o.overlayedDocument,u=this.applyToLocalView(a,o.mutatedFields);u=t.has(i.key)?null:u;let h=hp(a,u);h!==null&&r.set(i.key,h),a.isValidDocument()||a.convertToNoDocument(q.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),G())}isEqual(e){return this.batchId===e.batchId&&bn(this.mutations,e.mutations,(t,r)=>Yd(t,r))&&bn(this.baseMutations,e.baseMutations,(t,r)=>Yd(t,r))}},uc=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Q(e.mutations.length===r.length,58842,{fe:e.mutations.length,ge:r.length});let i=function(){return UI}(),o=e.mutations;for(let a=0;a<o.length;a++)i=i.insert(o[a].key,r[a].version);return new n(e,t,r,i)}};var lc=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var hc=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var se,K;function QI(n){switch(n){case C.OK:return L(64938);case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0;default:return L(15467,{code:n})}}function fp(n){if(n===void 0)return ot("GRPC error has no .code"),C.UNKNOWN;switch(n){case se.OK:return C.OK;case se.CANCELLED:return C.CANCELLED;case se.UNKNOWN:return C.UNKNOWN;case se.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case se.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case se.INTERNAL:return C.INTERNAL;case se.UNAVAILABLE:return C.UNAVAILABLE;case se.UNAUTHENTICATED:return C.UNAUTHENTICATED;case se.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case se.NOT_FOUND:return C.NOT_FOUND;case se.ALREADY_EXISTS:return C.ALREADY_EXISTS;case se.PERMISSION_DENIED:return C.PERMISSION_DENIED;case se.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case se.ABORTED:return C.ABORTED;case se.OUT_OF_RANGE:return C.OUT_OF_RANGE;case se.UNIMPLEMENTED:return C.UNIMPLEMENTED;case se.DATA_LOSS:return C.DATA_LOSS;default:return L(39323,{code:n})}}(K=se||(se={}))[K.OK=0]="OK",K[K.CANCELLED=1]="CANCELLED",K[K.UNKNOWN=2]="UNKNOWN",K[K.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",K[K.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",K[K.NOT_FOUND=5]="NOT_FOUND",K[K.ALREADY_EXISTS=6]="ALREADY_EXISTS",K[K.PERMISSION_DENIED=7]="PERMISSION_DENIED",K[K.UNAUTHENTICATED=16]="UNAUTHENTICATED",K[K.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",K[K.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",K[K.ABORTED=10]="ABORTED",K[K.OUT_OF_RANGE=11]="OUT_OF_RANGE",K[K.UNIMPLEMENTED=12]="UNIMPLEMENTED",K[K.INTERNAL=13]="INTERNAL",K[K.UNAVAILABLE=14]="UNAVAILABLE",K[K.DATA_LOSS=15]="DATA_LOSS";var Zd=null;var YI=new rt([4294967295,4294967295],0);function ef(n){let e=Sf().encode(n),t=new Ra;return t.update(e),new Uint8Array(t.digest())}function tf(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new rt([t,r],0),new rt([i,o],0)]}var dc=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Kt(`Invalid padding: ${t}`);if(r<0)throw new Kt(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Kt(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Kt(`Invalid padding when bitmap length is 0: ${t}`);this.pe=8*e.length-t,this.ye=rt.fromNumber(this.pe)}we(e,t,r){let i=e.add(t.multiply(rt.fromNumber(r)));return i.compare(YI)===1&&(i=new rt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ye).toNumber()}be(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.pe===0)return!1;let t=ef(e),[r,i]=tf(t);for(let o=0;o<this.hashCount;o++){let a=this.we(r,i,o);if(!this.be(a))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new n(o,i,t);return r.forEach(u=>a.insert(u)),a}insert(e){if(this.pe===0)return;let t=ef(e),[r,i]=tf(t);for(let o=0;o<this.hashCount;o++){let a=this.we(r,i,o);this.Se(a)}}Se(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Kt=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var ss=class n{constructor(e,t,r,i,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Lr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(q.min(),i,new ie(z),lt(),G())}},Lr=class n{constructor(e,t,r,i,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,G(),G(),G())}};var wn=class{constructor(e,t,r,i){this.De=e,this.removedTargetIds=t,this.key=r,this.ve=i}},os=class{constructor(e,t){this.targetId=e,this.Ce=t}},as=class{constructor(e,t,r=ye.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},cs=class{constructor(){this.Fe=0,this.Me=nf(),this.xe=ye.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return this.Fe!==0}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=G(),t=G(),r=G();return this.Me.forEach((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:L(38017,{changeType:o})}}),new Lr(this.xe,this.Oe,e,t,r)}Qe(){this.Ne=!1,this.Me=nf()}$e(e,t){this.Ne=!0,this.Me=this.Me.insert(e,t)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,Q(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}},fc=class{constructor(e){this.ze=e,this.je=new Map,this.He=lt(),this.Je=zi(),this.Ye=zi(),this.Ze=new ie(z)}Xe(e){for(let t of e.De)e.ve&&e.ve.isFoundDocument()?this.et(t,e.ve):this.tt(t,e.key,e.ve);for(let t of e.removedTargetIds)this.tt(t,e.key,e.ve)}nt(e){this.forEachTarget(e,t=>{let r=this.rt(t);switch(e.state){case 0:this.it(t)&&r.ke(e.resumeToken);break;case 1:r.We(),r.Be||r.Qe(),r.ke(e.resumeToken);break;case 2:r.We(),r.Be||this.removeTarget(t);break;case 3:this.it(t)&&(r.Ge(),r.ke(e.resumeToken));break;case 4:this.it(t)&&(this.st(t),r.ke(e.resumeToken));break;default:L(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.je.forEach((r,i)=>{this.it(i)&&t(i)})}ot(e){let t=e.targetId,r=e.Ce.count,i=this._t(t);if(i){let o=i.target;if(ic(o))if(r===0){let a=new M(o.path);this.tt(t,a,Me.newNoDocument(a,q.min()))}else Q(r===1,20013,{expectedCount:r});else{let a=this.ut(t);if(a!==r){let u=this.ct(e),h=u?this.lt(u,e,a):1;if(h!==0){this.st(t);let d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,d)}Zd?.ht(function(p,v,E,R,N){var x,k,$,U,j,J;let ve={localCacheCount:p,existenceFilterCount:v.count,databaseId:E.database,projectId:E.projectId},Y=v.unchangedNames;return Y&&(ve.bloomFilter={applied:N===0,hashCount:(x=Y?.hashCount)!==null&&x!==void 0?x:0,bitmapLength:(U=($=(k=Y?.bits)===null||k===void 0?void 0:k.bitmap)===null||$===void 0?void 0:$.length)!==null&&U!==void 0?U:0,padding:(J=(j=Y?.bits)===null||j===void 0?void 0:j.padding)!==null&&J!==void 0?J:0,mightContain:w=>{var m;return(m=R?.mightContain(w))!==null&&m!==void 0&&m}}),ve}(a,e.Ce,this.ze.Pt(),u,h))}}}}ct(e){let t=e.Ce.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=t,a,u;try{a=ct(r).toUint8Array()}catch(h){if(h instanceof es)return An("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new dc(a,i,o)}catch(h){return An(h instanceof Kt?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.pe===0?null:u}lt(e,t,r){return t.Ce.count===r-this.Tt(e,t.targetId)?0:2}Tt(e,t){let r=this.ze.getRemoteKeysForTarget(t),i=0;return r.forEach(o=>{let a=this.ze.Pt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.tt(t,o,null),i++)}),i}It(e){let t=new Map;this.je.forEach((o,a)=>{let u=this._t(a);if(u){if(o.current&&ic(u.target)){let h=new M(u.target.path);this.Et(h).has(a)||this.dt(a,h)||this.tt(a,h,Me.newNoDocument(h,e))}o.Le&&(t.set(a,o.qe()),o.Qe())}});let r=G();this.Ye.forEach((o,a)=>{let u=!0;a.forEachWhile(h=>{let d=this._t(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(r=r.add(o))}),this.He.forEach((o,a)=>a.setReadTime(e));let i=new ss(e,t,this.Ze,this.He,r);return this.He=lt(),this.Je=zi(),this.Ye=zi(),this.Ze=new ie(z),i}et(e,t){if(!this.it(e))return;let r=this.dt(e,t.key)?2:0;this.rt(e).$e(t.key,r),this.He=this.He.insert(t.key,t),this.Je=this.Je.insert(t.key,this.Et(t.key).add(e)),this.Ye=this.Ye.insert(t.key,this.At(t.key).add(e))}tt(e,t,r){if(!this.it(e))return;let i=this.rt(e);this.dt(e,t)?i.$e(t,1):i.Ue(t),this.Ye=this.Ye.insert(t,this.At(t).delete(e)),this.Ye=this.Ye.insert(t,this.At(t).add(e)),r&&(this.He=this.He.insert(t,r))}removeTarget(e){this.je.delete(e)}ut(e){let t=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let t=this.je.get(e);return t||(t=new cs,this.je.set(e,t)),t}At(e){let t=this.Ye.get(e);return t||(t=new le(z),this.Ye=this.Ye.insert(e,t)),t}Et(e){let t=this.Je.get(e);return t||(t=new le(z),this.Je=this.Je.insert(e,t)),t}it(e){let t=this._t(e)!==null;return t||O("WatchChangeAggregator","Detected inactive target",e),t}_t(e){let t=this.je.get(e);return t&&t.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new cs),this.ze.getRemoteKeysForTarget(e).forEach(t=>{this.tt(e,t,null)})}dt(e,t){return this.ze.getRemoteKeysForTarget(e).has(t)}};function zi(){return new ie(M.comparator)}function nf(){return new ie(M.comparator)}var JI={asc:"ASCENDING",desc:"DESCENDING"},XI={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ZI={and:"AND",or:"OR"},pc=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function mc(n,e){return n.useProto3Json||ks(e)?e:{value:e}}function us(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function pp(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function eE(n,e){return us(n,e.toTimestamp())}function Ge(n){return Q(!!n,49232),q.fromTimestamp(function(t){let r=at(t);return new de(r.seconds,r.nanos)}(n))}function ku(n,e){return gc(n,e).canonicalString()}function gc(n,e){let t=function(i){return new re(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function mp(n){let e=re.fromString(n);return Q(Ip(e),10190,{key:e.toString()}),e}function _c(n,e){return ku(n.databaseId,e.path)}function Oa(n,e){let t=mp(e);if(t.get(1)!==n.databaseId.projectId)throw new V(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new V(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new M(_p(t))}function gp(n,e){return ku(n.databaseId,e)}function tE(n){let e=mp(n);return e.length===4?re.emptyPath():_p(e)}function yc(n){return new re(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function _p(n){return Q(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function rf(n,e,t){return{name:_c(n,e),fields:t.value.mapValue.fields}}function nE(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:L(39313,{state:d})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(d,p){return d.useProto3Json?(Q(p===void 0||typeof p=="string",58123),ye.fromBase64String(p||"")):(Q(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),ye.fromUint8Array(p||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(d){let p=d.code===void 0?C.UNKNOWN:fp(d.code);return new V(p,d.message||"")}(a);t=new as(r,i,o,u||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Oa(n,r.document.name),o=Ge(r.document.updateTime),a=r.document.createTime?Ge(r.document.createTime):q.min(),u=new Le({mapValue:{fields:r.document.fields}}),h=Me.newFoundDocument(i,o,a,u),d=r.targetIds||[],p=r.removedTargetIds||[];t=new wn(d,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Oa(n,r.document),o=r.readTime?Ge(r.readTime):q.min(),a=Me.newNoDocument(i,o),u=r.removedTargetIds||[];t=new wn([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Oa(n,r.document),o=r.removedTargetIds||[];t=new wn([],o,i,null)}else{if(!("filter"in e))return L(11601,{Vt:e});{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:o}=r,a=new hc(i,o),u=r.targetId;t=new os(u,a)}}return t}function rE(n,e){let t;if(e instanceof en)t={update:rf(n,e.key,e.value)};else if(e instanceof is)t={delete:_c(n,e.key)};else if(e instanceof ht)t={update:rf(n,e.key,e.data),updateMask:dE(e.fieldMask)};else{if(!(e instanceof ac))return L(16599,{ft:e.type});t={verify:_c(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(o,a){let u=a.transform;if(u instanceof On)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Xt)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Zt)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof xn)return{fieldPath:a.field.canonicalString(),increment:u.Re};throw L(20930,{transform:a.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,o){return o.updateTime!==void 0?{updateTime:eE(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:L(27497)}(n,e.precondition)),t}function iE(n,e){return n&&n.length>0?(Q(e!==void 0,14353),n.map(t=>function(i,o){let a=i.updateTime?Ge(i.updateTime):Ge(o);return a.isEqual(q.min())&&(a=Ge(o)),new oc(a,i.transformResults||[])}(t,e))):[]}function sE(n,e){return{documents:[gp(n,e.path)]}}function oE(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=gp(n,i);let o=function(d){if(d.length!==0)return vp(He.create(d,"and"))}(e.filters);o&&(t.structuredQuery.where=o);let a=function(d){if(d.length!==0)return d.map(p=>function(E){return{field:vn(E.field),direction:uE(E.dir)}}(p))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);let u=mc(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{gt:t,parent:i}}function aE(n){let e=tE(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){Q(r===1,65062);let p=t.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let o=[];t.where&&(o=function(v){let E=yp(v);return E instanceof He&&Jf(E)?E.getFilters():[E]}(t.where));let a=[];t.orderBy&&(a=function(v){return v.map(E=>function(N){return new kn(In(N.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(N.direction))}(E))}(t.orderBy));let u=null;t.limit&&(u=function(v){let E;return E=typeof v=="object"?v.value:v,ks(E)?null:E}(t.limit));let h=null;t.startAt&&(h=function(v){let E=!!v.before,R=v.values||[];return new Cn(R,E)}(t.startAt));let d=null;return t.endAt&&(d=function(v){let E=!v.before,R=v.values||[];return new Cn(R,E)}(t.endAt)),OI(e,i,a,o,u,"F",h,d)}function cE(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L(28987,{purpose:i})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function yp(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=In(t.unaryFilter.field);return ae.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=In(t.unaryFilter.field);return ae.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let o=In(t.unaryFilter.field);return ae.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=In(t.unaryFilter.field);return ae.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return L(61313);default:return L(60726)}}(n):n.fieldFilter!==void 0?function(t){return ae.create(In(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return L(58110);default:return L(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return He.create(t.compositeFilter.filters.map(r=>yp(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return L(1026)}}(t.compositeFilter.op))}(n):L(30097,{filter:n})}function uE(n){return JI[n]}function lE(n){return XI[n]}function hE(n){return ZI[n]}function vn(n){return{fieldPath:n.canonicalString()}}function In(n){return Se.fromServerFormat(n.fieldPath)}function vp(n){return n instanceof ae?function(t){if(t.op==="=="){if(zd(t.value))return{unaryFilter:{field:vn(t.field),op:"IS_NAN"}};if(jd(t.value))return{unaryFilter:{field:vn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(zd(t.value))return{unaryFilter:{field:vn(t.field),op:"IS_NOT_NAN"}};if(jd(t.value))return{unaryFilter:{field:vn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:vn(t.field),op:lE(t.op),value:t.value}}}(n):n instanceof He?function(t){let r=t.getFilters().map(i=>vp(i));return r.length===1?r[0]:{compositeFilter:{op:hE(t.op),filters:r}}}(n):L(54877,{filter:n})}function dE(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Ip(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Mr=class n{constructor(e,t,r,i,o=q.min(),a=q.min(),u=ye.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var vc=class{constructor(e){this.wt=e}};function fE(n){let e=aE({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?sc(e,e.limit,"L"):e}var ls=class{constructor(){}vt(e,t){this.Ct(e,t),t.Ft()}Ct(e,t){if("nullValue"in e)this.Mt(t,5);else if("booleanValue"in e)this.Mt(t,10),t.xt(e.booleanValue?1:0);else if("integerValue"in e)this.Mt(t,15),t.xt(ee(e.integerValue));else if("doubleValue"in e){let r=ee(e.doubleValue);isNaN(r)?this.Mt(t,13):(this.Mt(t,15),Or(r)?t.xt(0):t.xt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Mt(t,20),typeof r=="string"&&(r=at(r)),t.Ot(`${r.seconds||""}`),t.xt(r.nanos||0)}else if("stringValue"in e)this.Nt(e.stringValue,t),this.Bt(t);else if("bytesValue"in e)this.Mt(t,30),t.Lt(ct(e.bytesValue)),this.Bt(t);else if("referenceValue"in e)this.kt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Mt(t,45),t.xt(r.latitude||0),t.xt(r.longitude||0)}else"mapValue"in e?Hf(e)?this.Mt(t,Number.MAX_SAFE_INTEGER):Kf(e)?this.qt(e.mapValue,t):(this.Qt(e.mapValue,t),this.Bt(t)):"arrayValue"in e?(this.$t(e.arrayValue,t),this.Bt(t)):L(19022,{Ut:e})}Nt(e,t){this.Mt(t,25),this.Kt(e,t)}Kt(e,t){t.Ot(e)}Qt(e,t){let r=e.fields||{};this.Mt(t,55);for(let i of Object.keys(r))this.Nt(i,t),this.Ct(r[i],t)}qt(e,t){var r,i;let o=e.fields||{};this.Mt(t,53);let a=Sn,u=((i=(r=o[a].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.Mt(t,15),t.xt(ee(u)),this.Nt(a,t),this.Ct(o[a],t)}$t(e,t){let r=e.values||[];this.Mt(t,50);for(let i of r)this.Ct(i,t)}kt(e,t){this.Mt(t,37),M.fromName(e).path.forEach(r=>{this.Mt(t,60),this.Kt(r,t)})}Mt(e,t){e.xt(t)}Bt(e){e.xt(2)}};ls.Wt=new ls;var Ic=class{constructor(){this.Cn=new Ec}addToCollectionParentIndex(e,t){return this.Cn.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(Jt.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(Jt.min())}updateCollectionGroup(e,t,r){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}},Ec=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new le(re.comparator),o=!i.has(r);return this.index[t]=i.add(r),o}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new le(re.comparator)).toArray()}};var yb=new Uint8Array(0);var sf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ep=41943040,ke=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};ke.DEFAULT_COLLECTION_PERCENTILE=10,ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ke.DEFAULT=new ke(Ep,ke.DEFAULT_COLLECTION_PERCENTILE,ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ke.DISABLED=new ke(-1,0,0);var Fr=class n{constructor(e){this.ur=e}next(){return this.ur+=2,this.ur}static cr(){return new n(0)}static lr(){return new n(-1)}};var of="LruGarbageCollector",pE=1048576;function af([n,e],[t,r]){let i=z(n,t);return i===0?z(e,r):i}var wc=class{constructor(e){this.Er=e,this.buffer=new le(af),this.dr=0}Ar(){return++this.dr}Rr(e){let t=[e,this.Ar()];if(this.buffer.size<this.Er)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();af(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},Tc=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Vr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.mr(6e4)}stop(){this.Vr&&(this.Vr.cancel(),this.Vr=null)}get started(){return this.Vr!==null}mr(e){O(of,`Garbage collection scheduled in ${e}ms`),this.Vr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>y(this,null,function*(){this.Vr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){qn(t)?O(of,"Ignoring IndexedDB error during garbage collection: ",t):yield Bn(t)}yield this.mr(3e5)}))}},Ac=class{constructor(e,t){this.gr=e,this.params=t}calculateTargetCount(e,t){return this.gr.pr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return P.resolve(Iu.le);let r=new wc(t);return this.gr.forEachTarget(e,i=>r.Rr(i.sequenceNumber)).next(()=>this.gr.yr(e,i=>r.Rr(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.gr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.gr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(O("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(sf)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(O("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),sf):this.wr(e,t))}getCacheSize(e){return this.gr.getCacheSize(e)}wr(e,t){let r,i,o,a,u,h,d,p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(v=>(v>this.params.maximumSequenceNumbersToCollect?(O("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${v}`),i=this.params.maximumSequenceNumbersToCollect):i=v,a=Date.now(),this.nthSequenceNumber(e,i))).next(v=>(r=v,u=Date.now(),this.removeTargets(e,r,t))).next(v=>(o=v,h=Date.now(),this.removeOrphanedDocuments(e,r))).next(v=>(d=Date.now(),_n()<=W.DEBUG&&O("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${v} documents in `+(d-h)+`ms
Total Duration: ${d-p}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:v})))}};function mE(n,e){return new Ac(n,e)}var bc=class{constructor(){this.changes=new ut(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Me.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?P.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Sc=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Rc=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&kr(r.mutation,i,je.empty(),de.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,G()).next(()=>r))}getLocalViewOfDocuments(e,t,r=G()){let i=Gt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(o=>{let a=Sr();return o.forEach((u,h)=>{a=a.insert(u,h.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let r=Gt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,G()))}populateOverlays(e,t,r){let i=[];return r.forEach(o=>{t.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(e,i).next(o=>{o.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,r,i){let o=lt(),a=Cr(),u=function(){return Cr()}();return t.forEach((h,d)=>{let p=r.get(d.key);i.has(d.key)&&(p===void 0||p.mutation instanceof ht)?o=o.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),kr(p.mutation,d,p.mutation.getFieldMask(),de.now())):a.set(d.key,je.empty())}),this.recalculateAndSaveOverlays(e,o).next(h=>(h.forEach((d,p)=>a.set(d,p)),t.forEach((d,p)=>{var v;return u.set(d,new Sc(p,(v=a.get(d))!==null&&v!==void 0?v:null))}),u))}recalculateAndSaveOverlays(e,t){let r=Cr(),i=new ie((a,u)=>a-u),o=G();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let u of a)u.keys().forEach(h=>{let d=t.get(h);if(d===null)return;let p=r.get(h)||je.empty();p=u.applyToLocalView(d,p),r.set(h,p);let v=(i.get(u.batchId)||G()).add(h);i=i.insert(u.batchId,v)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let h=u.getNext(),d=h.key,p=h.value,v=sp();p.forEach(E=>{if(!o.has(E)){let R=hp(t.get(E),r.get(E));R!==null&&v.set(E,R),o=o.add(E)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,v))}return P.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(a){return M.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):xI(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(o=>{let a=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-o.size):P.resolve(Gt()),u=Nr,h=o;return a.next(d=>P.forEach(d,(p,v)=>(u<v.largestBatchId&&(u=v.largestBatchId),o.get(p)?P.resolve():this.remoteDocumentCache.getEntry(e,p).next(E=>{h=h.insert(p,E)}))).next(()=>this.populateOverlays(e,d,o)).next(()=>this.computeViews(e,h,d,G())).next(p=>({batchId:u,changes:ip(p)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new M(t)).next(r=>{let i=Sr();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let o=t.collectionGroup,a=Sr();return this.indexManager.getCollectionParents(e,o).next(u=>P.forEach(u,h=>{let d=function(v,E){return new Dn(E,null,v.explicitOrderBy.slice(),v.filters.slice(),v.limit,v.limitType,v.startAt,v.endAt)}(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,d,r,i).next(p=>{p.forEach((v,E)=>{a=a.insert(v,E)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,i))).next(a=>{o.forEach((h,d)=>{let p=d.getKey();a.get(p)===null&&(a=a.insert(p,Me.newInvalidDocument(p)))});let u=Sr();return a.forEach((h,d)=>{let p=o.get(h);p!==void 0&&kr(p.mutation,d,je.empty(),de.now()),Os(t,d)&&(u=u.insert(h,d))}),u})}};var Pc=class{constructor(e){this.serializer=e,this.kr=new Map,this.qr=new Map}getBundleMetadata(e,t){return P.resolve(this.kr.get(t))}saveBundleMetadata(e,t){return this.kr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Ge(i.createTime)}}(t)),P.resolve()}getNamedQuery(e,t){return P.resolve(this.qr.get(t))}saveNamedQuery(e,t){return this.qr.set(t.name,function(i){return{name:i.name,query:fE(i.bundledQuery),readTime:Ge(i.readTime)}}(t)),P.resolve()}};var Cc=class{constructor(){this.overlays=new ie(M.comparator),this.Qr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Gt();return P.forEach(t,i=>this.getOverlay(e,i).next(o=>{o!==null&&r.set(i,o)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,o)=>{this.St(e,t,o)}),P.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.Qr.get(r);return i!==void 0&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.Qr.delete(r)),P.resolve()}getOverlaysForCollection(e,t,r){let i=Gt(),o=t.length+1,a=new M(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let h=u.getNext().value,d=h.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===o&&h.largestBatchId>r&&i.set(h.getKey(),h)}return P.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let o=new ie((d,p)=>d-p),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let p=o.get(d.largestBatchId);p===null&&(p=Gt(),o=o.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}let u=Gt(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((d,p)=>u.set(d,p)),!(u.size()>=i)););return P.resolve(u)}St(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let a=this.Qr.get(i.largestBatchId).delete(r.key);this.Qr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new lc(t,r));let o=this.Qr.get(t);o===void 0&&(o=G(),this.Qr.set(t,o)),this.Qr.set(t,o.add(r.key))}};var kc=class{constructor(){this.sessionToken=ye.EMPTY_BYTE_STRING}getSessionToken(e){return P.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,P.resolve()}};var Ur=class{constructor(){this.$r=new le(oe.Ur),this.Kr=new le(oe.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(e,t){let r=new oe(e,t);this.$r=this.$r.add(r),this.Kr=this.Kr.add(r)}Gr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.zr(new oe(e,t))}jr(e,t){e.forEach(r=>this.removeReference(r,t))}Hr(e){let t=new M(new re([])),r=new oe(t,e),i=new oe(t,e+1),o=[];return this.Kr.forEachInRange([r,i],a=>{this.zr(a),o.push(a.key)}),o}Jr(){this.$r.forEach(e=>this.zr(e))}zr(e){this.$r=this.$r.delete(e),this.Kr=this.Kr.delete(e)}Yr(e){let t=new M(new re([])),r=new oe(t,e),i=new oe(t,e+1),o=G();return this.Kr.forEachInRange([r,i],a=>{o=o.add(a.key)}),o}containsKey(e){let t=new oe(e,0),r=this.$r.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},oe=class{constructor(e,t){this.key=e,this.Zr=t}static Ur(e,t){return M.comparator(e.key,t.key)||z(e.Zr,t.Zr)}static Wr(e,t){return z(e.Zr,t.Zr)||M.comparator(e.key,t.key)}};var Dc=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nr=1,this.Xr=new le(oe.Ur)}checkEmpty(e){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let o=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new cc(o,t,r,i);this.mutationQueue.push(a);for(let u of i)this.Xr=this.Xr.add(new oe(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return P.resolve(a)}lookupMutationBatch(e,t){return P.resolve(this.ei(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.ti(r),o=i<0?0:i;return P.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?Eu:this.nr-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new oe(t,0),i=new oe(t,Number.POSITIVE_INFINITY),o=[];return this.Xr.forEachInRange([r,i],a=>{let u=this.ei(a.Zr);o.push(u)}),P.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new le(z);return t.forEach(i=>{let o=new oe(i,0),a=new oe(i,Number.POSITIVE_INFINITY);this.Xr.forEachInRange([o,a],u=>{r=r.add(u.Zr)})}),P.resolve(this.ni(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,o=r;M.isDocumentKey(o)||(o=o.child(""));let a=new oe(new M(o),0),u=new le(z);return this.Xr.forEachWhile(h=>{let d=h.key.path;return!!r.isPrefixOf(d)&&(d.length===i&&(u=u.add(h.Zr)),!0)},a),P.resolve(this.ni(u))}ni(e){let t=[];return e.forEach(r=>{let i=this.ei(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){Q(this.ri(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Xr;return P.forEach(t.mutations,i=>{let o=new oe(i.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Xr=r})}sr(e){}containsKey(e,t){let r=new oe(t,0),i=this.Xr.firstAfterOrEqual(r);return P.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,P.resolve()}ri(e,t){return this.ti(e)}ti(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}ei(e){let t=this.ti(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Nc=class{constructor(e){this.ii=e,this.docs=function(){return new ie(M.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),o=i?i.size:0,a=this.ii(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return P.resolve(r?r.document.mutableCopy():Me.newInvalidDocument(t))}getEntries(e,t){let r=lt();return t.forEach(i=>{let o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():Me.newInvalidDocument(i))}),P.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let o=lt(),a=t.path,u=new M(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){let{key:d,value:{document:p}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||pI(fI(p),r)<=0||(i.has(p.key)||Os(t,p))&&(o=o.insert(p.key,p.mutableCopy()))}return P.resolve(o)}getAllFromCollectionGroup(e,t,r,i){L(9500)}si(e,t){return P.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Oc(this)}getSize(e){return P.resolve(this.size)}},Oc=class extends bc{constructor(e){super(),this.Br=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Br.addEntry(e,i)):this.Br.removeEntry(r)}),P.waitFor(t)}getFromCache(e,t){return this.Br.getEntry(e,t)}getAllFromCache(e,t){return this.Br.getEntries(e,t)}};var xc=class{constructor(e){this.persistence=e,this.oi=new ut(t=>Su(t),Ru),this.lastRemoteSnapshotVersion=q.min(),this.highestTargetId=0,this._i=0,this.ai=new Ur,this.targetCount=0,this.ui=Fr.cr()}forEachTarget(e,t){return this.oi.forEach((r,i)=>t(i)),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this._i)}allocateTargetId(e){return this.highestTargetId=this.ui.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this._i&&(this._i=t),P.resolve()}Tr(e){this.oi.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ui=new Fr(t),this.highestTargetId=t),e.sequenceNumber>this._i&&(this._i=e.sequenceNumber)}addTargetData(e,t){return this.Tr(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.Tr(t),P.resolve()}removeTargetData(e,t){return this.oi.delete(t.target),this.ai.Hr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,r){let i=0,o=[];return this.oi.forEach((a,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.oi.delete(a),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),P.waitFor(o).next(()=>i)}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){let r=this.oi.get(t)||null;return P.resolve(r)}addMatchingKeys(e,t,r){return this.ai.Gr(t,r),P.resolve()}removeMatchingKeys(e,t,r){this.ai.jr(t,r);let i=this.persistence.referenceDelegate,o=[];return i&&t.forEach(a=>{o.push(i.markPotentiallyOrphaned(e,a))}),P.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.ai.Hr(t),P.resolve()}getMatchingKeysForTargetId(e,t){let r=this.ai.Yr(t);return P.resolve(r)}containsKey(e,t){return P.resolve(this.ai.containsKey(t))}};var hs=class{constructor(e,t){this.ci={},this.overlays={},this.li=new Iu(0),this.hi=!1,this.hi=!0,this.Pi=new kc,this.referenceDelegate=e(this),this.Ti=new xc(this),this.indexManager=new Ic,this.remoteDocumentCache=function(i){return new Nc(i)}(r=>this.referenceDelegate.Ii(r)),this.serializer=new vc(t),this.Ei=new Pc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Cc,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ci[e.toKey()];return r||(r=new Dc(t,this.referenceDelegate),this.ci[e.toKey()]=r),r}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(e,t,r){O("MemoryPersistence","Starting transaction:",e);let i=new Vc(this.li.next());return this.referenceDelegate.di(),r(i).next(o=>this.referenceDelegate.Ai(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}Ri(e,t){return P.or(Object.values(this.ci).map(r=>()=>r.containsKey(e,t)))}},Vc=class extends Wa{constructor(e){super(),this.currentSequenceNumber=e}},Lc=class n{constructor(e){this.persistence=e,this.Vi=new Ur,this.mi=null}static fi(e){return new n(e)}get gi(){if(this.mi)return this.mi;throw L(60996)}addReference(e,t,r){return this.Vi.addReference(r,t),this.gi.delete(r.toString()),P.resolve()}removeReference(e,t,r){return this.Vi.removeReference(r,t),this.gi.add(r.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.gi.add(t.toString()),P.resolve()}removeTarget(e,t){this.Vi.Hr(t.targetId).forEach(i=>this.gi.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(o=>this.gi.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}di(){this.mi=new Set}Ai(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.gi,r=>{let i=M.fromPath(r);return this.pi(e,i).next(o=>{o||t.removeEntry(i,q.min())})}).next(()=>(this.mi=null,t.apply(e)))}updateLimboDocument(e,t){return this.pi(e,t).next(r=>{r?this.gi.delete(t.toString()):this.gi.add(t.toString())})}Ii(e){return 0}pi(e,t){return P.or([()=>P.resolve(this.Vi.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ri(e,t)])}},ds=class n{constructor(e,t){this.persistence=e,this.yi=new ut(r=>yI(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=mE(this,t)}static fi(e,t){return new n(e,t)}di(){}Ai(e){return P.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}pr(e){let t=this.br(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}br(e){let t=0;return this.yr(e,r=>{t++}).next(()=>t)}yr(e,t){return P.forEach(this.yi,(r,i)=>this.Dr(e,r,i).next(o=>o?P.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.si(e,a=>this.Dr(e,a,t).next(u=>{u||(r++,o.removeEntry(a,q.min()))})).next(()=>o.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.yi.set(t,e.currentSequenceNumber),P.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.yi.set(r,e.currentSequenceNumber),P.resolve()}removeReference(e,t,r){return this.yi.set(r,e.currentSequenceNumber),P.resolve()}updateLimboDocument(e,t){return this.yi.set(t,e.currentSequenceNumber),P.resolve()}Ii(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Gi(e.data.value)),t}Dr(e,t,r){return P.or([()=>this.persistence.Ri(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.yi.get(t);return P.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var Mc=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.ds=r,this.As=i}static Rs(e,t){let r=G(),i=G();for(let o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new n(e,t.fromCache,r,i)}};var Fc=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Uc=class{constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=function(){return fh()?8:gI(ce())>0?6:4}()}initialize(e,t){this.ys=e,this.indexManager=t,this.Vs=!0}getDocumentsMatchingQuery(e,t,r,i){let o={result:null};return this.ws(e,t).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.bs(e,t,i,r).next(a=>{o.result=a})}).next(()=>{if(o.result)return;let a=new Fc;return this.Ss(e,t,a).next(u=>{if(o.result=u,this.fs)return this.Ds(e,t,a,u.size)})}).next(()=>o.result)}Ds(e,t,r,i){return r.documentReadCount<this.gs?(_n()<=W.DEBUG&&O("QueryEngine","SDK will not create cache indexes for query:",yn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),P.resolve()):(_n()<=W.DEBUG&&O("QueryEngine","Query:",yn(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.ps*i?(_n()<=W.DEBUG&&O("QueryEngine","The SDK decides to create cache indexes for query:",yn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,We(t))):P.resolve())}ws(e,t){if(Hd(t))return P.resolve(null);let r=We(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=sc(t,null,"F"),r=We(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(o=>{let a=G(...o);return this.ys.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,r).next(h=>{let d=this.vs(t,u);return this.Cs(t,d,a,h.readTime)?this.ws(e,sc(t,null,"F")):this.Fs(e,d,t,h)}))})))}bs(e,t,r,i){return Hd(t)||i.isEqual(q.min())?P.resolve(null):this.ys.getDocuments(e,r).next(o=>{let a=this.vs(t,o);return this.Cs(t,a,r,i)?P.resolve(null):(_n()<=W.DEBUG&&O("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),yn(t)),this.Fs(e,a,t,dI(i,Nr)).next(u=>u))})}vs(e,t){let r=new le(np(e));return t.forEach((i,o)=>{Os(e,o)&&(r=r.add(o))}),r}Cs(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Ss(e,t,r){return _n()<=W.DEBUG&&O("QueryEngine","Using full collection scan to execute query:",yn(t)),this.ys.getDocumentsMatchingQuery(e,t,Jt.min(),r)}Fs(e,t,r,i){return this.ys.getDocumentsMatchingQuery(e,r,i).next(o=>(t.forEach(a=>{o=o.insert(a.key,a)}),o))}};var Du="LocalStore",gE=3e8,Bc=class{constructor(e,t,r,i){this.persistence=e,this.Ms=t,this.serializer=i,this.xs=new ie(z),this.Os=new ut(o=>Su(o),Ru),this.Ns=new Map,this.Bs=e.getRemoteDocumentCache(),this.Ti=e.getTargetCache(),this.Ei=e.getBundleCache(),this.Ls(r)}Ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Rc(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.xs))}};function _E(n,e,t,r){return new Bc(n,e,t,r)}function wp(n,e){return y(this,null,function*(){let t=B(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(o=>(i=o,t.Ls(e),t.mutationQueue.getAllMutationBatches(r))).next(o=>{let a=[],u=[],h=G();for(let d of i){a.push(d.batchId);for(let p of d.mutations)h=h.add(p.key)}for(let d of o){u.push(d.batchId);for(let p of d.mutations)h=h.add(p.key)}return t.localDocuments.getDocuments(r,h).next(d=>({ks:d,removedBatchIds:a,addedBatchIds:u}))})})})}function yE(n,e){let t=B(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),o=t.Bs.newChangeBuffer({trackRemovals:!0});return function(u,h,d,p){let v=d.batch,E=v.keys(),R=P.resolve();return E.forEach(N=>{R=R.next(()=>p.getEntry(h,N)).next(x=>{let k=d.docVersions.get(N);Q(k!==null,48541),x.version.compareTo(k)<0&&(v.applyToRemoteDocument(x,d),x.isValidDocument()&&(x.setReadTime(d.commitVersion),p.addEntry(x)))})}),R.next(()=>u.mutationQueue.removeMutationBatch(h,v))}(t,r,e,o).next(()=>o.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(u){let h=G();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(h=h.add(u.batch.mutations[d].key));return h}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Tp(n){let e=B(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ti.getLastRemoteSnapshotVersion(t))}function vE(n,e){let t=B(n),r=e.snapshotVersion,i=t.xs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{let a=t.Bs.newChangeBuffer({trackRemovals:!0});i=t.xs;let u=[];e.targetChanges.forEach((p,v)=>{let E=i.get(v);if(!E)return;u.push(t.Ti.removeMatchingKeys(o,p.removedDocuments,v).next(()=>t.Ti.addMatchingKeys(o,p.addedDocuments,v)));let R=E.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(v)!==null?R=R.withResumeToken(ye.EMPTY_BYTE_STRING,q.min()).withLastLimboFreeSnapshotVersion(q.min()):p.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(p.resumeToken,r)),i=i.insert(v,R),function(x,k,$){return x.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=gE?!0:$.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size>0}(E,R,p)&&u.push(t.Ti.updateTargetData(o,R))});let h=lt(),d=G();if(e.documentUpdates.forEach(p=>{e.resolvedLimboDocuments.has(p)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(o,p))}),u.push(IE(o,a,e.documentUpdates).next(p=>{h=p.qs,d=p.Qs})),!r.isEqual(q.min())){let p=t.Ti.getLastRemoteSnapshotVersion(o).next(v=>t.Ti.setTargetsMetadata(o,o.currentSequenceNumber,r));u.push(p)}return P.waitFor(u).next(()=>a.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,h,d)).next(()=>h)}).then(o=>(t.xs=i,o))}function IE(n,e,t){let r=G(),i=G();return t.forEach(o=>r=r.add(o)),e.getEntries(n,r).next(o=>{let a=lt();return t.forEach((u,h)=>{let d=o.get(u);h.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(u)),h.isNoDocument()&&h.version.isEqual(q.min())?(e.removeEntry(u,h.readTime),a=a.insert(u,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(h),a=a.insert(u,h)):O(Du,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",h.version)}),{qs:a,Qs:i}})}function EE(n,e){let t=B(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Eu),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function wE(n,e){let t=B(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Ti.getTargetData(r,e).next(o=>o?(i=o,P.resolve(i)):t.Ti.allocateTargetId(r).next(a=>(i=new Mr(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Ti.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.xs.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.xs=t.xs.insert(r.targetId,r),t.Os.set(e,r.targetId)),r})}function qc(n,e,t){return y(this,null,function*(){let r=B(n),i=r.xs.get(e),o=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",o,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!qn(a))throw a;O(Du,`Failed to update sequence numbers for target ${e}: ${a}`)}r.xs=r.xs.remove(e),r.Os.delete(i.target)})}function cf(n,e,t){let r=B(n),i=q.min(),o=G();return r.persistence.runTransaction("Execute query","readwrite",a=>function(h,d,p){let v=B(h),E=v.Os.get(p);return E!==void 0?P.resolve(v.xs.get(E)):v.Ti.getTargetData(d,p)}(r,a,We(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.Ti.getMatchingKeysForTargetId(a,u.targetId).next(h=>{o=h})}).next(()=>r.Ms.getDocumentsMatchingQuery(a,e,t?i:q.min(),t?o:G())).next(u=>(TE(r,LI(e),u),{documents:u,$s:o})))}function TE(n,e,t){let r=n.Ns.get(e)||q.min();t.forEach((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.Ns.set(e,r)}var fs=class{constructor(){this.activeTargetIds=$I()}js(e){this.activeTargetIds=this.activeTargetIds.add(e)}Hs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}zs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var $c=class{constructor(){this.xo=new fs,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.xo.js(e),this.Oo[e]||"not-current"}updateQueryState(e,t,r){this.Oo[e]=t}removeLocalQueryTarget(e){this.xo.Hs(e)}isLocalQueryTarget(e){return this.xo.activeTargetIds.has(e)}clearQueryState(e){delete this.Oo[e]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(e){return this.xo.activeTargetIds.has(e)}start(){return this.xo=new fs,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var jc=class{No(e){}shutdown(){}};var uf="ConnectivityMonitor",ps=class{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(e){this.Qo.push(e)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){O(uf,"Network connectivity changed: AVAILABLE");for(let e of this.Qo)e(0)}qo(){O(uf,"Network connectivity changed: UNAVAILABLE");for(let e of this.Qo)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Wi=null;function zc(){return Wi===null?Wi=function(){return 268435456+Math.round(2147483648*Math.random())}():Wi++,"0x"+Wi.toString(16)}var xa="RestConnection",AE={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},Wc=class{get Uo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Ko=t+"://"+e.host,this.Wo=`projects/${r}/databases/${i}`,this.Go=this.databaseId.database===ts?`project_id=${r}`:`project_id=${r}&database_id=${i}`}zo(e,t,r,i,o){let a=zc(),u=this.jo(e,t.toUriEncodedString());O(xa,`Sending RPC '${e}' ${a}:`,u,r);let h={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(h,i,o);let{host:d}=new URL(u),p=yt(d);return this.Jo(e,u,h,r,p).then(v=>(O(xa,`Received RPC '${e}' ${a}: `,v),v),v=>{throw An(xa,`RPC '${e}' ${a} failed with error: `,v,"url: ",u,"request:",r),v})}Yo(e,t,r,i,o,a){return this.zo(e,t,r,i,o)}Ho(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Un}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,o)=>e[o]=i),r&&r.headers.forEach((i,o)=>e[o]=i)}jo(e,t){let r=AE[e];return`${this.Ko}/v1/${t}:${r}`}terminate(){}};var Gc=class{constructor(e){this.Zo=e.Zo,this.Xo=e.Xo}e_(e){this.t_=e}n_(e){this.r_=e}i_(e){this.s_=e}onMessage(e){this.o_=e}close(){this.Xo()}send(e){this.Zo(e)}__(){this.t_()}a_(){this.r_()}u_(e){this.s_(e)}c_(e){this.o_(e)}};var _e="WebChannelConnection",Kc=class extends Wc{constructor(e){super(e),this.l_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,i,o){let a=zc();return new Promise((u,h)=>{let d=new Pa;d.setWithCredentials(!0),d.listenOnce(Ca.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case br.NO_ERROR:let v=d.getResponseJson();O(_e,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(v)),u(v);break;case br.TIMEOUT:O(_e,`RPC '${e}' ${a} timed out`),h(new V(C.DEADLINE_EXCEEDED,"Request time out"));break;case br.HTTP_ERROR:let E=d.getStatus();if(O(_e,`RPC '${e}' ${a} failed with status:`,E,"response text:",d.getResponseText()),E>0){let R=d.getResponseJson();Array.isArray(R)&&(R=R[0]);let N=R?.error;if(N&&N.status&&N.message){let x=function($){let U=$.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf(U)>=0?U:C.UNKNOWN}(N.status);h(new V(x,N.message))}else h(new V(C.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new V(C.UNAVAILABLE,"Connection failed."));break;default:L(9055,{h_:e,streamId:a,P_:d.getLastErrorCode(),T_:d.getLastError()})}}finally{O(_e,`RPC '${e}' ${a} completed.`)}});let p=JSON.stringify(i);O(_e,`RPC '${e}' ${a} sending request:`,i),d.send(t,"POST",p,r,15)})}I_(e,t,r){let i=zc(),o=[this.Ko,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Na(),u=Da(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(h.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(h.useFetchStreams=!0),this.Ho(h.initMessageHeaders,t,r),h.encodeInitMessageHeaders=!0;let p=o.join("");O(_e,`Creating RPC '${e}' stream ${i}: ${p}`,h);let v=a.createWebChannel(p,h);this.E_(v);let E=!1,R=!1,N=new Gc({Zo:k=>{R?O(_e,`Not sending because RPC '${e}' stream ${i} is closed:`,k):(E||(O(_e,`Opening RPC '${e}' stream ${i} transport.`),v.open(),E=!0),O(_e,`RPC '${e}' stream ${i} sending:`,k),v.send(k))},Xo:()=>v.close()}),x=(k,$,U)=>{k.listen($,j=>{try{U(j)}catch(J){setTimeout(()=>{throw J},0)}})};return x(v,gn.EventType.OPEN,()=>{R||(O(_e,`RPC '${e}' stream ${i} transport opened.`),N.__())}),x(v,gn.EventType.CLOSE,()=>{R||(R=!0,O(_e,`RPC '${e}' stream ${i} transport closed`),N.u_(),this.d_(v))}),x(v,gn.EventType.ERROR,k=>{R||(R=!0,An(_e,`RPC '${e}' stream ${i} transport errored. Name:`,k.name,"Message:",k.message),N.u_(new V(C.UNAVAILABLE,"The operation could not be completed")))}),x(v,gn.EventType.MESSAGE,k=>{var $;if(!R){let U=k.data[0];Q(!!U,16349);let j=U,J=j?.error||(($=j[0])===null||$===void 0?void 0:$.error);if(J){O(_e,`RPC '${e}' stream ${i} received error:`,J);let ve=J.status,Y=function(_){let I=se[_];if(I!==void 0)return fp(I)}(ve),w=J.message;Y===void 0&&(Y=C.INTERNAL,w="Unknown error status: "+ve+" with message "+J.message),R=!0,N.u_(new V(Y,w)),v.close()}else O(_e,`RPC '${e}' stream ${i} received:`,U),N.c_(U)}}),x(u,ka.STAT_EVENT,k=>{k.stat===$i.PROXY?O(_e,`RPC '${e}' stream ${i} detected buffering proxy`):k.stat===$i.NOPROXY&&O(_e,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{N.a_()},0),N}terminate(){this.l_.forEach(e=>e.close()),this.l_=[]}E_(e){this.l_.push(e)}d_(e){this.l_=this.l_.filter(t=>t===e)}};function Va(){return typeof document<"u"?document:null}function xs(n){return new pc(n,!0)}var ms=class{constructor(e,t,r=1e3,i=1.5,o=6e4){this.xi=e,this.timerId=t,this.A_=r,this.R_=i,this.V_=o,this.m_=0,this.f_=null,this.g_=Date.now(),this.reset()}reset(){this.m_=0}p_(){this.m_=this.V_}y_(e){this.cancel();let t=Math.floor(this.m_+this.w_()),r=Math.max(0,Date.now()-this.g_),i=Math.max(0,t-r);i>0&&O("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.m_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.f_=this.xi.enqueueAfterDelay(this.timerId,i,()=>(this.g_=Date.now(),e())),this.m_*=this.R_,this.m_<this.A_&&(this.m_=this.A_),this.m_>this.V_&&(this.m_=this.V_)}b_(){this.f_!==null&&(this.f_.skipDelay(),this.f_=null)}cancel(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}w_(){return(Math.random()-.5)*this.m_}};var lf="PersistentStream",gs=class{constructor(e,t,r,i,o,a,u,h){this.xi=e,this.S_=r,this.D_=i,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.v_=0,this.C_=null,this.F_=null,this.stream=null,this.M_=0,this.x_=new ms(e,t)}O_(){return this.state===1||this.state===5||this.N_()}N_(){return this.state===2||this.state===3}start(){this.M_=0,this.state!==4?this.auth():this.B_()}stop(){return y(this,null,function*(){this.O_()&&(yield this.close(0))})}L_(){this.state=0,this.x_.reset()}k_(){this.N_()&&this.C_===null&&(this.C_=this.xi.enqueueAfterDelay(this.S_,6e4,()=>this.q_()))}Q_(e){this.U_(),this.stream.send(e)}q_(){return y(this,null,function*(){if(this.N_())return this.close(0)})}U_(){this.C_&&(this.C_.cancel(),this.C_=null)}K_(){this.F_&&(this.F_.cancel(),this.F_=null)}close(e,t){return y(this,null,function*(){this.U_(),this.K_(),this.x_.cancel(),this.v_++,e!==4?this.x_.reset():t&&t.code===C.RESOURCE_EXHAUSTED?(ot(t.toString()),ot("Using maximum backoff delay to prevent overloading the backend."),this.x_.p_()):t&&t.code===C.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.i_(t)})}W_(){}auth(){this.state=1;let e=this.G_(this.v_),t=this.v_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.v_===t&&this.z_(r,i)},r=>{e(()=>{let i=new V(C.UNKNOWN,"Fetching auth token failed: "+r.message);return this.j_(i)})})}z_(e,t){let r=this.G_(this.v_);this.stream=this.H_(e,t),this.stream.e_(()=>{r(()=>this.listener.e_())}),this.stream.n_(()=>{r(()=>(this.state=2,this.F_=this.xi.enqueueAfterDelay(this.D_,1e4,()=>(this.N_()&&(this.state=3),Promise.resolve())),this.listener.n_()))}),this.stream.i_(i=>{r(()=>this.j_(i))}),this.stream.onMessage(i=>{r(()=>++this.M_==1?this.J_(i):this.onNext(i))})}B_(){this.state=5,this.x_.y_(()=>y(this,null,function*(){this.state=0,this.start()}))}j_(e){return O(lf,`close with error: ${e}`),this.stream=null,this.close(4,e)}G_(e){return t=>{this.xi.enqueueAndForget(()=>this.v_===e?t():(O(lf,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Hc=class extends gs{constructor(e,t,r,i,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}H_(e,t){return this.connection.I_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.x_.reset();let t=nE(this.serializer,e),r=function(o){if(!("targetChange"in o))return q.min();let a=o.targetChange;return a.targetIds&&a.targetIds.length?q.min():a.readTime?Ge(a.readTime):q.min()}(e);return this.listener.Y_(t,r)}Z_(e){let t={};t.database=yc(this.serializer),t.addTarget=function(o,a){let u,h=a.target;if(u=ic(h)?{documents:sE(o,h)}:{query:oE(o,h).gt},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=pp(o,a.resumeToken);let d=mc(o,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(q.min())>0){u.readTime=us(o,a.snapshotVersion.toTimestamp());let d=mc(o,a.expectedCount);d!==null&&(u.expectedCount=d)}return u}(this.serializer,e);let r=cE(this.serializer,e);r&&(t.labels=r),this.Q_(t)}X_(e){let t={};t.database=yc(this.serializer),t.removeTarget=e,this.Q_(t)}},Qc=class extends gs{constructor(e,t,r,i,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}get ea(){return this.M_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.ea&&this.ta([])}H_(e,t){return this.connection.I_("Write",e,t)}J_(e){return Q(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Q(!e.writeResults||e.writeResults.length===0,55816),this.listener.na()}onNext(e){Q(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.x_.reset();let t=iE(e.writeResults,e.commitTime),r=Ge(e.commitTime);return this.listener.ra(r,t)}ia(){let e={};e.database=yc(this.serializer),this.Q_(e)}ta(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>rE(this.serializer,r))};this.Q_(t)}};var Yc=class{},Jc=class extends Yc{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.sa=!1}oa(){if(this.sa)throw new V(C.FAILED_PRECONDITION,"The client has already been terminated.")}zo(e,t,r,i){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.zo(e,gc(t,r),i,o,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new V(C.UNKNOWN,o.toString())})}Yo(e,t,r,i,o){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Yo(e,gc(t,r),i,a,u,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new V(C.UNKNOWN,a.toString())})}terminate(){this.sa=!0,this.connection.terminate()}},Xc=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this._a=0,this.aa=null,this.ua=!0}ca(){this._a===0&&(this.la("Unknown"),this.aa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.aa=null,this.ha("Backend didn't respond within 10 seconds."),this.la("Offline"),Promise.resolve())))}Pa(e){this.state==="Online"?this.la("Unknown"):(this._a++,this._a>=1&&(this.Ta(),this.ha(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.la("Offline")))}set(e){this.Ta(),this._a=0,e==="Online"&&(this.ua=!1),this.la(e)}la(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ha(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ua?(ot(t),this.ua=!1):O("OnlineStateTracker",t)}Ta(){this.aa!==null&&(this.aa.cancel(),this.aa=null)}};var tn="RemoteStore",Zc=class{constructor(e,t,r,i,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ia=[],this.Ea=new Map,this.da=new Set,this.Aa=[],this.Ra=o,this.Ra.No(a=>{r.enqueueAndForget(()=>y(this,null,function*(){rn(this)&&(O(tn,"Restarting streams for network reachability change."),yield function(h){return y(this,null,function*(){let d=B(h);d.da.add(4),yield zr(d),d.Va.set("Unknown"),d.da.delete(4),yield Vs(d)})}(this))}))}),this.Va=new Xc(r,i)}};function Vs(n){return y(this,null,function*(){if(rn(n))for(let e of n.Aa)yield e(!0)})}function zr(n){return y(this,null,function*(){for(let e of n.Aa)yield e(!1)})}function Ap(n,e){let t=B(n);t.Ea.has(e.targetId)||(t.Ea.set(e.targetId,e),Vu(t)?xu(t):$n(t).N_()&&Ou(t,e))}function Nu(n,e){let t=B(n),r=$n(t);t.Ea.delete(e),r.N_()&&bp(t,e),t.Ea.size===0&&(r.N_()?r.k_():rn(t)&&t.Va.set("Unknown"))}function Ou(n,e){if(n.ma.Ke(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(q.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}$n(n).Z_(e)}function bp(n,e){n.ma.Ke(e),$n(n).X_(e)}function xu(n){n.ma=new fc({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Rt:e=>n.Ea.get(e)||null,Pt:()=>n.datastore.serializer.databaseId}),$n(n).start(),n.Va.ca()}function Vu(n){return rn(n)&&!$n(n).O_()&&n.Ea.size>0}function rn(n){return B(n).da.size===0}function Sp(n){n.ma=void 0}function bE(n){return y(this,null,function*(){n.Va.set("Online")})}function SE(n){return y(this,null,function*(){n.Ea.forEach((e,t)=>{Ou(n,e)})})}function RE(n,e){return y(this,null,function*(){Sp(n),Vu(n)?(n.Va.Pa(e),xu(n)):n.Va.set("Unknown")})}function PE(n,e,t){return y(this,null,function*(){if(n.Va.set("Online"),e instanceof as&&e.state===2&&e.cause)try{yield function(i,o){return y(this,null,function*(){let a=o.cause;for(let u of o.targetIds)i.Ea.has(u)&&(yield i.remoteSyncer.rejectListen(u,a),i.Ea.delete(u),i.ma.removeTarget(u))})}(n,e)}catch(r){O(tn,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield _s(n,r)}else if(e instanceof wn?n.ma.Xe(e):e instanceof os?n.ma.ot(e):n.ma.nt(e),!t.isEqual(q.min()))try{let r=yield Tp(n.localStore);t.compareTo(r)>=0&&(yield function(o,a){let u=o.ma.It(a);return u.targetChanges.forEach((h,d)=>{if(h.resumeToken.approximateByteSize()>0){let p=o.Ea.get(d);p&&o.Ea.set(d,p.withResumeToken(h.resumeToken,a))}}),u.targetMismatches.forEach((h,d)=>{let p=o.Ea.get(h);if(!p)return;o.Ea.set(h,p.withResumeToken(ye.EMPTY_BYTE_STRING,p.snapshotVersion)),bp(o,h);let v=new Mr(p.target,h,d,p.sequenceNumber);Ou(o,v)}),o.remoteSyncer.applyRemoteEvent(u)}(n,t))}catch(r){O(tn,"Failed to raise snapshot:",r),yield _s(n,r)}})}function _s(n,e,t){return y(this,null,function*(){if(!qn(e))throw e;n.da.add(1),yield zr(n),n.Va.set("Offline"),t||(t=()=>Tp(n.localStore)),n.asyncQueue.enqueueRetryable(()=>y(null,null,function*(){O(tn,"Retrying IndexedDB access"),yield t(),n.da.delete(1),yield Vs(n)}))})}function Rp(n,e){return e().catch(t=>_s(n,t,e))}function Ls(n){return y(this,null,function*(){let e=B(n),t=kt(e),r=e.Ia.length>0?e.Ia[e.Ia.length-1].batchId:Eu;for(;CE(e);)try{let i=yield EE(e.localStore,r);if(i===null){e.Ia.length===0&&t.k_();break}r=i.batchId,kE(e,i)}catch(i){yield _s(e,i)}Pp(e)&&Cp(e)})}function CE(n){return rn(n)&&n.Ia.length<10}function kE(n,e){n.Ia.push(e);let t=kt(n);t.N_()&&t.ea&&t.ta(e.mutations)}function Pp(n){return rn(n)&&!kt(n).O_()&&n.Ia.length>0}function Cp(n){kt(n).start()}function DE(n){return y(this,null,function*(){kt(n).ia()})}function NE(n){return y(this,null,function*(){let e=kt(n);for(let t of n.Ia)e.ta(t.mutations)})}function OE(n,e,t){return y(this,null,function*(){let r=n.Ia.shift(),i=uc.from(r,e,t);yield Rp(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Ls(n)})}function xE(n,e){return y(this,null,function*(){e&&kt(n).ea&&(yield function(r,i){return y(this,null,function*(){if(function(a){return QI(a)&&a!==C.ABORTED}(i.code)){let o=r.Ia.shift();kt(r).L_(),yield Rp(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i)),yield Ls(r)}})}(n,e)),Pp(n)&&Cp(n)})}function hf(n,e){return y(this,null,function*(){let t=B(n);t.asyncQueue.verifyOperationInProgress(),O(tn,"RemoteStore received new credentials");let r=rn(t);t.da.add(3),yield zr(t),r&&t.Va.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.da.delete(3),yield Vs(t)})}function VE(n,e){return y(this,null,function*(){let t=B(n);e?(t.da.delete(2),yield Vs(t)):e||(t.da.add(2),yield zr(t),t.Va.set("Unknown"))})}function $n(n){return n.fa||(n.fa=function(t,r,i){let o=B(t);return o.oa(),new Hc(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(n.datastore,n.asyncQueue,{e_:bE.bind(null,n),n_:SE.bind(null,n),i_:RE.bind(null,n),Y_:PE.bind(null,n)}),n.Aa.push(e=>y(null,null,function*(){e?(n.fa.L_(),Vu(n)?xu(n):n.Va.set("Unknown")):(yield n.fa.stop(),Sp(n))}))),n.fa}function kt(n){return n.ga||(n.ga=function(t,r,i){let o=B(t);return o.oa(),new Qc(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(n.datastore,n.asyncQueue,{e_:()=>Promise.resolve(),n_:DE.bind(null,n),i_:xE.bind(null,n),na:NE.bind(null,n),ra:OE.bind(null,n)}),n.Aa.push(e=>y(null,null,function*(){e?(n.ga.L_(),yield Ls(n)):(yield n.ga.stop(),n.Ia.length>0&&(O(tn,`Stopping write stream with ${n.Ia.length} pending writes`),n.Ia=[]))}))),n.ga}var eu=class n{constructor(e,t,r,i,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new st,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,o){let a=Date.now()+r,u=new n(e,t,a,i,o);return u.start(r),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new V(C.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Lu(n,e){if(ot("AsyncQueue",`${e}: ${n}`),qn(n))return new V(C.UNAVAILABLE,`${e}: ${n}`);throw n}var ys=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||M.comparator(t.key,r.key):(t,r)=>M.comparator(t.key,r.key),this.keyedMap=Sr(),this.sortedSet=new ie(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var vs=class{constructor(){this.pa=new ie(M.comparator)}track(e){let t=e.doc.key,r=this.pa.get(t);r?e.type!==0&&r.type===3?this.pa=this.pa.insert(t,e):e.type===3&&r.type!==1?this.pa=this.pa.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.pa=this.pa.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.pa=this.pa.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.pa=this.pa.remove(t):e.type===1&&r.type===2?this.pa=this.pa.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.pa=this.pa.insert(t,{type:2,doc:e.doc}):L(63341,{Vt:e,ya:r}):this.pa=this.pa.insert(t,e)}wa(){let e=[];return this.pa.inorderTraversal((t,r)=>{e.push(r)}),e}},Ln=class n{constructor(e,t,r,i,o,a,u,h,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,i,o){let a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new n(e,t,ys.emptySet(t),a,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ns(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var tu=class{constructor(){this.ba=void 0,this.Sa=[]}Da(){return this.Sa.some(e=>e.va())}},nu=class{constructor(){this.queries=df(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){let i=B(t),o=i.queries;i.queries=df(),o.forEach((a,u)=>{for(let h of u.Sa)h.onError(r)})})(this,new V(C.ABORTED,"Firestore shutting down"))}};function df(){return new ut(n=>tp(n),Ns)}function LE(n,e){return y(this,null,function*(){let t=B(n),r=3,i=e.query,o=t.queries.get(i);o?!o.Da()&&e.va()&&(r=2):(o=new tu,r=e.va()?0:1);try{switch(r){case 0:o.ba=yield t.onListen(i,!0);break;case 1:o.ba=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){let u=Lu(a,`Initialization of query '${yn(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,o),o.Sa.push(e),e.Fa(t.onlineState),o.ba&&e.Ma(o.ba)&&Mu(t)})}function ME(n,e){return y(this,null,function*(){let t=B(n),r=e.query,i=3,o=t.queries.get(r);if(o){let a=o.Sa.indexOf(e);a>=0&&(o.Sa.splice(a,1),o.Sa.length===0?i=e.va()?0:1:!o.Da()&&e.va()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function FE(n,e){let t=B(n),r=!1;for(let i of e){let o=i.query,a=t.queries.get(o);if(a){for(let u of a.Sa)u.Ma(i)&&(r=!0);a.ba=i}}r&&Mu(t)}function UE(n,e,t){let r=B(n),i=r.queries.get(e);if(i)for(let o of i.Sa)o.onError(t);r.queries.delete(e)}function Mu(n){n.Ca.forEach(e=>{e.next()})}var ru,ff;(ff=ru||(ru={})).xa="default",ff.Cache="cache";var iu=class{constructor(e,t,r){this.query=e,this.Oa=t,this.Na=!1,this.Ba=null,this.onlineState="Unknown",this.options=r||{}}Ma(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Ln(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Na?this.La(e)&&(this.Oa.next(e),t=!0):this.ka(e,this.onlineState)&&(this.qa(e),t=!0),this.Ba=e,t}onError(e){this.Oa.error(e)}Fa(e){this.onlineState=e;let t=!1;return this.Ba&&!this.Na&&this.ka(this.Ba,e)&&(this.qa(this.Ba),t=!0),t}ka(e,t){if(!e.fromCache||!this.va())return!0;let r=t!=="Offline";return(!this.options.Qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}La(e){if(e.docChanges.length>0)return!0;let t=this.Ba&&this.Ba.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}qa(e){e=Ln.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Na=!0,this.Oa.next(e)}va(){return this.options.source!==ru.Cache}};var Is=class{constructor(e){this.key=e}},Es=class{constructor(e){this.key=e}},su=class{constructor(e,t){this.query=e,this.Ha=t,this.Ja=null,this.hasCachedResults=!1,this.current=!1,this.Ya=G(),this.mutatedKeys=G(),this.Za=np(e),this.Xa=new ys(this.Za)}get eu(){return this.Ha}tu(e,t){let r=t?t.nu:new vs,i=t?t.Xa:this.Xa,o=t?t.mutatedKeys:this.mutatedKeys,a=i,u=!1,h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((p,v)=>{let E=i.get(p),R=Os(this.query,v)?v:null,N=!!E&&this.mutatedKeys.has(E.key),x=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),k=!1;E&&R?E.data.isEqual(R.data)?N!==x&&(r.track({type:3,doc:R}),k=!0):this.ru(E,R)||(r.track({type:2,doc:R}),k=!0,(h&&this.Za(R,h)>0||d&&this.Za(R,d)<0)&&(u=!0)):!E&&R?(r.track({type:0,doc:R}),k=!0):E&&!R&&(r.track({type:1,doc:E}),k=!0,(h||d)&&(u=!0)),k&&(R?(a=a.add(R),o=x?o.add(p):o.delete(p)):(a=a.delete(p),o=o.delete(p)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{Xa:a,nu:r,Cs:u,mutatedKeys:o}}ru(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let o=this.Xa;this.Xa=e.Xa,this.mutatedKeys=e.mutatedKeys;let a=e.nu.wa();a.sort((p,v)=>function(R,N){let x=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L(20277,{Vt:k})}};return x(R)-x(N)}(p.type,v.type)||this.Za(p.doc,v.doc)),this.iu(r),i=i!=null&&i;let u=t&&!i?this.su():[],h=this.Ya.size===0&&this.current&&!i?1:0,d=h!==this.Ja;return this.Ja=h,a.length!==0||d?{snapshot:new Ln(this.query,e.Xa,o,a,e.mutatedKeys,h===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),ou:u}:{ou:u}}Fa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Xa:this.Xa,nu:new vs,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{ou:[]}}_u(e){return!this.Ha.has(e)&&!!this.Xa.has(e)&&!this.Xa.get(e).hasLocalMutations}iu(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}su(){if(!this.current)return[];let e=this.Ya;this.Ya=G(),this.Xa.forEach(r=>{this._u(r.key)&&(this.Ya=this.Ya.add(r.key))});let t=[];return e.forEach(r=>{this.Ya.has(r)||t.push(new Es(r))}),this.Ya.forEach(r=>{e.has(r)||t.push(new Is(r))}),t}au(e){this.Ha=e.$s,this.Ya=G();let t=this.tu(e.documents);return this.applyChanges(t,!0)}uu(){return Ln.fromInitialDocuments(this.query,this.Xa,this.mutatedKeys,this.Ja===0,this.hasCachedResults)}},Fu="SyncEngine",ou=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},au=class{constructor(e){this.key=e,this.cu=!1}},cu=class{constructor(e,t,r,i,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.lu={},this.hu=new ut(u=>tp(u),Ns),this.Pu=new Map,this.Tu=new Set,this.Iu=new ie(M.comparator),this.Eu=new Map,this.du=new Ur,this.Au={},this.Ru=new Map,this.Vu=Fr.lr(),this.onlineState="Unknown",this.mu=void 0}get isPrimaryClient(){return this.mu===!0}};function BE(n,e,t=!0){return y(this,null,function*(){let r=Vp(n),i,o=r.hu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.uu()):i=yield kp(r,e,t,!0),i})}function qE(n,e){return y(this,null,function*(){let t=Vp(n);yield kp(t,e,!0,!1)})}function kp(n,e,t,r){return y(this,null,function*(){let i=yield wE(n.localStore,We(e)),o=i.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t),u;return r&&(u=yield $E(n,e,o,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&Ap(n.remoteStore,i),u})}function $E(n,e,t,r,i){return y(this,null,function*(){n.fu=(v,E,R)=>function(x,k,$,U){return y(this,null,function*(){let j=k.view.tu($);j.Cs&&(j=yield cf(x.localStore,k.query,!1).then(({documents:w})=>k.view.tu(w,j)));let J=U&&U.targetChanges.get(k.targetId),ve=U&&U.targetMismatches.get(k.targetId)!=null,Y=k.view.applyChanges(j,x.isPrimaryClient,J,ve);return mf(x,k.targetId,Y.ou),Y.snapshot})}(n,v,E,R);let o=yield cf(n.localStore,e,!0),a=new su(e,o.$s),u=a.tu(o.documents),h=Lr.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),d=a.applyChanges(u,n.isPrimaryClient,h);mf(n,t,d.ou);let p=new ou(e,t,a);return n.hu.set(e,p),n.Pu.has(t)?n.Pu.get(t).push(e):n.Pu.set(t,[e]),d.snapshot})}function jE(n,e,t){return y(this,null,function*(){let r=B(n),i=r.hu.get(e),o=r.Pu.get(i.targetId);if(o.length>1)return r.Pu.set(i.targetId,o.filter(a=>!Ns(a,e))),void r.hu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield qc(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Nu(r.remoteStore,i.targetId),uu(r,i.targetId)}).catch(Bn))):(uu(r,i.targetId),yield qc(r.localStore,i.targetId,!0))})}function zE(n,e){return y(this,null,function*(){let t=B(n),r=t.hu.get(e),i=t.Pu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Nu(t.remoteStore,r.targetId))})}function WE(n,e,t){return y(this,null,function*(){let r=XE(n);try{let i=yield function(a,u){let h=B(a),d=de.now(),p=u.reduce((R,N)=>R.add(N.key),G()),v,E;return h.persistence.runTransaction("Locally write mutations","readwrite",R=>{let N=lt(),x=G();return h.Bs.getEntries(R,p).next(k=>{N=k,N.forEach(($,U)=>{U.isValidDocument()||(x=x.add($))})}).next(()=>h.localDocuments.getOverlayedDocuments(R,N)).next(k=>{v=k;let $=[];for(let U of u){let j=HI(U,v.get(U.key).overlayedDocument);j!=null&&$.push(new ht(U.key,j,Qf(j.value.mapValue),Qt.exists(!0)))}return h.mutationQueue.addMutationBatch(R,d,$,u)}).next(k=>{E=k;let $=k.applyToLocalDocumentSet(v,x);return h.documentOverlayCache.saveOverlays(R,k.batchId,$)})}).then(()=>({batchId:E.batchId,changes:ip(v)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(a,u,h){let d=a.Au[a.currentUser.toKey()];d||(d=new ie(z)),d=d.insert(u,h),a.Au[a.currentUser.toKey()]=d}(r,i.batchId,t),yield Wr(r,i.changes),yield Ls(r.remoteStore)}catch(i){let o=Lu(i,"Failed to persist write");t.reject(o)}})}function Dp(n,e){return y(this,null,function*(){let t=B(n);try{let r=yield vE(t.localStore,e);e.targetChanges.forEach((i,o)=>{let a=t.Eu.get(o);a&&(Q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.cu=!0:i.modifiedDocuments.size>0?Q(a.cu,14607):i.removedDocuments.size>0&&(Q(a.cu,42227),a.cu=!1))}),yield Wr(t,r,e)}catch(r){yield Bn(r)}})}function pf(n,e,t){let r=B(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.hu.forEach((o,a)=>{let u=a.view.Fa(e);u.snapshot&&i.push(u.snapshot)}),function(a,u){let h=B(a);h.onlineState=u;let d=!1;h.queries.forEach((p,v)=>{for(let E of v.Sa)E.Fa(u)&&(d=!0)}),d&&Mu(h)}(r.eventManager,e),i.length&&r.lu.Y_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function GE(n,e,t){return y(this,null,function*(){let r=B(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Eu.get(e),o=i&&i.key;if(o){let a=new ie(M.comparator);a=a.insert(o,Me.newNoDocument(o,q.min()));let u=G().add(o),h=new ss(q.min(),new Map,new ie(z),a,u);yield Dp(r,h),r.Iu=r.Iu.remove(o),r.Eu.delete(e),Uu(r)}else yield qc(r.localStore,e,!1).then(()=>uu(r,e,t)).catch(Bn)})}function KE(n,e){return y(this,null,function*(){let t=B(n),r=e.batch.batchId;try{let i=yield yE(t.localStore,e);Op(t,r,null),Np(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Wr(t,i)}catch(i){yield Bn(i)}})}function HE(n,e,t){return y(this,null,function*(){let r=B(n);try{let i=yield function(a,u){let h=B(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let p;return h.mutationQueue.lookupMutationBatch(d,u).next(v=>(Q(v!==null,37113),p=v.keys(),h.mutationQueue.removeMutationBatch(d,v))).next(()=>h.mutationQueue.performConsistencyCheck(d)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(d,p,u)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p)).next(()=>h.localDocuments.getDocuments(d,p))})}(r.localStore,e);Op(r,e,t),Np(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Wr(r,i)}catch(i){yield Bn(i)}})}function Np(n,e){(n.Ru.get(e)||[]).forEach(t=>{t.resolve()}),n.Ru.delete(e)}function Op(n,e,t){let r=B(n),i=r.Au[r.currentUser.toKey()];if(i){let o=i.get(e);o&&(t?o.reject(t):o.resolve(),i=i.remove(e)),r.Au[r.currentUser.toKey()]=i}}function uu(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Pu.get(e))n.hu.delete(r),t&&n.lu.gu(r,t);n.Pu.delete(e),n.isPrimaryClient&&n.du.Hr(e).forEach(r=>{n.du.containsKey(r)||xp(n,r)})}function xp(n,e){n.Tu.delete(e.path.canonicalString());let t=n.Iu.get(e);t!==null&&(Nu(n.remoteStore,t),n.Iu=n.Iu.remove(e),n.Eu.delete(t),Uu(n))}function mf(n,e,t){for(let r of t)r instanceof Is?(n.du.addReference(r.key,e),QE(n,r)):r instanceof Es?(O(Fu,"Document no longer in limbo: "+r.key),n.du.removeReference(r.key,e),n.du.containsKey(r.key)||xp(n,r.key)):L(19791,{pu:r})}function QE(n,e){let t=e.key,r=t.path.canonicalString();n.Iu.get(t)||n.Tu.has(r)||(O(Fu,"New document in limbo: "+t),n.Tu.add(r),Uu(n))}function Uu(n){for(;n.Tu.size>0&&n.Iu.size<n.maxConcurrentLimboResolutions;){let e=n.Tu.values().next().value;n.Tu.delete(e);let t=new M(re.fromString(e)),r=n.Vu.next();n.Eu.set(r,new au(t)),n.Iu=n.Iu.insert(t,r),Ap(n.remoteStore,new Mr(We(Pu(t.path)),r,"TargetPurposeLimboResolution",Iu.le))}}function Wr(n,e,t){return y(this,null,function*(){let r=B(n),i=[],o=[],a=[];r.hu.isEmpty()||(r.hu.forEach((u,h)=>{a.push(r.fu(h,e,t).then(d=>{var p;if((d||t)&&r.isPrimaryClient){let v=d?!d.fromCache:(p=t?.targetChanges.get(h.targetId))===null||p===void 0?void 0:p.current;r.sharedClientState.updateQueryState(h.targetId,v?"current":"not-current")}if(d){i.push(d);let v=Mc.Rs(h.targetId,d);o.push(v)}}))}),yield Promise.all(a),r.lu.Y_(i),yield function(h,d){return y(this,null,function*(){let p=B(h);try{yield p.persistence.runTransaction("notifyLocalViewChanges","readwrite",v=>P.forEach(d,E=>P.forEach(E.ds,R=>p.persistence.referenceDelegate.addReference(v,E.targetId,R)).next(()=>P.forEach(E.As,R=>p.persistence.referenceDelegate.removeReference(v,E.targetId,R)))))}catch(v){if(!qn(v))throw v;O(Du,"Failed to update sequence numbers: "+v)}for(let v of d){let E=v.targetId;if(!v.fromCache){let R=p.xs.get(E),N=R.snapshotVersion,x=R.withLastLimboFreeSnapshotVersion(N);p.xs=p.xs.insert(E,x)}}})}(r.localStore,o))})}function YE(n,e){return y(this,null,function*(){let t=B(n);if(!t.currentUser.isEqual(e)){O(Fu,"User change. New user:",e.toKey());let r=yield wp(t.localStore,e);t.currentUser=e,function(o,a){o.Ru.forEach(u=>{u.forEach(h=>{h.reject(new V(C.CANCELLED,a))})}),o.Ru.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Wr(t,r.ks)}})}function JE(n,e){let t=B(n),r=t.Eu.get(e);if(r&&r.cu)return G().add(r.key);{let i=G(),o=t.Pu.get(e);if(!o)return i;for(let a of o){let u=t.hu.get(a);i=i.unionWith(u.view.eu)}return i}}function Vp(n){let e=B(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Dp.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=JE.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=GE.bind(null,e),e.lu.Y_=FE.bind(null,e.eventManager),e.lu.gu=UE.bind(null,e.eventManager),e}function XE(n){let e=B(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=KE.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=HE.bind(null,e),e}var Lp=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return y(this,null,function*(){this.serializer=xs(t.databaseInfo.databaseId),this.sharedClientState=this.bu(t),this.persistence=this.Su(t),yield this.persistence.start(),this.localStore=this.Du(t),this.gcScheduler=this.vu(t,this.localStore),this.indexBackfillerScheduler=this.Cu(t,this.localStore)})}vu(t,r){return null}Cu(t,r){return null}Du(t){return _E(this.persistence,new Uc,t.initialUser,this.serializer)}Su(t){return new hs(Lc.fi,this.serializer)}bu(t){return new $c}terminate(){return y(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),lu=class extends Lp{constructor(e){super(),this.cacheSizeBytes=e}vu(e,t){Q(this.persistence.referenceDelegate instanceof ds,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new Tc(r,e.asyncQueue,t)}Su(e){let t=this.cacheSizeBytes!==void 0?ke.withCacheSize(this.cacheSizeBytes):ke.DEFAULT;return new hs(r=>ds.fi(r,t),this.serializer)}};var ZE=(()=>{class n{initialize(t,r){return y(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>pf(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=YE.bind(null,this.syncEngine),yield VE(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new nu}()}createDatastore(t){let r=xs(t.databaseInfo.databaseId),i=function(a){return new Kc(a)}(t.databaseInfo);return function(a,u,h,d){return new Jc(a,u,h,d)}(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return function(i,o,a,u,h){return new Zc(i,o,a,u,h)}(this.localStore,this.datastore,t.asyncQueue,r=>pf(this.syncEngine,r,0),function(){return ps.C()?new ps:new jc}())}createSyncEngine(t,r){return function(o,a,u,h,d,p,v){let E=new cu(o,a,u,h,d,p);return v&&(E.mu=!0),E}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return y(this,null,function*(){var t,r;yield function(o){return y(this,null,function*(){let a=B(o);O(tn,"RemoteStore shutting down."),a.da.add(5),yield zr(a),a.Ra.shutdown(),a.Va.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();var hu=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Mu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Mu(this.observer.error,e):ot("Uncaught Error in snapshot listener:",e.toString()))}xu(){this.muted=!0}Mu(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var Dt="FirestoreClient",du=class{constructor(e,t,r,i,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=ue.UNAUTHENTICATED,this.clientId=Ji.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,a=>y(this,null,function*(){O(Dt,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,a=>(O(Dt,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new st;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>y(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Lu(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function La(n,e){return y(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),O(Dt,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>y(null,null,function*(){r.isEqual(i)||(yield wp(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function gf(n,e){return y(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield ew(n);O(Dt,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>hf(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>hf(e.remoteStore,i)),n._onlineComponents=e})}function ew(n){return y(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){O(Dt,"Using user provided OfflineComponentProvider");try{yield La(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===C.FAILED_PRECONDITION||i.code===C.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;An("Error using user provided cache. Falling back to memory cache: "+t),yield La(n,new Lp)}}else O(Dt,"Using default OfflineComponentProvider"),yield La(n,new lu(void 0));return n._offlineComponents})}function Mp(n){return y(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(O(Dt,"Using user provided OnlineComponentProvider"),yield gf(n,n._uninitializedComponentsProvider._online)):(O(Dt,"Using default OnlineComponentProvider"),yield gf(n,new ZE))),n._onlineComponents})}function tw(n){return Mp(n).then(e=>e.syncEngine)}function _f(n){return y(this,null,function*(){let e=yield Mp(n),t=e.eventManager;return t.onListen=BE.bind(null,e.syncEngine),t.onUnlisten=jE.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=qE.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=zE.bind(null,e.syncEngine),t})}function Fp(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var yf=new Map;function Up(n,e,t){if(!t)throw new V(C.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function nw(n,e,t,r){if(e===!0&&r===!0)throw new V(C.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function vf(n){if(!M.isDocumentKey(n))throw new V(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function If(n){if(M.isDocumentKey(n))throw new V(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Bu(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":L(12329,{type:typeof n})}function Dr(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new V(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Bu(n);throw new V(C.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}var Bp="firestore.googleapis.com",Ef=!0,ws=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new V(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Bp,this.ssl=Ef}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:Ef;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Ep;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<pE)throw new V(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}nw("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Fp((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new V(C.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new V(C.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new V(C.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Mn=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ws({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new V(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new V(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ws(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Ma;switch(r.type){case"firstParty":return new qa(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new V(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return y(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=yf.get(t);r&&(O("ComponentProvider","Removing Datastore"),yf.delete(t),r.terminate())}(this),Promise.resolve()}};function qp(n,e,t,r={}){var i;n=Dr(n,Mn);let o=yt(e),a=n._getSettings(),u=Object.assign(Object.assign({},a),{emulatorOptions:n._getEmulatorOptions()}),h=`${e}:${t}`;o&&(gi(`https://${h}`),_i("Firestore",!0)),a.host!==Bp&&a.host!==h&&An("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let d=Object.assign(Object.assign({},a),{host:h,ssl:o,emulatorOptions:r});if(!Ue(d,u)&&(n._setSettings(d),r.mockUserToken)){let p,v;if(typeof r.mockUserToken=="string")p=r.mockUserToken,v=ue.MOCK_USER;else{p=ah(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let E=r.mockUserToken.sub||r.mockUserToken.user_id;if(!E)throw new V(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");v=new ue(E)}n._authCredentials=new Fa(new Qi(p,v))}}var Ts=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},De=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Pt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Pt=class n extends Ts{constructor(e,t,r){super(e,t,Pu(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new De(this.firestore,null,new M(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function $p(n,e,...t){if(n=we(n),Up("collection","path",e),n instanceof Mn){let r=re.fromString(e,...t);return If(r),new Pt(n,null,r)}{if(!(n instanceof De||n instanceof Pt))throw new V(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(re.fromString(e,...t));return If(r),new Pt(n.firestore,null,r)}}function qu(n,e,...t){if(n=we(n),arguments.length===1&&(e=Ji.newId()),Up("doc","path",e),n instanceof Mn){let r=re.fromString(e,...t);return vf(r),new De(n,null,new M(r))}{if(!(n instanceof De||n instanceof Pt))throw new V(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(re.fromString(e,...t));return vf(r),new De(n.firestore,n instanceof Pt?n.converter:null,new M(r))}}var wf="AsyncQueue",As=class{constructor(e=Promise.resolve()){this.Ju=[],this.Yu=!1,this.Zu=[],this.Xu=null,this.ec=!1,this.tc=!1,this.nc=[],this.x_=new ms(this,"async_queue_retry"),this.rc=()=>{let r=Va();r&&O(wf,"Visibility state changed to "+r.visibilityState),this.x_.b_()},this.sc=e;let t=Va();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.rc)}get isShuttingDown(){return this.Yu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.oc(),this._c(e)}enterRestrictedMode(e){if(!this.Yu){this.Yu=!0,this.tc=e||!1;let t=Va();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.rc)}}enqueue(e){if(this.oc(),this.Yu)return new Promise(()=>{});let t=new st;return this._c(()=>this.Yu&&this.tc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ju.push(e),this.ac()))}ac(){return y(this,null,function*(){if(this.Ju.length!==0){try{yield this.Ju[0](),this.Ju.shift(),this.x_.reset()}catch(e){if(!qn(e))throw e;O(wf,"Operation failed with retryable error: "+e)}this.Ju.length>0&&this.x_.y_(()=>this.ac())}})}_c(e){let t=this.sc.then(()=>(this.ec=!0,e().catch(r=>{throw this.Xu=r,this.ec=!1,ot("INTERNAL UNHANDLED ERROR: ",Tf(r)),r}).then(r=>(this.ec=!1,r))));return this.sc=t,t}enqueueAfterDelay(e,t,r){this.oc(),this.nc.indexOf(e)>-1&&(t=0);let i=eu.createAndSchedule(this,e,t,r,o=>this.uc(o));return this.Zu.push(i),i}oc(){this.Xu&&L(47125,{cc:Tf(this.Xu)})}verifyOperationInProgress(){}lc(){return y(this,null,function*(){let e;do e=this.sc,yield e;while(e!==this.sc)})}hc(e){for(let t of this.Zu)if(t.timerId===e)return!0;return!1}Pc(e){return this.lc().then(()=>{this.Zu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.Zu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.lc()})}Tc(e){this.nc.push(e)}uc(e){let t=this.Zu.indexOf(e);this.Zu.splice(t,1)}};function Tf(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function Af(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let o of r)if(o in i&&typeof i[o]=="function")return!0;return!1}(n,["next","error","complete"])}var Fn=class extends Mn{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new As,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return y(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new As(e),this._firestoreClient=void 0,yield e}})}};function jp(n,e){let t=typeof n=="object"?n:Ut(),r=typeof n=="string"?n:e||ts,i=hn(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let o=oh("firestore");o&&qp(i,...o)}return i}function zp(n){if(n._terminated)throw new V(C.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||rw(n),n._firestoreClient}function rw(n){var e,t,r;let i=n._freezeSettings(),o=function(u,h,d,p){return new Ga(u,h,d,p.host,p.ssl,p.experimentalForceLongPolling,p.experimentalAutoDetectLongPolling,Fp(p.experimentalLongPollingOptions),p.useFetchStreams,p.isUsingEmulator)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new du(n._authCredentials,n._appCheckCredentials,n._queue,o,n._componentsProvider&&function(u){let h=u?._online.build();return{_offline:u?._offline.build(h),_online:h}}(n._componentsProvider))}var Br=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(ye.fromBase64String(e))}catch(t){throw new V(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(ye.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var qr=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new V(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Se(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var bs=class{constructor(e){this._methodName=e}};var $r=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new V(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new V(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return z(this._lat,e._lat)||z(this._long,e._long)}};var jr=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0}(this._values,e._values)}};var iw=/^__.*__$/,fu=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new ht(e,this.data,this.fieldMask,t,this.fieldTransforms):new en(e,this.data,t,this.fieldTransforms)}};function Wp(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L(40011,{Ic:n})}}var pu=class n{constructor(e,t,r,i,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Ec(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ic(){return this.settings.Ic}dc(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ac(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.dc({path:r,Rc:!1});return i.Vc(e),i}mc(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.dc({path:r,Rc:!1});return i.Ec(),i}fc(e){return this.dc({path:void 0,Rc:!0})}gc(e){return Ss(e,this.settings.methodName,this.settings.yc||!1,this.path,this.settings.wc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ec(){if(this.path)for(let e=0;e<this.path.length;e++)this.Vc(this.path.get(e))}Vc(e){if(e.length===0)throw this.gc("Document fields must not be empty");if(Wp(this.Ic)&&iw.test(e))throw this.gc('Document fields cannot begin and end with "__"')}},mu=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||xs(e)}bc(e,t,r,i=!1){return new pu({Ic:e,methodName:t,wc:r,path:Se.emptyPath(),Rc:!1,yc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function sw(n){let e=n._freezeSettings(),t=xs(n._databaseId);return new mu(n._databaseId,!!e.ignoreUndefinedProperties,t)}function ow(n,e,t,r,i,o={}){let a=n.bc(o.merge||o.mergeFields?2:0,e,t,i);Qp("Data must be an object, but it was:",a,r);let u=Kp(r,a),h,d;if(o.merge)h=new je(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){let p=[];for(let v of o.mergeFields){let E=aw(e,v,t);if(!a.contains(E))throw new V(C.INVALID_ARGUMENT,`Field '${E}' is specified in your field mask but missing from your input data.`);uw(p,E)||p.push(E)}h=new je(p),d=a.fieldTransforms.filter(v=>h.covers(v.field))}else h=null,d=a.fieldTransforms;return new fu(new Le(u),h,d)}function Gp(n,e){if(Hp(n=we(n)))return Qp("Unsupported field value:",e,n),Kp(n,e);if(n instanceof bs)return function(r,i){if(!Wp(i.Ic))throw i.gc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.gc(`${r._methodName}() is not currently supported inside arrays`);let o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Rc&&e.Ic!==4)throw e.gc("Nested arrays are not supported");return function(r,i){let o=[],a=0;for(let u of r){let h=Gp(u,i.fc(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}}(n,e)}return function(r,i){if((r=we(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return jI(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let o=de.fromDate(r);return{timestampValue:us(i.serializer,o)}}if(r instanceof de){let o=new de(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:us(i.serializer,o)}}if(r instanceof $r)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Br)return{bytesValue:pp(i.serializer,r._byteString)};if(r instanceof De){let o=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw i.gc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:ku(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof jr)return function(a,u){return{mapValue:{fields:{[Tu]:{stringValue:Au},[Sn]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw u.gc("VectorValues must only contain numeric values.");return Cu(u.serializer,d)})}}}}}}(r,i);throw i.gc(`Unsupported field value: ${Bu(r)}`)}(n,e)}function Kp(n,e){let t={};return qf(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):nn(n,(r,i)=>{let o=Gp(i,e.Ac(r));o!=null&&(t[r]=o)}),{mapValue:{fields:t}}}function Hp(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof de||n instanceof $r||n instanceof Br||n instanceof De||n instanceof bs||n instanceof jr)}function Qp(n,e,t){if(!Hp(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=Bu(t);throw r==="an object"?e.gc(n+" a custom object"):e.gc(n+" "+r)}}function aw(n,e,t){if((e=we(e))instanceof qr)return e._internalPath;if(typeof e=="string")return Yp(n,e);throw Ss("Field path arguments must be of type string or ",n,!1,void 0,t)}var cw=new RegExp("[~\\*/\\[\\]]");function Yp(n,e,t){if(e.search(cw)>=0)throw Ss(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new qr(...e.split("."))._internalPath}catch{throw Ss(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Ss(n,e,t,r,i){let o=r&&!r.isEmpty(),a=i!==void 0,u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${i}`),h+=")"),new V(C.INVALID_ARGUMENT,u+n+h)}function uw(n,e){return n.some(t=>t.isEqual(e))}var Rs=class{constructor(e,t,r,i,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new De(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new gu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Jp("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},gu=class extends Rs{data(){return super.data()}};function Jp(n,e){return typeof e=="string"?Yp(n,e):e instanceof qr?e._internalPath:e._delegate._internalPath}function lw(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new V(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var _u=class{convertValue(e,t="none"){switch(Ct(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ee(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ct(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw L(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return nn(e,(i,o)=>{r[i]=this.convertValue(o,t)}),r}convertVectorValue(e){var t,r,i;let o=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[Sn].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(a=>ee(a.doubleValue));return new jr(o)}convertGeoPoint(e){return new $r(ee(e.latitude),ee(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Ds(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(xr(e));default:return null}}convertTimestamp(e){let t=at(e);return new de(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=re.fromString(e);Q(Ip(r),9688,{name:e});let i=new ns(r.get(1),r.get(3)),o=new M(r.popFirst(5));return i.isEqual(t)||ot(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}};function hw(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var Ht=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Ps=class extends Rs{constructor(e,t,r,i,o,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Tn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(Jp("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Tn=class extends Ps{data(e={}){return super.data(e)}},yu=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Ht(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Tn(this._firestore,this._userDataWriter,r.key,r,new Ht(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new V(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,o){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let h=new Tn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Ht(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>o||u.type!==3).map(u=>{let h=new Tn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Ht(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,p=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),p=a.indexOf(u.doc.key)),{type:dw(u.type),doc:h,oldIndex:d,newIndex:p}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function dw(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L(61501,{type:n})}}var Cs=class extends _u{constructor(e){super(),this.firestore=e}convertBytes(e){return new Br(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new De(this.firestore,null,t)}};function Xp(n,e){let t=Dr(n.firestore,Fn),r=qu(n),i=hw(n.converter,e);return fw(t,[ow(sw(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Qt.exists(!1))]).then(()=>r)}function $u(n,...e){var t,r,i;n=we(n);let o={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||Af(e[a])||(o=e[a],a++);let u={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(Af(e[a])){let v=e[a];e[a]=(t=v.next)===null||t===void 0?void 0:t.bind(v),e[a+1]=(r=v.error)===null||r===void 0?void 0:r.bind(v),e[a+2]=(i=v.complete)===null||i===void 0?void 0:i.bind(v)}let h,d,p;if(n instanceof De)d=Dr(n.firestore,Fn),p=Pu(n._key.path),h={next:v=>{e[a]&&e[a](pw(d,n,v))},error:e[a+1],complete:e[a+2]};else{let v=Dr(n,Ts);d=Dr(v.firestore,Fn),p=v._query;let E=new Cs(d);h={next:R=>{e[a]&&e[a](new yu(d,E,v,R))},error:e[a+1],complete:e[a+2]},lw(n._query)}return function(E,R,N,x){let k=new hu(x),$=new iu(R,k,N);return E.asyncQueue.enqueueAndForget(()=>y(null,null,function*(){return LE(yield _f(E),$)})),()=>{k.xu(),E.asyncQueue.enqueueAndForget(()=>y(null,null,function*(){return ME(yield _f(E),$)}))}}(zp(d),p,u,h)}function fw(n,e){return function(r,i){let o=new st;return r.asyncQueue.enqueueAndForget(()=>y(null,null,function*(){return WE(yield tw(r),i,o)})),o.promise}(zp(n),e)}function pw(n,e,t){let r=t.docs.get(e._key),i=new Cs(n);return new Ps(n,i,e._key,r,new Ht(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(i){Un=i})(It),xe(new Te("firestore",(r,{instanceIdentifier:i,options:o})=>{let a=r.getProvider("app").getImmediate(),u=new Fn(new Ua(r.getProvider("auth-internal")),new $a(a,r.getProvider("app-check-internal")),function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new V(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ns(d.options.projectId,p)}(a,i),a);return o=Object.assign({useFetchStreams:t},o),u._setSettings(o),u},"PUBLIC").setMultipleInstances(!0)),ne(Od,xd,e),ne(Od,xd,"esm2017")})();var Ms=function(){return Ms=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},Ms.apply(this,arguments)};var _w={includeMetadataChanges:!1};function ju(n,e){return e===void 0&&(e=_w),new Lt(function(t){var r=$u(n,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:r}})}function Zp(n){return ju(n,{includeMetadataChanges:!0})}function em(n,e){return e===void 0&&(e={}),Zp(n).pipe(li(function(t){return zu(t,e)}))}function zu(n,e){var t;e===void 0&&(e={});var r=n.data(e);return!n.exists()||typeof r!="object"||r===null||!e.idField?r:Ms(Ms({},r),(t={},t[e.idField]=n.id,t))}function tm(n){return ju(n,{includeMetadataChanges:!0}).pipe(li(function(e){return e.docs}))}function nm(n,e){return e===void 0&&(e={}),tm(n).pipe(li(function(t){return t.map(function(r){return zu(r,e)})}))}var Gr=class{constructor(e){return e}},rm="firestore",Wu=class{constructor(){return fn(rm)}};var Gu=new un("angularfire2.firestore-instances");function yw(n,e){let t=pr(rm,n,e);return t&&new Gr(t)}function vw(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Gr(r)}}var Iw={provide:Wu,deps:[[new Re,Gu]]},Ew={provide:Gr,useFactory:yw,deps:[[new Re,Gu],et]};function z0(n,...e){return ne("angularfire",Et.full,"fst"),ln([Ew,Iw,{provide:Gu,useFactory:vw(n),multi:!0,deps:[Fe,_t,wt,qt,[new Re,Ar],[new Re,pn],...e]}])}var W0=Ce(nm,!0);var G0=Ce(em,!0);var K0=Ce(Xp,!0,2);var H0=Ce($p,!0,2);var Q0=Ce(qu,!0,2);var Y0=Ce(jp,!0);export{PT as a,CT as b,XA as c,ZA as d,Gr as e,z0 as f,W0 as g,G0 as h,K0 as i,H0 as j,Q0 as k,Y0 as l};
